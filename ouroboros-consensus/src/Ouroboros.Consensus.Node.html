<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE MonadComprehensions #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns      #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards     #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications    #-}</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- | Run the whole Node</span><span>
</span><span id="line-7"></span><span class="hs-comment">--</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Intended for qualified import.</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.Node</span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">DiffusionTracers</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">DiffusionArguments</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#run"><span class="hs-identifier">run</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Exposed by 'run'</span></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#RunNodeArgs"><span class="hs-identifier">RunNodeArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Run.html#RunNode"><span class="hs-identifier">RunNode</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Tracers.html#Tracers"><span class="hs-identifier">Tracers</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Tracers.html#Tracers%27"><span class="hs-identifier">Tracers'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html#TraceEvent"><span class="hs-identifier">ChainDB.TraceEvent</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.ProtocolInfo.html#ProtocolInfo"><span class="hs-identifier">ProtocolInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier">ChainDbArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeArgs"><span class="hs-identifier">NodeArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernel"><span class="hs-identifier">NodeKernel</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#MaxTxCapacityOverride"><span class="hs-identifier">MaxTxCapacityOverride</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Mempool.Impl.html#MempoolCapacityBytesOverride"><span class="hs-identifier">MempoolCapacityBytesOverride</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier">IPSubscriptionTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier">DnsSubscriptionTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier">ConnectionId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">RemoteConnectionId</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Internal helpers</span></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#openChainDB"><span class="hs-identifier">openChainDB</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#mkChainDbArgs"><span class="hs-identifier">mkChainDbArgs</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#mkNodeArgs"><span class="hs-identifier">mkNodeArgs</span></a></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#nodeArgsEnforceInvariants"><span class="hs-identifier">nodeArgsEnforceInvariants</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Codec.Serialise</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DeserialiseFailure</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/src"><span class="hs-identifier">Control.Tracer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/src"><span class="hs-identifier">Tracer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">contramap</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Functor.Identity</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Identity</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.Random</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">newStdGen</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">randomIO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">randomRIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.BlockFetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">BlockFetchConfiguration</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Diffusion</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.Magic</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.NodeToClient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">LocalConnectionId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>                     </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">NodeToClientVersionData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">Ouroboros.Network.NodeToNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">MiniProtocolParameters</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>                     </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">NodeToNodeVersionData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">RemoteConnectionId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>                     </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier">combineVersions</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier">defaultMiniProtocolParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier">Ouroboros.Network.Protocol.Limits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier">shortWait</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Block.html"><span class="hs-identifier">Ouroboros.Consensus.Block</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.BlockchainTime.html"><span class="hs-identifier">Ouroboros.Consensus.BlockchainTime</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#getSystemStart"><span class="hs-identifier">getSystemStart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Config.html"><span class="hs-identifier">Ouroboros.Consensus.Config</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Config.SupportsNode.html"><span class="hs-identifier">Ouroboros.Consensus.Config.SupportsNode</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Fragment.InFuture.html"><span class="hs-identifier">Ouroboros.Consensus.Fragment.InFuture</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Fragment.InFuture.html#CheckInFuture"><span class="hs-identifier">CheckInFuture</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>                     </span><span class="annot"><a href="Ouroboros.Consensus.Fragment.InFuture.html#ClockSkew"><span class="hs-identifier">ClockSkew</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Fragment.InFuture.html"><span class="hs-identifier">Ouroboros.Consensus.Fragment.InFuture</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">InFuture</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.Extended.html"><span class="hs-identifier">Ouroboros.Consensus.Ledger.Extended</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.Extended.html#ExtLedgerState"><span class="hs-identifier">ExtLedgerState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToClient.html"><span class="hs-identifier">Ouroboros.Consensus.Network.NodeToClient</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NTC</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html"><span class="hs-identifier">Ouroboros.Consensus.Network.NodeToNode</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NTN</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.DbLock.html"><span class="hs-identifier">Ouroboros.Consensus.Node.DbLock</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.DbMarker.html"><span class="hs-identifier">Ouroboros.Consensus.Node.DbMarker</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.ErrorPolicy.html"><span class="hs-identifier">Ouroboros.Consensus.Node.ErrorPolicy</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.InitStorage.html"><span class="hs-identifier">Ouroboros.Consensus.Node.InitStorage</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.NetworkProtocolVersion.html"><span class="hs-identifier">Ouroboros.Consensus.Node.NetworkProtocolVersion</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.ProtocolInfo.html"><span class="hs-identifier">Ouroboros.Consensus.Node.ProtocolInfo</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.Recovery.html"><span class="hs-identifier">Ouroboros.Consensus.Node.Recovery</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.Run.html"><span class="hs-identifier">Ouroboros.Consensus.Node.Run</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Node.Tracers.html"><span class="hs-identifier">Ouroboros.Consensus.Node.Tracers</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html"><span class="hs-identifier">Ouroboros.Consensus.NodeKernel</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.IOLike.html"><span class="hs-identifier">Ouroboros.Consensus.Util.IOLike</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.Orphans.html"><span class="hs-identifier">Ouroboros.Consensus.Util.Orphans</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.ResourceRegistry.html"><span class="hs-identifier">Ouroboros.Consensus.Util.ResourceRegistry</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.ChainDB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.API.html#ChainDB"><span class="hs-identifier">ChainDB</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier">ChainDbArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.ChainDB</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ChainDB</span></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Storage.FS.API.Types.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.FS.API.Types</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Storage.FS.IO.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.FS.IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.FS.IO.html#ioHasFS"><span class="hs-identifier">ioHasFS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Storage.ImmutableDB.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.ImmutableDB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.ImmutableDB.Chunks.Internal.html#ChunkInfo"><span class="hs-identifier">ChunkInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>                     </span><span class="annot"><a href="Ouroboros.Consensus.Storage.ImmutableDB.Impl.Types.html#ValidationPolicy"><span class="hs-identifier">ValidationPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Storage.LedgerDB.DiskPolicy.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.LedgerDB.DiskPolicy</span></a></span><span>
</span><span id="line-87"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.LedgerDB.DiskPolicy.html#defaultDiskPolicy"><span class="hs-identifier">defaultDiskPolicy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Storage.LedgerDB.InMemory.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.LedgerDB.InMemory</span></a></span><span>
</span><span id="line-89"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbDefaultParams"><span class="hs-identifier">ledgerDbDefaultParams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.VolatileDB</span></a></span><span>
</span><span id="line-91"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.Impl.Types.html#BlockValidationPolicy"><span class="hs-identifier">BlockValidationPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.VolatileDB.Impl.Types.html#mkBlocksPerFile"><span class="hs-identifier">mkBlocksPerFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">-- | Arguments required by 'runNode'</span><span>
</span><span id="line-94"></span><span class="hs-keyword">data</span><span> </span><span id="RunNodeArgs"><span class="annot"><a href="Ouroboros.Consensus.Node.html#RunNodeArgs"><span class="hs-identifier hs-var">RunNodeArgs</span></a></span></span><span> </span><span id="local-6989586621680040959"><span class="annot"><a href="#local-6989586621680040959"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RunNodeArgs"><span class="annot"><a href="Ouroboros.Consensus.Node.html#RunNodeArgs"><span class="hs-identifier hs-var">RunNodeArgs</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-95"></span><span>      </span><span class="hs-comment">-- | Consensus tracers</span><span>
</span><span id="line-96"></span><span>      </span><span id="rnTraceConsensus"><span class="annot"><span class="annottext">RunNodeArgs blk
-&gt; Tracers IO RemoteConnectionId LocalConnectionId blk
</span><a href="Ouroboros.Consensus.Node.html#rnTraceConsensus"><span class="hs-identifier hs-var hs-var">rnTraceConsensus</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Tracers.html#Tracers"><span class="hs-identifier hs-type">Tracers</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">RemoteConnectionId</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">LocalConnectionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040959"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>      </span><span class="hs-comment">-- | Protocol tracers for node-to-node communication</span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnTraceNTN"><span class="annot"><span class="annottext">RunNodeArgs blk
-&gt; Tracers IO RemoteConnectionId blk DeserialiseFailure
</span><a href="Ouroboros.Consensus.Node.html#rnTraceNTN"><span class="hs-identifier hs-var hs-var">rnTraceNTN</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Tracers"><span class="hs-identifier hs-type">NTN.Tracers</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">RemoteConnectionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040959"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeserialiseFailure</span></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>      </span><span class="hs-comment">-- | Protocol tracers for node-to-client communication</span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnTraceNTC"><span class="annot"><span class="annottext">RunNodeArgs blk
-&gt; Tracers IO LocalConnectionId blk DeserialiseFailure
</span><a href="Ouroboros.Consensus.Node.html#rnTraceNTC"><span class="hs-identifier hs-var hs-var">rnTraceNTC</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToClient.html#Tracers"><span class="hs-identifier hs-type">NTC.Tracers</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">LocalConnectionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040959"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeserialiseFailure</span></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span>      </span><span class="hs-comment">-- | ChainDB tracer</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnTraceDB"><span class="annot"><span class="annottext">RunNodeArgs blk -&gt; Tracer IO (TraceEvent blk)
</span><a href="Ouroboros.Consensus.Node.html#rnTraceDB"><span class="hs-identifier hs-var hs-var">rnTraceDB</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/src"><span class="hs-identifier hs-type">Tracer</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html#TraceEvent"><span class="hs-identifier hs-type">ChainDB.TraceEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040959"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>      </span><span class="hs-comment">-- | Diffusion tracers</span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnTraceDiffusion"><span class="annot"><span class="annottext">RunNodeArgs blk -&gt; DiffusionTracers
</span><a href="Ouroboros.Consensus.Node.html#rnTraceDiffusion"><span class="hs-identifier hs-var hs-var">rnTraceDiffusion</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">DiffusionTracers</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span>      </span><span class="hs-comment">-- | Diffusion arguments</span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnDiffusionArguments"><span class="annot"><span class="annottext">RunNodeArgs blk -&gt; DiffusionArguments
</span><a href="Ouroboros.Consensus.Node.html#rnDiffusionArguments"><span class="hs-identifier hs-var hs-var">rnDiffusionArguments</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">DiffusionArguments</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>      </span><span class="hs-comment">-- | Network magic</span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnNetworkMagic"><span class="annot"><span class="annottext">RunNodeArgs blk -&gt; NetworkMagic
</span><a href="Ouroboros.Consensus.Node.html#rnNetworkMagic"><span class="hs-identifier hs-var hs-var">rnNetworkMagic</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NetworkMagic</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>      </span><span class="hs-comment">-- | Database path</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnDatabasePath"><span class="annot"><span class="annottext">RunNodeArgs blk -&gt; FilePath
</span><a href="Ouroboros.Consensus.Node.html#rnDatabasePath"><span class="hs-identifier hs-var hs-var">rnDatabasePath</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>      </span><span class="hs-comment">-- | Protocol info</span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnProtocolInfo"><span class="annot"><span class="annottext">RunNodeArgs blk -&gt; ProtocolInfo IO blk
</span><a href="Ouroboros.Consensus.Node.html#rnProtocolInfo"><span class="hs-identifier hs-var hs-var">rnProtocolInfo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.ProtocolInfo.html#ProtocolInfo"><span class="hs-identifier hs-type">ProtocolInfo</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680040959"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span>      </span><span class="hs-comment">-- | Customise the 'ChainDbArgs'</span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnCustomiseChainDbArgs"><span class="annot"><span class="annottext">RunNodeArgs blk
-&gt; ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk
</span><a href="Ouroboros.Consensus.Node.html#rnCustomiseChainDbArgs"><span class="hs-identifier hs-var hs-var">rnCustomiseChainDbArgs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-type">ChainDbArgs</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Identity</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680040959"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-type">ChainDbArgs</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Identity</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680040959"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>      </span><span class="hs-comment">-- | Customise the 'NodeArgs'</span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnCustomiseNodeArgs"><span class="annot"><span class="annottext">RunNodeArgs blk
-&gt; NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; NodeArgs IO RemoteConnectionId LocalConnectionId blk
</span><a href="Ouroboros.Consensus.Node.html#rnCustomiseNodeArgs"><span class="hs-identifier hs-var hs-var">rnCustomiseNodeArgs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeArgs"><span class="hs-identifier hs-type">NodeArgs</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">RemoteConnectionId</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">LocalConnectionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040959"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-127"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeArgs"><span class="hs-identifier hs-type">NodeArgs</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">RemoteConnectionId</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">LocalConnectionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040959"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>      </span><span class="hs-comment">-- | node-to-node protocol versions to run.</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnNodeToNodeVersions"><span class="annot"><span class="annottext">RunNodeArgs blk
-&gt; Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
</span><a href="Ouroboros.Consensus.Node.html#rnNodeToNodeVersions"><span class="hs-identifier hs-var hs-var">rnNodeToNodeVersions</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Node.NetworkProtocolVersion.html#BlockNodeToNodeVersion"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040959"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>      </span><span class="hs-comment">-- | node-to-client protocol versions to run.</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnNodeToClientVersions"><span class="annot"><span class="annottext">RunNodeArgs blk
-&gt; Map NodeToClientVersion (BlockNodeToClientVersion blk)
</span><a href="Ouroboros.Consensus.Node.html#rnNodeToClientVersions"><span class="hs-identifier hs-var hs-var">rnNodeToClientVersions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToClientVersion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Node.NetworkProtocolVersion.html#BlockNodeToClientVersion"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040959"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>      </span><span class="hs-comment">-- | Hook called after the initialisation of the 'NodeKernel'</span><span>
</span><span id="line-136"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-137"></span><span>      </span><span class="hs-comment">-- Called on the 'NodeKernel' after creating it, but before the network</span><span>
</span><span id="line-138"></span><span>      </span><span class="hs-comment">-- layer is initialised.</span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnNodeKernelHook"><span class="annot"><span class="annottext">RunNodeArgs blk
-&gt; ResourceRegistry IO
-&gt; NodeKernel IO RemoteConnectionId LocalConnectionId blk
-&gt; IO ()
</span><a href="Ouroboros.Consensus.Node.html#rnNodeKernelHook"><span class="hs-identifier hs-var hs-var">rnNodeKernelHook</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.ResourceRegistry.html#ResourceRegistry"><span class="hs-identifier hs-type">ResourceRegistry</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span>
</span><span id="line-140"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernel"><span class="hs-identifier hs-type">NodeKernel</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">RemoteConnectionId</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">LocalConnectionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040959"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-141"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>      </span><span class="hs-comment">-- | Maximum clock skew.</span><span>
</span><span id="line-144"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-145"></span><span>      </span><span class="hs-comment">-- Use 'defaultClockSkew' when unsure.</span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="rnMaxClockSkew"><span class="annot"><span class="annottext">RunNodeArgs blk -&gt; ClockSkew
</span><a href="Ouroboros.Consensus.Node.html#rnMaxClockSkew"><span class="hs-identifier hs-var hs-var">rnMaxClockSkew</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Fragment.InFuture.html#ClockSkew"><span class="hs-identifier hs-type">ClockSkew</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-comment">-- | Start a node.</span><span>
</span><span id="line-150"></span><span class="hs-comment">--</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- This opens the 'ChainDB', sets up the 'NodeKernel' and initialises the</span><span>
</span><span id="line-152"></span><span class="hs-comment">-- network layer.</span><span>
</span><span id="line-153"></span><span class="hs-comment">--</span><span>
</span><span id="line-154"></span><span class="hs-comment">-- This function runs forever unless an exception is thrown.</span><span>
</span><span id="line-155"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#run"><span class="hs-identifier hs-type">run</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680040672"><span class="annot"><a href="#local-6989586621680040672"><span class="hs-identifier hs-type">blk</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Run.html#RunNode"><span class="hs-identifier hs-type">RunNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040672"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#RunNodeArgs"><span class="hs-identifier hs-type">RunNodeArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040672"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span id="run"><span class="annot"><span class="annottext">run :: RunNodeArgs blk -&gt; IO ()
</span><a href="Ouroboros.Consensus.Node.html#run"><span class="hs-identifier hs-var hs-var">run</span></a></span></span><span> </span><span id="local-6989586621680040671"><span class="annot"><span class="annottext">runargs :: RunNodeArgs blk
</span><a href="#local-6989586621680040671"><span class="hs-identifier hs-var">runargs</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Ouroboros.Consensus.Node.html#RunNodeArgs"><span class="hs-identifier hs-type">RunNodeArgs</span></a></span><span class="hs-special">{</span><span id="local-6989586621680040656"><span id="local-6989586621680040657"><span id="local-6989586621680040658"><span id="local-6989586621680040659"><span id="local-6989586621680040660"><span id="local-6989586621680040661"><span id="local-6989586621680040662"><span id="local-6989586621680040663"><span id="local-6989586621680040664"><span id="local-6989586621680040665"><span id="local-6989586621680040666"><span id="local-6989586621680040667"><span id="local-6989586621680040668"><span id="local-6989586621680040669"><span id="local-6989586621680040670"><span class="annot"><span class="annottext">FilePath
Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
Map NodeToClientVersion (BlockNodeToClientVersion blk)
Tracer IO (TraceEvent blk)
DiffusionTracers
DiffusionArguments
NetworkMagic
ProtocolInfo IO blk
ClockSkew
Tracers IO RemoteConnectionId LocalConnectionId blk
Tracers IO RemoteConnectionId blk DeserialiseFailure
Tracers IO LocalConnectionId blk DeserialiseFailure
ResourceRegistry IO
-&gt; NodeKernel IO RemoteConnectionId LocalConnectionId blk -&gt; IO ()
ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk
NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; NodeArgs IO RemoteConnectionId LocalConnectionId blk
rnMaxClockSkew :: ClockSkew
rnNodeKernelHook :: ResourceRegistry IO
-&gt; NodeKernel IO RemoteConnectionId LocalConnectionId blk -&gt; IO ()
rnNodeToClientVersions :: Map NodeToClientVersion (BlockNodeToClientVersion blk)
rnNodeToNodeVersions :: Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
rnCustomiseNodeArgs :: NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; NodeArgs IO RemoteConnectionId LocalConnectionId blk
rnCustomiseChainDbArgs :: ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk
rnProtocolInfo :: ProtocolInfo IO blk
rnDatabasePath :: FilePath
rnNetworkMagic :: NetworkMagic
rnDiffusionArguments :: DiffusionArguments
rnTraceDiffusion :: DiffusionTracers
rnTraceDB :: Tracer IO (TraceEvent blk)
rnTraceNTC :: Tracers IO LocalConnectionId blk DeserialiseFailure
rnTraceNTN :: Tracers IO RemoteConnectionId blk DeserialiseFailure
rnTraceConsensus :: Tracers IO RemoteConnectionId LocalConnectionId blk
rnMaxClockSkew :: forall blk. RunNodeArgs blk -&gt; ClockSkew
rnNodeKernelHook :: forall blk.
RunNodeArgs blk
-&gt; ResourceRegistry IO
-&gt; NodeKernel IO RemoteConnectionId LocalConnectionId blk
-&gt; IO ()
rnNodeToClientVersions :: forall blk.
RunNodeArgs blk
-&gt; Map NodeToClientVersion (BlockNodeToClientVersion blk)
rnNodeToNodeVersions :: forall blk.
RunNodeArgs blk
-&gt; Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
rnCustomiseNodeArgs :: forall blk.
RunNodeArgs blk
-&gt; NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; NodeArgs IO RemoteConnectionId LocalConnectionId blk
rnCustomiseChainDbArgs :: forall blk.
RunNodeArgs blk
-&gt; ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk
rnProtocolInfo :: forall blk. RunNodeArgs blk -&gt; ProtocolInfo IO blk
rnDatabasePath :: forall blk. RunNodeArgs blk -&gt; FilePath
rnNetworkMagic :: forall blk. RunNodeArgs blk -&gt; NetworkMagic
rnDiffusionArguments :: forall blk. RunNodeArgs blk -&gt; DiffusionArguments
rnTraceDiffusion :: forall blk. RunNodeArgs blk -&gt; DiffusionTracers
rnTraceDB :: forall blk. RunNodeArgs blk -&gt; Tracer IO (TraceEvent blk)
rnTraceNTC :: forall blk.
RunNodeArgs blk
-&gt; Tracers IO LocalConnectionId blk DeserialiseFailure
rnTraceNTN :: forall blk.
RunNodeArgs blk
-&gt; Tracers IO RemoteConnectionId blk DeserialiseFailure
rnTraceConsensus :: forall blk.
RunNodeArgs blk
-&gt; Tracers IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040656"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="annottext">RunNodeArgs blk -&gt; (Bool -&gt; IO ()) -&gt; IO ()
forall blk a.
RunNode blk =&gt;
RunNodeArgs blk -&gt; (Bool -&gt; IO a) -&gt; IO a
</span><a href="Ouroboros.Consensus.Node.html#withDBChecks"><span class="hs-identifier hs-var">withDBChecks</span></a></span><span> </span><span class="annot"><span class="annottext">RunNodeArgs blk
</span><a href="#local-6989586621680040671"><span class="hs-identifier hs-var">runargs</span></a></span><span> </span><span class="annot"><span class="annottext">((Bool -&gt; IO ()) -&gt; IO ()) -&gt; (Bool -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680040654"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680040654"><span class="hs-identifier hs-var">lastShutDownWasClean</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="annottext">(ResourceRegistry IO -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a.
(IOLike m, HasCallStack) =&gt;
(ResourceRegistry m -&gt; m a) -&gt; m a
</span><a href="Ouroboros.Consensus.Util.ResourceRegistry.html#withRegistry"><span class="hs-identifier hs-var">withRegistry</span></a></span><span> </span><span class="annot"><span class="annottext">((ResourceRegistry IO -&gt; IO ()) -&gt; IO ())
-&gt; (ResourceRegistry IO -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680040652"><span class="annot"><span class="annottext">ResourceRegistry IO
</span><a href="#local-6989586621680040652"><span class="hs-identifier hs-var">registry</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680040651"><span class="hs-identifier hs-type">systemStart</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#SystemStart"><span class="hs-identifier hs-type">SystemStart</span></a></span><span>
</span><span id="line-162"></span><span>          </span><span id="local-6989586621680040651"><span class="annot"><span class="annottext">systemStart :: SystemStart
</span><a href="#local-6989586621680040651"><span class="hs-identifier hs-var hs-var">systemStart</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockConfig blk -&gt; SystemStart
forall blk.
ConfigSupportsNode blk =&gt;
BlockConfig blk -&gt; SystemStart
</span><a href="Ouroboros.Consensus.Config.SupportsNode.html#getSystemStart"><span class="hs-identifier hs-var">getSystemStart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; BlockConfig blk
forall blk. TopLevelConfig blk -&gt; BlockConfig blk
</span><a href="Ouroboros.Consensus.Config.html#configBlock"><span class="hs-identifier hs-var">configBlock</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621680040648"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span>          </span><span class="annot"><a href="#local-6989586621680040647"><span class="hs-identifier hs-type">systemTime</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#SystemTime"><span class="hs-identifier hs-type">SystemTime</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span>
</span><span id="line-165"></span><span>          </span><span id="local-6989586621680040647"><span class="annot"><span class="annottext">systemTime :: SystemTime IO
</span><a href="#local-6989586621680040647"><span class="hs-identifier hs-var hs-var">systemTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SystemStart -&gt; Tracer IO TraceBlockchainTimeEvent -&gt; SystemTime IO
forall (m :: * -&gt; *).
(MonadTime m, MonadDelay m) =&gt;
SystemStart -&gt; Tracer m TraceBlockchainTimeEvent -&gt; SystemTime m
</span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Default.html#defaultSystemTime"><span class="hs-identifier hs-var">defaultSystemTime</span></a></span><span>
</span><span id="line-166"></span><span>                         </span><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621680040651"><span class="hs-identifier hs-var">systemStart</span></a></span><span>
</span><span id="line-167"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tracers IO RemoteConnectionId LocalConnectionId blk
-&gt; Tracer IO TraceBlockchainTimeEvent
forall remotePeer localPeer blk (f :: * -&gt; *).
Tracers' remotePeer localPeer blk f -&gt; f TraceBlockchainTimeEvent
</span><a href="Ouroboros.Consensus.Node.Tracers.html#blockchainTimeTracer"><span class="hs-identifier hs-var hs-var">blockchainTimeTracer</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040670"><span class="hs-identifier hs-var">rnTraceConsensus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>          </span><span class="annot"><a href="#local-6989586621680040644"><span class="hs-identifier hs-type">inFuture</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Fragment.InFuture.html#CheckInFuture"><span class="hs-identifier hs-type">CheckInFuture</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680040672"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-170"></span><span>          </span><span id="local-6989586621680040644"><span class="annot"><span class="annottext">inFuture :: CheckInFuture IO blk
</span><a href="#local-6989586621680040644"><span class="hs-identifier hs-var hs-var">inFuture</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerConfig blk
-&gt; ClockSkew -&gt; SystemTime IO -&gt; CheckInFuture IO blk
forall (m :: * -&gt; *) blk.
(Monad m, UpdateLedger blk, HasHardForkHistory blk) =&gt;
LedgerConfig blk
-&gt; ClockSkew -&gt; SystemTime m -&gt; CheckInFuture m blk
</span><a href="Ouroboros.Consensus.Fragment.InFuture.html#reference"><span class="hs-identifier hs-var">InFuture.reference</span></a></span><span>
</span><span id="line-171"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; LedgerConfig blk
forall blk. TopLevelConfig blk -&gt; LedgerConfig blk
</span><a href="Ouroboros.Consensus.Config.html#configLedger"><span class="hs-identifier hs-var">configLedger</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621680040648"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>                       </span><span class="annot"><span class="annottext">ClockSkew
</span><a href="#local-6989586621680040656"><span class="hs-identifier hs-var">rnMaxClockSkew</span></a></span><span>
</span><span id="line-173"></span><span>                       </span><span class="annot"><span class="annottext">SystemTime IO
</span><a href="#local-6989586621680040647"><span class="hs-identifier hs-var">systemTime</span></a></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680040641"><span class="annot"><span class="annottext">customiseChainDbArgs' :: ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk
</span><a href="#local-6989586621680040641"><span class="hs-identifier hs-var hs-var">customiseChainDbArgs'</span></a></span></span><span> </span><span id="local-6989586621680040640"><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk
</span><a href="#local-6989586621680040640"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-176"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680040654"><span class="hs-identifier hs-var">lastShutDownWasClean</span></a></span><span>
</span><span id="line-177"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk
</span><a href="#local-6989586621680040661"><span class="hs-identifier hs-var">rnCustomiseChainDbArgs</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk
</span><a href="#local-6989586621680040640"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-178"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-179"></span><span>              </span><span class="hs-comment">-- When the last shutdown was not clean, validate the complete</span><span>
</span><span id="line-180"></span><span>              </span><span class="hs-comment">-- ChainDB to detect and recover from any corruptions. This will</span><span>
</span><span id="line-181"></span><span>              </span><span class="hs-comment">-- override the default value /and/ the user-customised value of</span><span>
</span><span id="line-182"></span><span>              </span><span class="hs-comment">-- the 'ChainDB.cdbImmValidation' and the</span><span>
</span><span id="line-183"></span><span>              </span><span class="hs-comment">-- 'ChainDB.cdbVolValidation' fields.</span><span>
</span><span id="line-184"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk
</span><a href="#local-6989586621680040661"><span class="hs-identifier hs-var">rnCustomiseChainDbArgs</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk
</span><a href="#local-6989586621680040640"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-185"></span><span>                  </span><span class="annot"><span class="annottext">cdbImmutableDbValidation :: ValidationPolicy
</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbImmutableDbValidation"><span class="hs-identifier hs-var">ChainDB.cdbImmutableDbValidation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValidationPolicy
</span><a href="Ouroboros.Consensus.Storage.ImmutableDB.Impl.Types.html#ValidateAllChunks"><span class="hs-identifier hs-var">ValidateAllChunks</span></a></span><span>
</span><span id="line-186"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cdbVolatileDbValidation :: BlockValidationPolicy
</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbVolatileDbValidation"><span class="hs-identifier hs-var">ChainDB.cdbVolatileDbValidation</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockValidationPolicy
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.Impl.Types.html#ValidateAll"><span class="hs-identifier hs-var">ValidateAll</span></a></span><span>
</span><span id="line-187"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResourceKey IO
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680040635"><span class="annot"><span class="annottext">ChainDB IO blk
</span><a href="#local-6989586621680040635"><span class="hs-identifier hs-var">chainDB</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ResourceRegistry IO
-&gt; (ResourceId -&gt; IO (ChainDB IO blk))
-&gt; (ChainDB IO blk -&gt; IO ())
-&gt; IO (ResourceKey IO, ChainDB IO blk)
forall (m :: * -&gt; *) a.
(IOLike m, HasCallStack) =&gt;
ResourceRegistry m
-&gt; (ResourceId -&gt; m a) -&gt; (a -&gt; m ()) -&gt; m (ResourceKey m, a)
</span><a href="Ouroboros.Consensus.Util.ResourceRegistry.html#allocate"><span class="hs-identifier hs-var">allocate</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRegistry IO
</span><a href="#local-6989586621680040652"><span class="hs-identifier hs-var">registry</span></a></span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">ResourceId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tracer IO (TraceEvent blk)
-&gt; ResourceRegistry IO
-&gt; CheckInFuture IO blk
-&gt; FilePath
-&gt; TopLevelConfig blk
-&gt; ExtLedgerState blk
-&gt; (ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk)
-&gt; IO (ChainDB IO blk)
forall blk.
RunNode blk =&gt;
Tracer IO (TraceEvent blk)
-&gt; ResourceRegistry IO
-&gt; CheckInFuture IO blk
-&gt; FilePath
-&gt; TopLevelConfig blk
-&gt; ExtLedgerState blk
-&gt; (ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk)
-&gt; IO (ChainDB IO blk)
</span><a href="Ouroboros.Consensus.Node.html#openChainDB"><span class="hs-identifier hs-var">openChainDB</span></a></span><span>
</span><span id="line-191"></span><span>          </span><span class="annot"><span class="annottext">Tracer IO (TraceEvent blk)
</span><a href="#local-6989586621680040667"><span class="hs-identifier hs-var">rnTraceDB</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRegistry IO
</span><a href="#local-6989586621680040652"><span class="hs-identifier hs-var">registry</span></a></span><span> </span><span class="annot"><span class="annottext">CheckInFuture IO blk
</span><a href="#local-6989586621680040644"><span class="hs-identifier hs-var">inFuture</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680040663"><span class="hs-identifier hs-var">rnDatabasePath</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621680040648"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">ExtLedgerState blk
</span><a href="#local-6989586621680040633"><span class="hs-identifier hs-var">initLedger</span></a></span><span>
</span><span id="line-192"></span><span>          </span><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk
</span><a href="#local-6989586621680040641"><span class="hs-identifier hs-var">customiseChainDbArgs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>        </span><span class="annot"><span class="annottext">ChainDB IO blk -&gt; IO ()
forall (m :: * -&gt; *) blk. ChainDB m blk -&gt; m ()
</span><a href="Ouroboros.Consensus.Storage.ChainDB.API.html#closeDB"><span class="hs-identifier hs-var hs-var">ChainDB.closeDB</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>      </span><span id="local-6989586621680040631"><span class="annot"><span class="annottext">BlockchainTime IO
</span><a href="#local-6989586621680040631"><span class="hs-identifier hs-var">btime</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ResourceRegistry IO
-&gt; Tracer IO (RelativeTime, PastHorizonException)
-&gt; SystemTime IO
-&gt; LedgerConfig blk
-&gt; IO BackoffDelay
-&gt; STM IO (LedgerState blk)
-&gt; IO (BlockchainTime IO)
forall (m :: * -&gt; *) blk.
(IOLike m, HasHardForkHistory blk, HasCallStack) =&gt;
ResourceRegistry m
-&gt; Tracer m (RelativeTime, PastHorizonException)
-&gt; SystemTime m
-&gt; LedgerConfig blk
-&gt; m BackoffDelay
-&gt; STM m (LedgerState blk)
-&gt; m (BlockchainTime m)
</span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.HardFork.html#hardForkBlockchainTime"><span class="hs-identifier hs-var">hardForkBlockchainTime</span></a></span><span>
</span><span id="line-196"></span><span>                      </span><span class="annot"><span class="annottext">ResourceRegistry IO
</span><a href="#local-6989586621680040652"><span class="hs-identifier hs-var">registry</span></a></span><span>
</span><span id="line-197"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((RelativeTime, PastHorizonException) -&gt; TraceBlockchainTimeEvent)
-&gt; Tracer IO TraceBlockchainTimeEvent
-&gt; Tracer IO (RelativeTime, PastHorizonException)
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><span class="hs-identifier hs-var">contramap</span></span><span>
</span><span id="line-198"></span><span>                         </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680040629"><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621680040629"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680040628"><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621680040628"><span class="hs-identifier hs-var">ex</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-199"></span><span>                              </span><span class="annot"><span class="annottext">UTCTime -&gt; PastHorizonException -&gt; TraceBlockchainTimeEvent
</span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Util.html#TraceCurrentSlotUnknown"><span class="hs-identifier hs-var">TraceCurrentSlotUnknown</span></a></span><span>
</span><span id="line-200"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SystemStart -&gt; RelativeTime -&gt; UTCTime
</span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#fromRelativeTime"><span class="hs-identifier hs-var">fromRelativeTime</span></a></span><span> </span><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621680040651"><span class="hs-identifier hs-var">systemStart</span></a></span><span> </span><span class="annot"><span class="annottext">RelativeTime
</span><a href="#local-6989586621680040629"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>                                </span><span class="annot"><span class="annottext">PastHorizonException
</span><a href="#local-6989586621680040628"><span class="hs-identifier hs-var">ex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tracers IO RemoteConnectionId LocalConnectionId blk
-&gt; Tracer IO TraceBlockchainTimeEvent
forall remotePeer localPeer blk (f :: * -&gt; *).
Tracers' remotePeer localPeer blk f -&gt; f TraceBlockchainTimeEvent
</span><a href="Ouroboros.Consensus.Node.Tracers.html#blockchainTimeTracer"><span class="hs-identifier hs-var hs-var">blockchainTimeTracer</span></a></span><span> </span><span class="annot"><span class="annottext">Tracers IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040670"><span class="hs-identifier hs-var">rnTraceConsensus</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>                      </span><span class="annot"><span class="annottext">SystemTime IO
</span><a href="#local-6989586621680040647"><span class="hs-identifier hs-var">systemTime</span></a></span><span>
</span><span id="line-204"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; LedgerConfig blk
forall blk. TopLevelConfig blk -&gt; LedgerConfig blk
</span><a href="Ouroboros.Consensus.Config.html#configLedger"><span class="hs-identifier hs-var">configLedger</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621680040648"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackoffDelay -&gt; IO BackoffDelay
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(BackoffDelay -&gt; IO BackoffDelay)
-&gt; BackoffDelay -&gt; IO BackoffDelay
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; BackoffDelay
</span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.HardFork.html#BackoffDelay"><span class="hs-identifier hs-var">BackoffDelay</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><span class="hs-number">60</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- see 'BackoffDelay'</span><span>
</span><span id="line-206"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExtLedgerState blk -&gt; LedgerState blk
forall blk. ExtLedgerState blk -&gt; LedgerState blk
</span><a href="Ouroboros.Consensus.Ledger.Extended.html#ledgerState"><span class="hs-identifier hs-var hs-var">ledgerState</span></a></span><span> </span><span class="annot"><span class="annottext">(ExtLedgerState blk -&gt; LedgerState blk)
-&gt; STM (ExtLedgerState blk) -&gt; STM (LedgerState blk)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-207"></span><span>                         </span><span class="annot"><span class="annottext">ChainDB IO blk -&gt; STM IO (ExtLedgerState blk)
forall (m :: * -&gt; *) blk.
ChainDB m blk -&gt; STM m (ExtLedgerState blk)
</span><a href="Ouroboros.Consensus.Storage.ChainDB.API.html#getCurrentLedger"><span class="hs-identifier hs-var hs-var">ChainDB.getCurrentLedger</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDB IO blk
</span><a href="#local-6989586621680040635"><span class="hs-identifier hs-var">chainDB</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>      </span><span id="local-6989586621680040621"><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040621"><span class="hs-identifier hs-var">nodeArgs</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; NodeArgs IO RemoteConnectionId LocalConnectionId blk
forall (m :: * -&gt; *) blk.
NodeArgs m RemoteConnectionId LocalConnectionId blk
-&gt; NodeArgs m RemoteConnectionId LocalConnectionId blk
</span><a href="Ouroboros.Consensus.Node.html#nodeArgsEnforceInvariants"><span class="hs-identifier hs-var">nodeArgsEnforceInvariants</span></a></span><span> </span><span class="annot"><span class="annottext">(NodeArgs IO RemoteConnectionId LocalConnectionId blk
 -&gt; NodeArgs IO RemoteConnectionId LocalConnectionId blk)
-&gt; (NodeArgs IO RemoteConnectionId LocalConnectionId blk
    -&gt; NodeArgs IO RemoteConnectionId LocalConnectionId blk)
-&gt; NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; NodeArgs IO RemoteConnectionId LocalConnectionId blk
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; NodeArgs IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040660"><span class="hs-identifier hs-var">rnCustomiseNodeArgs</span></a></span><span> </span><span class="annot"><span class="annottext">(NodeArgs IO RemoteConnectionId LocalConnectionId blk
 -&gt; NodeArgs IO RemoteConnectionId LocalConnectionId blk)
-&gt; IO (NodeArgs IO RemoteConnectionId LocalConnectionId blk)
-&gt; IO (NodeArgs IO RemoteConnectionId LocalConnectionId blk)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-209"></span><span>                      </span><span class="annot"><span class="annottext">ResourceRegistry IO
-&gt; TopLevelConfig blk
-&gt; [IO (BlockForging IO blk)]
-&gt; Tracers IO RemoteConnectionId LocalConnectionId blk
-&gt; BlockchainTime IO
-&gt; ChainDB IO blk
-&gt; IO (NodeArgs IO RemoteConnectionId LocalConnectionId blk)
forall blk.
RunNode blk =&gt;
ResourceRegistry IO
-&gt; TopLevelConfig blk
-&gt; [IO (BlockForging IO blk)]
-&gt; Tracers IO RemoteConnectionId LocalConnectionId blk
-&gt; BlockchainTime IO
-&gt; ChainDB IO blk
-&gt; IO (NodeArgs IO RemoteConnectionId LocalConnectionId blk)
</span><a href="Ouroboros.Consensus.Node.html#mkNodeArgs"><span class="hs-identifier hs-var">mkNodeArgs</span></a></span><span>
</span><span id="line-210"></span><span>                        </span><span class="annot"><span class="annottext">ResourceRegistry IO
</span><a href="#local-6989586621680040652"><span class="hs-identifier hs-var">registry</span></a></span><span>
</span><span id="line-211"></span><span>                        </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621680040648"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-212"></span><span>                        </span><span class="annot"><span class="annottext">[IO (BlockForging IO blk)]
</span><a href="#local-6989586621680040619"><span class="hs-identifier hs-var">blockForging</span></a></span><span>
</span><span id="line-213"></span><span>                        </span><span class="annot"><span class="annottext">Tracers IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040670"><span class="hs-identifier hs-var">rnTraceConsensus</span></a></span><span>
</span><span id="line-214"></span><span>                        </span><span class="annot"><span class="annottext">BlockchainTime IO
</span><a href="#local-6989586621680040631"><span class="hs-identifier hs-var">btime</span></a></span><span>
</span><span id="line-215"></span><span>                        </span><span class="annot"><span class="annottext">ChainDB IO blk
</span><a href="#local-6989586621680040635"><span class="hs-identifier hs-var">chainDB</span></a></span><span>
</span><span id="line-216"></span><span>      </span><span id="local-6989586621680040618"><span class="annot"><span class="annottext">NodeKernel IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040618"><span class="hs-identifier hs-var">nodeKernel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; IO (NodeKernel IO RemoteConnectionId LocalConnectionId blk)
forall (m :: * -&gt; *) remotePeer localPeer blk.
(IOLike m, RunNode blk, NoThunks remotePeer, Ord remotePeer,
 Hashable remotePeer) =&gt;
NodeArgs m remotePeer localPeer blk
-&gt; m (NodeKernel m remotePeer localPeer blk)
</span><a href="Ouroboros.Consensus.NodeKernel.html#initNodeKernel"><span class="hs-identifier hs-var">initNodeKernel</span></a></span><span> </span><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040621"><span class="hs-identifier hs-var">nodeArgs</span></a></span><span>
</span><span id="line-217"></span><span>      </span><span class="annot"><span class="annottext">ResourceRegistry IO
-&gt; NodeKernel IO RemoteConnectionId LocalConnectionId blk -&gt; IO ()
</span><a href="#local-6989586621680040657"><span class="hs-identifier hs-var">rnNodeKernelHook</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRegistry IO
</span><a href="#local-6989586621680040652"><span class="hs-identifier hs-var">registry</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040618"><span class="hs-identifier hs-var">nodeKernel</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680040616"><span class="annot"><span class="annottext">ntnApps :: BlockNodeToNodeVersion blk
-&gt; Apps
     IO
     RemoteConnectionId
     ByteString
     ByteString
     ByteString
     ByteString
     ()
</span><a href="#local-6989586621680040616"><span class="hs-identifier hs-var hs-var">ntnApps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; NodeKernel IO RemoteConnectionId LocalConnectionId blk
-&gt; BlockNodeToNodeVersion blk
-&gt; Apps
     IO
     RemoteConnectionId
     ByteString
     ByteString
     ByteString
     ByteString
     ()
</span><a href="#local-6989586621680040615"><span class="hs-identifier hs-var">mkNodeToNodeApps</span></a></span><span>   </span><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040621"><span class="hs-identifier hs-var">nodeArgs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040618"><span class="hs-identifier hs-var">nodeKernel</span></a></span><span>
</span><span id="line-220"></span><span>          </span><span id="local-6989586621680040614"><span class="annot"><span class="annottext">ntcApps :: BlockNodeToClientVersion blk
-&gt; Apps IO LocalConnectionId ByteString ByteString ByteString ()
</span><a href="#local-6989586621680040614"><span class="hs-identifier hs-var hs-var">ntcApps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; NodeKernel IO RemoteConnectionId LocalConnectionId blk
-&gt; BlockNodeToClientVersion blk
-&gt; Apps IO LocalConnectionId ByteString ByteString ByteString ()
</span><a href="#local-6989586621680040613"><span class="hs-identifier hs-var">mkNodeToClientApps</span></a></span><span> </span><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040621"><span class="hs-identifier hs-var">nodeArgs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040618"><span class="hs-identifier hs-var">nodeKernel</span></a></span><span>
</span><span id="line-221"></span><span>          </span><span id="local-6989586621680040612"><span class="annot"><span class="annottext">diffusionApplications :: DiffusionApplications
</span><a href="#local-6989586621680040612"><span class="hs-identifier hs-var hs-var">diffusionApplications</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters
-&gt; (BlockNodeToNodeVersion blk
    -&gt; Apps
         IO
         RemoteConnectionId
         ByteString
         ByteString
         ByteString
         ByteString
         ())
-&gt; (BlockNodeToClientVersion blk
    -&gt; Apps IO LocalConnectionId ByteString ByteString ByteString ())
-&gt; DiffusionApplications
</span><a href="#local-6989586621680040611"><span class="hs-identifier hs-var">mkDiffusionApplications</span></a></span><span>
</span><span id="line-222"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; MiniProtocolParameters
forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeArgs m remotePeer localPeer blk -&gt; MiniProtocolParameters
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AminiProtocolParameters%3ANodeArgs"><span class="hs-identifier hs-var hs-var">miniProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040621"><span class="hs-identifier hs-var">nodeArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>                                    </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
-&gt; Apps
     IO
     RemoteConnectionId
     ByteString
     ByteString
     ByteString
     ByteString
     ()
</span><a href="#local-6989586621680040616"><span class="hs-identifier hs-var">ntnApps</span></a></span><span>
</span><span id="line-224"></span><span>                                    </span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
-&gt; Apps IO LocalConnectionId ByteString ByteString ByteString ()
</span><a href="#local-6989586621680040614"><span class="hs-identifier hs-var">ntcApps</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>      </span><span class="annot"><span class="annottext">DiffusionTracers
-&gt; DiffusionArguments -&gt; DiffusionApplications -&gt; IO ()
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">runDataDiffusion</span></a></span><span> </span><span class="annot"><span class="annottext">DiffusionTracers
</span><a href="#local-6989586621680040666"><span class="hs-identifier hs-var">rnTraceDiffusion</span></a></span><span>
</span><span id="line-227"></span><span>                       </span><span class="annot"><span class="annottext">DiffusionArguments
</span><a href="#local-6989586621680040665"><span class="hs-identifier hs-var">rnDiffusionArguments</span></a></span><span>
</span><span id="line-228"></span><span>                       </span><span class="annot"><span class="annottext">DiffusionApplications
</span><a href="#local-6989586621680040612"><span class="hs-identifier hs-var">diffusionApplications</span></a></span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-230"></span><span>    </span><span id="local-6989586621680040825"><span class="annot"><a href="#local-6989586621680040608"><span class="hs-identifier hs-type">randomElem</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680040825"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680040825"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-231"></span><span>    </span><span id="local-6989586621680040608"><span class="annot"><span class="annottext">randomElem :: [a] -&gt; IO a
</span><a href="#local-6989586621680040608"><span class="hs-identifier hs-var hs-var">randomElem</span></a></span></span><span> </span><span id="local-6989586621680040607"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680040607"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-232"></span><span>      </span><span id="local-6989586621680040606"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680040606"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; IO Int
forall a. Random a =&gt; (a, a) -&gt; IO a
</span><span class="hs-identifier hs-var">randomRIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680040607"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>      </span><span class="annot"><span class="annottext">a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; IO a) -&gt; a -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680040607"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Int -&gt; a
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680040606"><span class="hs-identifier hs-var">ix</span></a></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span>    </span><span id="local-6989586621680040603"><span class="annot"><span class="annottext">nodeToNodeVersionData :: NodeToNodeVersionData
</span><a href="#local-6989586621680040603"><span class="hs-identifier hs-var hs-var">nodeToNodeVersionData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersionData :: NetworkMagic -&gt; DiffusionMode -&gt; NodeToNodeVersionData
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToNodeVersionData</span></a></span><span>
</span><span id="line-236"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">networkMagic :: NetworkMagic
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">networkMagic</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkMagic
</span><a href="#local-6989586621680040664"><span class="hs-identifier hs-var">rnNetworkMagic</span></a></span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">diffusionMode :: DiffusionMode
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">diffusionMode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiffusionArguments -&gt; DiffusionMode
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var hs-var">daDiffusionMode</span></a></span><span> </span><span class="annot"><span class="annottext">DiffusionArguments
</span><a href="#local-6989586621680040665"><span class="hs-identifier hs-var">rnDiffusionArguments</span></a></span><span>
</span><span id="line-238"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-239"></span><span>    </span><span id="local-6989586621680040598"><span class="annot"><span class="annottext">nodeToClientVersionData :: NodeToClientVersionData
</span><a href="#local-6989586621680040598"><span class="hs-identifier hs-var hs-var">nodeToClientVersionData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeToClientVersionData :: NetworkMagic -&gt; NodeToClientVersionData
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NodeToClientVersionData</span></a></span><span>
</span><span id="line-240"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">networkMagic :: NetworkMagic
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">networkMagic</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkMagic
</span><a href="#local-6989586621680040664"><span class="hs-identifier hs-var">rnNetworkMagic</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.Node.ProtocolInfo.html#ProtocolInfo"><span class="hs-identifier hs-type">ProtocolInfo</span></a></span><span>
</span><span id="line-243"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pInfoConfig :: forall (m :: * -&gt; *) b. ProtocolInfo m b -&gt; TopLevelConfig b
</span><a href="Ouroboros.Consensus.Node.ProtocolInfo.html#pInfoConfig"><span class="hs-identifier hs-var">pInfoConfig</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680040648"><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621680040648"><span class="hs-identifier hs-var">cfg</span></a></span></span><span>
</span><span id="line-244"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pInfoInitLedger :: forall (m :: * -&gt; *) b. ProtocolInfo m b -&gt; ExtLedgerState b
</span><a href="Ouroboros.Consensus.Node.ProtocolInfo.html#pInfoInitLedger"><span class="hs-identifier hs-var">pInfoInitLedger</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680040633"><span class="annot"><span class="annottext">ExtLedgerState blk
</span><a href="#local-6989586621680040633"><span class="hs-identifier hs-var">initLedger</span></a></span></span><span>
</span><span id="line-245"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pInfoBlockForging :: forall (m :: * -&gt; *) b. ProtocolInfo m b -&gt; [m (BlockForging m b)]
</span><a href="Ouroboros.Consensus.Node.ProtocolInfo.html#pInfoBlockForging"><span class="hs-identifier hs-var">pInfoBlockForging</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680040619"><span class="annot"><span class="annottext">[IO (BlockForging IO blk)]
</span><a href="#local-6989586621680040619"><span class="hs-identifier hs-var">blockForging</span></a></span></span><span>
</span><span id="line-246"></span><span>      </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtocolInfo IO blk
</span><a href="#local-6989586621680040662"><span class="hs-identifier hs-var">rnProtocolInfo</span></a></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><a href="#local-6989586621680040591"><span class="hs-identifier hs-type">codecConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Block.Abstract.html#CodecConfig"><span class="hs-identifier hs-type">CodecConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040672"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span id="local-6989586621680040591"><span class="annot"><span class="annottext">codecConfig :: CodecConfig blk
</span><a href="#local-6989586621680040591"><span class="hs-identifier hs-var hs-var">codecConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; CodecConfig blk
forall blk. TopLevelConfig blk -&gt; CodecConfig blk
</span><a href="Ouroboros.Consensus.Config.html#configCodec"><span class="hs-identifier hs-var">configCodec</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621680040648"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>    </span><span class="annot"><a href="#local-6989586621680040615"><span class="hs-identifier hs-type">mkNodeToNodeApps</span></a></span><span>
</span><span id="line-252"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeArgs"><span class="hs-identifier hs-type">NodeArgs</span></a></span><span>   </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">RemoteConnectionId</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">LocalConnectionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040672"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-253"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernel"><span class="hs-identifier hs-type">NodeKernel</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">RemoteConnectionId</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">LocalConnectionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040672"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-254"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.NetworkProtocolVersion.html#BlockNodeToNodeVersion"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040672"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-255"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Apps"><span class="hs-identifier hs-type">NTN.Apps</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">RemoteConnectionId</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>    </span><span id="local-6989586621680040615"><span class="annot"><span class="annottext">mkNodeToNodeApps :: NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; NodeKernel IO RemoteConnectionId LocalConnectionId blk
-&gt; BlockNodeToNodeVersion blk
-&gt; Apps
     IO
     RemoteConnectionId
     ByteString
     ByteString
     ByteString
     ByteString
     ()
</span><a href="#local-6989586621680040615"><span class="hs-identifier hs-var hs-var">mkNodeToNodeApps</span></a></span></span><span> </span><span id="local-6989586621680040589"><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040589"><span class="hs-identifier hs-var">nodeArgs</span></a></span></span><span> </span><span id="local-6989586621680040588"><span class="annot"><span class="annottext">NodeKernel IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040588"><span class="hs-identifier hs-var">nodeKernel</span></a></span></span><span> </span><span id="local-6989586621680040587"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621680040587"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-257"></span><span>        </span><span class="annot"><span class="annottext">NodeKernel IO RemoteConnectionId LocalConnectionId blk
-&gt; Tracers IO RemoteConnectionId blk DeserialiseFailure
-&gt; Codecs
     blk
     DeserialiseFailure
     IO
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
-&gt; IO ChainSyncTimeout
-&gt; Handlers IO RemoteConnectionId blk
-&gt; Apps
     IO
     RemoteConnectionId
     ByteString
     ByteString
     ByteString
     ByteString
     ()
forall (m :: * -&gt; *) remotePeer localPeer blk e bCS bBF bTX bKA.
(IOLike m, MonadTimer m, Ord remotePeer, Exception e,
 LedgerSupportsProtocol blk, ShowProxy blk, ShowProxy (Header blk),
 ShowProxy (TxId (GenTx blk)), ShowProxy (GenTx blk)) =&gt;
NodeKernel m remotePeer localPeer blk
-&gt; Tracers m remotePeer blk e
-&gt; Codecs blk e m bCS bCS bBF bBF bTX bKA
-&gt; m ChainSyncTimeout
-&gt; Handlers m remotePeer blk
-&gt; Apps m remotePeer bCS bBF bTX bKA ()
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#mkApps"><span class="hs-identifier hs-var">NTN.mkApps</span></a></span><span>
</span><span id="line-258"></span><span>          </span><span class="annot"><span class="annottext">NodeKernel IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040588"><span class="hs-identifier hs-var">nodeKernel</span></a></span><span>
</span><span id="line-259"></span><span>          </span><span class="annot"><span class="annottext">Tracers IO RemoteConnectionId blk DeserialiseFailure
</span><a href="#local-6989586621680040669"><span class="hs-identifier hs-var">rnTraceNTN</span></a></span><span>
</span><span id="line-260"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; BlockNodeToNodeVersion blk
-&gt; Codecs
     blk
     DeserialiseFailure
     IO
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
forall (m :: * -&gt; *) blk.
(IOLike m, SerialiseNodeToNodeConstraints blk) =&gt;
CodecConfig blk
-&gt; BlockNodeToNodeVersion blk
-&gt; Codecs
     blk
     DeserialiseFailure
     m
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
     ByteString
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#defaultCodecs"><span class="hs-identifier hs-var">NTN.defaultCodecs</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621680040591"><span class="hs-identifier hs-var">codecConfig</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621680040587"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>          </span><span class="annot"><span class="annottext">IO ChainSyncTimeout
</span><a href="#local-6989586621680040584"><span class="hs-identifier hs-var">chainSyncTimeout</span></a></span><span>
</span><span id="line-262"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; NodeKernel IO RemoteConnectionId LocalConnectionId blk
-&gt; Handlers IO RemoteConnectionId blk
forall (m :: * -&gt; *) blk remotePeer localPeer.
(IOLike m, MonadTimer m, LedgerSupportsMempool blk,
 HasTxId (GenTx blk), LedgerSupportsProtocol blk, Ord remotePeer) =&gt;
NodeArgs m remotePeer localPeer blk
-&gt; NodeKernel m remotePeer localPeer blk
-&gt; Handlers m remotePeer blk
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#mkHandlers"><span class="hs-identifier hs-var">NTN.mkHandlers</span></a></span><span> </span><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040589"><span class="hs-identifier hs-var">nodeArgs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040588"><span class="hs-identifier hs-var">nodeKernel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-264"></span><span>        </span><span class="annot"><a href="#local-6989586621680040584"><span class="hs-identifier hs-type">chainSyncTimeout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NTN.ChainSyncTimeout</span></a></span><span>
</span><span id="line-265"></span><span>        </span><span id="local-6989586621680040584"><span class="annot"><span class="annottext">chainSyncTimeout :: IO ChainSyncTimeout
</span><a href="#local-6989586621680040584"><span class="hs-identifier hs-var hs-var">chainSyncTimeout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-266"></span><span>            </span><span class="hs-comment">-- These values approximately correspond to false positive</span><span>
</span><span id="line-267"></span><span>            </span><span class="hs-comment">-- thresholds for streaks of empty slots with 99% probability,</span><span>
</span><span id="line-268"></span><span>            </span><span class="hs-comment">-- 99.9% probability up to 99.999% probability.</span><span>
</span><span id="line-269"></span><span>            </span><span class="hs-comment">-- t = T_s [log (1-Y) / log (1-f)]</span><span>
</span><span id="line-270"></span><span>            </span><span class="hs-comment">-- Y = [0.99, 0.999...]</span><span>
</span><span id="line-271"></span><span>            </span><span class="hs-comment">-- T_s = slot length of 1s.</span><span>
</span><span id="line-272"></span><span>            </span><span class="hs-comment">-- f = 0.05</span><span>
</span><span id="line-273"></span><span>            </span><span class="hs-comment">-- The timeout is randomly picked per bearer to avoid all bearers</span><span>
</span><span id="line-274"></span><span>            </span><span class="hs-comment">-- going down at the same time in case of a long streak of empty</span><span>
</span><span id="line-275"></span><span>            </span><span class="hs-comment">-- slots. TODO: workaround until peer selection governor.</span><span>
</span><span id="line-276"></span><span>            </span><span id="local-6989586621680040582"><span class="annot"><span class="annottext">Maybe DiffTime
</span><a href="#local-6989586621680040582"><span class="hs-identifier hs-var">mustReplyTimeout</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; Maybe DiffTime
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(DiffTime -&gt; Maybe DiffTime) -&gt; IO DiffTime -&gt; IO (Maybe DiffTime)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[DiffTime] -&gt; IO DiffTime
forall a. [a] -&gt; IO a
</span><a href="#local-6989586621680040608"><span class="hs-identifier hs-var">randomElem</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">90</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">135</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">180</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">224</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">269</span></span><span class="hs-special">]</span><span>
</span><span id="line-277"></span><span>            </span><span class="annot"><span class="annottext">ChainSyncTimeout -&gt; IO ChainSyncTimeout
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ChainSyncTimeout :: Maybe DiffTime -&gt; Maybe DiffTime -&gt; ChainSyncTimeout
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">NTN.ChainSyncTimeout</span></a></span><span>
</span><span id="line-278"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">canAwaitTimeout :: Maybe DiffTime
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">canAwaitTimeout</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe DiffTime
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">shortWait</span></a></span><span>
</span><span id="line-279"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe DiffTime
mustReplyTimeout :: Maybe DiffTime
mustReplyTimeout :: Maybe DiffTime
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var hs-var">mustReplyTimeout</span></a></span><span>
</span><span id="line-280"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><a href="#local-6989586621680040613"><span class="hs-identifier hs-type">mkNodeToClientApps</span></a></span><span>
</span><span id="line-283"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeArgs"><span class="hs-identifier hs-type">NodeArgs</span></a></span><span>   </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">RemoteConnectionId</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">LocalConnectionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040672"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-284"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeKernel"><span class="hs-identifier hs-type">NodeKernel</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">RemoteConnectionId</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">LocalConnectionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040672"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-285"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.NetworkProtocolVersion.html#BlockNodeToClientVersion"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040672"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-286"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToClient.html#Apps"><span class="hs-identifier hs-type">NTC.Apps</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">LocalConnectionId</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>    </span><span id="local-6989586621680040613"><span class="annot"><span class="annottext">mkNodeToClientApps :: NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; NodeKernel IO RemoteConnectionId LocalConnectionId blk
-&gt; BlockNodeToClientVersion blk
-&gt; Apps IO LocalConnectionId ByteString ByteString ByteString ()
</span><a href="#local-6989586621680040613"><span class="hs-identifier hs-var hs-var">mkNodeToClientApps</span></a></span></span><span> </span><span id="local-6989586621680040578"><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040578"><span class="hs-identifier hs-var">nodeArgs</span></a></span></span><span> </span><span id="local-6989586621680040577"><span class="annot"><span class="annottext">NodeKernel IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040577"><span class="hs-identifier hs-var">nodeKernel</span></a></span></span><span> </span><span id="local-6989586621680040576"><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621680040576"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-288"></span><span>        </span><span class="annot"><span class="annottext">Tracers IO LocalConnectionId blk DeserialiseFailure
-&gt; Codecs
     blk DeserialiseFailure IO ByteString ByteString ByteString
-&gt; Handlers IO LocalConnectionId blk
-&gt; Apps IO LocalConnectionId ByteString ByteString ByteString ()
forall (m :: * -&gt; *) peer blk e bCS bTX bSQ.
(IOLike m, Exception e, ShowProxy blk, ShowProxy (ApplyTxErr blk),
 ShowProxy (Query blk), ShowProxy (GenTx blk),
 ShowQuery (Query blk)) =&gt;
Tracers m peer blk e
-&gt; Codecs blk e m bCS bTX bSQ
-&gt; Handlers m peer blk
-&gt; Apps m peer bCS bTX bSQ ()
</span><a href="Ouroboros.Consensus.Network.NodeToClient.html#mkApps"><span class="hs-identifier hs-var">NTC.mkApps</span></a></span><span>
</span><span id="line-289"></span><span>          </span><span class="annot"><span class="annottext">Tracers IO LocalConnectionId blk DeserialiseFailure
</span><a href="#local-6989586621680040668"><span class="hs-identifier hs-var">rnTraceNTC</span></a></span><span>
</span><span id="line-290"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; BlockNodeToClientVersion blk
-&gt; Codecs
     blk DeserialiseFailure IO ByteString ByteString ByteString
forall (m :: * -&gt; *) blk.
(MonadST m, SerialiseNodeToClientConstraints blk,
 ShowQuery (Query blk)) =&gt;
CodecConfig blk
-&gt; BlockNodeToClientVersion blk -&gt; DefaultCodecs blk m
</span><a href="Ouroboros.Consensus.Network.NodeToClient.html#defaultCodecs"><span class="hs-identifier hs-var">NTC.defaultCodecs</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621680040591"><span class="hs-identifier hs-var">codecConfig</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621680040576"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; NodeKernel IO RemoteConnectionId LocalConnectionId blk
-&gt; Handlers IO LocalConnectionId blk
forall (m :: * -&gt; *) blk remotePeer localPeer.
(IOLike m, LedgerSupportsMempool blk, QueryLedger blk) =&gt;
NodeArgs m remotePeer localPeer blk
-&gt; NodeKernel m remotePeer localPeer blk
-&gt; Handlers m localPeer blk
</span><a href="Ouroboros.Consensus.Network.NodeToClient.html#mkHandlers"><span class="hs-identifier hs-var">NTC.mkHandlers</span></a></span><span> </span><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040578"><span class="hs-identifier hs-var">nodeArgs</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKernel IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040577"><span class="hs-identifier hs-var">nodeKernel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span>    </span><span class="annot"><a href="#local-6989586621680040611"><span class="hs-identifier hs-type">mkDiffusionApplications</span></a></span><span>
</span><span id="line-294"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">MiniProtocolParameters</span></a></span><span>
</span><span id="line-295"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span>   </span><span class="annot"><a href="Ouroboros.Consensus.Node.NetworkProtocolVersion.html#BlockNodeToNodeVersion"><span class="hs-identifier hs-type">BlockNodeToNodeVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040672"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-296"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToNode.html#Apps"><span class="hs-identifier hs-type">NTN.Apps</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">RemoteConnectionId</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>         </span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span>   </span><span class="annot"><a href="Ouroboros.Consensus.Node.NetworkProtocolVersion.html#BlockNodeToClientVersion"><span class="hs-identifier hs-type">BlockNodeToClientVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040672"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-299"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Network.NodeToClient.html#Apps"><span class="hs-identifier hs-type">NTC.Apps</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">LocalConnectionId</span></a></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>         </span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">DiffusionApplications</span></a></span><span>
</span><span id="line-302"></span><span>    </span><span id="local-6989586621680040611"><span class="annot"><span class="annottext">mkDiffusionApplications :: MiniProtocolParameters
-&gt; (BlockNodeToNodeVersion blk
    -&gt; Apps
         IO
         RemoteConnectionId
         ByteString
         ByteString
         ByteString
         ByteString
         ())
-&gt; (BlockNodeToClientVersion blk
    -&gt; Apps IO LocalConnectionId ByteString ByteString ByteString ())
-&gt; DiffusionApplications
</span><a href="#local-6989586621680040611"><span class="hs-identifier hs-var hs-var">mkDiffusionApplications</span></a></span></span><span> </span><span id="local-6989586621680040572"><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="#local-6989586621680040572"><span class="hs-identifier hs-var">miniProtocolParams</span></a></span></span><span> </span><span id="local-6989586621680040571"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
-&gt; Apps
     IO
     RemoteConnectionId
     ByteString
     ByteString
     ByteString
     ByteString
     ()
</span><a href="#local-6989586621680040571"><span class="hs-identifier hs-var">ntnApps</span></a></span></span><span> </span><span id="local-6989586621680040570"><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
-&gt; Apps IO LocalConnectionId ByteString ByteString ByteString ()
</span><a href="#local-6989586621680040570"><span class="hs-identifier hs-var">ntcApps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-303"></span><span>      </span><span class="annot"><span class="annottext">DiffusionApplications :: Versions
  NodeToNodeVersion
  NodeToNodeVersionData
  (OuroborosApplication
     'ResponderMode SockAddr ByteString IO Void ())
-&gt; Versions
     NodeToNodeVersion
     NodeToNodeVersionData
     (OuroborosApplication
        'InitiatorMode SockAddr ByteString IO () Void)
-&gt; Versions
     NodeToClientVersion
     NodeToClientVersionData
     (OuroborosApplication
        'ResponderMode LocalAddress ByteString IO Void ())
-&gt; ErrorPolicies
-&gt; DiffusionApplications
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">DiffusionApplications</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-304"></span><span>          </span><span class="annot"><span class="annottext">daResponderApplication :: Versions
  NodeToNodeVersion
  NodeToNodeVersionData
  (OuroborosApplication
     'ResponderMode SockAddr ByteString IO Void ())
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">daResponderApplication</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Versions
   NodeToNodeVersion
   NodeToNodeVersionData
   (OuroborosApplication
      'ResponderMode SockAddr ByteString IO Void ())]
-&gt; Versions
     NodeToNodeVersion
     NodeToNodeVersionData
     (OuroborosApplication
        'ResponderMode SockAddr ByteString IO Void ())
forall vNum (f :: * -&gt; *) extra r.
(Ord vNum, Foldable f, HasCallStack) =&gt;
f (Versions vNum extra r) -&gt; Versions vNum extra r
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">combineVersions</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-305"></span><span>              </span><span class="annot"><span class="annottext">NodeToNodeVersion
-&gt; NodeToNodeVersionData
-&gt; OuroborosApplication
     'ResponderMode SockAddr ByteString IO Void ()
-&gt; Versions
     NodeToNodeVersion
     NodeToNodeVersionData
     (OuroborosApplication
        'ResponderMode SockAddr ByteString IO Void ())
forall vNum vData r. vNum -&gt; vData -&gt; r -&gt; Versions vNum vData r
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">simpleSingletonVersions</span></a></span><span>
</span><span id="line-306"></span><span>                </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680040566"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-307"></span><span>                </span><span class="annot"><span class="annottext">NodeToNodeVersionData
</span><a href="#local-6989586621680040603"><span class="hs-identifier hs-var">nodeToNodeVersionData</span></a></span><span>
</span><span id="line-308"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MiniProtocolParameters
-&gt; NodeToNodeVersion
-&gt; Apps
     IO
     RemoteConnectionId
     ByteString
     ByteString
     ByteString
     ByteString
     ()
-&gt; OuroborosApplication
     'ResponderMode SockAddr ByteString IO Void ()
forall (m :: * -&gt; *) peer b a.
MiniProtocolParameters
-&gt; NodeToNodeVersion
-&gt; Apps m (ConnectionId peer) b b b b a
-&gt; OuroborosApplication 'ResponderMode peer b m Void a
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#responder"><span class="hs-identifier hs-var">NTN.responder</span></a></span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="#local-6989586621680040572"><span class="hs-identifier hs-var">miniProtocolParams</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680040566"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">(Apps
   IO
   RemoteConnectionId
   ByteString
   ByteString
   ByteString
   ByteString
   ()
 -&gt; OuroborosApplication
      'ResponderMode SockAddr ByteString IO Void ())
-&gt; Apps
     IO
     RemoteConnectionId
     ByteString
     ByteString
     ByteString
     ByteString
     ()
-&gt; OuroborosApplication
     'ResponderMode SockAddr ByteString IO Void ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
-&gt; Apps
     IO
     RemoteConnectionId
     ByteString
     ByteString
     ByteString
     ByteString
     ()
</span><a href="#local-6989586621680040571"><span class="hs-identifier hs-var">ntnApps</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621680040564"><span class="hs-identifier hs-var">blockVersion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680040566"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680040566"><span class="hs-identifier hs-var">version</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680040564"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621680040564"><span class="hs-identifier hs-var">blockVersion</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
-&gt; [(NodeToNodeVersion, BlockNodeToNodeVersion blk)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
</span><a href="#local-6989586621680040659"><span class="hs-identifier hs-var">rnNodeToNodeVersions</span></a></span><span>
</span><span id="line-310"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-311"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">daInitiatorApplication :: Versions
  NodeToNodeVersion
  NodeToNodeVersionData
  (OuroborosApplication
     'InitiatorMode SockAddr ByteString IO () Void)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">daInitiatorApplication</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Versions
   NodeToNodeVersion
   NodeToNodeVersionData
   (OuroborosApplication
      'InitiatorMode SockAddr ByteString IO () Void)]
-&gt; Versions
     NodeToNodeVersion
     NodeToNodeVersionData
     (OuroborosApplication
        'InitiatorMode SockAddr ByteString IO () Void)
forall vNum (f :: * -&gt; *) extra r.
(Ord vNum, Foldable f, HasCallStack) =&gt;
f (Versions vNum extra r) -&gt; Versions vNum extra r
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">combineVersions</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-312"></span><span>              </span><span class="annot"><span class="annottext">NodeToNodeVersion
-&gt; NodeToNodeVersionData
-&gt; OuroborosApplication
     'InitiatorMode SockAddr ByteString IO () Void
-&gt; Versions
     NodeToNodeVersion
     NodeToNodeVersionData
     (OuroborosApplication
        'InitiatorMode SockAddr ByteString IO () Void)
forall vNum vData r. vNum -&gt; vData -&gt; r -&gt; Versions vNum vData r
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">simpleSingletonVersions</span></a></span><span>
</span><span id="line-313"></span><span>                </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680040561"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-314"></span><span>                </span><span class="annot"><span class="annottext">NodeToNodeVersionData
</span><a href="#local-6989586621680040603"><span class="hs-identifier hs-var">nodeToNodeVersionData</span></a></span><span>
</span><span id="line-315"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MiniProtocolParameters
-&gt; NodeToNodeVersion
-&gt; Apps
     IO
     RemoteConnectionId
     ByteString
     ByteString
     ByteString
     ByteString
     ()
-&gt; OuroborosApplication
     'InitiatorMode SockAddr ByteString IO () Void
forall (m :: * -&gt; *) peer b a.
MiniProtocolParameters
-&gt; NodeToNodeVersion
-&gt; Apps m (ConnectionId peer) b b b b a
-&gt; OuroborosApplication 'InitiatorMode peer b m a Void
</span><a href="Ouroboros.Consensus.Network.NodeToNode.html#initiator"><span class="hs-identifier hs-var">NTN.initiator</span></a></span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="#local-6989586621680040572"><span class="hs-identifier hs-var">miniProtocolParams</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680040561"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">(Apps
   IO
   RemoteConnectionId
   ByteString
   ByteString
   ByteString
   ByteString
   ()
 -&gt; OuroborosApplication
      'InitiatorMode SockAddr ByteString IO () Void)
-&gt; Apps
     IO
     RemoteConnectionId
     ByteString
     ByteString
     ByteString
     ByteString
     ()
-&gt; OuroborosApplication
     'InitiatorMode SockAddr ByteString IO () Void
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
-&gt; Apps
     IO
     RemoteConnectionId
     ByteString
     ByteString
     ByteString
     ByteString
     ()
</span><a href="#local-6989586621680040571"><span class="hs-identifier hs-var">ntnApps</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621680040559"><span class="hs-identifier hs-var">blockVersion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680040561"><span class="annot"><span class="annottext">NodeToNodeVersion
</span><a href="#local-6989586621680040561"><span class="hs-identifier hs-var">version</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680040559"><span class="annot"><span class="annottext">BlockNodeToNodeVersion blk
</span><a href="#local-6989586621680040559"><span class="hs-identifier hs-var">blockVersion</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
-&gt; [(NodeToNodeVersion, BlockNodeToNodeVersion blk)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
</span><a href="#local-6989586621680040659"><span class="hs-identifier hs-var">rnNodeToNodeVersions</span></a></span><span>
</span><span id="line-317"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-318"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">daLocalResponderApplication :: Versions
  NodeToClientVersion
  NodeToClientVersionData
  (OuroborosApplication
     'ResponderMode LocalAddress ByteString IO Void ())
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">daLocalResponderApplication</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Versions
   NodeToClientVersion
   NodeToClientVersionData
   (OuroborosApplication
      'ResponderMode LocalAddress ByteString IO Void ())]
-&gt; Versions
     NodeToClientVersion
     NodeToClientVersionData
     (OuroborosApplication
        'ResponderMode LocalAddress ByteString IO Void ())
forall vNum (f :: * -&gt; *) extra r.
(Ord vNum, Foldable f, HasCallStack) =&gt;
f (Versions vNum extra r) -&gt; Versions vNum extra r
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">combineVersions</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-319"></span><span>              </span><span class="annot"><span class="annottext">NodeToClientVersion
-&gt; NodeToClientVersionData
-&gt; OuroborosApplication
     'ResponderMode LocalAddress ByteString IO Void ()
-&gt; Versions
     NodeToClientVersion
     NodeToClientVersionData
     (OuroborosApplication
        'ResponderMode LocalAddress ByteString IO Void ())
forall vNum vData r. vNum -&gt; vData -&gt; r -&gt; Versions vNum vData r
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-framework-0.1.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">simpleSingletonVersions</span></a></span><span>
</span><span id="line-320"></span><span>                </span><span class="annot"><span class="annottext">NodeToClientVersion
</span><a href="#local-6989586621680040557"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-321"></span><span>                </span><span class="annot"><span class="annottext">NodeToClientVersionData
</span><a href="#local-6989586621680040598"><span class="hs-identifier hs-var">nodeToClientVersionData</span></a></span><span>
</span><span id="line-322"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeToClientVersion
-&gt; Apps IO LocalConnectionId ByteString ByteString ByteString ()
-&gt; OuroborosApplication
     'ResponderMode LocalAddress ByteString IO Void ()
forall (m :: * -&gt; *) peer b a.
NodeToClientVersion
-&gt; Apps m (ConnectionId peer) b b b a
-&gt; OuroborosApplication 'ResponderMode peer b m Void a
</span><a href="Ouroboros.Consensus.Network.NodeToClient.html#responder"><span class="hs-identifier hs-var">NTC.responder</span></a></span><span> </span><span class="annot"><span class="annottext">NodeToClientVersion
</span><a href="#local-6989586621680040557"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">(Apps IO LocalConnectionId ByteString ByteString ByteString ()
 -&gt; OuroborosApplication
      'ResponderMode LocalAddress ByteString IO Void ())
-&gt; Apps IO LocalConnectionId ByteString ByteString ByteString ()
-&gt; OuroborosApplication
     'ResponderMode LocalAddress ByteString IO Void ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
-&gt; Apps IO LocalConnectionId ByteString ByteString ByteString ()
</span><a href="#local-6989586621680040570"><span class="hs-identifier hs-var">ntcApps</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621680040555"><span class="hs-identifier hs-var">blockVersion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680040557"><span class="annot"><span class="annottext">NodeToClientVersion
</span><a href="#local-6989586621680040557"><span class="hs-identifier hs-var">version</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680040555"><span class="annot"><span class="annottext">BlockNodeToClientVersion blk
</span><a href="#local-6989586621680040555"><span class="hs-identifier hs-var">blockVersion</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map NodeToClientVersion (BlockNodeToClientVersion blk)
-&gt; [(NodeToClientVersion, BlockNodeToClientVersion blk)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map NodeToClientVersion (BlockNodeToClientVersion blk)
</span><a href="#local-6989586621680040658"><span class="hs-identifier hs-var">rnNodeToClientVersions</span></a></span><span>
</span><span id="line-324"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-325"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">daErrorPolicies :: ErrorPolicies
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">daErrorPolicies</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrorPolicies
</span><a href="Ouroboros.Consensus.Node.ErrorPolicy.html#consensusErrorPolicy"><span class="hs-identifier hs-var">consensusErrorPolicy</span></a></span><span>
</span><span id="line-326"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="hs-comment">-- | Check the DB marker, lock the DB and look for the clean shutdown marker.</span><span>
</span><span id="line-329"></span><span class="hs-comment">--</span><span>
</span><span id="line-330"></span><span class="hs-comment">-- Run the body action with the DB locked, and if the last shutdown was clean.</span><span>
</span><span id="line-331"></span><span class="hs-comment">--</span><span>
</span><span id="line-332"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#withDBChecks"><span class="hs-identifier hs-type">withDBChecks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680040958"><span class="annot"><a href="#local-6989586621680040958"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span id="local-6989586621680040956"><span class="annot"><a href="#local-6989586621680040956"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-333"></span><span>                </span><span class="annot"><a href="Ouroboros.Consensus.Node.Run.html#RunNode"><span class="hs-identifier hs-type">RunNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040958"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-334"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#RunNodeArgs"><span class="hs-identifier hs-type">RunNodeArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040958"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-335"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680040956"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ Body action with last shutdown was clean.</span><span>
</span><span id="line-336"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680040956"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-337"></span><span id="withDBChecks"><span class="annot"><span class="annottext">withDBChecks :: RunNodeArgs blk -&gt; (Bool -&gt; IO a) -&gt; IO a
</span><a href="Ouroboros.Consensus.Node.html#withDBChecks"><span class="hs-identifier hs-var hs-var">withDBChecks</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.html#RunNodeArgs"><span class="hs-identifier hs-type">RunNodeArgs</span></a></span><span class="hs-special">{</span><span id="local-6989586621680040538"><span id="local-6989586621680040539"><span id="local-6989586621680040540"><span id="local-6989586621680040541"><span id="local-6989586621680040542"><span id="local-6989586621680040543"><span id="local-6989586621680040544"><span id="local-6989586621680040545"><span id="local-6989586621680040546"><span id="local-6989586621680040547"><span id="local-6989586621680040548"><span id="local-6989586621680040549"><span id="local-6989586621680040550"><span id="local-6989586621680040551"><span id="local-6989586621680040552"><span class="annot"><span class="annottext">FilePath
Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
Map NodeToClientVersion (BlockNodeToClientVersion blk)
Tracer IO (TraceEvent blk)
DiffusionTracers
DiffusionArguments
NetworkMagic
ProtocolInfo IO blk
ClockSkew
Tracers IO RemoteConnectionId LocalConnectionId blk
Tracers IO RemoteConnectionId blk DeserialiseFailure
Tracers IO LocalConnectionId blk DeserialiseFailure
ResourceRegistry IO
-&gt; NodeKernel IO RemoteConnectionId LocalConnectionId blk -&gt; IO ()
ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk
NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; NodeArgs IO RemoteConnectionId LocalConnectionId blk
rnMaxClockSkew :: ClockSkew
rnNodeKernelHook :: ResourceRegistry IO
-&gt; NodeKernel IO RemoteConnectionId LocalConnectionId blk -&gt; IO ()
rnNodeToClientVersions :: Map NodeToClientVersion (BlockNodeToClientVersion blk)
rnNodeToNodeVersions :: Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
rnCustomiseNodeArgs :: NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; NodeArgs IO RemoteConnectionId LocalConnectionId blk
rnCustomiseChainDbArgs :: ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk
rnProtocolInfo :: ProtocolInfo IO blk
rnDatabasePath :: FilePath
rnNetworkMagic :: NetworkMagic
rnDiffusionArguments :: DiffusionArguments
rnTraceDiffusion :: DiffusionTracers
rnTraceDB :: Tracer IO (TraceEvent blk)
rnTraceNTC :: Tracers IO LocalConnectionId blk DeserialiseFailure
rnTraceNTN :: Tracers IO RemoteConnectionId blk DeserialiseFailure
rnTraceConsensus :: Tracers IO RemoteConnectionId LocalConnectionId blk
rnMaxClockSkew :: forall blk. RunNodeArgs blk -&gt; ClockSkew
rnNodeKernelHook :: forall blk.
RunNodeArgs blk
-&gt; ResourceRegistry IO
-&gt; NodeKernel IO RemoteConnectionId LocalConnectionId blk
-&gt; IO ()
rnNodeToClientVersions :: forall blk.
RunNodeArgs blk
-&gt; Map NodeToClientVersion (BlockNodeToClientVersion blk)
rnNodeToNodeVersions :: forall blk.
RunNodeArgs blk
-&gt; Map NodeToNodeVersion (BlockNodeToNodeVersion blk)
rnCustomiseNodeArgs :: forall blk.
RunNodeArgs blk
-&gt; NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; NodeArgs IO RemoteConnectionId LocalConnectionId blk
rnCustomiseChainDbArgs :: forall blk.
RunNodeArgs blk
-&gt; ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk
rnProtocolInfo :: forall blk. RunNodeArgs blk -&gt; ProtocolInfo IO blk
rnDatabasePath :: forall blk. RunNodeArgs blk -&gt; FilePath
rnNetworkMagic :: forall blk. RunNodeArgs blk -&gt; NetworkMagic
rnDiffusionArguments :: forall blk. RunNodeArgs blk -&gt; DiffusionArguments
rnTraceDiffusion :: forall blk. RunNodeArgs blk -&gt; DiffusionTracers
rnTraceDB :: forall blk. RunNodeArgs blk -&gt; Tracer IO (TraceEvent blk)
rnTraceNTC :: forall blk.
RunNodeArgs blk
-&gt; Tracers IO LocalConnectionId blk DeserialiseFailure
rnTraceNTN :: forall blk.
RunNodeArgs blk
-&gt; Tracers IO RemoteConnectionId blk DeserialiseFailure
rnTraceConsensus :: forall blk.
RunNodeArgs blk
-&gt; Tracers IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040538"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680040537"><span class="annot"><span class="annottext">Bool -&gt; IO a
</span><a href="#local-6989586621680040537"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-comment">-- Check the DB marker first, before doing the lock file, since if the</span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-comment">-- marker is not present, it expects an empty DB dir.</span><span>
</span><span id="line-341"></span><span>    </span><span class="annot"><span class="annottext">(DbMarkerError -&gt; IO ())
-&gt; (() -&gt; IO ()) -&gt; Either DbMarkerError () -&gt; IO ()
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">DbMarkerError -&gt; IO ()
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either DbMarkerError () -&gt; IO ())
-&gt; IO (Either DbMarkerError ()) -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">HasFS IO HandleIO
-&gt; MountPoint -&gt; NetworkMagic -&gt; IO (Either DbMarkerError ())
forall (m :: * -&gt; *) h.
MonadThrow m =&gt;
HasFS m h
-&gt; MountPoint -&gt; NetworkMagic -&gt; m (Either DbMarkerError ())
</span><a href="Ouroboros.Consensus.Node.DbMarker.html#checkDbMarker"><span class="hs-identifier hs-var">checkDbMarker</span></a></span><span>
</span><span id="line-342"></span><span>      </span><span class="annot"><span class="annottext">HasFS IO HandleIO
</span><a href="#local-6989586621680040532"><span class="hs-identifier hs-var">hasFS</span></a></span><span>
</span><span id="line-343"></span><span>      </span><span class="annot"><span class="annottext">MountPoint
</span><a href="#local-6989586621680040531"><span class="hs-identifier hs-var">mountPoint</span></a></span><span>
</span><span id="line-344"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockConfig blk -&gt; NetworkMagic
forall blk.
ConfigSupportsNode blk =&gt;
BlockConfig blk -&gt; NetworkMagic
</span><a href="Ouroboros.Consensus.Config.SupportsNode.html#getNetworkMagic"><span class="hs-identifier hs-var">getNetworkMagic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; BlockConfig blk
forall blk. TopLevelConfig blk -&gt; BlockConfig blk
</span><a href="Ouroboros.Consensus.Config.html#configBlock"><span class="hs-identifier hs-var">configBlock</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621680040529"><span class="hs-identifier hs-var">pInfoConfig</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-comment">-- Then create the lock file.</span><span>
</span><span id="line-347"></span><span>    </span><span class="annot"><span class="annottext">MountPoint -&gt; IO a -&gt; IO a
forall a. MountPoint -&gt; IO a -&gt; IO a
</span><a href="Ouroboros.Consensus.Node.DbLock.html#withLockDB"><span class="hs-identifier hs-var">withLockDB</span></a></span><span> </span><span class="annot"><span class="annottext">MountPoint
</span><a href="#local-6989586621680040531"><span class="hs-identifier hs-var">mountPoint</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO a) -&gt; IO a -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span>      </span><span class="hs-comment">-- When we shut down cleanly, we create a marker file so that the next</span><span>
</span><span id="line-350"></span><span>      </span><span class="hs-comment">-- time we start, we know we don't have to validate the contents of the</span><span>
</span><span id="line-351"></span><span>      </span><span class="hs-comment">-- whole ChainDB. When we shut down with an exception indicating</span><span>
</span><span id="line-352"></span><span>      </span><span class="hs-comment">-- corruption or something going wrong with the file system, we don't</span><span>
</span><span id="line-353"></span><span>      </span><span class="hs-comment">-- create this marker file so that the next time we start, we do a full</span><span>
</span><span id="line-354"></span><span>      </span><span class="hs-comment">-- validation.</span><span>
</span><span id="line-355"></span><span>      </span><span id="local-6989586621680040527"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680040527"><span class="hs-identifier hs-var">lastShutDownWasClean</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasFS IO HandleIO -&gt; IO Bool
forall (m :: * -&gt; *) h. HasFS m h -&gt; m Bool
</span><a href="Ouroboros.Consensus.Node.Recovery.html#hasCleanShutdownMarker"><span class="hs-identifier hs-var">hasCleanShutdownMarker</span></a></span><span> </span><span class="annot"><span class="annottext">HasFS IO HandleIO
</span><a href="#local-6989586621680040532"><span class="hs-identifier hs-var">hasFS</span></a></span><span>
</span><span id="line-356"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680040527"><span class="hs-identifier hs-var">lastShutDownWasClean</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasFS IO HandleIO -&gt; IO ()
forall (m :: * -&gt; *) h. HasFS m h -&gt; m ()
</span><a href="Ouroboros.Consensus.Node.Recovery.html#removeCleanShutdownMarker"><span class="hs-identifier hs-var">removeCleanShutdownMarker</span></a></span><span> </span><span class="annot"><span class="annottext">HasFS IO HandleIO
</span><a href="#local-6989586621680040532"><span class="hs-identifier hs-var">hasFS</span></a></span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span>      </span><span class="hs-comment">-- On a clean shutdown, create a marker in the database folder so that</span><span>
</span><span id="line-359"></span><span>      </span><span class="hs-comment">-- next time we start up, we know we don't have to validate the whole</span><span>
</span><span id="line-360"></span><span>      </span><span class="hs-comment">-- database.</span><span>
</span><span id="line-361"></span><span>      </span><span class="annot"><span class="annottext">HasFS IO HandleIO -&gt; IO a -&gt; IO a
forall (m :: * -&gt; *) h a. IOLike m =&gt; HasFS m h -&gt; m a -&gt; m a
</span><a href="Ouroboros.Consensus.Node.Recovery.html#createMarkerOnCleanShutdown"><span class="hs-identifier hs-var">createMarkerOnCleanShutdown</span></a></span><span> </span><span class="annot"><span class="annottext">HasFS IO HandleIO
</span><a href="#local-6989586621680040532"><span class="hs-identifier hs-var">hasFS</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO a) -&gt; IO a -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-362"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; IO a
</span><a href="#local-6989586621680040537"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680040527"><span class="hs-identifier hs-var">lastShutDownWasClean</span></a></span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-364"></span><span>    </span><span id="local-6989586621680040531"><span class="annot"><span class="annottext">mountPoint :: MountPoint
</span><a href="#local-6989586621680040531"><span class="hs-identifier hs-var hs-var">mountPoint</span></a></span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; MountPoint
</span><a href="Ouroboros.Consensus.Storage.FS.API.Types.html#MountPoint"><span class="hs-identifier hs-var">MountPoint</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680040545"><span class="hs-identifier hs-var">rnDatabasePath</span></a></span><span>
</span><span id="line-365"></span><span>    </span><span id="local-6989586621680040532"><span class="annot"><span class="annottext">hasFS :: HasFS IO HandleIO
</span><a href="#local-6989586621680040532"><span class="hs-identifier hs-var hs-var">hasFS</span></a></span></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MountPoint -&gt; HasFS IO HandleIO
</span><a href="Ouroboros.Consensus.Storage.FS.IO.html#ioHasFS"><span class="hs-identifier hs-var">ioHasFS</span></a></span><span> </span><span class="annot"><span class="annottext">MountPoint
</span><a href="#local-6989586621680040531"><span class="hs-identifier hs-var">mountPoint</span></a></span><span>
</span><span id="line-366"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.Node.ProtocolInfo.html#ProtocolInfo"><span class="hs-identifier hs-type">ProtocolInfo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621680040529"><span class="annot"><span class="annottext">TopLevelConfig blk
pInfoConfig :: TopLevelConfig blk
pInfoConfig :: forall (m :: * -&gt; *) b. ProtocolInfo m b -&gt; TopLevelConfig b
</span><a href="#local-6989586621680040529"><span class="hs-identifier hs-var hs-var">pInfoConfig</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtocolInfo IO blk
</span><a href="#local-6989586621680040544"><span class="hs-identifier hs-var">rnProtocolInfo</span></a></span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#openChainDB"><span class="hs-identifier hs-type">openChainDB</span></a></span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680040917"><span class="annot"><a href="#local-6989586621680040917"><span class="hs-identifier hs-type">blk</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Run.html#RunNode"><span class="hs-identifier hs-type">RunNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040917"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-370"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/src"><span class="hs-identifier hs-type">Tracer</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html#TraceEvent"><span class="hs-identifier hs-type">ChainDB.TraceEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040917"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.ResourceRegistry.html#ResourceRegistry"><span class="hs-identifier hs-type">ResourceRegistry</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Fragment.InFuture.html#CheckInFuture"><span class="hs-identifier hs-type">CheckInFuture</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680040917"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-374"></span><span>     </span><span class="hs-comment">-- ^ Database path</span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Config.html#TopLevelConfig"><span class="hs-identifier hs-type">TopLevelConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040917"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-376"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.Extended.html#ExtLedgerState"><span class="hs-identifier hs-type">ExtLedgerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040917"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-377"></span><span>     </span><span class="hs-comment">-- ^ Initial ledger</span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-type">ChainDbArgs</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Identity</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680040917"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-type">ChainDbArgs</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Identity</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680040917"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>      </span><span class="hs-comment">-- ^ Customise the 'ChainDbArgs'</span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.API.html#ChainDB"><span class="hs-identifier hs-type">ChainDB</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680040917"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span id="openChainDB"><span class="annot"><span class="annottext">openChainDB :: Tracer IO (TraceEvent blk)
-&gt; ResourceRegistry IO
-&gt; CheckInFuture IO blk
-&gt; FilePath
-&gt; TopLevelConfig blk
-&gt; ExtLedgerState blk
-&gt; (ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk)
-&gt; IO (ChainDB IO blk)
</span><a href="Ouroboros.Consensus.Node.html#openChainDB"><span class="hs-identifier hs-var hs-var">openChainDB</span></a></span></span><span> </span><span id="local-6989586621680040522"><span class="annot"><span class="annottext">Tracer IO (TraceEvent blk)
</span><a href="#local-6989586621680040522"><span class="hs-identifier hs-var">tracer</span></a></span></span><span> </span><span id="local-6989586621680040521"><span class="annot"><span class="annottext">ResourceRegistry IO
</span><a href="#local-6989586621680040521"><span class="hs-identifier hs-var">registry</span></a></span></span><span> </span><span id="local-6989586621680040520"><span class="annot"><span class="annottext">CheckInFuture IO blk
</span><a href="#local-6989586621680040520"><span class="hs-identifier hs-var">inFuture</span></a></span></span><span> </span><span id="local-6989586621680040519"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680040519"><span class="hs-identifier hs-var">dbPath</span></a></span></span><span> </span><span id="local-6989586621680040518"><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621680040518"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621680040517"><span class="annot"><span class="annottext">ExtLedgerState blk
</span><a href="#local-6989586621680040517"><span class="hs-identifier hs-var">initLedger</span></a></span></span><span> </span><span id="local-6989586621680040516"><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk
</span><a href="#local-6989586621680040516"><span class="hs-identifier hs-var">customiseArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-382"></span><span>    </span><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk -&gt; IO (ChainDB IO blk)
forall (m :: * -&gt; *) blk.
(IOLike m, LedgerSupportsProtocol blk, InspectLedger blk,
 HasHardForkHistory blk, ConvertRawHash blk,
 SerialiseDiskConstraints blk) =&gt;
ChainDbArgs Identity m blk -&gt; m (ChainDB m blk)
</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.html#openDB"><span class="hs-identifier hs-var">ChainDB.openDB</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk
</span><a href="#local-6989586621680040514"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-384"></span><span>    </span><span class="annot"><a href="#local-6989586621680040514"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-type">ChainDbArgs</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Identity</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680040917"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-385"></span><span>    </span><span id="local-6989586621680040514"><span class="annot"><span class="annottext">args :: ChainDbArgs Identity IO blk
</span><a href="#local-6989586621680040514"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk
</span><a href="#local-6989586621680040516"><span class="hs-identifier hs-var">customiseArgs</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk)
-&gt; ChainDbArgs Identity IO blk -&gt; ChainDbArgs Identity IO blk
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-386"></span><span>             </span><span class="annot"><span class="annottext">Tracer IO (TraceEvent blk)
-&gt; ResourceRegistry IO
-&gt; CheckInFuture IO blk
-&gt; FilePath
-&gt; TopLevelConfig blk
-&gt; ExtLedgerState blk
-&gt; ChunkInfo
-&gt; ChainDbArgs Identity IO blk
forall blk.
RunNode blk =&gt;
Tracer IO (TraceEvent blk)
-&gt; ResourceRegistry IO
-&gt; CheckInFuture IO blk
-&gt; FilePath
-&gt; TopLevelConfig blk
-&gt; ExtLedgerState blk
-&gt; ChunkInfo
-&gt; ChainDbArgs Identity IO blk
</span><a href="Ouroboros.Consensus.Node.html#mkChainDbArgs"><span class="hs-identifier hs-var">mkChainDbArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO (TraceEvent blk)
</span><a href="#local-6989586621680040522"><span class="hs-identifier hs-var">tracer</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRegistry IO
</span><a href="#local-6989586621680040521"><span class="hs-identifier hs-var">registry</span></a></span><span> </span><span class="annot"><span class="annottext">CheckInFuture IO blk
</span><a href="#local-6989586621680040520"><span class="hs-identifier hs-var">inFuture</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680040519"><span class="hs-identifier hs-var">dbPath</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621680040518"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">ExtLedgerState blk
</span><a href="#local-6989586621680040517"><span class="hs-identifier hs-var">initLedger</span></a></span><span>
</span><span id="line-387"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StorageConfig blk -&gt; ChunkInfo
forall blk. NodeInitStorage blk =&gt; StorageConfig blk -&gt; ChunkInfo
</span><a href="Ouroboros.Consensus.Node.InitStorage.html#nodeImmutableDbChunkInfo"><span class="hs-identifier hs-var">nodeImmutableDbChunkInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; StorageConfig blk
forall blk. TopLevelConfig blk -&gt; StorageConfig blk
</span><a href="Ouroboros.Consensus.Config.html#configStorage"><span class="hs-identifier hs-var">configStorage</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621680040518"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#mkChainDbArgs"><span class="hs-identifier hs-type">mkChainDbArgs</span></a></span><span>
</span><span id="line-390"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680040738"><span class="annot"><a href="#local-6989586621680040738"><span class="hs-identifier hs-type">blk</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Run.html#RunNode"><span class="hs-identifier hs-type">RunNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040738"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/src"><span class="hs-identifier hs-type">Tracer</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html#TraceEvent"><span class="hs-identifier hs-type">ChainDB.TraceEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040738"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.ResourceRegistry.html#ResourceRegistry"><span class="hs-identifier hs-type">ResourceRegistry</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Fragment.InFuture.html#CheckInFuture"><span class="hs-identifier hs-type">CheckInFuture</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680040738"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-395"></span><span>     </span><span class="hs-comment">-- ^ Database path</span><span>
</span><span id="line-396"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Config.html#TopLevelConfig"><span class="hs-identifier hs-type">TopLevelConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040738"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-397"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.Extended.html#ExtLedgerState"><span class="hs-identifier hs-type">ExtLedgerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040738"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-398"></span><span>     </span><span class="hs-comment">-- ^ Initial ledger</span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.ImmutableDB.Chunks.Internal.html#ChunkInfo"><span class="hs-identifier hs-type">ChunkInfo</span></a></span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-type">ChainDbArgs</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Identity</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680040738"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-401"></span><span id="mkChainDbArgs"><span class="annot"><span class="annottext">mkChainDbArgs :: Tracer IO (TraceEvent blk)
-&gt; ResourceRegistry IO
-&gt; CheckInFuture IO blk
-&gt; FilePath
-&gt; TopLevelConfig blk
-&gt; ExtLedgerState blk
-&gt; ChunkInfo
-&gt; ChainDbArgs Identity IO blk
</span><a href="Ouroboros.Consensus.Node.html#mkChainDbArgs"><span class="hs-identifier hs-var hs-var">mkChainDbArgs</span></a></span></span><span> </span><span id="local-6989586621680040511"><span class="annot"><span class="annottext">Tracer IO (TraceEvent blk)
</span><a href="#local-6989586621680040511"><span class="hs-identifier hs-var">tracer</span></a></span></span><span> </span><span id="local-6989586621680040510"><span class="annot"><span class="annottext">ResourceRegistry IO
</span><a href="#local-6989586621680040510"><span class="hs-identifier hs-var">registry</span></a></span></span><span> </span><span id="local-6989586621680040509"><span class="annot"><span class="annottext">CheckInFuture IO blk
</span><a href="#local-6989586621680040509"><span class="hs-identifier hs-var">inFuture</span></a></span></span><span> </span><span id="local-6989586621680040508"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680040508"><span class="hs-identifier hs-var">dbPath</span></a></span></span><span> </span><span id="local-6989586621680040507"><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621680040507"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621680040506"><span class="annot"><span class="annottext">ExtLedgerState blk
</span><a href="#local-6989586621680040506"><span class="hs-identifier hs-var">initLedger</span></a></span></span><span>
</span><span id="line-402"></span><span>              </span><span id="local-6989586621680040505"><span class="annot"><span class="annottext">ChunkInfo
</span><a href="#local-6989586621680040505"><span class="hs-identifier hs-var">chunkInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; ChainDbArgs Defaults IO blk
forall blk. FilePath -&gt; ChainDbArgs Defaults IO blk
</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#defaultArgs"><span class="hs-identifier hs-var">ChainDB.defaultArgs</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621680040508"><span class="hs-identifier hs-var">dbPath</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-403"></span><span>      </span><span class="annot"><span class="annottext">cdbMaxBlocksPerFile :: BlocksPerFile
</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbMaxBlocksPerFile"><span class="hs-identifier hs-var">ChainDB.cdbMaxBlocksPerFile</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; BlocksPerFile
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.Impl.Types.html#mkBlocksPerFile"><span class="hs-identifier hs-var">mkBlocksPerFile</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">1000</span></span><span>
</span><span id="line-404"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cdbChunkInfo :: HKD Identity ChunkInfo
</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbChunkInfo"><span class="hs-identifier hs-var">ChainDB.cdbChunkInfo</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HKD Identity ChunkInfo
ChunkInfo
</span><a href="#local-6989586621680040505"><span class="hs-identifier hs-var">chunkInfo</span></a></span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cdbGenesis :: HKD Identity (IO (ExtLedgerState blk))
</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbGenesis"><span class="hs-identifier hs-var">ChainDB.cdbGenesis</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExtLedgerState blk -&gt; IO (ExtLedgerState blk)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">ExtLedgerState blk
</span><a href="#local-6989586621680040506"><span class="hs-identifier hs-var">initLedger</span></a></span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cdbDiskPolicy :: HKD Identity DiskPolicy
</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbDiskPolicy"><span class="hs-identifier hs-var">ChainDB.cdbDiskPolicy</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecurityParam -&gt; DiskPolicy
</span><a href="Ouroboros.Consensus.Storage.LedgerDB.DiskPolicy.html#defaultDiskPolicy"><span class="hs-identifier hs-var">defaultDiskPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">SecurityParam
</span><a href="#local-6989586621680040499"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-407"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cdbCheckIntegrity :: HKD Identity (blk -&gt; Bool)
</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbCheckIntegrity"><span class="hs-identifier hs-var">ChainDB.cdbCheckIntegrity</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StorageConfig blk -&gt; blk -&gt; Bool
forall blk. NodeInitStorage blk =&gt; StorageConfig blk -&gt; blk -&gt; Bool
</span><a href="Ouroboros.Consensus.Node.InitStorage.html#nodeCheckIntegrity"><span class="hs-identifier hs-var">nodeCheckIntegrity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; StorageConfig blk
forall blk. TopLevelConfig blk -&gt; StorageConfig blk
</span><a href="Ouroboros.Consensus.Config.html#configStorage"><span class="hs-identifier hs-var">configStorage</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621680040507"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cdbParamsLgrDB :: HKD Identity LedgerDbParams
</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbParamsLgrDB"><span class="hs-identifier hs-var">ChainDB.cdbParamsLgrDB</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecurityParam -&gt; LedgerDbParams
</span><a href="Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#ledgerDbDefaultParams"><span class="hs-identifier hs-var">ledgerDbDefaultParams</span></a></span><span> </span><span class="annot"><span class="annottext">SecurityParam
</span><a href="#local-6989586621680040499"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cdbTopLevelConfig :: HKD Identity (TopLevelConfig blk)
</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbTopLevelConfig"><span class="hs-identifier hs-var">ChainDB.cdbTopLevelConfig</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HKD Identity (TopLevelConfig blk)
TopLevelConfig blk
</span><a href="#local-6989586621680040507"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cdbRegistry :: HKD Identity (ResourceRegistry IO)
</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbRegistry"><span class="hs-identifier hs-var">ChainDB.cdbRegistry</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HKD Identity (ResourceRegistry IO)
ResourceRegistry IO
</span><a href="#local-6989586621680040510"><span class="hs-identifier hs-var">registry</span></a></span><span>
</span><span id="line-411"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cdbTracer :: Tracer IO (TraceEvent blk)
</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbTracer"><span class="hs-identifier hs-var">ChainDB.cdbTracer</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer IO (TraceEvent blk)
</span><a href="#local-6989586621680040511"><span class="hs-identifier hs-var">tracer</span></a></span><span>
</span><span id="line-412"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cdbImmutableDbValidation :: ValidationPolicy
</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbImmutableDbValidation"><span class="hs-identifier hs-var">ChainDB.cdbImmutableDbValidation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValidationPolicy
</span><a href="Ouroboros.Consensus.Storage.ImmutableDB.Impl.Types.html#ValidateMostRecentChunk"><span class="hs-identifier hs-var">ValidateMostRecentChunk</span></a></span><span>
</span><span id="line-413"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cdbVolatileDbValidation :: BlockValidationPolicy
</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbVolatileDbValidation"><span class="hs-identifier hs-var">ChainDB.cdbVolatileDbValidation</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockValidationPolicy
</span><a href="Ouroboros.Consensus.Storage.VolatileDB.Impl.Types.html#NoValidation"><span class="hs-identifier hs-var">NoValidation</span></a></span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cdbCheckInFuture :: HKD Identity (CheckInFuture IO blk)
</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbCheckInFuture"><span class="hs-identifier hs-var">ChainDB.cdbCheckInFuture</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HKD Identity (CheckInFuture IO blk)
CheckInFuture IO blk
</span><a href="#local-6989586621680040509"><span class="hs-identifier hs-var">inFuture</span></a></span><span>
</span><span id="line-415"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-416"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-417"></span><span>    </span><span id="local-6989586621680040499"><span class="annot"><span class="annottext">k :: SecurityParam
</span><a href="#local-6989586621680040499"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; SecurityParam
forall blk.
ConsensusProtocol (BlockProtocol blk) =&gt;
TopLevelConfig blk -&gt; SecurityParam
</span><a href="Ouroboros.Consensus.Config.html#configSecurityParam"><span class="hs-identifier hs-var">configSecurityParam</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621680040507"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span class="annot"><a href="Ouroboros.Consensus.Node.html#mkNodeArgs"><span class="hs-identifier hs-type">mkNodeArgs</span></a></span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680040887"><span class="annot"><a href="#local-6989586621680040887"><span class="hs-identifier hs-type">blk</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Run.html#RunNode"><span class="hs-identifier hs-type">RunNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040887"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.ResourceRegistry.html#ResourceRegistry"><span class="hs-identifier hs-type">ResourceRegistry</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span>
</span><span id="line-422"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Config.html#TopLevelConfig"><span class="hs-identifier hs-type">TopLevelConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040887"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Block.Forging.html#BlockForging"><span class="hs-identifier hs-type">BlockForging</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680040887"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-424"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Node.Tracers.html#Tracers"><span class="hs-identifier hs-type">Tracers</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">RemoteConnectionId</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">LocalConnectionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040887"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.BlockchainTime.API.html#BlockchainTime"><span class="hs-identifier hs-type">BlockchainTime</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.ChainDB.API.html#ChainDB"><span class="hs-identifier hs-type">ChainDB</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680040887"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeArgs"><span class="hs-identifier hs-type">NodeArgs</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">RemoteConnectionId</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">LocalConnectionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040887"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span id="mkNodeArgs"><span class="annot"><span class="annottext">mkNodeArgs :: ResourceRegistry IO
-&gt; TopLevelConfig blk
-&gt; [IO (BlockForging IO blk)]
-&gt; Tracers IO RemoteConnectionId LocalConnectionId blk
-&gt; BlockchainTime IO
-&gt; ChainDB IO blk
-&gt; IO (NodeArgs IO RemoteConnectionId LocalConnectionId blk)
</span><a href="Ouroboros.Consensus.Node.html#mkNodeArgs"><span class="hs-identifier hs-var hs-var">mkNodeArgs</span></a></span></span><span> </span><span id="local-6989586621680040488"><span class="annot"><span class="annottext">ResourceRegistry IO
</span><a href="#local-6989586621680040488"><span class="hs-identifier hs-var">registry</span></a></span></span><span> </span><span id="local-6989586621680040487"><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621680040487"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621680040486"><span class="annot"><span class="annottext">[IO (BlockForging IO blk)]
</span><a href="#local-6989586621680040486"><span class="hs-identifier hs-var">initBlockForging</span></a></span></span><span> </span><span id="local-6989586621680040485"><span class="annot"><span class="annottext">Tracers IO RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040485"><span class="hs-identifier hs-var">tracers</span></a></span></span><span> </span><span id="local-6989586621680040484"><span class="annot"><span class="annottext">BlockchainTime IO
</span><a href="#local-6989586621680040484"><span class="hs-identifier hs-var">btime</span></a></span></span><span> </span><span id="local-6989586621680040483"><span class="annot"><span class="annottext">ChainDB IO blk
</span><a href="#local-6989586621680040483"><span class="hs-identifier hs-var">chainDB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-429"></span><span>    </span><span id="local-6989586621680040482"><span class="annot"><span class="annottext">[BlockForging IO blk]
</span><a href="#local-6989586621680040482"><span class="hs-identifier hs-var">blockForging</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[IO (BlockForging IO blk)] -&gt; IO [BlockForging IO blk]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="annot"><span class="annottext">[IO (BlockForging IO blk)]
</span><a href="#local-6989586621680040486"><span class="hs-identifier hs-var">initBlockForging</span></a></span><span>
</span><span id="line-430"></span><span>    </span><span id="local-6989586621680040480"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680040480"><span class="hs-identifier hs-var">bfsalt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int
forall a. Random a =&gt; IO a
</span><span class="hs-identifier hs-var">randomIO</span></span><span> </span><span class="hs-comment">-- Per-node specific value used by blockfetch when ranking peers.</span><span>
</span><span id="line-431"></span><span>    </span><span id="local-6989586621680040479"><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621680040479"><span class="hs-identifier hs-var">keepAliveRng</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO StdGen
</span><span class="hs-identifier hs-var">newStdGen</span></span><span>
</span><span id="line-432"></span><span>    </span><span class="annot"><span class="annottext">NodeArgs IO RemoteConnectionId LocalConnectionId blk
-&gt; IO (NodeArgs IO RemoteConnectionId LocalConnectionId blk)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">NodeArgs :: forall (m :: * -&gt; *) remotePeer localPeer blk.
Tracers m remotePeer localPeer blk
-&gt; ResourceRegistry m
-&gt; TopLevelConfig blk
-&gt; BlockchainTime m
-&gt; ChainDB m blk
-&gt; (StorageConfig blk -&gt; InitChainDB m blk -&gt; m ())
-&gt; (Header blk -&gt; Word32)
-&gt; [BlockForging m blk]
-&gt; MaxTxCapacityOverride
-&gt; MempoolCapacityBytesOverride
-&gt; MiniProtocolParameters
-&gt; BlockFetchConfiguration
-&gt; StdGen
-&gt; NodeArgs m remotePeer localPeer blk
</span><a href="Ouroboros.Consensus.NodeKernel.html#NodeArgs"><span class="hs-identifier hs-type">NodeArgs</span></a></span><span>
</span><span id="line-433"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Tracers IO RemoteConnectionId LocalConnectionId blk
$sel:tracers:NodeArgs :: Tracers IO RemoteConnectionId LocalConnectionId blk
tracers :: Tracers IO RemoteConnectionId LocalConnectionId blk
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3Atracers%3ANodeArgs"><span class="hs-identifier hs-var hs-var">tracers</span></a></span><span>
</span><span id="line-434"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ResourceRegistry IO
$sel:registry:NodeArgs :: ResourceRegistry IO
registry :: ResourceRegistry IO
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3Aregistry%3ANodeArgs"><span class="hs-identifier hs-var hs-var">registry</span></a></span><span>
</span><span id="line-435"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
$sel:cfg:NodeArgs :: TopLevelConfig blk
cfg :: TopLevelConfig blk
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3Acfg%3ANodeArgs"><span class="hs-identifier hs-var hs-var">cfg</span></a></span><span>
</span><span id="line-436"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BlockchainTime IO
$sel:btime:NodeArgs :: BlockchainTime IO
btime :: BlockchainTime IO
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3Abtime%3ANodeArgs"><span class="hs-identifier hs-var hs-var">btime</span></a></span><span>
</span><span id="line-437"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ChainDB IO blk
$sel:chainDB:NodeArgs :: ChainDB IO blk
chainDB :: ChainDB IO blk
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AchainDB%3ANodeArgs"><span class="hs-identifier hs-var hs-var">chainDB</span></a></span><span>
</span><span id="line-438"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:blockForging:NodeArgs :: [BlockForging IO blk]
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AblockForging%3ANodeArgs"><span class="hs-identifier hs-var">blockForging</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BlockForging IO blk]
</span><a href="#local-6989586621680040482"><span class="hs-identifier hs-var">blockForging</span></a></span><span>
</span><span id="line-439"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:initChainDB:NodeArgs :: StorageConfig blk -&gt; InitChainDB IO blk -&gt; IO ()
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AinitChainDB%3ANodeArgs"><span class="hs-identifier hs-var">initChainDB</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StorageConfig blk -&gt; InitChainDB IO blk -&gt; IO ()
forall blk (m :: * -&gt; *).
(NodeInitStorage blk, IOLike m) =&gt;
StorageConfig blk -&gt; InitChainDB m blk -&gt; m ()
</span><a href="Ouroboros.Consensus.Node.InitStorage.html#nodeInitChainDB"><span class="hs-identifier hs-var">nodeInitChainDB</span></a></span><span>
</span><span id="line-440"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:blockFetchSize:NodeArgs :: Header blk -&gt; Word32
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AblockFetchSize%3ANodeArgs"><span class="hs-identifier hs-var">blockFetchSize</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Header blk -&gt; Word32
forall blk.
SerialiseNodeToNodeConstraints blk =&gt;
Header blk -&gt; Word32
</span><a href="Ouroboros.Consensus.Node.Run.html#estimateBlockSize"><span class="hs-identifier hs-var">estimateBlockSize</span></a></span><span>
</span><span id="line-441"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:maxTxCapacityOverride:NodeArgs :: MaxTxCapacityOverride
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AmaxTxCapacityOverride%3ANodeArgs"><span class="hs-identifier hs-var">maxTxCapacityOverride</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaxTxCapacityOverride
</span><a href="Ouroboros.Consensus.NodeKernel.html#NoMaxTxCapacityOverride"><span class="hs-identifier hs-var">NoMaxTxCapacityOverride</span></a></span><span>
</span><span id="line-442"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:mempoolCapacityOverride:NodeArgs :: MempoolCapacityBytesOverride
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AmempoolCapacityOverride%3ANodeArgs"><span class="hs-identifier hs-var">mempoolCapacityOverride</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MempoolCapacityBytesOverride
</span><a href="Ouroboros.Consensus.Mempool.Impl.html#NoMempoolCapacityBytesOverride"><span class="hs-identifier hs-var">NoMempoolCapacityBytesOverride</span></a></span><span>
</span><span id="line-443"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:miniProtocolParameters:NodeArgs :: MiniProtocolParameters
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AminiProtocolParameters%3ANodeArgs"><span class="hs-identifier hs-var">miniProtocolParameters</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">defaultMiniProtocolParameters</span></a></span><span>
</span><span id="line-444"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:blockFetchConfiguration:NodeArgs :: BlockFetchConfiguration
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AblockFetchConfiguration%3ANodeArgs"><span class="hs-identifier hs-var">blockFetchConfiguration</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BlockFetchConfiguration
</span><a href="#local-6989586621680040462"><span class="hs-identifier hs-var">defaultBlockFetchConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680040480"><span class="hs-identifier hs-var">bfsalt</span></a></span><span>
</span><span id="line-445"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:keepAliveRng:NodeArgs :: StdGen
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AkeepAliveRng%3ANodeArgs"><span class="hs-identifier hs-var">keepAliveRng</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621680040479"><span class="hs-identifier hs-var">keepAliveRng</span></a></span><span>
</span><span id="line-446"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-448"></span><span>    </span><span class="annot"><a href="#local-6989586621680040462"><span class="hs-identifier hs-type">defaultBlockFetchConfiguration</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">BlockFetchConfiguration</span></a></span><span>
</span><span id="line-449"></span><span>    </span><span id="local-6989586621680040462"><span class="annot"><span class="annottext">defaultBlockFetchConfiguration :: Int -&gt; BlockFetchConfiguration
</span><a href="#local-6989586621680040462"><span class="hs-identifier hs-var hs-var">defaultBlockFetchConfiguration</span></a></span></span><span> </span><span id="local-6989586621680040460"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680040460"><span class="hs-identifier hs-var">bfsalt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockFetchConfiguration :: Word -&gt; Word -&gt; Word -&gt; DiffTime -&gt; Int -&gt; BlockFetchConfiguration
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">BlockFetchConfiguration</span></a></span><span>
</span><span id="line-450"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">bfcMaxConcurrencyBulkSync :: Word
</span><a href="#local-6989586621680040458"><span class="hs-identifier hs-var">bfcMaxConcurrencyBulkSync</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span>
</span><span id="line-451"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bfcMaxConcurrencyDeadline :: Word
</span><a href="#local-6989586621680040457"><span class="hs-identifier hs-var">bfcMaxConcurrencyDeadline</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span>
</span><span id="line-452"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bfcMaxRequestsInflight :: Word
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">bfcMaxRequestsInflight</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters -&gt; Word
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var hs-var">blockFetchPipeliningMax</span></a></span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">defaultMiniProtocolParameters</span></a></span><span>
</span><span id="line-453"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bfcDecisionLoopInterval :: DiffTime
</span><a href="#local-6989586621680040454"><span class="hs-identifier hs-var">bfcDecisionLoopInterval</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">0.01</span></span><span> </span><span class="hs-comment">-- 10ms</span><span>
</span><span id="line-454"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bfcSalt :: Int
</span><a href="#local-6989586621680040453"><span class="hs-identifier hs-var">bfcSalt</span></a></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680040460"><span class="hs-identifier hs-var">bfsalt</span></a></span><span>
</span><span id="line-455"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="hs-comment">-- | We allow the user running the node to customise the 'NodeArgs' through</span><span>
</span><span id="line-458"></span><span class="hs-comment">-- 'rnCustomiseNodeArgs', but there are some limits to some values. This</span><span>
</span><span id="line-459"></span><span class="hs-comment">-- function makes sure we don't exceed those limits and that the values are</span><span>
</span><span id="line-460"></span><span class="hs-comment">-- consistent.</span><span>
</span><span id="line-461"></span><span id="local-6989586621680040892"><span id="local-6989586621680040893"><span class="annot"><a href="Ouroboros.Consensus.Node.html#nodeArgsEnforceInvariants"><span class="hs-identifier hs-type">nodeArgsEnforceInvariants</span></a></span><span>
</span><span id="line-462"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeArgs"><span class="hs-identifier hs-type">NodeArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040893"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">RemoteConnectionId</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">LocalConnectionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040892"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeArgs"><span class="hs-identifier hs-type">NodeArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040893"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">RemoteConnectionId</span></a></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">LocalConnectionId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680040892"><span class="hs-identifier hs-type">blk</span></a></span></span></span><span>
</span><span id="line-464"></span><span id="nodeArgsEnforceInvariants"><span class="annot"><span class="annottext">nodeArgsEnforceInvariants :: NodeArgs m RemoteConnectionId LocalConnectionId blk
-&gt; NodeArgs m RemoteConnectionId LocalConnectionId blk
</span><a href="Ouroboros.Consensus.Node.html#nodeArgsEnforceInvariants"><span class="hs-identifier hs-var hs-var">nodeArgsEnforceInvariants</span></a></span></span><span> </span><span id="local-6989586621680040452"><span class="annot"><span class="annottext">nodeArgs :: NodeArgs m RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040452"><span class="hs-identifier hs-var">nodeArgs</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Ouroboros.Consensus.NodeKernel.html#NodeArgs"><span class="hs-identifier hs-type">NodeArgs</span></a></span><span class="hs-special">{</span><span id="local-6989586621680040439"><span id="local-6989586621680040440"><span id="local-6989586621680040441"><span id="local-6989586621680040442"><span id="local-6989586621680040443"><span id="local-6989586621680040444"><span id="local-6989586621680040445"><span id="local-6989586621680040446"><span id="local-6989586621680040447"><span id="local-6989586621680040448"><span id="local-6989586621680040449"><span id="local-6989586621680040450"><span id="local-6989586621680040451"><span class="annot"><span class="annottext">[BlockForging m blk]
MiniProtocolParameters
BlockFetchConfiguration
StdGen
TopLevelConfig blk
ResourceRegistry m
ChainDB m blk
BlockchainTime m
Tracers m RemoteConnectionId LocalConnectionId blk
MempoolCapacityBytesOverride
MaxTxCapacityOverride
Header blk -&gt; Word32
StorageConfig blk -&gt; InitChainDB m blk -&gt; m ()
keepAliveRng :: StdGen
blockFetchConfiguration :: BlockFetchConfiguration
miniProtocolParameters :: MiniProtocolParameters
mempoolCapacityOverride :: MempoolCapacityBytesOverride
maxTxCapacityOverride :: MaxTxCapacityOverride
blockForging :: [BlockForging m blk]
blockFetchSize :: Header blk -&gt; Word32
initChainDB :: StorageConfig blk -&gt; InitChainDB m blk -&gt; m ()
chainDB :: ChainDB m blk
btime :: BlockchainTime m
cfg :: TopLevelConfig blk
registry :: ResourceRegistry m
tracers :: Tracers m RemoteConnectionId LocalConnectionId blk
$sel:keepAliveRng:NodeArgs :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeArgs m remotePeer localPeer blk -&gt; StdGen
$sel:blockFetchConfiguration:NodeArgs :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeArgs m remotePeer localPeer blk -&gt; BlockFetchConfiguration
$sel:mempoolCapacityOverride:NodeArgs :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeArgs m remotePeer localPeer blk -&gt; MempoolCapacityBytesOverride
$sel:maxTxCapacityOverride:NodeArgs :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeArgs m remotePeer localPeer blk -&gt; MaxTxCapacityOverride
$sel:blockFetchSize:NodeArgs :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeArgs m remotePeer localPeer blk -&gt; Header blk -&gt; Word32
$sel:initChainDB:NodeArgs :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeArgs m remotePeer localPeer blk
-&gt; StorageConfig blk -&gt; InitChainDB m blk -&gt; m ()
$sel:blockForging:NodeArgs :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeArgs m remotePeer localPeer blk -&gt; [BlockForging m blk]
$sel:chainDB:NodeArgs :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeArgs m remotePeer localPeer blk -&gt; ChainDB m blk
$sel:btime:NodeArgs :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeArgs m remotePeer localPeer blk -&gt; BlockchainTime m
$sel:cfg:NodeArgs :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeArgs m remotePeer localPeer blk -&gt; TopLevelConfig blk
$sel:registry:NodeArgs :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeArgs m remotePeer localPeer blk -&gt; ResourceRegistry m
$sel:tracers:NodeArgs :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeArgs m remotePeer localPeer blk
-&gt; Tracers m remotePeer localPeer blk
$sel:miniProtocolParameters:NodeArgs :: forall (m :: * -&gt; *) remotePeer localPeer blk.
NodeArgs m remotePeer localPeer blk -&gt; MiniProtocolParameters
</span><a href="#local-6989586621680040439"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeArgs m RemoteConnectionId LocalConnectionId blk
</span><a href="#local-6989586621680040452"><span class="hs-identifier hs-var">nodeArgs</span></a></span><span>
</span><span id="line-465"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:miniProtocolParameters:NodeArgs :: MiniProtocolParameters
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AminiProtocolParameters%3ANodeArgs"><span class="hs-identifier hs-var">miniProtocolParameters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="#local-6989586621680040441"><span class="hs-identifier hs-var">miniProtocolParameters</span></a></span><span>
</span><span id="line-466"></span><span>        </span><span class="hs-comment">-- If 'blockFetchPipeliningMax' exceeds the configured default, it</span><span>
</span><span id="line-467"></span><span>        </span><span class="hs-comment">-- would be a protocol violation.</span><span>
</span><span id="line-468"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">blockFetchPipeliningMax :: Word
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">blockFetchPipeliningMax</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-469"></span><span>            </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MiniProtocolParameters -&gt; Word
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var hs-var">blockFetchPipeliningMax</span></a></span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="#local-6989586621680040441"><span class="hs-identifier hs-var">miniProtocolParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MiniProtocolParameters -&gt; Word
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var hs-var">blockFetchPipeliningMax</span></a></span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">defaultMiniProtocolParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-472"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:blockFetchConfiguration:NodeArgs :: BlockFetchConfiguration
</span><a href="Ouroboros.Consensus.NodeKernel.html#%24sel%3AblockFetchConfiguration%3ANodeArgs"><span class="hs-identifier hs-var">blockFetchConfiguration</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockFetchConfiguration
</span><a href="#local-6989586621680040440"><span class="hs-identifier hs-var">blockFetchConfiguration</span></a></span><span>
</span><span id="line-473"></span><span>        </span><span class="hs-comment">-- 'bfcMaxRequestsInflight' must be &lt;= 'blockFetchPipeliningMax'</span><span>
</span><span id="line-474"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">bfcMaxRequestsInflight :: Word
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">bfcMaxRequestsInflight</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-475"></span><span>            </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockFetchConfiguration -&gt; Word
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var hs-var">bfcMaxRequestsInflight</span></a></span><span> </span><span class="annot"><span class="annottext">BlockFetchConfiguration
</span><a href="#local-6989586621680040440"><span class="hs-identifier hs-var">blockFetchConfiguration</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MiniProtocolParameters -&gt; Word
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var hs-var">blockFetchPipeliningMax</span></a></span><span> </span><span class="annot"><span class="annottext">MiniProtocolParameters
</span><a href="#local-6989586621680040441"><span class="hs-identifier hs-var">miniProtocolParameters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-478"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-479"></span></pre></body></html>