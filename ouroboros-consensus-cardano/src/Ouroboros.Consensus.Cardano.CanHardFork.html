<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds          #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds                #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass           #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric            #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DisambiguateRecordFields #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts         #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances        #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase               #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses    #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns           #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings        #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards          #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables      #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TupleSections            #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications         #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies             #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators            #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances     #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-20"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.Cardano.CanHardFork</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#TriggerHardFork"><span class="hs-identifier">TriggerHardFork</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#ByronPartialLedgerConfig"><span class="hs-identifier">ByronPartialLedgerConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#ShelleyPartialLedgerConfig"><span class="hs-identifier">ShelleyPartialLedgerConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#CardanoHardForkConstraints"><span class="hs-identifier">CardanoHardForkConstraints</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#forecastAcrossShelley"><span class="hs-identifier">forecastAcrossShelley</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateChainDepStateAcrossShelley"><span class="hs-identifier">translateChainDepStateAcrossShelley</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Except</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runExcept</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwError</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">listToMaybe</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Data.SOP.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">NP</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unComp</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(:.:)</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Void</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Void</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">NoThunks.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NoThunks</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Cardano.Crypto.DSIGN</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ed25519DSIGN</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Cardano.Crypto.Hash.Blake2b</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Blake2b_224</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Blake2b_256</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Chain.Common</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CC</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Chain.Genesis</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CC.Genesis</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Chain.Update</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CC.Update</span></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Block</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Forecast</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.HardFork.History</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Bound</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">boundSlot</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>                     </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">addSlots</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Ledger.Abstract</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.TypeFamilyWrappers</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Util</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">eitherToMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Util.RedundantConstraints</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.State.Types</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Util.InPairs</span></a></span><span>
</span><span id="line-59"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">RequiringBoth</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">ignoringBoth</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Util.Tails</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Tails</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier">Ouroboros.Consensus.Byron.Ledger</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier">Ouroboros.Consensus.Byron.Ledger.Inspect</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Byron.Inspect</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier">Ouroboros.Consensus.Byron.Node</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Protocol.PBFT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">PBft</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">PBftCrypto</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Protocol.PBFT.State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">PBftState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Protocol.PBFT.State</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PBftState</span></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier">Ouroboros.Consensus.Shelley.Ledger</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier">Ouroboros.Consensus.Shelley.Ledger.Inspect</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Shelley.Inspect</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier">Ouroboros.Consensus.Shelley.Node</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier">Ouroboros.Consensus.Shelley.Protocol</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Allegra.Translation</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Crypto</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ADDRHASH</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">DSIGN</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">HASH</span></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Era</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SL</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Mary.Translation</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Shelley.Spec.Ledger.API</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SL</span></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Cardano.Block.html"><span class="hs-identifier">Ouroboros.Consensus.Cardano.Block</span></a></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Figure out the transition point for Byron

  The Byron ledger defines the update 'State' in
  &quot;Cardano.Chain.Update.Validation.Interface&quot;. The critical piece of state we
  need is

  &gt; candidateProtocolUpdates :: ![CandidateProtocolUpdate]

  which are the update proposals that have been voted on, accepted, and
  endorsed, and now need to become stable. In `tryBumpVersion`
  (&quot;Cardano.Chain.Update.Validation.Interface.ProtocolVersionBump&quot;) we
  find the candidates that are at least 'kUpdateStabilityParam' (@== 4k@) deep,
  and then construct

  &gt; State
  &gt; { nextProtocolVersion    = cpuProtocolVersion
  &gt; , nextProtocolParameters = cpuProtocolParameters
  &gt; }

  (with 'State' from &quot;Cardano.Chain.Update.Validation.Interface.ProtocolVersionBump&quot;)
  where 'cpuProtocolVersion'/'cpuProtocolParameters' are the version and
  parameters from the update. This then ends up in the following callstack

  &gt; applyChainTick
  &gt; |
  &gt; \-- epochTransition
  &gt;     |
  &gt;     \-- registerEpoch
  &gt;         |
  &gt;         \-- tryBumpVersion

  Now, if this is changing the major version of the protocol, then this actually
  indicates the transition to Shelley, and the Byron 'applyChainTick' won't
  actually happen. Instead, in 'singleEraTransition' we will report the
  'EpochNo' of the transition as soon as it's @2k@ (not @4k@!) deep: in other
  words, as soon as it is stable; at this point, the HFC will do the rest.

  A slightly subtle point is that the Byron ledger does not record any
  information about /past/ updates to the protocol parameters, and so if we
  /were/ to ask the Byron ledger /after/ the update when the transition is
  going to take place (did take place), it will say 'Nothing': transition not
  yet known. In practice this won't matter, as it will have been translated to
  a Shelley ledger at that point.
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#byronTransition"><span class="hs-identifier hs-type">byronTransition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">PartialLedgerConfig</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">ByronBlock</span></a></span><span>
</span><span id="line-129"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span>   </span><span class="hs-comment">-- ^ Shelley major protocol version</span><span>
</span><span id="line-130"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">ByronBlock</span></a></span><span>
</span><span id="line-131"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span>
</span><span id="line-132"></span><span id="byronTransition"><span class="annot"><span class="annottext">byronTransition :: PartialLedgerConfig ByronBlock
-&gt; Word16 -&gt; LedgerState ByronBlock -&gt; Maybe EpochNo
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#byronTransition"><span class="hs-identifier hs-var hs-var">byronTransition</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#ByronPartialLedgerConfig"><span class="hs-identifier hs-type">ByronPartialLedgerConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621679286770"><span id="local-6989586621679286771"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#byronTriggerHardFork"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679286767"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679286767"><span class="hs-identifier hs-var">shelleyMajorVersion</span></a></span></span><span> </span><span id="local-6989586621679286766"><span class="annot"><span class="annottext">LedgerState ByronBlock
</span><a href="#local-6989586621679286766"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><span class="annottext">[EpochNo] -&gt; Maybe EpochNo
forall a. [a] -&gt; Maybe a
</span><a href="#local-6989586621679286765"><span class="hs-identifier hs-var">takeAny</span></a></span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><span class="annottext">([EpochNo] -&gt; Maybe EpochNo)
-&gt; (LedgerState ByronBlock -&gt; [EpochNo])
-&gt; LedgerState ByronBlock
-&gt; Maybe EpochNo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ProtocolUpdate -&gt; Maybe EpochNo) -&gt; [ProtocolUpdate] -&gt; [EpochNo]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">ProtocolUpdate -&gt; Maybe EpochNo
</span><a href="#local-6989586621679286763"><span class="hs-identifier hs-var">isTransitionToShelley</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><span class="annottext">([ProtocolUpdate] -&gt; [EpochNo])
-&gt; (LedgerState ByronBlock -&gt; [ProtocolUpdate])
-&gt; LedgerState ByronBlock
-&gt; [EpochNo]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LedgerConfig ByronBlock
-&gt; LedgerState ByronBlock -&gt; [ProtocolUpdate]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-var">Byron.Inspect.protocolUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerConfig ByronBlock
</span><a href="#local-6989586621679286771"><span class="hs-identifier hs-var">byronLedgerConfig</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><span class="annottext">(LedgerState ByronBlock -&gt; Maybe EpochNo)
-&gt; LedgerState ByronBlock -&gt; Maybe EpochNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LedgerState ByronBlock
</span><a href="#local-6989586621679286766"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">ByronTransitionInfo</span></a></span><span> </span><span id="local-6989586621679286760"><span class="annot"><span class="annottext">Map ProtocolVersion BlockNo
</span><a href="#local-6989586621679286760"><span class="hs-identifier hs-var">transitionInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerState ByronBlock -&gt; ByronTransition
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-var hs-var">byronLedgerTransition</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState ByronBlock
</span><a href="#local-6989586621679286766"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621679286758"><span class="annot"><span class="annottext">genesis :: LedgerConfig ByronBlock
</span><a href="#local-6989586621679286758"><span class="hs-identifier hs-var hs-var">genesis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerConfig ByronBlock
</span><a href="#local-6989586621679286771"><span class="hs-identifier hs-var">byronLedgerConfig</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621679286757"><span class="annot"><span class="annottext">k :: BlockCount
</span><a href="#local-6989586621679286757"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenesisData -&gt; BlockCount
</span><span class="hs-identifier hs-var hs-var">CC.Genesis.gdK</span></span><span> </span><span class="annot"><span class="annottext">(GenesisData -&gt; BlockCount) -&gt; GenesisData -&gt; BlockCount
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Config -&gt; GenesisData
</span><span class="hs-identifier hs-var hs-var">CC.Genesis.configGenesisData</span></span><span> </span><span class="annot"><span class="annottext">LedgerConfig ByronBlock
Config
</span><a href="#local-6989586621679286758"><span class="hs-identifier hs-var">genesis</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><a href="#local-6989586621679286763"><span class="hs-identifier hs-type">isTransitionToShelley</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">Byron.Inspect.ProtocolUpdate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span>
</span><span id="line-144"></span><span>    </span><span id="local-6989586621679286763"><span class="annot"><span class="annottext">isTransitionToShelley :: ProtocolUpdate -&gt; Maybe EpochNo
</span><a href="#local-6989586621679286763"><span class="hs-identifier hs-var hs-var">isTransitionToShelley</span></a></span></span><span> </span><span id="local-6989586621679286754"><span class="annot"><span class="annottext">ProtocolUpdate
</span><a href="#local-6989586621679286754"><span class="hs-identifier hs-var">update</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-145"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion -&gt; Word16
</span><span class="hs-identifier hs-var hs-var">CC.Update.pvMajor</span></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679286752"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679286767"><span class="hs-identifier hs-var">shelleyMajorVersion</span></a></span><span>
</span><span id="line-146"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ProtocolUpdate -&gt; UpdateState
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-var hs-var">Byron.Inspect.protocolUpdateState</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolUpdate
</span><a href="#local-6989586621679286754"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-147"></span><span>          </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">Byron.Inspect.UpdateCandidate</span></a></span><span> </span><span id="local-6989586621679286749"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679286749"><span class="hs-identifier hs-var">_becameCandidateSlotNo</span></a></span></span><span> </span><span id="local-6989586621679286748"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679286748"><span class="hs-identifier hs-var">adoptedIn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-148"></span><span>            </span><span id="local-6989586621679286747"><span class="annot"><span class="annottext">BlockNo
</span><a href="#local-6989586621679286747"><span class="hs-identifier hs-var">becameCandidateBlockNo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ProtocolVersion -&gt; Map ProtocolVersion BlockNo -&gt; Maybe BlockNo
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679286752"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">Map ProtocolVersion BlockNo
</span><a href="#local-6989586621679286760"><span class="hs-identifier hs-var">transitionInfo</span></a></span><span>
</span><span id="line-149"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BlockNo -&gt; Bool
</span><a href="#local-6989586621679286745"><span class="hs-identifier hs-var">isReallyStable</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNo
</span><a href="#local-6989586621679286747"><span class="hs-identifier hs-var">becameCandidateBlockNo</span></a></span><span>
</span><span id="line-150"></span><span>            </span><span class="annot"><span class="annottext">EpochNo -&gt; Maybe EpochNo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679286748"><span class="hs-identifier hs-var">adoptedIn</span></a></span><span>
</span><span id="line-151"></span><span>          </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">Byron.Inspect.UpdateStableCandidate</span></a></span><span> </span><span id="local-6989586621679286743"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679286743"><span class="hs-identifier hs-var">adoptedIn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-152"></span><span>            </span><span class="hs-comment">-- If the Byron ledger thinks it's stable, it's _definitely_ stable</span><span>
</span><span id="line-153"></span><span>            </span><span class="annot"><span class="annottext">EpochNo -&gt; Maybe EpochNo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679286743"><span class="hs-identifier hs-var">adoptedIn</span></a></span><span>
</span><span id="line-154"></span><span>          </span><span id="local-6989586621679286742"><span class="annot"><span class="annottext">UpdateState
</span><a href="#local-6989586621679286742"><span class="hs-identifier hs-var">_otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-155"></span><span>            </span><span class="hs-comment">-- The proposal isn't yet a candidate, never mind a stable one</span><span>
</span><span id="line-156"></span><span>            </span><span class="annot"><span class="annottext">Maybe EpochNo
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-157"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-158"></span><span>        </span><span class="annot"><a href="#local-6989586621679286752"><span class="hs-identifier hs-type">version</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CC.Update.ProtocolVersion</span></span><span>
</span><span id="line-159"></span><span>        </span><span id="local-6989586621679286752"><span class="annot"><span class="annottext">version :: ProtocolVersion
</span><a href="#local-6989586621679286752"><span class="hs-identifier hs-var hs-var">version</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtocolUpdate -&gt; ProtocolVersion
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-var hs-var">Byron.Inspect.protocolUpdateVersion</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolUpdate
</span><a href="#local-6989586621679286754"><span class="hs-identifier hs-var">update</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-comment">-- Normally, stability in the ledger is defined in terms of slots, not</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-comment">-- blocks. Byron considers the proposal to be stable after the slot is more</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-comment">-- than @2k@ old. That is not wrong: after @2k@, the block indeed is stable.</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-comment">-- Unfortunately, this means that the /conclusion about stability itself/</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-comment">-- is /not/ stable: if we were to switch to a denser fork, we might change</span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-comment">-- our mind (on the sparse chain we thought the block was already stable,</span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-comment">-- but on the dense chain we conclude it is it not yet stable).</span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-comment">-- It is unclear at the moment if this presents a problem; the HFC assumes</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-comment">-- monotonicity of timing info, in the sense that that any slot/time</span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-comment">-- conversions are either unknown or else not subject to rollback.</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-comment">-- The problem sketched above might mean that we can go from &quot;conversion</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-comment">-- known&quot; to &quot;conversion unknown&quot;, but then when we go back again to</span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-comment">-- &quot;conversion known&quot;, we /are/ guaranteed that we'd get the same answer.</span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-comment">-- Rather than trying to analyse this subtle problem, we instead base</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-comment">-- stability on block numbers; after the block is `k` deep, we know for sure</span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-comment">-- that it is stable, and moreover, no matter which chain we switch to, that</span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-comment">-- will remain to be the case.</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-comment">-- The Byron 'UpdateState' records the 'SlotNo' of the block in which the</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-comment">-- proposal became a candidate (i.e., when the last required endorsement</span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-comment">-- came in). That doesn't tell us very much, we need to know the block</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-comment">-- number; that's precisely what the 'ByronTransition' part of the Byron</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-comment">-- state tells us.</span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><a href="#local-6989586621679286745"><span class="hs-identifier hs-type">isReallyStable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BlockNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-188"></span><span>    </span><span id="local-6989586621679286745"><span class="annot"><span class="annottext">isReallyStable :: BlockNo -&gt; Bool
</span><a href="#local-6989586621679286745"><span class="hs-identifier hs-var hs-var">isReallyStable</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BlockNo</span></span><span> </span><span id="local-6989586621679286738"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679286738"><span class="hs-identifier hs-var">bno</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679286737"><span class="hs-identifier hs-var">distance</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">BlockCount -&gt; Word64
</span><span class="hs-identifier hs-var hs-var">CC.unBlockCount</span></span><span> </span><span class="annot"><span class="annottext">BlockCount
</span><a href="#local-6989586621679286757"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-189"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-190"></span><span>        </span><span class="annot"><a href="#local-6989586621679286737"><span class="hs-identifier hs-type">distance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-191"></span><span>        </span><span id="local-6989586621679286737"><span class="annot"><span class="annottext">distance :: Word64
</span><a href="#local-6989586621679286737"><span class="hs-identifier hs-var hs-var">distance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LedgerState ByronBlock -&gt; WithOrigin BlockNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-var hs-var">byronLedgerTipBlockNo</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState ByronBlock
</span><a href="#local-6989586621679286766"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-192"></span><span>                     </span><span class="annot"><span class="annottext">WithOrigin BlockNo
</span><span class="hs-identifier hs-var">Origin</span></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679286738"><span class="hs-identifier hs-var">bno</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1</span></span><span>
</span><span id="line-193"></span><span>                     </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">NotOrigin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BlockNo</span></span><span> </span><span id="local-6989586621679286731"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679286731"><span class="hs-identifier hs-var">tip</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679286731"><span class="hs-identifier hs-var">tip</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679286738"><span class="hs-identifier hs-var">bno</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-comment">-- We only expect a single proposal that updates to Shelley, but in case</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-comment">-- there are multiple, any one will do</span><span>
</span><span id="line-197"></span><span>    </span><span id="local-6989586621679287142"><span class="annot"><a href="#local-6989586621679286765"><span class="hs-identifier hs-type">takeAny</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679287142"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679287142"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621679286765"><span class="annot"><span class="annottext">takeAny :: [a] -&gt; Maybe a
</span><a href="#local-6989586621679286765"><span class="hs-identifier hs-var hs-var">takeAny</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Maybe a
forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Figure out the transition point for Shelley
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#shelleyTransition"><span class="hs-identifier hs-type">shelleyTransition</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-205"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679287014"><span class="annot"><a href="#local-6989586621679287014"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679287014"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">PartialLedgerConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679287014"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span>   </span><span class="hs-comment">-- ^ Next era's major protocol version</span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679287014"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span>
</span><span id="line-210"></span><span id="shelleyTransition"><span class="annot"><span class="annottext">shelleyTransition :: PartialLedgerConfig (ShelleyBlock era)
-&gt; Word16 -&gt; LedgerState (ShelleyBlock era) -&gt; Maybe EpochNo
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#shelleyTransition"><span class="hs-identifier hs-var hs-var">shelleyTransition</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#ShelleyPartialLedgerConfig"><span class="hs-identifier hs-type">ShelleyPartialLedgerConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621679286727"><span id="local-6989586621679286728"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#shelleyTriggerHardFork"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span>
</span><span id="line-211"></span><span>                  </span><span id="local-6989586621679286724"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679286724"><span class="hs-identifier hs-var">transitionMajorVersion</span></a></span></span><span>
</span><span id="line-212"></span><span>                  </span><span id="local-6989586621679286723"><span class="annot"><span class="annottext">LedgerState (ShelleyBlock era)
</span><a href="#local-6989586621679286723"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-213"></span><span>      </span><span class="annot"><span class="annottext">[EpochNo] -&gt; Maybe EpochNo
forall a. [a] -&gt; Maybe a
</span><a href="#local-6989586621679286722"><span class="hs-identifier hs-var">takeAny</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><span class="annottext">([EpochNo] -&gt; Maybe EpochNo)
-&gt; (LedgerState (ShelleyBlock era) -&gt; [EpochNo])
-&gt; LedgerState (ShelleyBlock era)
-&gt; Maybe EpochNo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ProtocolUpdate era -&gt; Maybe EpochNo)
-&gt; [ProtocolUpdate era] -&gt; [EpochNo]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">ProtocolUpdate era -&gt; Maybe EpochNo
</span><a href="#local-6989586621679286721"><span class="hs-identifier hs-var">isTransition</span></a></span><span>
</span><span id="line-215"></span><span>    </span><span class="annot"><span class="annottext">([ProtocolUpdate era] -&gt; [EpochNo])
-&gt; (LedgerState (ShelleyBlock era) -&gt; [ProtocolUpdate era])
-&gt; LedgerState (ShelleyBlock era)
-&gt; [EpochNo]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis era
-&gt; LedgerState (ShelleyBlock era) -&gt; [ProtocolUpdate era]
forall era.
ShelleyBasedEra era =&gt;
ShelleyGenesis era
-&gt; LedgerState (ShelleyBlock era) -&gt; [ProtocolUpdate era]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">Shelley.Inspect.protocolUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis era
</span><a href="#local-6989586621679286719"><span class="hs-identifier hs-var">genesis</span></a></span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><span class="annottext">(LedgerState (ShelleyBlock era) -&gt; Maybe EpochNo)
-&gt; LedgerState (ShelleyBlock era) -&gt; Maybe EpochNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LedgerState (ShelleyBlock era)
</span><a href="#local-6989586621679286723"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-218"></span><span>    </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyTransitionInfo</span></a></span><span class="hs-special">{</span><span id="local-6989586621679286717"><span class="annot"><span class="annottext">Word32
shelleyAfterVoting :: ShelleyTransition -&gt; Word32
shelleyAfterVoting :: Word32
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-glyph hs-var hs-var">..</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerState (ShelleyBlock era) -&gt; ShelleyTransition
forall era. LedgerState (ShelleyBlock era) -&gt; ShelleyTransition
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var hs-var">shelleyLedgerTransition</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState (ShelleyBlock era)
</span><a href="#local-6989586621679286723"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-comment">-- 'shelleyLedgerConfig' contains a dummy 'EpochInfo' but this does not</span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-comment">-- matter for extracting the genesis config</span><span>
</span><span id="line-222"></span><span>    </span><span class="annot"><a href="#local-6989586621679286719"><span class="hs-identifier hs-type">genesis</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SL.ShelleyGenesis</span></span><span> </span><span class="annot"><a href="#local-6989586621679287014"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-223"></span><span>    </span><span id="local-6989586621679286719"><span class="annot"><span class="annottext">genesis :: ShelleyGenesis era
</span><a href="#local-6989586621679286719"><span class="hs-identifier hs-var hs-var">genesis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyLedgerConfig era -&gt; ShelleyGenesis era
forall era. ShelleyLedgerConfig era -&gt; ShelleyGenesis era
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">shelleyLedgerGenesis</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyLedgerConfig era
</span><a href="#local-6989586621679286728"><span class="hs-identifier hs-var">shelleyLedgerConfig</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>    </span><span class="annot"><a href="#local-6989586621679286713"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-226"></span><span>    </span><span id="local-6989586621679286713"><span class="annot"><span class="annottext">k :: Word64
</span><a href="#local-6989586621679286713"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis era -&gt; Word64
forall era. ShelleyGenesis era -&gt; Word64
</span><span class="hs-identifier hs-var hs-var">SL.sgSecurityParam</span></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis era
</span><a href="#local-6989586621679286719"><span class="hs-identifier hs-var">genesis</span></a></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span>    </span><span class="annot"><a href="#local-6989586621679286721"><span class="hs-identifier hs-type">isTransition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">Shelley.Inspect.ProtocolUpdate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679287014"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span>
</span><span id="line-229"></span><span>    </span><span id="local-6989586621679286721"><span class="annot"><span class="annottext">isTransition :: ProtocolUpdate era -&gt; Maybe EpochNo
</span><a href="#local-6989586621679286721"><span class="hs-identifier hs-var hs-var">isTransition</span></a></span></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">Shelley.Inspect.ProtocolUpdate</span></a></span><span class="hs-special">{</span><span id="local-6989586621679286709"><span id="local-6989586621679286710"><span class="annot"><span class="annottext">UpdateProposal era
UpdateState (EraCrypto era)
protocolUpdateProposal :: forall era. ProtocolUpdate era -&gt; UpdateProposal era
protocolUpdateState :: forall era. ProtocolUpdate era -&gt; UpdateState (EraCrypto era)
protocolUpdateState :: UpdateState (EraCrypto era)
protocolUpdateProposal :: UpdateProposal era
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-230"></span><span>         </span><span class="annot"><span class="hs-identifier hs-type">SL.ProtVer</span></span><span> </span><span id="local-6989586621679286705"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679286705"><span class="hs-identifier hs-var">major</span></a></span></span><span> </span><span id="local-6989586621679286704"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679286704"><span class="hs-identifier hs-var">_minor</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ProtVer
</span><a href="#local-6989586621679286703"><span class="hs-identifier hs-var">proposalVersion</span></a></span><span>
</span><span id="line-231"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679286705"><span class="hs-identifier hs-var">major</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679286724"><span class="hs-identifier hs-var">transitionMajorVersion</span></a></span><span>
</span><span id="line-232"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679286702"><span class="hs-identifier hs-var">proposalReachedQuorum</span></a></span><span>
</span><span id="line-233"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679286717"><span class="hs-identifier hs-var">shelleyAfterVoting</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679286713"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-234"></span><span>         </span><span class="annot"><span class="annottext">EpochNo -&gt; Maybe EpochNo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679286701"><span class="hs-identifier hs-var">proposalEpoch</span></a></span><span>
</span><span id="line-235"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-236"></span><span>         </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">Shelley.Inspect.UpdateProposal</span></a></span><span class="hs-special">{</span><span id="local-6989586621679286699"><span id="local-6989586621679286701"><span id="local-6989586621679286703"><span class="annot"><span class="annottext">Maybe ProtVer
EpochNo
PParamsDelta era
proposalParams :: forall era. UpdateProposal era -&gt; PParamsDelta era
proposalVersion :: forall era. UpdateProposal era -&gt; Maybe ProtVer
proposalEpoch :: forall era. UpdateProposal era -&gt; EpochNo
proposalParams :: PParamsDelta era
proposalEpoch :: EpochNo
proposalVersion :: Maybe ProtVer
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UpdateProposal era
</span><a href="#local-6989586621679286710"><span class="hs-identifier hs-var">protocolUpdateProposal</span></a></span><span>
</span><span id="line-237"></span><span>         </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">Shelley.Inspect.UpdateState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679286694"><span id="local-6989586621679286702"><span class="annot"><span class="annottext">Bool
[KeyHash 'Genesis (EraCrypto era)]
proposalVotes :: forall c. UpdateState c -&gt; [KeyHash 'Genesis c]
proposalReachedQuorum :: forall c. UpdateState c -&gt; Bool
proposalVotes :: [KeyHash 'Genesis (EraCrypto era)]
proposalReachedQuorum :: Bool
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UpdateState (EraCrypto era)
</span><a href="#local-6989586621679286709"><span class="hs-identifier hs-var">protocolUpdateState</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-comment">-- In principle there could be multiple proposals that all change the</span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-comment">-- major protocol version. In practice this can't happen because each</span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-comment">-- delegate can only vote for one proposal, but the types don't guarantee</span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-comment">-- this. We don't need to worry about this, and just pick any of them.</span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621679286691"><span class="annot"><a href="#local-6989586621679286722"><span class="hs-identifier hs-type">takeAny</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679286691"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679286691"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-244"></span><span>    </span><span id="local-6989586621679286722"><span class="annot"><span class="annottext">takeAny :: [a] -&gt; Maybe a
</span><a href="#local-6989586621679286722"><span class="hs-identifier hs-var hs-var">takeAny</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Maybe a
forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  SingleEraBlock Byron
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SingleEraBlock</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">ByronBlock</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-251"></span><span>  </span><span id="local-6989586621679286666"><span class="annot"><span class="annottext">singleEraTransition :: PartialLedgerConfig ByronBlock
-&gt; EraParams -&gt; Bound -&gt; LedgerState ByronBlock -&gt; Maybe EpochNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">singleEraTransition</span></a></span></span><span> </span><span id="local-6989586621679286664"><span class="annot"><span class="annottext">PartialLedgerConfig ByronBlock
</span><a href="#local-6989586621679286664"><span class="hs-identifier hs-var">pcfg</span></a></span></span><span> </span><span id="local-6989586621679286663"><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621679286663"><span class="hs-identifier hs-var">_eraParams</span></a></span></span><span> </span><span id="local-6989586621679286662"><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621679286662"><span class="hs-identifier hs-var">_eraStart</span></a></span></span><span> </span><span id="local-6989586621679286661"><span class="annot"><span class="annottext">LedgerState ByronBlock
</span><a href="#local-6989586621679286661"><span class="hs-identifier hs-var">ledgerState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-252"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByronPartialLedgerConfig -&gt; TriggerHardFork
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#byronTriggerHardFork"><span class="hs-identifier hs-var hs-var">byronTriggerHardFork</span></a></span><span> </span><span class="annot"><span class="annottext">PartialLedgerConfig ByronBlock
ByronPartialLedgerConfig
</span><a href="#local-6989586621679286664"><span class="hs-identifier hs-var">pcfg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><span class="annottext">TriggerHardFork
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#TriggerHardForkNever"><span class="hs-identifier hs-var">TriggerHardForkNever</span></a></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe EpochNo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-254"></span><span>        </span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#TriggerHardForkAtEpoch"><span class="hs-identifier hs-type">TriggerHardForkAtEpoch</span></a></span><span>   </span><span id="local-6989586621679286658"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679286658"><span class="hs-identifier hs-var">epoch</span></a></span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; Maybe EpochNo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679286658"><span class="hs-identifier hs-var">epoch</span></a></span><span>
</span><span id="line-255"></span><span>        </span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#TriggerHardForkAtVersion"><span class="hs-identifier hs-type">TriggerHardForkAtVersion</span></a></span><span> </span><span id="local-6989586621679286656"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679286656"><span class="hs-identifier hs-var">shelleyMajorVersion</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-256"></span><span>            </span><span class="annot"><span class="annottext">PartialLedgerConfig ByronBlock
-&gt; Word16 -&gt; LedgerState ByronBlock -&gt; Maybe EpochNo
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#byronTransition"><span class="hs-identifier hs-var">byronTransition</span></a></span><span>
</span><span id="line-257"></span><span>              </span><span class="annot"><span class="annottext">PartialLedgerConfig ByronBlock
</span><a href="#local-6989586621679286664"><span class="hs-identifier hs-var">pcfg</span></a></span><span>
</span><span id="line-258"></span><span>              </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679286656"><span class="hs-identifier hs-var">shelleyMajorVersion</span></a></span><span>
</span><span id="line-259"></span><span>              </span><span class="annot"><span class="annottext">LedgerState ByronBlock
</span><a href="#local-6989586621679286661"><span class="hs-identifier hs-var">ledgerState</span></a></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>  </span><span id="local-6989586621679286655"><span class="annot"><span class="annottext">singleEraInfo :: proxy ByronBlock -&gt; SingleEraInfo ByronBlock
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">singleEraInfo</span></a></span></span><span> </span><span class="annot"><span class="annottext">proxy ByronBlock
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingleEraInfo :: forall blk. Text -&gt; SingleEraInfo blk
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SingleEraInfo</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-262"></span><span>      </span><span class="annot"><span class="annottext">singleEraName :: Text
</span><a href="#local-6989586621679286652"><span class="hs-identifier hs-var">singleEraName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Byron&quot;</span></span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span id="local-6989586621679286651"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679286647"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">PBftCrypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286651"><span class="hs-identifier hs-type">bc</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">HasPartialConsensusConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">PBft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286651"><span class="hs-identifier hs-type">bc</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-comment">-- Use defaults</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span class="hs-comment">-- | The trigger condition that will cause the hard fork transition.</span><span>
</span><span id="line-269"></span><span id="local-6989586621679286644"><span id="local-6989586621679286645"></span></span><span class="hs-keyword">data</span><span> </span><span id="TriggerHardFork"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#TriggerHardFork"><span class="hs-identifier hs-var">TriggerHardFork</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-comment">-- | Trigger the transition when the on-chain protocol major version (from</span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-comment">-- the ledger state) reaches this number.</span><span>
</span><span id="line-272"></span><span>    </span><span id="TriggerHardForkAtVersion"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#TriggerHardForkAtVersion"><span class="hs-identifier hs-var">TriggerHardForkAtVersion</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-comment">-- | For testing only, trigger the transition at a specific hard-coded</span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-comment">-- epoch, irrespective of the ledger state.</span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TriggerHardForkAtEpoch"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#TriggerHardForkAtEpoch"><span class="hs-identifier hs-var">TriggerHardForkAtEpoch</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-comment">-- | Never trigger a hard fork</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TriggerHardForkNever"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#TriggerHardForkNever"><span class="hs-identifier hs-var">TriggerHardForkNever</span></a></span></span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679286638"><span id="local-6989586621679286640"><span id="local-6989586621679286642"><span class="annot"><span class="annottext">Int -&gt; TriggerHardFork -&gt; ShowS
[TriggerHardFork] -&gt; ShowS
TriggerHardFork -&gt; String
(Int -&gt; TriggerHardFork -&gt; ShowS)
-&gt; (TriggerHardFork -&gt; String)
-&gt; ([TriggerHardFork] -&gt; ShowS)
-&gt; Show TriggerHardFork
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [TriggerHardFork] -&gt; ShowS
$cshowList :: [TriggerHardFork] -&gt; ShowS
show :: TriggerHardFork -&gt; String
$cshow :: TriggerHardFork -&gt; String
showsPrec :: Int -&gt; TriggerHardFork -&gt; ShowS
$cshowsPrec :: Int -&gt; TriggerHardFork -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. TriggerHardFork -&gt; Rep TriggerHardFork x)
-&gt; (forall x. Rep TriggerHardFork x -&gt; TriggerHardFork)
-&gt; Generic TriggerHardFork
forall x. Rep TriggerHardFork x -&gt; TriggerHardFork
forall x. TriggerHardFork -&gt; Rep TriggerHardFork x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep TriggerHardFork x -&gt; TriggerHardFork
$cfrom :: forall x. TriggerHardFork -&gt; Rep TriggerHardFork x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679286628"><span id="local-6989586621679286630"><span id="local-6989586621679286632"><span class="annot"><span class="annottext">Context -&gt; TriggerHardFork -&gt; IO (Maybe ThunkInfo)
Proxy TriggerHardFork -&gt; String
(Context -&gt; TriggerHardFork -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; TriggerHardFork -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy TriggerHardFork -&gt; String)
-&gt; NoThunks TriggerHardFork
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
showTypeOf :: Proxy TriggerHardFork -&gt; String
$cshowTypeOf :: Proxy TriggerHardFork -&gt; String
wNoThunks :: Context -&gt; TriggerHardFork -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: Context -&gt; TriggerHardFork -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; TriggerHardFork -&gt; IO (Maybe ThunkInfo)
$cnoThunks :: Context -&gt; TriggerHardFork -&gt; IO (Maybe ThunkInfo)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="hs-comment">-- | When Byron is part of the hard-fork combinator, we use the partial ledger</span><span>
</span><span id="line-281"></span><span class="hs-comment">-- config. Standalone Byron uses the regular ledger config. This means that</span><span>
</span><span id="line-282"></span><span class="hs-comment">-- the partial ledger config is the perfect place to store the trigger</span><span>
</span><span id="line-283"></span><span class="hs-comment">-- condition for the hard fork to Shelley, as we don't have to modify the</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- ledger config for standalone Byron.</span><span>
</span><span id="line-285"></span><span id="local-6989586621679286625"><span id="local-6989586621679286626"></span></span><span class="hs-keyword">data</span><span> </span><span id="ByronPartialLedgerConfig"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#ByronPartialLedgerConfig"><span class="hs-identifier hs-var">ByronPartialLedgerConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ByronPartialLedgerConfig"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#ByronPartialLedgerConfig"><span class="hs-identifier hs-var">ByronPartialLedgerConfig</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-286"></span><span>      </span><span id="byronLedgerConfig"><span class="annot"><span class="annottext">ByronPartialLedgerConfig -&gt; LedgerConfig ByronBlock
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#byronLedgerConfig"><span class="hs-identifier hs-var hs-var">byronLedgerConfig</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerConfig</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">ByronBlock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="byronTriggerHardFork"><span class="annot"><span class="annottext">ByronPartialLedgerConfig -&gt; TriggerHardFork
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#byronTriggerHardFork"><span class="hs-identifier hs-var hs-var">byronTriggerHardFork</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#TriggerHardFork"><span class="hs-identifier hs-type">TriggerHardFork</span></a></span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x.
 ByronPartialLedgerConfig -&gt; Rep ByronPartialLedgerConfig x)
-&gt; (forall x.
    Rep ByronPartialLedgerConfig x -&gt; ByronPartialLedgerConfig)
-&gt; Generic ByronPartialLedgerConfig
forall x.
Rep ByronPartialLedgerConfig x -&gt; ByronPartialLedgerConfig
forall x.
ByronPartialLedgerConfig -&gt; Rep ByronPartialLedgerConfig x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x.
Rep ByronPartialLedgerConfig x -&gt; ByronPartialLedgerConfig
$cfrom :: forall x.
ByronPartialLedgerConfig -&gt; Rep ByronPartialLedgerConfig x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679286617"><span id="local-6989586621679286619"><span id="local-6989586621679286621"><span class="annot"><span class="annottext">Context -&gt; ByronPartialLedgerConfig -&gt; IO (Maybe ThunkInfo)
Proxy ByronPartialLedgerConfig -&gt; String
(Context -&gt; ByronPartialLedgerConfig -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; ByronPartialLedgerConfig -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy ByronPartialLedgerConfig -&gt; String)
-&gt; NoThunks ByronPartialLedgerConfig
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
showTypeOf :: Proxy ByronPartialLedgerConfig -&gt; String
$cshowTypeOf :: Proxy ByronPartialLedgerConfig -&gt; String
wNoThunks :: Context -&gt; ByronPartialLedgerConfig -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: Context -&gt; ByronPartialLedgerConfig -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; ByronPartialLedgerConfig -&gt; IO (Maybe ThunkInfo)
$cnoThunks :: Context -&gt; ByronPartialLedgerConfig -&gt; IO (Maybe ThunkInfo)
</span><a href="#local-6989586621679286617"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">HasPartialLedgerConfig</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">ByronBlock</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="PartialLedgerConfig"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PartialLedgerConfig</span></a></span></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">ByronBlock</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#ByronPartialLedgerConfig"><span class="hs-identifier hs-type">ByronPartialLedgerConfig</span></a></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>  </span><span id="local-6989586621679286612"><span class="annot"><span class="annottext">completeLedgerConfig :: proxy ByronBlock
-&gt; EpochInfo Identity
-&gt; PartialLedgerConfig ByronBlock
-&gt; LedgerConfig ByronBlock
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">completeLedgerConfig</span></a></span></span><span> </span><span class="annot"><span class="annottext">proxy ByronBlock
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">EpochInfo Identity
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PartialLedgerConfig ByronBlock -&gt; LedgerConfig ByronBlock
ByronPartialLedgerConfig -&gt; LedgerConfig ByronBlock
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#byronLedgerConfig"><span class="hs-identifier hs-var hs-var">byronLedgerConfig</span></a></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  SingleEraBlock Shelley
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span id="local-6989586621679286610"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286610"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SingleEraBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286610"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-302"></span><span>  </span><span id="local-6989586621679286586"><span class="annot"><span class="annottext">singleEraTransition :: PartialLedgerConfig (ShelleyBlock era)
-&gt; EraParams
-&gt; Bound
-&gt; LedgerState (ShelleyBlock era)
-&gt; Maybe EpochNo
</span><a href="#local-6989586621679286586"><span class="hs-identifier hs-var hs-var hs-var hs-var">singleEraTransition</span></a></span></span><span> </span><span id="local-6989586621679286585"><span class="annot"><span class="annottext">PartialLedgerConfig (ShelleyBlock era)
</span><a href="#local-6989586621679286585"><span class="hs-identifier hs-var">pcfg</span></a></span></span><span> </span><span id="local-6989586621679286584"><span class="annot"><span class="annottext">EraParams
</span><a href="#local-6989586621679286584"><span class="hs-identifier hs-var">_eraParams</span></a></span></span><span> </span><span id="local-6989586621679286583"><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621679286583"><span class="hs-identifier hs-var">_eraStart</span></a></span></span><span> </span><span id="local-6989586621679286582"><span class="annot"><span class="annottext">LedgerState (ShelleyBlock era)
</span><a href="#local-6989586621679286582"><span class="hs-identifier hs-var">ledgerState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-303"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ShelleyPartialLedgerConfig era -&gt; TriggerHardFork
forall era. ShelleyPartialLedgerConfig era -&gt; TriggerHardFork
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#shelleyTriggerHardFork"><span class="hs-identifier hs-var hs-var">shelleyTriggerHardFork</span></a></span><span> </span><span class="annot"><span class="annottext">PartialLedgerConfig (ShelleyBlock era)
ShelleyPartialLedgerConfig era
</span><a href="#local-6989586621679286585"><span class="hs-identifier hs-var">pcfg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><span class="annottext">TriggerHardFork
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#TriggerHardForkNever"><span class="hs-identifier hs-var">TriggerHardForkNever</span></a></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe EpochNo
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-305"></span><span>        </span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#TriggerHardForkAtEpoch"><span class="hs-identifier hs-type">TriggerHardForkAtEpoch</span></a></span><span>   </span><span id="local-6989586621679286581"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679286581"><span class="hs-identifier hs-var">epoch</span></a></span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; Maybe EpochNo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679286581"><span class="hs-identifier hs-var">epoch</span></a></span><span>
</span><span id="line-306"></span><span>        </span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#TriggerHardForkAtVersion"><span class="hs-identifier hs-type">TriggerHardForkAtVersion</span></a></span><span> </span><span id="local-6989586621679286580"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679286580"><span class="hs-identifier hs-var">shelleyMajorVersion</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-307"></span><span>            </span><span class="annot"><span class="annottext">PartialLedgerConfig (ShelleyBlock era)
-&gt; Word16 -&gt; LedgerState (ShelleyBlock era) -&gt; Maybe EpochNo
forall era.
ShelleyBasedEra era =&gt;
PartialLedgerConfig (ShelleyBlock era)
-&gt; Word16 -&gt; LedgerState (ShelleyBlock era) -&gt; Maybe EpochNo
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#shelleyTransition"><span class="hs-identifier hs-var">shelleyTransition</span></a></span><span>
</span><span id="line-308"></span><span>              </span><span class="annot"><span class="annottext">PartialLedgerConfig (ShelleyBlock era)
</span><a href="#local-6989586621679286585"><span class="hs-identifier hs-var">pcfg</span></a></span><span>
</span><span id="line-309"></span><span>              </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679286580"><span class="hs-identifier hs-var">shelleyMajorVersion</span></a></span><span>
</span><span id="line-310"></span><span>              </span><span class="annot"><span class="annottext">LedgerState (ShelleyBlock era)
</span><a href="#local-6989586621679286582"><span class="hs-identifier hs-var">ledgerState</span></a></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>  </span><span id="local-6989586621679286579"><span class="annot"><span class="annottext">singleEraInfo :: proxy (ShelleyBlock era) -&gt; SingleEraInfo (ShelleyBlock era)
</span><a href="#local-6989586621679286579"><span class="hs-identifier hs-var hs-var hs-var hs-var">singleEraInfo</span></a></span></span><span> </span><span class="annot"><span class="annottext">proxy (ShelleyBlock era)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingleEraInfo :: forall blk. Text -&gt; SingleEraInfo blk
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SingleEraInfo</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-313"></span><span>      </span><span class="annot"><span class="annottext">singleEraName :: Text
</span><a href="#local-6989586621679286652"><span class="hs-identifier hs-var">singleEraName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy era -&gt; Text
forall era (proxy :: * -&gt; *).
ShelleyBasedEra era =&gt;
proxy era -&gt; Text
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">shelleyBasedEraName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy era
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679286610"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-special">}</span></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span id="local-6989586621679286576"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PraosCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679286576"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">HasPartialConsensusConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">TPraos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286576"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-317"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="PartialConsensusConfig"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PartialConsensusConfig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">TPraos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286576"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">TPraosParams</span></a></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>  </span><span id="local-6989586621679286572"><span class="annot"><span class="annottext">completeConsensusConfig :: proxy (TPraos c)
-&gt; EpochInfo Identity
-&gt; PartialConsensusConfig (TPraos c)
-&gt; ConsensusConfig (TPraos c)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">completeConsensusConfig</span></a></span></span><span> </span><span class="annot"><span class="annottext">proxy (TPraos c)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679286570"><span class="annot"><span class="annottext">EpochInfo Identity
</span><a href="#local-6989586621679286570"><span class="hs-identifier hs-var">tpraosEpochInfo</span></a></span></span><span> </span><span id="local-6989586621679286569"><span class="annot"><span class="annottext">PartialConsensusConfig (TPraos c)
</span><a href="#local-6989586621679286569"><span class="hs-identifier hs-var">tpraosParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TPraosConfig :: forall c.
TPraosParams -&gt; EpochInfo Identity -&gt; ConsensusConfig (TPraos c)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">TPraosConfig</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">PartialConsensusConfig (TPraos c)
EpochInfo Identity
TPraosParams
tpraosParams :: TPraosParams
tpraosEpochInfo :: EpochInfo Identity
tpraosParams :: PartialConsensusConfig (TPraos c)
tpraosEpochInfo :: EpochInfo Identity
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span id="local-6989586621679286564"><span id="local-6989586621679286565"></span></span><span class="hs-keyword">data</span><span> </span><span id="ShelleyPartialLedgerConfig"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#ShelleyPartialLedgerConfig"><span class="hs-identifier hs-var">ShelleyPartialLedgerConfig</span></a></span></span><span> </span><span id="local-6989586621679287015"><span class="annot"><a href="#local-6989586621679287015"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ShelleyPartialLedgerConfig"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#ShelleyPartialLedgerConfig"><span class="hs-identifier hs-var">ShelleyPartialLedgerConfig</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-322"></span><span>      </span><span class="hs-comment">-- | We cache the non-partial ledger config containing a dummy</span><span>
</span><span id="line-323"></span><span>      </span><span class="hs-comment">-- 'EpochInfo' that needs to be replaced with the correct one.</span><span>
</span><span id="line-324"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-325"></span><span>      </span><span class="hs-comment">-- We do this to avoid recomputing the ledger config each time</span><span>
</span><span id="line-326"></span><span>      </span><span class="hs-comment">-- 'completeLedgerConfig' is called, as 'mkShelleyLedgerConfig' does</span><span>
</span><span id="line-327"></span><span>      </span><span class="hs-comment">-- some rather expensive computations that shouldn't be repeated too</span><span>
</span><span id="line-328"></span><span>      </span><span class="hs-comment">-- often (e.g., 'sgActiveSlotCoeff').</span><span>
</span><span id="line-329"></span><span>      </span><span id="shelleyLedgerConfig"><span class="annot"><span class="annottext">ShelleyPartialLedgerConfig era -&gt; ShelleyLedgerConfig era
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#shelleyLedgerConfig"><span class="hs-identifier hs-var hs-var">shelleyLedgerConfig</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyLedgerConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679287015"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="shelleyTriggerHardFork"><span class="annot"><span class="annottext">ShelleyPartialLedgerConfig era -&gt; TriggerHardFork
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#shelleyTriggerHardFork"><span class="hs-identifier hs-var hs-var">shelleyTriggerHardFork</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#TriggerHardFork"><span class="hs-identifier hs-type">TriggerHardFork</span></a></span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x.
 ShelleyPartialLedgerConfig era
 -&gt; Rep (ShelleyPartialLedgerConfig era) x)
-&gt; (forall x.
    Rep (ShelleyPartialLedgerConfig era) x
    -&gt; ShelleyPartialLedgerConfig era)
-&gt; Generic (ShelleyPartialLedgerConfig era)
forall x.
Rep (ShelleyPartialLedgerConfig era) x
-&gt; ShelleyPartialLedgerConfig era
forall x.
ShelleyPartialLedgerConfig era
-&gt; Rep (ShelleyPartialLedgerConfig era) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall era x.
Rep (ShelleyPartialLedgerConfig era) x
-&gt; ShelleyPartialLedgerConfig era
forall era x.
ShelleyPartialLedgerConfig era
-&gt; Rep (ShelleyPartialLedgerConfig era) x
$cto :: forall era x.
Rep (ShelleyPartialLedgerConfig era) x
-&gt; ShelleyPartialLedgerConfig era
$cfrom :: forall era x.
ShelleyPartialLedgerConfig era
-&gt; Rep (ShelleyPartialLedgerConfig era) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679286556"><span id="local-6989586621679286558"><span id="local-6989586621679286560"><span class="annot"><span class="annottext">Context -&gt; ShelleyPartialLedgerConfig era -&gt; IO (Maybe ThunkInfo)
Proxy (ShelleyPartialLedgerConfig era) -&gt; String
(Context -&gt; ShelleyPartialLedgerConfig era -&gt; IO (Maybe ThunkInfo))
-&gt; (Context
    -&gt; ShelleyPartialLedgerConfig era -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (ShelleyPartialLedgerConfig era) -&gt; String)
-&gt; NoThunks (ShelleyPartialLedgerConfig era)
forall era.
ShelleyBasedEra era =&gt;
Context -&gt; ShelleyPartialLedgerConfig era -&gt; IO (Maybe ThunkInfo)
forall era.
ShelleyBasedEra era =&gt;
Proxy (ShelleyPartialLedgerConfig era) -&gt; String
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
showTypeOf :: Proxy (ShelleyPartialLedgerConfig era) -&gt; String
$cshowTypeOf :: forall era.
ShelleyBasedEra era =&gt;
Proxy (ShelleyPartialLedgerConfig era) -&gt; String
wNoThunks :: Context -&gt; ShelleyPartialLedgerConfig era -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: forall era.
ShelleyBasedEra era =&gt;
Context -&gt; ShelleyPartialLedgerConfig era -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; ShelleyPartialLedgerConfig era -&gt; IO (Maybe ThunkInfo)
$cnoThunks :: forall era.
ShelleyBasedEra era =&gt;
Context -&gt; ShelleyPartialLedgerConfig era -&gt; IO (Maybe ThunkInfo)
</span><a href="#local-6989586621679286556"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span id="local-6989586621679286555"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286555"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">HasPartialLedgerConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286555"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="PartialLedgerConfig"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PartialLedgerConfig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286555"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#ShelleyPartialLedgerConfig"><span class="hs-identifier hs-type">ShelleyPartialLedgerConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286555"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span>  </span><span class="hs-comment">-- Replace the dummy 'EpochInfo' with the real one</span><span>
</span><span id="line-338"></span><span>  </span><span id="local-6989586621679286551"><span class="annot"><span class="annottext">completeLedgerConfig :: proxy (ShelleyBlock era)
-&gt; EpochInfo Identity
-&gt; PartialLedgerConfig (ShelleyBlock era)
-&gt; LedgerConfig (ShelleyBlock era)
</span><a href="#local-6989586621679286551"><span class="hs-identifier hs-var hs-var hs-var hs-var">completeLedgerConfig</span></a></span></span><span> </span><span class="annot"><span class="annottext">proxy (ShelleyBlock era)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679286550"><span class="annot"><span class="annottext">EpochInfo Identity
</span><a href="#local-6989586621679286550"><span class="hs-identifier hs-var">epochInfo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#ShelleyPartialLedgerConfig"><span class="hs-identifier hs-type">ShelleyPartialLedgerConfig</span></a></span><span> </span><span id="local-6989586621679286549"><span class="annot"><a href="#local-6989586621679286549"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-339"></span><span>      </span><span class="annot"><span class="annottext">ShelleyLedgerConfig era
</span><a href="#local-6989586621679286549"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-340"></span><span>          </span><span class="annot"><span class="annottext">shelleyLedgerGlobals :: Globals
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">shelleyLedgerGlobals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyLedgerConfig era -&gt; Globals
forall era. ShelleyLedgerConfig era -&gt; Globals
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var hs-var">shelleyLedgerGlobals</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyLedgerConfig era
</span><a href="#local-6989586621679286549"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-341"></span><span>              </span><span class="annot"><span class="annottext">epochInfo :: EpochInfo Identity
</span><a href="#local-6989586621679286547"><span class="hs-identifier hs-var">SL.epochInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochInfo Identity
</span><a href="#local-6989586621679286550"><span class="hs-identifier hs-var">epochInfo</span></a></span><span>
</span><span id="line-342"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-343"></span><span>        </span><span class="hs-special">}</span></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  CanHardFork
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span class="hs-keyword">type</span><span> </span><span id="CardanoHardForkConstraints"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#CardanoHardForkConstraints"><span class="hs-identifier hs-var">CardanoHardForkConstraints</span></a></span></span><span> </span><span id="local-6989586621679286546"><span class="annot"><a href="#local-6989586621679286546"><span class="hs-identifier hs-type">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-350"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PraosCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679286546"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-351"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ShelleyEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286546"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AllegraEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286546"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MaryEra</span></span><span>    </span><span class="annot"><a href="#local-6989586621679286546"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-comment">-- These equalities allow the transition from Byron to Shelley, since</span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-comment">-- @shelley-spec-ledger@ requires Ed25519 for Byron bootstrap addresses and</span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-comment">-- the current Byron-to-Shelley translation requires a 224-bit hash for</span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-comment">-- address and a 256-bit hash for header hashes.</span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HASH</span></span><span>     </span><span class="annot"><a href="#local-6989586621679286546"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Blake2b_256</span></span><span>
</span><span id="line-359"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ADDRHASH</span></span><span> </span><span class="annot"><a href="#local-6989586621679286546"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Blake2b_224</span></span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DSIGN</span></span><span>    </span><span class="annot"><a href="#local-6989586621679286546"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ed25519DSIGN</span></span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span id="local-6989586621679286545"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#CardanoHardForkConstraints"><span class="hs-identifier hs-type">CardanoHardForkConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286545"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">CanHardFork</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Cardano.Block.html#CardanoEras"><span class="hs-identifier hs-type">CardanoEras</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286545"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-364"></span><span>  </span><span id="local-6989586621679286537"><span class="annot"><span class="annottext">hardForkEraTranslation :: EraTranslation (CardanoEras c)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">hardForkEraTranslation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EraTranslation :: forall (xs :: [*]).
InPairs (RequiringBoth WrapLedgerConfig (Translate LedgerState)) xs
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     xs
-&gt; InPairs
     (RequiringBoth
        WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
     xs
-&gt; EraTranslation xs
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">EraTranslation</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-365"></span><span>      </span><span class="annot"><span class="annottext">translateLedgerState :: InPairs
  (RequiringBoth WrapLedgerConfig (Translate LedgerState))
  (CardanoEras c)
</span><a href="#local-6989586621679286534"><span class="hs-identifier hs-var">translateLedgerState</span></a></span><span>   </span><span class="hs-glyph">=</span><span>
</span><span id="line-366"></span><span>          </span><span class="annot"><span class="annottext">RequiringBoth
  WrapLedgerConfig
  (Translate LedgerState)
  ByronBlock
  (ShelleyBlock (ShelleyEra c))
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig (Translate LedgerState))
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig (Translate LedgerState))
     (CardanoEras c)
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (zs :: [k]).
f x y -&gt; InPairs f (y : zs) -&gt; InPairs f (x : y : zs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PCons</span></a></span><span> </span><span class="annot"><span class="annottext">RequiringBoth
  WrapLedgerConfig
  (Translate LedgerState)
  ByronBlock
  (ShelleyBlock (ShelleyEra c))
forall c.
(ShelleyBasedEra (ShelleyEra c), HASH c ~ Blake2b_256,
 ADDRHASH c ~ Blake2b_224) =&gt;
RequiringBoth
  WrapLedgerConfig
  (Translate LedgerState)
  ByronBlock
  (ShelleyBlock (ShelleyEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateLedgerStateByronToShelleyWrapper"><span class="hs-identifier hs-var">translateLedgerStateByronToShelleyWrapper</span></a></span><span>
</span><span id="line-367"></span><span>        </span><span class="annot"><span class="annottext">(InPairs
   (RequiringBoth WrapLedgerConfig (Translate LedgerState))
   '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
     ShelleyBlock (MaryEra c)]
 -&gt; InPairs
      (RequiringBoth WrapLedgerConfig (Translate LedgerState))
      (CardanoEras c))
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig (Translate LedgerState))
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig (Translate LedgerState))
     (CardanoEras c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RequiringBoth
  WrapLedgerConfig
  (Translate LedgerState)
  (ShelleyBlock (ShelleyEra c))
  (ShelleyBlock (AllegraEra c))
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig (Translate LedgerState))
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig (Translate LedgerState))
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (zs :: [k]).
f x y -&gt; InPairs f (y : zs) -&gt; InPairs f (x : y : zs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PCons</span></a></span><span> </span><span class="annot"><span class="annottext">RequiringBoth
  WrapLedgerConfig
  (Translate LedgerState)
  (ShelleyBlock (ShelleyEra c))
  (ShelleyBlock (AllegraEra c))
forall c.
PraosCrypto c =&gt;
RequiringBoth
  WrapLedgerConfig
  (Translate LedgerState)
  (ShelleyBlock (ShelleyEra c))
  (ShelleyBlock (AllegraEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateLedgerStateShelleyToAllegraWrapper"><span class="hs-identifier hs-var">translateLedgerStateShelleyToAllegraWrapper</span></a></span><span>
</span><span id="line-368"></span><span>        </span><span class="annot"><span class="annottext">(InPairs
   (RequiringBoth WrapLedgerConfig (Translate LedgerState))
   '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
 -&gt; InPairs
      (RequiringBoth WrapLedgerConfig (Translate LedgerState))
      '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
        ShelleyBlock (MaryEra c)])
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig (Translate LedgerState))
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig (Translate LedgerState))
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RequiringBoth
  WrapLedgerConfig
  (Translate LedgerState)
  (ShelleyBlock (AllegraEra c))
  (ShelleyBlock (MaryEra c))
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig (Translate LedgerState))
     '[ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig (Translate LedgerState))
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (zs :: [k]).
f x y -&gt; InPairs f (y : zs) -&gt; InPairs f (x : y : zs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PCons</span></a></span><span> </span><span class="annot"><span class="annottext">RequiringBoth
  WrapLedgerConfig
  (Translate LedgerState)
  (ShelleyBlock (AllegraEra c))
  (ShelleyBlock (MaryEra c))
forall c.
PraosCrypto c =&gt;
RequiringBoth
  WrapLedgerConfig
  (Translate LedgerState)
  (ShelleyBlock (AllegraEra c))
  (ShelleyBlock (MaryEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateLedgerStateAllegraToMaryWrapper"><span class="hs-identifier hs-var">translateLedgerStateAllegraToMaryWrapper</span></a></span><span>
</span><span id="line-369"></span><span>        </span><span class="annot"><span class="annottext">(InPairs
   (RequiringBoth WrapLedgerConfig (Translate LedgerState))
   '[ShelleyBlock (MaryEra c)]
 -&gt; InPairs
      (RequiringBoth WrapLedgerConfig (Translate LedgerState))
      '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)])
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig (Translate LedgerState))
     '[ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig (Translate LedgerState))
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InPairs
  (RequiringBoth WrapLedgerConfig (Translate LedgerState))
  '[ShelleyBlock (MaryEra c)]
forall k (f :: k -&gt; k -&gt; *) (x :: k). InPairs f '[x]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PNil</span></a></span><span>
</span><span id="line-370"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">translateChainDepState :: InPairs
  (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
  (CardanoEras c)
</span><a href="#local-6989586621679286528"><span class="hs-identifier hs-var">translateChainDepState</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-371"></span><span>          </span><span class="annot"><span class="annottext">RequiringBoth
  WrapConsensusConfig
  (Translate WrapChainDepState)
  ByronBlock
  (ShelleyBlock (ShelleyEra c))
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     (CardanoEras c)
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (zs :: [k]).
f x y -&gt; InPairs f (y : zs) -&gt; InPairs f (x : y : zs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PCons</span></a></span><span> </span><span class="annot"><span class="annottext">RequiringBoth
  WrapConsensusConfig
  (Translate WrapChainDepState)
  ByronBlock
  (ShelleyBlock (ShelleyEra c))
forall c.
RequiringBoth
  WrapConsensusConfig
  (Translate WrapChainDepState)
  ByronBlock
  (ShelleyBlock (ShelleyEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateChainDepStateByronToShelleyWrapper"><span class="hs-identifier hs-var">translateChainDepStateByronToShelleyWrapper</span></a></span><span>
</span><span id="line-372"></span><span>        </span><span class="annot"><span class="annottext">(InPairs
   (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
   '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
     ShelleyBlock (MaryEra c)]
 -&gt; InPairs
      (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
      (CardanoEras c))
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     (CardanoEras c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RequiringBoth
  WrapConsensusConfig
  (Translate WrapChainDepState)
  (ShelleyBlock (ShelleyEra c))
  (ShelleyBlock (AllegraEra c))
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (zs :: [k]).
f x y -&gt; InPairs f (y : zs) -&gt; InPairs f (x : y : zs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PCons</span></a></span><span> </span><span class="annot"><span class="annottext">RequiringBoth
  WrapConsensusConfig
  (Translate WrapChainDepState)
  (ShelleyBlock (ShelleyEra c))
  (ShelleyBlock (AllegraEra c))
forall eraFrom eraTo.
(EraCrypto eraFrom ~ EraCrypto eraTo) =&gt;
RequiringBoth
  WrapConsensusConfig
  (Translate WrapChainDepState)
  (ShelleyBlock eraFrom)
  (ShelleyBlock eraTo)
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateChainDepStateAcrossShelley"><span class="hs-identifier hs-var">translateChainDepStateAcrossShelley</span></a></span><span>
</span><span id="line-373"></span><span>        </span><span class="annot"><span class="annottext">(InPairs
   (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
   '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
 -&gt; InPairs
      (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
      '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
        ShelleyBlock (MaryEra c)])
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RequiringBoth
  WrapConsensusConfig
  (Translate WrapChainDepState)
  (ShelleyBlock (AllegraEra c))
  (ShelleyBlock (MaryEra c))
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     '[ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (zs :: [k]).
f x y -&gt; InPairs f (y : zs) -&gt; InPairs f (x : y : zs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PCons</span></a></span><span> </span><span class="annot"><span class="annottext">RequiringBoth
  WrapConsensusConfig
  (Translate WrapChainDepState)
  (ShelleyBlock (AllegraEra c))
  (ShelleyBlock (MaryEra c))
forall eraFrom eraTo.
(EraCrypto eraFrom ~ EraCrypto eraTo) =&gt;
RequiringBoth
  WrapConsensusConfig
  (Translate WrapChainDepState)
  (ShelleyBlock eraFrom)
  (ShelleyBlock eraTo)
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateChainDepStateAcrossShelley"><span class="hs-identifier hs-var">translateChainDepStateAcrossShelley</span></a></span><span>
</span><span id="line-374"></span><span>        </span><span class="annot"><span class="annottext">(InPairs
   (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
   '[ShelleyBlock (MaryEra c)]
 -&gt; InPairs
      (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
      '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)])
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     '[ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InPairs
  (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
  '[ShelleyBlock (MaryEra c)]
forall k (f :: k -&gt; k -&gt; *) (x :: k). InPairs f '[x]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PNil</span></a></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">translateLedgerView :: InPairs
  (RequiringBoth
     WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
  (CardanoEras c)
</span><a href="#local-6989586621679286526"><span class="hs-identifier hs-var">translateLedgerView</span></a></span><span>    </span><span class="hs-glyph">=</span><span>
</span><span id="line-376"></span><span>          </span><span class="annot"><span class="annottext">RequiringBoth
  WrapLedgerConfig
  (TranslateForecast LedgerState WrapLedgerView)
  ByronBlock
  (ShelleyBlock (ShelleyEra c))
-&gt; InPairs
     (RequiringBoth
        WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth
        WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
     (CardanoEras c)
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (zs :: [k]).
f x y -&gt; InPairs f (y : zs) -&gt; InPairs f (x : y : zs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PCons</span></a></span><span> </span><span class="annot"><span class="annottext">RequiringBoth
  WrapLedgerConfig
  (TranslateForecast LedgerState WrapLedgerView)
  ByronBlock
  (ShelleyBlock (ShelleyEra c))
forall c.
RequiringBoth
  WrapLedgerConfig
  (TranslateForecast LedgerState WrapLedgerView)
  ByronBlock
  (ShelleyBlock (ShelleyEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateLedgerViewByronToShelleyWrapper"><span class="hs-identifier hs-var">translateLedgerViewByronToShelleyWrapper</span></a></span><span>
</span><span id="line-377"></span><span>        </span><span class="annot"><span class="annottext">(InPairs
   (RequiringBoth
      WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
   '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
     ShelleyBlock (MaryEra c)]
 -&gt; InPairs
      (RequiringBoth
         WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
      (CardanoEras c))
-&gt; InPairs
     (RequiringBoth
        WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth
        WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
     (CardanoEras c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RequiringBoth
  WrapLedgerConfig
  (TranslateForecast LedgerState WrapLedgerView)
  (ShelleyBlock (ShelleyEra c))
  (ShelleyBlock (AllegraEra c))
-&gt; InPairs
     (RequiringBoth
        WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth
        WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (zs :: [k]).
f x y -&gt; InPairs f (y : zs) -&gt; InPairs f (x : y : zs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PCons</span></a></span><span> </span><span class="annot"><span class="annottext">RequiringBoth
  WrapLedgerConfig
  (TranslateForecast LedgerState WrapLedgerView)
  (ShelleyBlock (ShelleyEra c))
  (ShelleyBlock (AllegraEra c))
forall eraFrom eraTo.
(EraCrypto eraFrom ~ EraCrypto eraTo, ShelleyBasedEra eraFrom) =&gt;
RequiringBoth
  WrapLedgerConfig
  (TranslateForecast LedgerState WrapLedgerView)
  (ShelleyBlock eraFrom)
  (ShelleyBlock eraTo)
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateLedgerViewAcrossShelley"><span class="hs-identifier hs-var">translateLedgerViewAcrossShelley</span></a></span><span>
</span><span id="line-378"></span><span>        </span><span class="annot"><span class="annottext">(InPairs
   (RequiringBoth
      WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
   '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
 -&gt; InPairs
      (RequiringBoth
         WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
      '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
        ShelleyBlock (MaryEra c)])
-&gt; InPairs
     (RequiringBoth
        WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth
        WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RequiringBoth
  WrapLedgerConfig
  (TranslateForecast LedgerState WrapLedgerView)
  (ShelleyBlock (AllegraEra c))
  (ShelleyBlock (MaryEra c))
-&gt; InPairs
     (RequiringBoth
        WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
     '[ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth
        WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (zs :: [k]).
f x y -&gt; InPairs f (y : zs) -&gt; InPairs f (x : y : zs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PCons</span></a></span><span> </span><span class="annot"><span class="annottext">RequiringBoth
  WrapLedgerConfig
  (TranslateForecast LedgerState WrapLedgerView)
  (ShelleyBlock (AllegraEra c))
  (ShelleyBlock (MaryEra c))
forall eraFrom eraTo.
(EraCrypto eraFrom ~ EraCrypto eraTo, ShelleyBasedEra eraFrom) =&gt;
RequiringBoth
  WrapLedgerConfig
  (TranslateForecast LedgerState WrapLedgerView)
  (ShelleyBlock eraFrom)
  (ShelleyBlock eraTo)
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateLedgerViewAcrossShelley"><span class="hs-identifier hs-var">translateLedgerViewAcrossShelley</span></a></span><span>
</span><span id="line-379"></span><span>        </span><span class="annot"><span class="annottext">(InPairs
   (RequiringBoth
      WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
   '[ShelleyBlock (MaryEra c)]
 -&gt; InPairs
      (RequiringBoth
         WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
      '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)])
-&gt; InPairs
     (RequiringBoth
        WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
     '[ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth
        WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InPairs
  (RequiringBoth
     WrapLedgerConfig (TranslateForecast LedgerState WrapLedgerView))
  '[ShelleyBlock (MaryEra c)]
forall k (f :: k -&gt; k -&gt; *) (x :: k). InPairs f '[x]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PNil</span></a></span><span>
</span><span id="line-380"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-381"></span><span>  </span><span id="local-6989586621679286523"><span class="annot"><span class="annottext">hardForkChainSel :: Tails AcrossEraSelection (CardanoEras c)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">hardForkChainSel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-382"></span><span>        </span><span class="hs-comment">-- Byron &lt;-&gt; Shelley, ...</span><span>
</span><span id="line-383"></span><span>        </span><span class="annot"><span class="annottext">NP
  (AcrossEraSelection ByronBlock)
  '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
    ShelleyBlock (MaryEra c)]
-&gt; Tails
     AcrossEraSelection
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
-&gt; Tails AcrossEraSelection (CardanoEras c)
forall k (f :: k -&gt; k -&gt; *) (x :: k) (xs1 :: [k]).
NP (f x) xs1 -&gt; Tails f xs1 -&gt; Tails f (x : xs1)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">TCons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AcrossEraSelection ByronBlock (ShelleyBlock (ShelleyEra c))
forall a b. AcrossEraSelection a b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">CompareBlockNo</span></a></span><span> </span><span class="annot"><span class="annottext">AcrossEraSelection ByronBlock (ShelleyBlock (ShelleyEra c))
-&gt; NP
     (AcrossEraSelection ByronBlock)
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
-&gt; NP
     (AcrossEraSelection ByronBlock)
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
forall k (a :: k -&gt; *) (x :: k) (xs :: [k]).
a x -&gt; NP a xs -&gt; NP a (x : xs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">AcrossEraSelection ByronBlock (ShelleyBlock (AllegraEra c))
forall a b. AcrossEraSelection a b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">CompareBlockNo</span></a></span><span> </span><span class="annot"><span class="annottext">AcrossEraSelection ByronBlock (ShelleyBlock (AllegraEra c))
-&gt; NP (AcrossEraSelection ByronBlock) '[ShelleyBlock (MaryEra c)]
-&gt; NP
     (AcrossEraSelection ByronBlock)
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
forall k (a :: k -&gt; *) (x :: k) (xs :: [k]).
a x -&gt; NP a xs -&gt; NP a (x : xs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">AcrossEraSelection ByronBlock (ShelleyBlock (MaryEra c))
forall a b. AcrossEraSelection a b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">CompareBlockNo</span></a></span><span> </span><span class="annot"><span class="annottext">AcrossEraSelection ByronBlock (ShelleyBlock (MaryEra c))
-&gt; NP (AcrossEraSelection ByronBlock) '[]
-&gt; NP (AcrossEraSelection ByronBlock) '[ShelleyBlock (MaryEra c)]
forall k (a :: k -&gt; *) (x :: k) (xs :: [k]).
a x -&gt; NP a xs -&gt; NP a (x : xs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">NP (AcrossEraSelection ByronBlock) '[]
forall k (a :: k -&gt; *). NP a '[]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">Nil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>        </span><span class="hs-comment">-- Shelley &lt;-&gt; Allegra, ...</span><span>
</span><span id="line-385"></span><span>      </span><span class="annot"><span class="annottext">(Tails
   AcrossEraSelection
   '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
     ShelleyBlock (MaryEra c)]
 -&gt; Tails AcrossEraSelection (CardanoEras c))
-&gt; Tails
     AcrossEraSelection
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
-&gt; Tails AcrossEraSelection (CardanoEras c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NP
  (AcrossEraSelection (ShelleyBlock (ShelleyEra c)))
  '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
-&gt; Tails
     AcrossEraSelection
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
-&gt; Tails
     AcrossEraSelection
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
forall k (f :: k -&gt; k -&gt; *) (x :: k) (xs1 :: [k]).
NP (f x) xs1 -&gt; Tails f xs1 -&gt; Tails f (x : xs1)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">TCons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AcrossEraSelection
  (ShelleyBlock (ShelleyEra c)) (ShelleyBlock (AllegraEra c))
forall a b.
(BlockProtocol a ~ BlockProtocol b) =&gt;
AcrossEraSelection a b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">SelectSameProtocol</span></a></span><span> </span><span class="annot"><span class="annottext">AcrossEraSelection
  (ShelleyBlock (ShelleyEra c)) (ShelleyBlock (AllegraEra c))
-&gt; NP
     (AcrossEraSelection (ShelleyBlock (ShelleyEra c)))
     '[ShelleyBlock (MaryEra c)]
-&gt; NP
     (AcrossEraSelection (ShelleyBlock (ShelleyEra c)))
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
forall k (a :: k -&gt; *) (x :: k) (xs :: [k]).
a x -&gt; NP a xs -&gt; NP a (x : xs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">AcrossEraSelection
  (ShelleyBlock (ShelleyEra c)) (ShelleyBlock (MaryEra c))
forall a b.
(BlockProtocol a ~ BlockProtocol b) =&gt;
AcrossEraSelection a b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">SelectSameProtocol</span></a></span><span> </span><span class="annot"><span class="annottext">AcrossEraSelection
  (ShelleyBlock (ShelleyEra c)) (ShelleyBlock (MaryEra c))
-&gt; NP (AcrossEraSelection (ShelleyBlock (ShelleyEra c))) '[]
-&gt; NP
     (AcrossEraSelection (ShelleyBlock (ShelleyEra c)))
     '[ShelleyBlock (MaryEra c)]
forall k (a :: k -&gt; *) (x :: k) (xs :: [k]).
a x -&gt; NP a xs -&gt; NP a (x : xs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">NP (AcrossEraSelection (ShelleyBlock (ShelleyEra c))) '[]
forall k (a :: k -&gt; *). NP a '[]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">Nil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>        </span><span class="hs-comment">-- Allegra &lt;-&gt; Mary, ...</span><span>
</span><span id="line-387"></span><span>      </span><span class="annot"><span class="annottext">(Tails
   AcrossEraSelection
   '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
 -&gt; Tails
      AcrossEraSelection
      '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
        ShelleyBlock (MaryEra c)])
-&gt; Tails
     AcrossEraSelection
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
-&gt; Tails
     AcrossEraSelection
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NP
  (AcrossEraSelection (ShelleyBlock (AllegraEra c)))
  '[ShelleyBlock (MaryEra c)]
-&gt; Tails AcrossEraSelection '[ShelleyBlock (MaryEra c)]
-&gt; Tails
     AcrossEraSelection
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
forall k (f :: k -&gt; k -&gt; *) (x :: k) (xs1 :: [k]).
NP (f x) xs1 -&gt; Tails f xs1 -&gt; Tails f (x : xs1)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">TCons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AcrossEraSelection
  (ShelleyBlock (AllegraEra c)) (ShelleyBlock (MaryEra c))
forall a b.
(BlockProtocol a ~ BlockProtocol b) =&gt;
AcrossEraSelection a b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">SelectSameProtocol</span></a></span><span> </span><span class="annot"><span class="annottext">AcrossEraSelection
  (ShelleyBlock (AllegraEra c)) (ShelleyBlock (MaryEra c))
-&gt; NP (AcrossEraSelection (ShelleyBlock (AllegraEra c))) '[]
-&gt; NP
     (AcrossEraSelection (ShelleyBlock (AllegraEra c)))
     '[ShelleyBlock (MaryEra c)]
forall k (a :: k -&gt; *) (x :: k) (xs :: [k]).
a x -&gt; NP a xs -&gt; NP a (x : xs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">NP (AcrossEraSelection (ShelleyBlock (AllegraEra c))) '[]
forall k (a :: k -&gt; *). NP a '[]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">Nil</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>        </span><span class="hs-comment">-- Mary &lt;-&gt; ...</span><span>
</span><span id="line-389"></span><span>      </span><span class="annot"><span class="annottext">(Tails AcrossEraSelection '[ShelleyBlock (MaryEra c)]
 -&gt; Tails
      AcrossEraSelection
      '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)])
-&gt; Tails AcrossEraSelection '[ShelleyBlock (MaryEra c)]
-&gt; Tails
     AcrossEraSelection
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NP (AcrossEraSelection (ShelleyBlock (MaryEra c))) '[]
-&gt; Tails AcrossEraSelection '[]
-&gt; Tails AcrossEraSelection '[ShelleyBlock (MaryEra c)]
forall k (f :: k -&gt; k -&gt; *) (x :: k) (xs1 :: [k]).
NP (f x) xs1 -&gt; Tails f xs1 -&gt; Tails f (x : xs1)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">TCons</span></a></span><span> </span><span class="annot"><span class="annottext">NP (AcrossEraSelection (ShelleyBlock (MaryEra c))) '[]
forall k (a :: k -&gt; *). NP a '[]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">Nil</span></a></span><span>
</span><span id="line-390"></span><span>      </span><span class="annot"><span class="annottext">(Tails AcrossEraSelection '[]
 -&gt; Tails AcrossEraSelection '[ShelleyBlock (MaryEra c)])
-&gt; Tails AcrossEraSelection '[]
-&gt; Tails AcrossEraSelection '[ShelleyBlock (MaryEra c)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tails AcrossEraSelection '[]
forall k (f :: k -&gt; k -&gt; *). Tails f '[]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">TNil</span></a></span><span>
</span><span id="line-391"></span><span>  </span><span id="local-6989586621679286515"><span class="annot"><span class="annottext">hardForkInjectTxs :: InPairs (RequiringBoth WrapLedgerConfig InjectTx) (CardanoEras c)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">hardForkInjectTxs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-392"></span><span>        </span><span class="annot"><span class="annottext">RequiringBoth
  WrapLedgerConfig InjectTx ByronBlock (ShelleyBlock (ShelleyEra c))
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig InjectTx)
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig InjectTx) (CardanoEras c)
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (zs :: [k]).
f x y -&gt; InPairs f (y : zs) -&gt; InPairs f (x : y : zs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PCons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InjectTx ByronBlock (ShelleyBlock (ShelleyEra c))
-&gt; RequiringBoth
     WrapLedgerConfig InjectTx ByronBlock (ShelleyBlock (ShelleyEra c))
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (h :: k -&gt; *).
f x y -&gt; RequiringBoth h f x y
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ignoringBoth</span></a></span><span> </span><span class="annot"><span class="annottext">InjectTx ByronBlock (ShelleyBlock (ShelleyEra c))
forall blk blk'. InjectTx blk blk'
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">cannotInjectTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>      </span><span class="annot"><span class="annottext">(InPairs
   (RequiringBoth WrapLedgerConfig InjectTx)
   '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
     ShelleyBlock (MaryEra c)]
 -&gt; InPairs
      (RequiringBoth WrapLedgerConfig InjectTx) (CardanoEras c))
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig InjectTx)
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig InjectTx) (CardanoEras c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RequiringBoth
  WrapLedgerConfig
  InjectTx
  (ShelleyBlock (ShelleyEra c))
  (ShelleyBlock (AllegraEra c))
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig InjectTx)
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig InjectTx)
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (zs :: [k]).
f x y -&gt; InPairs f (y : zs) -&gt; InPairs f (x : y : zs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PCons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InjectTx
  (ShelleyBlock (ShelleyEra c)) (ShelleyBlock (AllegraEra c))
-&gt; RequiringBoth
     WrapLedgerConfig
     InjectTx
     (ShelleyBlock (ShelleyEra c))
     (ShelleyBlock (AllegraEra c))
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (h :: k -&gt; *).
f x y -&gt; RequiringBoth h f x y
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ignoringBoth</span></a></span><span> </span><span class="annot"><span class="annottext">InjectTx
  (ShelleyBlock (ShelleyEra c)) (ShelleyBlock (AllegraEra c))
forall c.
PraosCrypto c =&gt;
InjectTx
  (ShelleyBlock (ShelleyEra c)) (ShelleyBlock (AllegraEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateTxShelleyToAllegraWrapper"><span class="hs-identifier hs-var">translateTxShelleyToAllegraWrapper</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>      </span><span class="annot"><span class="annottext">(InPairs
   (RequiringBoth WrapLedgerConfig InjectTx)
   '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
 -&gt; InPairs
      (RequiringBoth WrapLedgerConfig InjectTx)
      '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
        ShelleyBlock (MaryEra c)])
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig InjectTx)
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig InjectTx)
     '[ShelleyBlock (ShelleyEra c), ShelleyBlock (AllegraEra c),
       ShelleyBlock (MaryEra c)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RequiringBoth
  WrapLedgerConfig
  InjectTx
  (ShelleyBlock (AllegraEra c))
  (ShelleyBlock (MaryEra c))
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig InjectTx)
     '[ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig InjectTx)
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (zs :: [k]).
f x y -&gt; InPairs f (y : zs) -&gt; InPairs f (x : y : zs)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PCons</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InjectTx (ShelleyBlock (AllegraEra c)) (ShelleyBlock (MaryEra c))
-&gt; RequiringBoth
     WrapLedgerConfig
     InjectTx
     (ShelleyBlock (AllegraEra c))
     (ShelleyBlock (MaryEra c))
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (h :: k -&gt; *).
f x y -&gt; RequiringBoth h f x y
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ignoringBoth</span></a></span><span> </span><span class="annot"><span class="annottext">InjectTx (ShelleyBlock (AllegraEra c)) (ShelleyBlock (MaryEra c))
forall c.
PraosCrypto c =&gt;
InjectTx (ShelleyBlock (AllegraEra c)) (ShelleyBlock (MaryEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateTxAllegraToMaryWrapper"><span class="hs-identifier hs-var">translateTxAllegraToMaryWrapper</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>      </span><span class="annot"><span class="annottext">(InPairs
   (RequiringBoth WrapLedgerConfig InjectTx)
   '[ShelleyBlock (MaryEra c)]
 -&gt; InPairs
      (RequiringBoth WrapLedgerConfig InjectTx)
      '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)])
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig InjectTx)
     '[ShelleyBlock (MaryEra c)]
-&gt; InPairs
     (RequiringBoth WrapLedgerConfig InjectTx)
     '[ShelleyBlock (AllegraEra c), ShelleyBlock (MaryEra c)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InPairs
  (RequiringBoth WrapLedgerConfig InjectTx)
  '[ShelleyBlock (MaryEra c)]
forall k (f :: k -&gt; k -&gt; *) (x :: k). InPairs f '[x]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PNil</span></a></span></span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Translation from Byron to Shelley
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateHeaderHashByronToShelley"><span class="hs-identifier hs-type">translateHeaderHashByronToShelley</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-402"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679286914"><span class="annot"><a href="#local-6989586621679286914"><span class="hs-identifier hs-type">c</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-403"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ShelleyEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286914"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HASH</span></span><span> </span><span class="annot"><a href="#local-6989586621679286914"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Blake2b_256</span></span><span>
</span><span id="line-405"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">HeaderHash</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">ByronBlock</span></a></span><span>
</span><span id="line-407"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">HeaderHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ShelleyEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286914"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span id="translateHeaderHashByronToShelley"><span class="annot"><span class="annottext">translateHeaderHashByronToShelley :: HeaderHash ByronBlock -&gt; HeaderHash (ShelleyBlock (ShelleyEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateHeaderHashByronToShelley"><span class="hs-identifier hs-var hs-var">translateHeaderHashByronToShelley</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-409"></span><span>      </span><span class="annot"><span class="annottext">Proxy (ShelleyBlock (ShelleyEra c))
-&gt; ShortByteString -&gt; HeaderHash (ShelleyBlock (ShelleyEra c))
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; ShortByteString -&gt; HeaderHash blk
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">fromShortRawHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (ShelleyBlock (ShelleyEra c))
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ShelleyEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286914"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>    </span><span class="annot"><span class="annottext">(ShortByteString -&gt; ShelleyHash c)
-&gt; (ByronHash -&gt; ShortByteString) -&gt; ByronHash -&gt; ShelleyHash c
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Proxy ByronBlock -&gt; HeaderHash ByronBlock -&gt; ShortByteString
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; HeaderHash blk -&gt; ShortByteString
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">toShortRawHash</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy ByronBlock
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">ByronBlock</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-412"></span><span>    </span><span class="hs-comment">-- Byron uses 'Blake2b_256' for header hashes</span><span>
</span><span id="line-413"></span><span>    </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy (HASH c ~ Blake2b_256) -&gt; ()
forall (c :: Constraint) (proxy :: Constraint -&gt; *).
c =&gt;
proxy c -&gt; ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">keepRedundantConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (HASH c ~ Blake2b_256)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HASH</span></span><span> </span><span class="annot"><a href="#local-6989586621679286914"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Blake2b_256</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span id="local-6989586621679286899"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translatePointByronToShelley"><span class="hs-identifier hs-type">translatePointByronToShelley</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-416"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ShelleyEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286899"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HASH</span></span><span> </span><span class="annot"><a href="#local-6989586621679286899"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Blake2b_256</span></span><span>
</span><span id="line-418"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">ByronBlock</span></a></span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WithOrigin</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BlockNo</span></span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WithOrigin</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyTip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ShelleyEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286899"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-422"></span><span id="translatePointByronToShelley"><span class="annot"><span class="annottext">translatePointByronToShelley :: Point ByronBlock
-&gt; WithOrigin BlockNo -&gt; WithOrigin (ShelleyTip (ShelleyEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translatePointByronToShelley"><span class="hs-identifier hs-var hs-var">translatePointByronToShelley</span></a></span></span><span> </span><span id="local-6989586621679286505"><span class="annot"><span class="annottext">Point ByronBlock
</span><a href="#local-6989586621679286505"><span class="hs-identifier hs-var">point</span></a></span></span><span> </span><span id="local-6989586621679286504"><span class="annot"><span class="annottext">WithOrigin BlockNo
</span><a href="#local-6989586621679286504"><span class="hs-identifier hs-var">bNo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-423"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point ByronBlock
</span><a href="#local-6989586621679286505"><span class="hs-identifier hs-var">point</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WithOrigin BlockNo
</span><a href="#local-6989586621679286504"><span class="hs-identifier hs-var">bNo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-424"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point ByronBlock
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-var">GenesisPoint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WithOrigin BlockNo
</span><span class="hs-identifier hs-var">Origin</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-425"></span><span>        </span><span class="annot"><span class="annottext">WithOrigin (ShelleyTip (ShelleyEra c))
forall t. WithOrigin t
</span><span class="hs-identifier hs-var">Origin</span></span><span>
</span><span id="line-426"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src"><span class="hs-identifier hs-type">BlockPoint</span></a></span><span> </span><span id="local-6989586621679286501"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679286501"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679286500"><span class="annot"><span class="annottext">HeaderHash ByronBlock
</span><a href="#local-6989586621679286500"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">NotOrigin</span></a></span><span> </span><span id="local-6989586621679286499"><span class="annot"><span class="annottext">BlockNo
</span><a href="#local-6989586621679286499"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShelleyTip (ShelleyEra c) -&gt; WithOrigin (ShelleyTip (ShelleyEra c))
forall t. t -&gt; WithOrigin t
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">NotOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyTip :: forall era.
SlotNo
-&gt; BlockNo -&gt; HeaderHash (ShelleyBlock era) -&gt; ShelleyTip era
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyTip</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-427"></span><span>          </span><span class="annot"><span class="annottext">shelleyTipSlotNo :: SlotNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">shelleyTipSlotNo</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679286501"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-428"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">shelleyTipBlockNo :: BlockNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">shelleyTipBlockNo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockNo
</span><a href="#local-6989586621679286499"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-429"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">shelleyTipHash :: HeaderHash (ShelleyBlock (ShelleyEra c))
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">shelleyTipHash</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderHash ByronBlock -&gt; HeaderHash (ShelleyBlock (ShelleyEra c))
forall c.
(ShelleyBasedEra (ShelleyEra c), HASH c ~ Blake2b_256) =&gt;
HeaderHash ByronBlock -&gt; HeaderHash (ShelleyBlock (ShelleyEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateHeaderHashByronToShelley"><span class="hs-identifier hs-var">translateHeaderHashByronToShelley</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderHash ByronBlock
</span><a href="#local-6989586621679286500"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-430"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-431"></span><span>      </span><span id="local-6989586621679286494"><span class="annot"><span class="annottext">(Point ByronBlock, WithOrigin BlockNo)
</span><a href="#local-6989586621679286494"><span class="hs-identifier hs-var">_otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-432"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; WithOrigin (ShelleyTip (ShelleyEra c))
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;translatePointByronToShelley: invalid Byron state&quot;</span></span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span id="local-6989586621679286964"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateLedgerStateByronToShelleyWrapper"><span class="hs-identifier hs-type">translateLedgerStateByronToShelleyWrapper</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-435"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ShelleyEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286964"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HASH</span></span><span>     </span><span class="annot"><a href="#local-6989586621679286964"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Blake2b_256</span></span><span>
</span><span id="line-437"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ADDRHASH</span></span><span> </span><span class="annot"><a href="#local-6989586621679286964"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Blake2b_224</span></span><span>
</span><span id="line-438"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">RequiringBoth</span></a></span><span>
</span><span id="line-440"></span><span>       </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapLedgerConfig</span></a></span><span>
</span><span id="line-441"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Translate</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>       </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">ByronBlock</span></a></span><span>
</span><span id="line-443"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ShelleyEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286964"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-444"></span><span id="translateLedgerStateByronToShelleyWrapper"><span class="annot"><span class="annottext">translateLedgerStateByronToShelleyWrapper :: RequiringBoth
  WrapLedgerConfig
  (Translate LedgerState)
  ByronBlock
  (ShelleyBlock (ShelleyEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateLedgerStateByronToShelleyWrapper"><span class="hs-identifier hs-var hs-var">translateLedgerStateByronToShelleyWrapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-445"></span><span>    </span><span class="annot"><span class="annottext">(WrapLedgerConfig ByronBlock
 -&gt; WrapLedgerConfig (ShelleyBlock (ShelleyEra c))
 -&gt; Translate LedgerState ByronBlock (ShelleyBlock (ShelleyEra c)))
-&gt; RequiringBoth
     WrapLedgerConfig
     (Translate LedgerState)
     ByronBlock
     (ShelleyBlock (ShelleyEra c))
forall k (h :: k -&gt; *) (f :: k -&gt; k -&gt; *) (x :: k) (y :: k).
(h x -&gt; h y -&gt; f x y) -&gt; RequiringBoth h f x y
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">RequireBoth</span></a></span><span> </span><span class="annot"><span class="annottext">((WrapLedgerConfig ByronBlock
  -&gt; WrapLedgerConfig (ShelleyBlock (ShelleyEra c))
  -&gt; Translate LedgerState ByronBlock (ShelleyBlock (ShelleyEra c)))
 -&gt; RequiringBoth
      WrapLedgerConfig
      (Translate LedgerState)
      ByronBlock
      (ShelleyBlock (ShelleyEra c)))
-&gt; (WrapLedgerConfig ByronBlock
    -&gt; WrapLedgerConfig (ShelleyBlock (ShelleyEra c))
    -&gt; Translate LedgerState ByronBlock (ShelleyBlock (ShelleyEra c)))
-&gt; RequiringBoth
     WrapLedgerConfig
     (Translate LedgerState)
     ByronBlock
     (ShelleyBlock (ShelleyEra c))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">WrapLedgerConfig ByronBlock
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapLedgerConfig</span></a></span><span> </span><span id="local-6989586621679286490"><span class="annot"><span class="annottext">LedgerConfig (ShelleyBlock (ShelleyEra c))
</span><a href="#local-6989586621679286490"><span class="hs-identifier hs-var">cfgShelley</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-446"></span><span>    </span><span class="annot"><span class="annottext">(EpochNo
 -&gt; LedgerState ByronBlock
 -&gt; LedgerState (ShelleyBlock (ShelleyEra c)))
-&gt; Translate LedgerState ByronBlock (ShelleyBlock (ShelleyEra c))
forall (f :: * -&gt; *) x y.
(EpochNo -&gt; f x -&gt; f y) -&gt; Translate f x y
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">Translate</span></a></span><span>   </span><span class="annot"><span class="annottext">((EpochNo
  -&gt; LedgerState ByronBlock
  -&gt; LedgerState (ShelleyBlock (ShelleyEra c)))
 -&gt; Translate LedgerState ByronBlock (ShelleyBlock (ShelleyEra c)))
-&gt; (EpochNo
    -&gt; LedgerState ByronBlock
    -&gt; LedgerState (ShelleyBlock (ShelleyEra c)))
-&gt; Translate LedgerState ByronBlock (ShelleyBlock (ShelleyEra c))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679286488"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679286488"><span class="hs-identifier hs-var">epochNo</span></a></span></span><span> </span><span id="local-6989586621679286487"><span class="annot"><span class="annottext">LedgerState ByronBlock
</span><a href="#local-6989586621679286487"><span class="hs-identifier hs-var">ledgerByron</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-447"></span><span>      </span><span class="annot"><span class="annottext">ShelleyLedgerState :: forall era.
WithOrigin (ShelleyTip era)
-&gt; NewEpochState era
-&gt; ShelleyTransition
-&gt; LedgerState (ShelleyBlock era)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyLedgerState</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-448"></span><span>        </span><span class="annot"><span class="annottext">shelleyLedgerTip :: WithOrigin (ShelleyTip (ShelleyEra c))
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">shelleyLedgerTip</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-449"></span><span>          </span><span class="annot"><span class="annottext">Point ByronBlock
-&gt; WithOrigin BlockNo -&gt; WithOrigin (ShelleyTip (ShelleyEra c))
forall c.
(ShelleyBasedEra (ShelleyEra c), HASH c ~ Blake2b_256) =&gt;
Point ByronBlock
-&gt; WithOrigin BlockNo -&gt; WithOrigin (ShelleyTip (ShelleyEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translatePointByronToShelley"><span class="hs-identifier hs-var">translatePointByronToShelley</span></a></span><span>
</span><span id="line-450"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy ByronBlock -&gt; LedgerState ByronBlock -&gt; Point ByronBlock
forall blk.
UpdateLedger blk =&gt;
Proxy blk -&gt; LedgerState blk -&gt; Point blk
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ledgerTipPoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy ByronBlock
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">ByronBlock</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LedgerState ByronBlock
</span><a href="#local-6989586621679286487"><span class="hs-identifier hs-var">ledgerByron</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LedgerState ByronBlock -&gt; WithOrigin BlockNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-var hs-var">byronLedgerTipBlockNo</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState ByronBlock
</span><a href="#local-6989586621679286487"><span class="hs-identifier hs-var">ledgerByron</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">shelleyLedgerState :: NewEpochState (ShelleyEra c)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">shelleyLedgerState</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-453"></span><span>          </span><span class="annot"><span class="annottext">ShelleyGenesis (ShelleyEra c)
-&gt; EpochNo -&gt; ChainValidationState -&gt; NewEpochState (ShelleyEra c)
forall c.
(Crypto c, ADDRHASH c ~ Blake2b_224) =&gt;
ShelleyGenesis (ShelleyEra c)
-&gt; EpochNo -&gt; ChainValidationState -&gt; NewEpochState (ShelleyEra c)
</span><span class="hs-identifier hs-var">SL.translateToShelleyLedgerState</span></span><span>
</span><span id="line-454"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyLedgerConfig (ShelleyEra c) -&gt; ShelleyGenesis (ShelleyEra c)
forall era. ShelleyLedgerConfig era -&gt; ShelleyGenesis era
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">shelleyLedgerGenesis</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerConfig (ShelleyBlock (ShelleyEra c))
ShelleyLedgerConfig (ShelleyEra c)
</span><a href="#local-6989586621679286490"><span class="hs-identifier hs-var">cfgShelley</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>            </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679286488"><span class="hs-identifier hs-var">epochNo</span></a></span><span>
</span><span id="line-456"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LedgerState ByronBlock -&gt; ChainValidationState
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-var hs-var">byronLedgerState</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState ByronBlock
</span><a href="#local-6989586621679286487"><span class="hs-identifier hs-var">ledgerByron</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-457"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">shelleyLedgerTransition :: ShelleyTransition
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">shelleyLedgerTransition</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-458"></span><span>          </span><span class="annot"><span class="annottext">ShelleyTransitionInfo :: Word32 -&gt; ShelleyTransition
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyTransitionInfo</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">shelleyAfterVoting :: Word32
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">shelleyAfterVoting</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span class="hs-special">}</span><span>
</span><span id="line-459"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span id="local-6989586621679286956"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateChainDepStateByronToShelleyWrapper"><span class="hs-identifier hs-type">translateChainDepStateByronToShelleyWrapper</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-462"></span><span>     </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">RequiringBoth</span></a></span><span>
</span><span id="line-463"></span><span>       </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapConsensusConfig</span></a></span><span>
</span><span id="line-464"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Translate</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapChainDepState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>       </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">ByronBlock</span></a></span><span>
</span><span id="line-466"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ShelleyEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286956"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-467"></span><span id="translateChainDepStateByronToShelleyWrapper"><span class="annot"><span class="annottext">translateChainDepStateByronToShelleyWrapper :: RequiringBoth
  WrapConsensusConfig
  (Translate WrapChainDepState)
  ByronBlock
  (ShelleyBlock (ShelleyEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateChainDepStateByronToShelleyWrapper"><span class="hs-identifier hs-var hs-var">translateChainDepStateByronToShelleyWrapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-468"></span><span>    </span><span class="annot"><span class="annottext">(WrapConsensusConfig ByronBlock
 -&gt; WrapConsensusConfig (ShelleyBlock (ShelleyEra c))
 -&gt; Translate
      WrapChainDepState ByronBlock (ShelleyBlock (ShelleyEra c)))
-&gt; RequiringBoth
     WrapConsensusConfig
     (Translate WrapChainDepState)
     ByronBlock
     (ShelleyBlock (ShelleyEra c))
forall k (h :: k -&gt; *) (f :: k -&gt; k -&gt; *) (x :: k) (y :: k).
(h x -&gt; h y -&gt; f x y) -&gt; RequiringBoth h f x y
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">RequireBoth</span></a></span><span> </span><span class="annot"><span class="annottext">((WrapConsensusConfig ByronBlock
  -&gt; WrapConsensusConfig (ShelleyBlock (ShelleyEra c))
  -&gt; Translate
       WrapChainDepState ByronBlock (ShelleyBlock (ShelleyEra c)))
 -&gt; RequiringBoth
      WrapConsensusConfig
      (Translate WrapChainDepState)
      ByronBlock
      (ShelleyBlock (ShelleyEra c)))
-&gt; (WrapConsensusConfig ByronBlock
    -&gt; WrapConsensusConfig (ShelleyBlock (ShelleyEra c))
    -&gt; Translate
         WrapChainDepState ByronBlock (ShelleyBlock (ShelleyEra c)))
-&gt; RequiringBoth
     WrapConsensusConfig
     (Translate WrapChainDepState)
     ByronBlock
     (ShelleyBlock (ShelleyEra c))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">WrapConsensusConfig ByronBlock
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapConsensusConfig</span></a></span><span> </span><span id="local-6989586621679286479"><span class="annot"><span class="annottext">ConsensusConfig (BlockProtocol (ShelleyBlock (ShelleyEra c)))
</span><a href="#local-6989586621679286479"><span class="hs-identifier hs-var">cfgShelley</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-469"></span><span>      </span><span class="annot"><span class="annottext">(EpochNo
 -&gt; WrapChainDepState ByronBlock
 -&gt; WrapChainDepState (ShelleyBlock (ShelleyEra c)))
-&gt; Translate
     WrapChainDepState ByronBlock (ShelleyBlock (ShelleyEra c))
forall (f :: * -&gt; *) x y.
(EpochNo -&gt; f x -&gt; f y) -&gt; Translate f x y
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">Translate</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochNo
  -&gt; WrapChainDepState ByronBlock
  -&gt; WrapChainDepState (ShelleyBlock (ShelleyEra c)))
 -&gt; Translate
      WrapChainDepState ByronBlock (ShelleyBlock (ShelleyEra c)))
-&gt; (EpochNo
    -&gt; WrapChainDepState ByronBlock
    -&gt; WrapChainDepState (ShelleyBlock (ShelleyEra c)))
-&gt; Translate
     WrapChainDepState ByronBlock (ShelleyBlock (ShelleyEra c))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">EpochNo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapChainDepState</span></a></span><span> </span><span id="local-6989586621679286477"><span class="annot"><span class="annottext">ChainDepState (BlockProtocol ByronBlock)
</span><a href="#local-6989586621679286477"><span class="hs-identifier hs-var">pbftState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-470"></span><span>        </span><span class="annot"><span class="annottext">ChainDepState (BlockProtocol (ShelleyBlock (ShelleyEra c)))
-&gt; WrapChainDepState (ShelleyBlock (ShelleyEra c))
forall blk.
ChainDepState (BlockProtocol blk) -&gt; WrapChainDepState blk
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">WrapChainDepState</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainDepState (BlockProtocol (ShelleyBlock (ShelleyEra c)))
 -&gt; WrapChainDepState (ShelleyBlock (ShelleyEra c)))
-&gt; ChainDepState (BlockProtocol (ShelleyBlock (ShelleyEra c)))
-&gt; WrapChainDepState (ShelleyBlock (ShelleyEra c))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-471"></span><span>          </span><span class="annot"><span class="annottext">ConsensusConfig (TPraos c)
-&gt; PBftState PBftByronCrypto -&gt; TPraosState c
forall bc c.
ConsensusConfig (TPraos c) -&gt; PBftState bc -&gt; TPraosState c
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateChainDepStateByronToShelley"><span class="hs-identifier hs-var">translateChainDepStateByronToShelley</span></a></span><span> </span><span class="annot"><span class="annottext">ConsensusConfig (BlockProtocol (ShelleyBlock (ShelleyEra c)))
ConsensusConfig (TPraos c)
</span><a href="#local-6989586621679286479"><span class="hs-identifier hs-var">cfgShelley</span></a></span><span> </span><span class="annot"><span class="annottext">PBftState PBftByronCrypto
ChainDepState (BlockProtocol ByronBlock)
</span><a href="#local-6989586621679286477"><span class="hs-identifier hs-var">pbftState</span></a></span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateChainDepStateByronToShelley"><span class="hs-identifier hs-type">translateChainDepStateByronToShelley</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-474"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679286887"><span class="annot"><a href="#local-6989586621679286887"><span class="hs-identifier hs-type">bc</span></a></span></span><span> </span><span id="local-6989586621679286888"><span class="annot"><a href="#local-6989586621679286888"><span class="hs-identifier hs-type">c</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-475"></span><span>     </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">ConsensusConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">TPraos</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286888"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">PBftState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286887"><span class="hs-identifier hs-type">bc</span></a></span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">TPraosState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286888"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-478"></span><span id="translateChainDepStateByronToShelley"><span class="annot"><span class="annottext">translateChainDepStateByronToShelley :: ConsensusConfig (TPraos c) -&gt; PBftState bc -&gt; TPraosState c
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateChainDepStateByronToShelley"><span class="hs-identifier hs-var hs-var">translateChainDepStateByronToShelley</span></a></span></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">TPraosConfig</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679286475"><span class="annot"><a href="#local-6989586621679286475"><span class="hs-identifier hs-var hs-var">tpraosParams</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span id="local-6989586621679286474"><span class="annot"><span class="annottext">PBftState bc
</span><a href="#local-6989586621679286474"><span class="hs-identifier hs-var">pbftState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-479"></span><span>    </span><span class="hs-comment">-- Note that the 'PBftState' doesn't know about EBBs. So if the last slot of</span><span>
</span><span id="line-480"></span><span>    </span><span class="hs-comment">-- the Byron era were occupied by an EBB (and no regular block in that same</span><span>
</span><span id="line-481"></span><span>    </span><span class="hs-comment">-- slot), we would pick the wrong slot here, i.e., the slot of the regular</span><span>
</span><span id="line-482"></span><span>    </span><span class="hs-comment">-- block before the EBB.</span><span>
</span><span id="line-483"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-484"></span><span>    </span><span class="hs-comment">-- Fortunately, this is impossible for two reasons:</span><span>
</span><span id="line-485"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-486"></span><span>    </span><span class="hs-comment">-- 1. On mainnet we stopped producing EBBs a while before the transition.</span><span>
</span><span id="line-487"></span><span>    </span><span class="hs-comment">-- 2. The transition happens at the start of an epoch, so if the last slot</span><span>
</span><span id="line-488"></span><span>    </span><span class="hs-comment">--    were occupied by an EBB, it must have been the EBB at the start of the</span><span>
</span><span id="line-489"></span><span>    </span><span class="hs-comment">--    previous epoch. This means the previous epoch must have been empty,</span><span>
</span><span id="line-490"></span><span>    </span><span class="hs-comment">--    which is a violation of the &quot;@k@ blocks per @2k@ slots&quot; property.</span><span>
</span><span id="line-491"></span><span>    </span><span class="annot"><span class="annottext">WithOrigin SlotNo -&gt; ChainDepState c -&gt; TPraosState c
forall c. WithOrigin SlotNo -&gt; ChainDepState c -&gt; TPraosState c
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">TPraosState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PBftState bc -&gt; WithOrigin SlotNo
forall c. PBftState c -&gt; WithOrigin SlotNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">PBftState.lastSignedSlot</span></a></span><span> </span><span class="annot"><span class="annottext">PBftState bc
</span><a href="#local-6989586621679286474"><span class="hs-identifier hs-var">pbftState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ChainDepState c -&gt; TPraosState c)
-&gt; ChainDepState c -&gt; TPraosState c
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-492"></span><span>      </span><span class="annot"><span class="annottext">ChainDepState :: forall crypto.
PrtclState crypto -&gt; TicknState -&gt; Nonce -&gt; ChainDepState crypto
</span><span class="hs-identifier hs-type">SL.ChainDepState</span></span><span>
</span><span id="line-493"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">csProtocol :: PrtclState c
</span><span class="hs-identifier hs-var">SL.csProtocol</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'BlockIssuer c) Word64
-&gt; Nonce -&gt; Nonce -&gt; PrtclState c
forall crypto.
Map (KeyHash 'BlockIssuer crypto) Word64
-&gt; Nonce -&gt; Nonce -&gt; PrtclState crypto
</span><span class="hs-identifier hs-var">SL.PrtclState</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'BlockIssuer c) Word64
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">Nonce
</span><a href="#local-6989586621679286467"><span class="hs-identifier hs-var">nonce</span></a></span><span> </span><span class="annot"><span class="annottext">Nonce
</span><a href="#local-6989586621679286467"><span class="hs-identifier hs-var">nonce</span></a></span><span>
</span><span id="line-494"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">csTickn :: TicknState
</span><span class="hs-identifier hs-var">SL.csTickn</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TicknState :: Nonce -&gt; Nonce -&gt; TicknState
</span><span class="hs-identifier hs-type">SL.TicknState</span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-495"></span><span>              </span><span class="annot"><span class="annottext">ticknStateEpochNonce :: Nonce
</span><span class="hs-identifier hs-var">ticknStateEpochNonce</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nonce
</span><a href="#local-6989586621679286467"><span class="hs-identifier hs-var">nonce</span></a></span><span>
</span><span id="line-496"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ticknStatePrevHashNonce :: Nonce
</span><span class="hs-identifier hs-var">ticknStatePrevHashNonce</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nonce
</span><span class="hs-identifier hs-var">SL.NeutralNonce</span></span><span>
</span><span id="line-497"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-498"></span><span>          </span><span class="hs-comment">-- Overridden before used</span><span>
</span><span id="line-499"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">csLabNonce :: Nonce
</span><span class="hs-identifier hs-var">SL.csLabNonce</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nonce
</span><span class="hs-identifier hs-var">SL.NeutralNonce</span></span><span>
</span><span id="line-500"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-502"></span><span>    </span><span id="local-6989586621679286467"><span class="annot"><span class="annottext">nonce :: Nonce
</span><a href="#local-6989586621679286467"><span class="hs-identifier hs-var hs-var">nonce</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TPraosParams -&gt; Nonce
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var hs-var">tpraosInitialNonce</span></a></span><span> </span><span class="annot"><span class="annottext">TPraosParams
</span><a href="#local-6989586621679286475"><span class="hs-identifier hs-var">tpraosParams</span></a></span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateLedgerViewByronToShelleyWrapper"><span class="hs-identifier hs-type">translateLedgerViewByronToShelleyWrapper</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-505"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679286953"><span class="annot"><a href="#local-6989586621679286953"><span class="hs-identifier hs-type">c</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-506"></span><span>     </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">RequiringBoth</span></a></span><span>
</span><span id="line-507"></span><span>       </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapLedgerConfig</span></a></span><span>
</span><span id="line-508"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">TranslateForecast</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapLedgerView</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>       </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">ByronBlock</span></a></span><span>
</span><span id="line-510"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ShelleyEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286953"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span id="translateLedgerViewByronToShelleyWrapper"><span class="annot"><span class="annottext">translateLedgerViewByronToShelleyWrapper :: RequiringBoth
  WrapLedgerConfig
  (TranslateForecast LedgerState WrapLedgerView)
  ByronBlock
  (ShelleyBlock (ShelleyEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateLedgerViewByronToShelleyWrapper"><span class="hs-identifier hs-var hs-var">translateLedgerViewByronToShelleyWrapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-512"></span><span>    </span><span class="annot"><span class="annottext">(WrapLedgerConfig ByronBlock
 -&gt; WrapLedgerConfig (ShelleyBlock (ShelleyEra c))
 -&gt; TranslateForecast
      LedgerState
      WrapLedgerView
      ByronBlock
      (ShelleyBlock (ShelleyEra c)))
-&gt; RequiringBoth
     WrapLedgerConfig
     (TranslateForecast LedgerState WrapLedgerView)
     ByronBlock
     (ShelleyBlock (ShelleyEra c))
forall k (h :: k -&gt; *) (f :: k -&gt; k -&gt; *) (x :: k) (y :: k).
(h x -&gt; h y -&gt; f x y) -&gt; RequiringBoth h f x y
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">RequireBoth</span></a></span><span> </span><span class="annot"><span class="annottext">((WrapLedgerConfig ByronBlock
  -&gt; WrapLedgerConfig (ShelleyBlock (ShelleyEra c))
  -&gt; TranslateForecast
       LedgerState
       WrapLedgerView
       ByronBlock
       (ShelleyBlock (ShelleyEra c)))
 -&gt; RequiringBoth
      WrapLedgerConfig
      (TranslateForecast LedgerState WrapLedgerView)
      ByronBlock
      (ShelleyBlock (ShelleyEra c)))
-&gt; (WrapLedgerConfig ByronBlock
    -&gt; WrapLedgerConfig (ShelleyBlock (ShelleyEra c))
    -&gt; TranslateForecast
         LedgerState
         WrapLedgerView
         ByronBlock
         (ShelleyBlock (ShelleyEra c)))
-&gt; RequiringBoth
     WrapLedgerConfig
     (TranslateForecast LedgerState WrapLedgerView)
     ByronBlock
     (ShelleyBlock (ShelleyEra c))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">WrapLedgerConfig ByronBlock
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapLedgerConfig</span></a></span><span> </span><span id="local-6989586621679286459"><span class="annot"><span class="annottext">LedgerConfig (ShelleyBlock (ShelleyEra c))
</span><a href="#local-6989586621679286459"><span class="hs-identifier hs-var">cfgShelley</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-513"></span><span>      </span><span class="annot"><span class="annottext">(Bound
 -&gt; SlotNo
 -&gt; LedgerState ByronBlock
 -&gt; Except
      OutsideForecastRange
      (Ticked (WrapLedgerView (ShelleyBlock (ShelleyEra c)))))
-&gt; TranslateForecast
     LedgerState WrapLedgerView ByronBlock (ShelleyBlock (ShelleyEra c))
forall (f :: * -&gt; *) (g :: * -&gt; *) x y.
(Bound
 -&gt; SlotNo -&gt; f x -&gt; Except OutsideForecastRange (Ticked (g y)))
-&gt; TranslateForecast f g x y
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">TranslateForecast</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyLedgerConfig (ShelleyEra c)
-&gt; Bound
-&gt; SlotNo
-&gt; LedgerState ByronBlock
-&gt; Except
     OutsideForecastRange
     (Ticked (WrapLedgerView (ShelleyBlock (ShelleyEra c))))
</span><a href="#local-6989586621679286457"><span class="hs-identifier hs-var">forecast</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerConfig (ShelleyBlock (ShelleyEra c))
ShelleyLedgerConfig (ShelleyEra c)
</span><a href="#local-6989586621679286459"><span class="hs-identifier hs-var">cfgShelley</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-515"></span><span>    </span><span class="hs-comment">-- We ignore the Byron ledger view and create a new Shelley.</span><span>
</span><span id="line-516"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-517"></span><span>    </span><span class="hs-comment">-- The full Shelley forecast range (stability window) starts from the first</span><span>
</span><span id="line-518"></span><span>    </span><span class="hs-comment">-- slot of the Shelley era, no matter how many slots there are between the</span><span>
</span><span id="line-519"></span><span>    </span><span class="hs-comment">-- Byron ledger and the first Shelley slot. Note that this number of slots</span><span>
</span><span id="line-520"></span><span>    </span><span class="hs-comment">-- is still guaranteed to be less than the forecast range of the HFC in the</span><span>
</span><span id="line-521"></span><span>    </span><span class="hs-comment">-- Byron era.</span><span>
</span><span id="line-522"></span><span>    </span><span class="annot"><a href="#local-6989586621679286457"><span class="hs-identifier hs-type">forecast</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-523"></span><span>         </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyLedgerConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ShelleyEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286953"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Bound</span></a></span><span>
</span><span id="line-525"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-526"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-byron-0.1.0.0/noopt/doc/html/ouroboros-consensus-byron/src"><span class="hs-identifier hs-type">ByronBlock</span></a></span><span>
</span><span id="line-527"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Except</span></span><span>
</span><span id="line-528"></span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">OutsideForecastRange</span></a></span><span>
</span><span id="line-529"></span><span>           </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapLedgerView</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ShelleyEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286953"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>    </span><span id="local-6989586621679286457"><span class="annot"><span class="annottext">forecast :: ShelleyLedgerConfig (ShelleyEra c)
-&gt; Bound
-&gt; SlotNo
-&gt; LedgerState ByronBlock
-&gt; Except
     OutsideForecastRange
     (Ticked (WrapLedgerView (ShelleyBlock (ShelleyEra c))))
</span><a href="#local-6989586621679286457"><span class="hs-identifier hs-var hs-var">forecast</span></a></span></span><span> </span><span id="local-6989586621679286456"><span class="annot"><span class="annottext">ShelleyLedgerConfig (ShelleyEra c)
</span><a href="#local-6989586621679286456"><span class="hs-identifier hs-var">cfgShelley</span></a></span></span><span> </span><span id="local-6989586621679286455"><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621679286455"><span class="hs-identifier hs-var">bound</span></a></span></span><span> </span><span id="local-6989586621679286454"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679286454"><span class="hs-identifier hs-var">forecastFor</span></a></span></span><span> </span><span id="local-6989586621679286453"><span class="annot"><span class="annottext">LedgerState ByronBlock
</span><a href="#local-6989586621679286453"><span class="hs-identifier hs-var">currentByronState</span></a></span></span><span>
</span><span id="line-531"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679286454"><span class="hs-identifier hs-var">forecastFor</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679286451"><span class="hs-identifier hs-var">maxFor</span></a></span><span>
</span><span id="line-532"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ticked (WrapLedgerView (ShelleyBlock (ShelleyEra c)))
-&gt; Except
     OutsideForecastRange
     (Ticked (WrapLedgerView (ShelleyBlock (ShelleyEra c))))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Ticked (WrapLedgerView (ShelleyBlock (ShelleyEra c)))
 -&gt; Except
      OutsideForecastRange
      (Ticked (WrapLedgerView (ShelleyBlock (ShelleyEra c)))))
-&gt; Ticked (WrapLedgerView (ShelleyBlock (ShelleyEra c)))
-&gt; Except
     OutsideForecastRange
     (Ticked (WrapLedgerView (ShelleyBlock (ShelleyEra c))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-533"></span><span>            </span><span class="annot"><span class="annottext">Ticked (LedgerView (BlockProtocol (ShelleyBlock (ShelleyEra c))))
-&gt; Ticked (WrapLedgerView (ShelleyBlock (ShelleyEra c)))
forall blk.
Ticked (LedgerView (BlockProtocol blk))
-&gt; Ticked (WrapLedgerView blk)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">WrapTickedLedgerView</span></a></span><span> </span><span class="annot"><span class="annottext">(Ticked (LedgerView (BlockProtocol (ShelleyBlock (ShelleyEra c))))
 -&gt; Ticked (WrapLedgerView (ShelleyBlock (ShelleyEra c))))
-&gt; Ticked
     (LedgerView (BlockProtocol (ShelleyBlock (ShelleyEra c))))
-&gt; Ticked (WrapLedgerView (ShelleyBlock (ShelleyEra c)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LedgerView c -&gt; Ticked (LedgerView c)
forall c. LedgerView c -&gt; Ticked (LedgerView c)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">TickedPraosLedgerView</span></a></span><span> </span><span class="annot"><span class="annottext">(LedgerView c -&gt; Ticked (LedgerView c))
-&gt; LedgerView c -&gt; Ticked (LedgerView c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-534"></span><span>              </span><span class="annot"><span class="annottext">ShelleyGenesis (ShelleyEra c) -&gt; LedgerView c
forall c. ShelleyGenesis (ShelleyEra c) -&gt; LedgerView c
</span><span class="hs-identifier hs-var">SL.mkInitialShelleyLedgerView</span></span><span>
</span><span id="line-535"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyLedgerConfig (ShelleyEra c) -&gt; ShelleyGenesis (ShelleyEra c)
forall era. ShelleyLedgerConfig era -&gt; ShelleyGenesis era
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">shelleyLedgerGenesis</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyLedgerConfig (ShelleyEra c)
</span><a href="#local-6989586621679286456"><span class="hs-identifier hs-var">cfgShelley</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-536"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-537"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutsideForecastRange
-&gt; Except
     OutsideForecastRange
     (Ticked (WrapLedgerView (ShelleyBlock (ShelleyEra c))))
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(OutsideForecastRange
 -&gt; Except
      OutsideForecastRange
      (Ticked (WrapLedgerView (ShelleyBlock (ShelleyEra c)))))
-&gt; OutsideForecastRange
-&gt; Except
     OutsideForecastRange
     (Ticked (WrapLedgerView (ShelleyBlock (ShelleyEra c))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OutsideForecastRange :: WithOrigin SlotNo -&gt; SlotNo -&gt; SlotNo -&gt; OutsideForecastRange
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">OutsideForecastRange</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-538"></span><span>              </span><span class="annot"><span class="annottext">outsideForecastAt :: WithOrigin SlotNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">outsideForecastAt</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerState ByronBlock -&gt; WithOrigin SlotNo
forall blk.
UpdateLedger blk =&gt;
LedgerState blk -&gt; WithOrigin SlotNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ledgerTipSlot</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState ByronBlock
</span><a href="#local-6989586621679286453"><span class="hs-identifier hs-var">currentByronState</span></a></span><span>
</span><span id="line-539"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">outsideForecastMaxFor :: SlotNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">outsideForecastMaxFor</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679286451"><span class="hs-identifier hs-var">maxFor</span></a></span><span>
</span><span id="line-540"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">outsideForecastFor :: SlotNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">outsideForecastFor</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679286454"><span class="hs-identifier hs-var">forecastFor</span></a></span><span>
</span><span id="line-541"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-542"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-543"></span><span>        </span><span id="local-6989586621679286442"><span class="annot"><span class="annottext">globals :: Globals
</span><a href="#local-6989586621679286442"><span class="hs-identifier hs-var hs-var">globals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyLedgerConfig (ShelleyEra c) -&gt; Globals
forall era. ShelleyLedgerConfig era -&gt; Globals
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var hs-var">shelleyLedgerGlobals</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyLedgerConfig (ShelleyEra c)
</span><a href="#local-6989586621679286456"><span class="hs-identifier hs-var">cfgShelley</span></a></span><span>
</span><span id="line-544"></span><span>        </span><span id="local-6989586621679286441"><span class="annot"><span class="annottext">swindow :: Word64
</span><a href="#local-6989586621679286441"><span class="hs-identifier hs-var hs-var">swindow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Globals -&gt; Word64
</span><span class="hs-identifier hs-var hs-var">SL.stabilityWindow</span></span><span> </span><span class="annot"><span class="annottext">Globals
</span><a href="#local-6989586621679286442"><span class="hs-identifier hs-var">globals</span></a></span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span>        </span><span class="hs-comment">-- This is the exclusive upper bound of the forecast range</span><span>
</span><span id="line-547"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-548"></span><span>        </span><span class="hs-comment">-- If Shelley's stability window is 0, it means we can't forecast /at</span><span>
</span><span id="line-549"></span><span>        </span><span class="hs-comment">-- all/ in the Shelley era. Not even to the first slot in the Shelley</span><span>
</span><span id="line-550"></span><span>        </span><span class="hs-comment">-- era! Remember that forecasting to slot @S@ means forecasting the</span><span>
</span><span id="line-551"></span><span>        </span><span class="hs-comment">-- ledger view obtained from the ledger state /after/ applying the block</span><span>
</span><span id="line-552"></span><span>        </span><span class="hs-comment">-- with slot @S@. If the stability window is 0, we can't even forecast</span><span>
</span><span id="line-553"></span><span>        </span><span class="hs-comment">-- after the very first &quot;virtual&quot; Shelley block, meaning we can't</span><span>
</span><span id="line-554"></span><span>        </span><span class="hs-comment">-- forecast into the Shelley era when still in the Byron era.</span><span>
</span><span id="line-555"></span><span>        </span><span class="annot"><a href="#local-6989586621679286451"><span class="hs-identifier hs-type">maxFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-556"></span><span>        </span><span id="local-6989586621679286451"><span class="annot"><span class="annottext">maxFor :: SlotNo
</span><a href="#local-6989586621679286451"><span class="hs-identifier hs-var hs-var">maxFor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SlotNo -&gt; SlotNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">addSlots</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679286441"><span class="hs-identifier hs-var">swindow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bound -&gt; SlotNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var">boundSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621679286455"><span class="hs-identifier hs-var">bound</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Translation from one Shelley-based era to another Shelley-based era
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span id="local-6989586621679286439"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286439"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-563"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SL.PreviousEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286439"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-564"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">EraCrypto</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SL.PreviousEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286439"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">EraCrypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286439"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-565"></span><span>         </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SL.TranslateEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286439"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyTip</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-566"></span><span>  </span><span id="local-6989586621679286434"><span class="annot"><span class="annottext">translateEra :: TranslationContext era
-&gt; ShelleyTip (PreviousEra era)
-&gt; Except (TranslationError era ShelleyTip) (ShelleyTip era)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">translateEra</span></span></span><span> </span><span class="annot"><span class="annottext">TranslationContext era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyTip</span></a></span><span> </span><span id="local-6989586621679286432"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679286432"><span class="hs-identifier hs-var">sno</span></a></span></span><span> </span><span id="local-6989586621679286431"><span class="annot"><span class="annottext">BlockNo
</span><a href="#local-6989586621679286431"><span class="hs-identifier hs-var">bno</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyHash</span></a></span><span> </span><span id="local-6989586621679286429"><span class="annot"><a href="#local-6989586621679286429"><span class="hs-identifier hs-var">hash</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-567"></span><span>      </span><span class="annot"><span class="annottext">ShelleyTip era -&gt; ExceptT Void Identity (ShelleyTip era)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ShelleyTip era -&gt; ExceptT Void Identity (ShelleyTip era))
-&gt; ShelleyTip era -&gt; ExceptT Void Identity (ShelleyTip era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SlotNo
-&gt; BlockNo -&gt; HeaderHash (ShelleyBlock era) -&gt; ShelleyTip era
forall era.
SlotNo
-&gt; BlockNo -&gt; HeaderHash (ShelleyBlock era) -&gt; ShelleyTip era
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">ShelleyTip</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679286432"><span class="hs-identifier hs-var">sno</span></a></span><span> </span><span class="annot"><span class="annottext">BlockNo
</span><a href="#local-6989586621679286431"><span class="hs-identifier hs-var">bno</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashHeader (EraCrypto era) -&gt; ShelleyHash (EraCrypto era)
forall c. HashHeader c -&gt; ShelleyHash c
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">ShelleyHash</span></a></span><span> </span><span class="annot"><span class="annottext">HashHeader (EraCrypto era)
</span><a href="#local-6989586621679286429"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span id="local-6989586621679286428"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286428"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-570"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SL.TranslateEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286428"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyTip</span></a></span><span>
</span><span id="line-571"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SL.TranslateEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286428"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SL.NewEpochState</span></span><span>
</span><span id="line-572"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SL.TranslationError</span></span><span> </span><span class="annot"><a href="#local-6989586621679286428"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SL.NewEpochState</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span>
</span><span id="line-573"></span><span>         </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SL.TranslateEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286428"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-574"></span><span>  </span><span id="local-6989586621679286424"><span class="annot"><span class="annottext">translateEra :: TranslationContext era
-&gt; (:.:) LedgerState ShelleyBlock (PreviousEra era)
-&gt; Except
     (TranslationError era (LedgerState :.: ShelleyBlock))
     ((:.:) LedgerState ShelleyBlock era)
</span><a href="#local-6989586621679286424"><span class="hs-identifier hs-var hs-var hs-var hs-var">translateEra</span></a></span></span><span> </span><span id="local-6989586621679286423"><span class="annot"><span class="annottext">TranslationContext era
</span><a href="#local-6989586621679286423"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Comp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyLedgerState</span></a></span><span> </span><span id="local-6989586621679286421"><span class="annot"><a href="#local-6989586621679286421"><span class="hs-identifier hs-var">tip</span></a></span></span><span> </span><span id="local-6989586621679286420"><span class="annot"><a href="#local-6989586621679286420"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span id="local-6989586621679286419"><span class="annot"><a href="#local-6989586621679286419"><span class="hs-identifier hs-var">_transition</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-575"></span><span>      </span><span id="local-6989586621679286418"><span class="annot"><span class="annottext">WithOrigin (ShelleyTip era)
</span><a href="#local-6989586621679286418"><span class="hs-identifier hs-var">tip'</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ShelleyTip (PreviousEra era)
 -&gt; ExceptT Void Identity (ShelleyTip era))
-&gt; WithOrigin (ShelleyTip (PreviousEra era))
-&gt; ExceptT Void Identity (WithOrigin (ShelleyTip era))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TranslationContext era
-&gt; ShelleyTip (PreviousEra era)
-&gt; Except (TranslationError era ShelleyTip) (ShelleyTip era)
forall era (f :: * -&gt; *).
TranslateEra era f =&gt;
TranslationContext era
-&gt; f (PreviousEra era) -&gt; Except (TranslationError era f) (f era)
</span><span class="hs-identifier hs-var">SL.translateEra</span></span><span> </span><span class="annot"><span class="annottext">TranslationContext era
</span><a href="#local-6989586621679286423"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WithOrigin (ShelleyTip (PreviousEra era))
</span><a href="#local-6989586621679286421"><span class="hs-identifier hs-var">tip</span></a></span><span>
</span><span id="line-576"></span><span>      </span><span id="local-6989586621679286416"><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679286416"><span class="hs-identifier hs-var">state'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TranslationContext era
-&gt; NewEpochState (PreviousEra era)
-&gt; Except (TranslationError era NewEpochState) (NewEpochState era)
forall era (f :: * -&gt; *).
TranslateEra era f =&gt;
TranslationContext era
-&gt; f (PreviousEra era) -&gt; Except (TranslationError era f) (f era)
</span><span class="hs-identifier hs-var">SL.translateEra</span></span><span> </span><span class="annot"><span class="annottext">TranslationContext era
</span><a href="#local-6989586621679286423"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState (PreviousEra era)
</span><a href="#local-6989586621679286420"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-577"></span><span>      </span><span class="annot"><span class="annottext">(:.:) LedgerState ShelleyBlock era
-&gt; ExceptT Void Identity ((:.:) LedgerState ShelleyBlock era)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((:.:) LedgerState ShelleyBlock era
 -&gt; ExceptT Void Identity ((:.:) LedgerState ShelleyBlock era))
-&gt; (:.:) LedgerState ShelleyBlock era
-&gt; ExceptT Void Identity ((:.:) LedgerState ShelleyBlock era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LedgerState (ShelleyBlock era)
-&gt; (:.:) LedgerState ShelleyBlock era
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
f (g p) -&gt; (:.:) f g p
</span><span class="hs-identifier hs-var">Comp</span></span><span> </span><span class="annot"><span class="annottext">(LedgerState (ShelleyBlock era)
 -&gt; (:.:) LedgerState ShelleyBlock era)
-&gt; LedgerState (ShelleyBlock era)
-&gt; (:.:) LedgerState ShelleyBlock era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShelleyLedgerState :: forall era.
WithOrigin (ShelleyTip era)
-&gt; NewEpochState era
-&gt; ShelleyTransition
-&gt; LedgerState (ShelleyBlock era)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyLedgerState</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-578"></span><span>          </span><span class="annot"><span class="annottext">shelleyLedgerTip :: WithOrigin (ShelleyTip era)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">shelleyLedgerTip</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WithOrigin (ShelleyTip era)
</span><a href="#local-6989586621679286418"><span class="hs-identifier hs-var">tip'</span></a></span><span>
</span><span id="line-579"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">shelleyLedgerState :: NewEpochState era
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">shelleyLedgerState</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679286416"><span class="hs-identifier hs-var">state'</span></a></span><span>
</span><span id="line-580"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">shelleyLedgerTransition :: ShelleyTransition
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">shelleyLedgerTransition</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; ShelleyTransition
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">ShelleyTransitionInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span>
</span><span id="line-581"></span><span>        </span><span class="hs-special">}</span></span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span id="local-6989586621679286415"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286415"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-584"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SL.TranslateEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286415"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SL.Tx</span></span><span>
</span><span id="line-585"></span><span>         </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SL.TranslateEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286415"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-586"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="TranslationError"><span class="annot"><span class="hs-identifier hs-var">TranslationError</span></span></span><span> </span><span class="annot"><a href="#local-6989586621679286415"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:.:</span></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SL.TranslationError</span></span><span> </span><span class="annot"><a href="#local-6989586621679286415"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SL.Tx</span></span><span>
</span><span id="line-587"></span><span>  </span><span id="local-6989586621679286411"><span class="annot"><span class="annottext">translateEra :: TranslationContext era
-&gt; (:.:) GenTx ShelleyBlock (PreviousEra era)
-&gt; Except
     (TranslationError era (GenTx :.: ShelleyBlock))
     ((:.:) GenTx ShelleyBlock era)
</span><a href="#local-6989586621679286411"><span class="hs-identifier hs-var hs-var hs-var hs-var">translateEra</span></a></span></span><span> </span><span id="local-6989586621679286410"><span class="annot"><span class="annottext">TranslationContext era
</span><a href="#local-6989586621679286410"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Comp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyTx</span></a></span><span> </span><span id="local-6989586621679286408"><span class="annot"><a href="#local-6989586621679286408"><span class="hs-identifier hs-var">_txId</span></a></span></span><span> </span><span id="local-6989586621679286407"><span class="annot"><a href="#local-6989586621679286407"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-588"></span><span>    </span><span class="hs-comment">-- TODO will the txId stay the same? If so, we could avoid recomputing it</span><span>
</span><span id="line-589"></span><span>    </span><span class="annot"><span class="annottext">GenTx (ShelleyBlock era) -&gt; (:.:) GenTx ShelleyBlock era
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
f (g p) -&gt; (:.:) f g p
</span><span class="hs-identifier hs-var">Comp</span></span><span> </span><span class="annot"><span class="annottext">(GenTx (ShelleyBlock era) -&gt; (:.:) GenTx ShelleyBlock era)
-&gt; (Tx era -&gt; GenTx (ShelleyBlock era))
-&gt; Tx era
-&gt; (:.:) GenTx ShelleyBlock era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; GenTx (ShelleyBlock era)
forall era.
ShelleyBasedEra era =&gt;
Tx era -&gt; GenTx (ShelleyBlock era)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">mkShelleyTx</span></a></span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; (:.:) GenTx ShelleyBlock era)
-&gt; ExceptT (TranslationError era Tx) Identity (Tx era)
-&gt; ExceptT
     (TranslationError era Tx) Identity ((:.:) GenTx ShelleyBlock era)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TranslationContext era
-&gt; Tx (PreviousEra era)
-&gt; ExceptT (TranslationError era Tx) Identity (Tx era)
forall era (f :: * -&gt; *).
TranslateEra era f =&gt;
TranslationContext era
-&gt; f (PreviousEra era) -&gt; Except (TranslationError era f) (f era)
</span><span class="hs-identifier hs-var">SL.translateEra</span></span><span> </span><span class="annot"><span class="annottext">TranslationContext era
</span><a href="#local-6989586621679286410"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Tx (PreviousEra era)
</span><a href="#local-6989586621679286407"><span class="hs-identifier hs-var">tx</span></a></span></span><span>
</span><span id="line-590"></span><span>
</span><span id="line-591"></span><span class="hs-comment">-- | Forecast from a Shelley-based era to the next Shelley-based era.</span><span>
</span><span id="line-592"></span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#forecastAcrossShelley"><span class="hs-identifier hs-type">forecastAcrossShelley</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-593"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679286809"><span class="annot"><a href="#local-6989586621679286809"><span class="hs-identifier hs-type">eraFrom</span></a></span></span><span> </span><span id="local-6989586621679286808"><span class="annot"><a href="#local-6989586621679286808"><span class="hs-identifier hs-type">eraTo</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-594"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">EraCrypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286809"><span class="hs-identifier hs-type">eraFrom</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">EraCrypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286808"><span class="hs-identifier hs-type">eraTo</span></a></span><span>
</span><span id="line-595"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286809"><span class="hs-identifier hs-type">eraFrom</span></a></span><span>
</span><span id="line-596"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyLedgerConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286809"><span class="hs-identifier hs-type">eraFrom</span></a></span><span>
</span><span id="line-598"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyLedgerConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286808"><span class="hs-identifier hs-type">eraTo</span></a></span><span>
</span><span id="line-599"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Bound</span></a></span><span>  </span><span class="hs-comment">-- ^ Transition between the two eras</span><span>
</span><span id="line-600"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-comment">-- ^ Forecast for this slot</span><span>
</span><span id="line-601"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286809"><span class="hs-identifier hs-type">eraFrom</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-602"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Except</span></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">OutsideForecastRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapLedgerView</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286808"><span class="hs-identifier hs-type">eraTo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span id="forecastAcrossShelley"><span class="annot"><span class="annottext">forecastAcrossShelley :: ShelleyLedgerConfig eraFrom
-&gt; ShelleyLedgerConfig eraTo
-&gt; Bound
-&gt; SlotNo
-&gt; LedgerState (ShelleyBlock eraFrom)
-&gt; Except
     OutsideForecastRange (Ticked (WrapLedgerView (ShelleyBlock eraTo)))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#forecastAcrossShelley"><span class="hs-identifier hs-var hs-var">forecastAcrossShelley</span></a></span></span><span> </span><span id="local-6989586621679286404"><span class="annot"><span class="annottext">ShelleyLedgerConfig eraFrom
</span><a href="#local-6989586621679286404"><span class="hs-identifier hs-var">cfgFrom</span></a></span></span><span> </span><span id="local-6989586621679286403"><span class="annot"><span class="annottext">ShelleyLedgerConfig eraTo
</span><a href="#local-6989586621679286403"><span class="hs-identifier hs-var">cfgTo</span></a></span></span><span> </span><span id="local-6989586621679286402"><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621679286402"><span class="hs-identifier hs-var">transition</span></a></span></span><span> </span><span id="local-6989586621679286401"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679286401"><span class="hs-identifier hs-var">forecastFor</span></a></span></span><span> </span><span id="local-6989586621679286400"><span class="annot"><span class="annottext">LedgerState (ShelleyBlock eraFrom)
</span><a href="#local-6989586621679286400"><span class="hs-identifier hs-var">ledgerStateFrom</span></a></span></span><span>
</span><span id="line-604"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679286401"><span class="hs-identifier hs-var">forecastFor</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679286399"><span class="hs-identifier hs-var">maxFor</span></a></span><span>
</span><span id="line-605"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ticked (WrapLedgerView (ShelleyBlock eraTo))
-&gt; Except
     OutsideForecastRange (Ticked (WrapLedgerView (ShelleyBlock eraTo)))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Ticked (WrapLedgerView (ShelleyBlock eraTo))
 -&gt; Except
      OutsideForecastRange
      (Ticked (WrapLedgerView (ShelleyBlock eraTo))))
-&gt; Ticked (WrapLedgerView (ShelleyBlock eraTo))
-&gt; Except
     OutsideForecastRange (Ticked (WrapLedgerView (ShelleyBlock eraTo)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; Ticked (WrapLedgerView (ShelleyBlock eraTo))
</span><a href="#local-6989586621679286398"><span class="hs-identifier hs-var">futureLedgerView</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679286401"><span class="hs-identifier hs-var">forecastFor</span></a></span><span>
</span><span id="line-606"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-607"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OutsideForecastRange
-&gt; Except
     OutsideForecastRange (Ticked (WrapLedgerView (ShelleyBlock eraTo)))
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(OutsideForecastRange
 -&gt; Except
      OutsideForecastRange
      (Ticked (WrapLedgerView (ShelleyBlock eraTo))))
-&gt; OutsideForecastRange
-&gt; Except
     OutsideForecastRange (Ticked (WrapLedgerView (ShelleyBlock eraTo)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OutsideForecastRange :: WithOrigin SlotNo -&gt; SlotNo -&gt; SlotNo -&gt; OutsideForecastRange
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">OutsideForecastRange</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-608"></span><span>          </span><span class="annot"><span class="annottext">outsideForecastAt :: WithOrigin SlotNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">outsideForecastAt</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerState (ShelleyBlock eraFrom) -&gt; WithOrigin SlotNo
forall blk.
UpdateLedger blk =&gt;
LedgerState blk -&gt; WithOrigin SlotNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ledgerTipSlot</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState (ShelleyBlock eraFrom)
</span><a href="#local-6989586621679286400"><span class="hs-identifier hs-var">ledgerStateFrom</span></a></span><span>
</span><span id="line-609"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">outsideForecastMaxFor :: SlotNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">outsideForecastMaxFor</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679286399"><span class="hs-identifier hs-var">maxFor</span></a></span><span>
</span><span id="line-610"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">outsideForecastFor :: SlotNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">outsideForecastFor</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679286401"><span class="hs-identifier hs-var">forecastFor</span></a></span><span>
</span><span id="line-611"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-612"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-613"></span><span>    </span><span class="hs-comment">-- | 'SL.futureLedgerView' imposes its own bounds. Those bounds could</span><span>
</span><span id="line-614"></span><span>    </span><span class="hs-comment">-- /exceed/ the 'maxFor' we have computed, but should never be /less/.</span><span>
</span><span id="line-615"></span><span>    </span><span class="annot"><a href="#local-6989586621679286398"><span class="hs-identifier hs-type">futureLedgerView</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapLedgerView</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286808"><span class="hs-identifier hs-type">eraTo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>    </span><span id="local-6989586621679286398"><span class="annot"><span class="annottext">futureLedgerView :: SlotNo -&gt; Ticked (WrapLedgerView (ShelleyBlock eraTo))
</span><a href="#local-6989586621679286398"><span class="hs-identifier hs-var hs-var">futureLedgerView</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-617"></span><span>          </span><span class="annot"><span class="annottext">Ticked (LedgerView (Crypto eraTo))
-&gt; Ticked (WrapLedgerView (ShelleyBlock eraTo))
forall blk.
Ticked (LedgerView (BlockProtocol blk))
-&gt; Ticked (WrapLedgerView blk)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">WrapTickedLedgerView</span></a></span><span>
</span><span id="line-618"></span><span>        </span><span class="annot"><span class="annottext">(Ticked (LedgerView (Crypto eraTo))
 -&gt; Ticked (WrapLedgerView (ShelleyBlock eraTo)))
-&gt; (SlotNo -&gt; Ticked (LedgerView (Crypto eraTo)))
-&gt; SlotNo
-&gt; Ticked (WrapLedgerView (ShelleyBlock eraTo))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LedgerView (Crypto eraTo) -&gt; Ticked (LedgerView (Crypto eraTo))
forall c. LedgerView c -&gt; Ticked (LedgerView c)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var">TickedPraosLedgerView</span></a></span><span>
</span><span id="line-619"></span><span>        </span><span class="annot"><span class="annottext">(LedgerView (Crypto eraTo) -&gt; Ticked (LedgerView (Crypto eraTo)))
-&gt; (SlotNo -&gt; LedgerView (Crypto eraTo))
-&gt; SlotNo
-&gt; Ticked (LedgerView (Crypto eraTo))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(FutureLedgerViewError eraFrom -&gt; LedgerView (Crypto eraTo))
-&gt; (LedgerView (Crypto eraTo) -&gt; LedgerView (Crypto eraTo))
-&gt; Either
     (FutureLedgerViewError eraFrom) (LedgerView (Crypto eraTo))
-&gt; LedgerView (Crypto eraTo)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span>
</span><span id="line-620"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679286396"><span class="annot"><span class="annottext">FutureLedgerViewError eraFrom
</span><a href="#local-6989586621679286396"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; LedgerView (Crypto eraTo)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;futureLedgerView failed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FutureLedgerViewError eraFrom -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">FutureLedgerViewError eraFrom
</span><a href="#local-6989586621679286396"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>            </span><span class="annot"><span class="annottext">LedgerView (Crypto eraTo) -&gt; LedgerView (Crypto eraTo)
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-622"></span><span>        </span><span class="annot"><span class="annottext">(Either (FutureLedgerViewError eraFrom) (LedgerView (Crypto eraTo))
 -&gt; LedgerView (Crypto eraTo))
-&gt; (SlotNo
    -&gt; Either
         (FutureLedgerViewError eraFrom) (LedgerView (Crypto eraTo)))
-&gt; SlotNo
-&gt; LedgerView (Crypto eraTo)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Globals
-&gt; NewEpochState eraFrom
-&gt; SlotNo
-&gt; Either
     (FutureLedgerViewError eraFrom) (LedgerView (Crypto eraFrom))
forall era (m :: * -&gt; *).
(GetLedgerView era, MonadError (FutureLedgerViewError era) m) =&gt;
Globals
-&gt; NewEpochState era -&gt; SlotNo -&gt; m (LedgerView (Crypto era))
</span><span class="hs-identifier hs-var">SL.futureLedgerView</span></span><span>
</span><span id="line-623"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyLedgerConfig eraFrom -&gt; Globals
forall era. ShelleyLedgerConfig era -&gt; Globals
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var hs-var">shelleyLedgerGlobals</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyLedgerConfig eraFrom
</span><a href="#local-6989586621679286404"><span class="hs-identifier hs-var">cfgFrom</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LedgerState (ShelleyBlock eraFrom) -&gt; NewEpochState eraFrom
forall era. LedgerState (ShelleyBlock era) -&gt; NewEpochState era
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var hs-var">shelleyLedgerState</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState (ShelleyBlock eraFrom)
</span><a href="#local-6989586621679286400"><span class="hs-identifier hs-var">ledgerStateFrom</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span>
</span><span id="line-626"></span><span>    </span><span class="hs-comment">-- Exclusive upper bound</span><span>
</span><span id="line-627"></span><span>    </span><span class="annot"><a href="#local-6989586621679286399"><span class="hs-identifier hs-type">maxFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-628"></span><span>    </span><span id="local-6989586621679286399"><span class="annot"><span class="annottext">maxFor :: SlotNo
</span><a href="#local-6989586621679286399"><span class="hs-identifier hs-var hs-var">maxFor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WithOrigin SlotNo -&gt; SlotNo -&gt; Word64 -&gt; Word64 -&gt; SlotNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">crossEraForecastBound</span></a></span><span>
</span><span id="line-629"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LedgerState (ShelleyBlock eraFrom) -&gt; WithOrigin SlotNo
forall blk.
UpdateLedger blk =&gt;
LedgerState blk -&gt; WithOrigin SlotNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ledgerTipSlot</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState (ShelleyBlock eraFrom)
</span><a href="#local-6989586621679286400"><span class="hs-identifier hs-var">ledgerStateFrom</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bound -&gt; SlotNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var">boundSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621679286402"><span class="hs-identifier hs-var">transition</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Globals -&gt; Word64
</span><span class="hs-identifier hs-var hs-var">SL.stabilityWindow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyLedgerConfig eraFrom -&gt; Globals
forall era. ShelleyLedgerConfig era -&gt; Globals
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var hs-var">shelleyLedgerGlobals</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyLedgerConfig eraFrom
</span><a href="#local-6989586621679286404"><span class="hs-identifier hs-var">cfgFrom</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-632"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Globals -&gt; Word64
</span><span class="hs-identifier hs-var hs-var">SL.stabilityWindow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyLedgerConfig eraTo -&gt; Globals
forall era. ShelleyLedgerConfig era -&gt; Globals
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-var hs-var">shelleyLedgerGlobals</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyLedgerConfig eraTo
</span><a href="#local-6989586621679286403"><span class="hs-identifier hs-var">cfgTo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span>
</span><span id="line-634"></span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateChainDepStateAcrossShelley"><span class="hs-identifier hs-type">translateChainDepStateAcrossShelley</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-635"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679286955"><span class="annot"><a href="#local-6989586621679286955"><span class="hs-identifier hs-type">eraFrom</span></a></span></span><span> </span><span id="local-6989586621679286954"><span class="annot"><a href="#local-6989586621679286954"><span class="hs-identifier hs-type">eraTo</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-636"></span><span>     </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">EraCrypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286955"><span class="hs-identifier hs-type">eraFrom</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">EraCrypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286954"><span class="hs-identifier hs-type">eraTo</span></a></span><span>
</span><span id="line-637"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">RequiringBoth</span></a></span><span>
</span><span id="line-638"></span><span>       </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapConsensusConfig</span></a></span><span>
</span><span id="line-639"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Translate</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapChainDepState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-640"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286955"><span class="hs-identifier hs-type">eraFrom</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-641"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286954"><span class="hs-identifier hs-type">eraTo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-642"></span><span id="translateChainDepStateAcrossShelley"><span class="annot"><span class="annottext">translateChainDepStateAcrossShelley :: RequiringBoth
  WrapConsensusConfig
  (Translate WrapChainDepState)
  (ShelleyBlock eraFrom)
  (ShelleyBlock eraTo)
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateChainDepStateAcrossShelley"><span class="hs-identifier hs-var hs-var">translateChainDepStateAcrossShelley</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-643"></span><span>    </span><span class="annot"><span class="annottext">Translate
  WrapChainDepState (ShelleyBlock eraFrom) (ShelleyBlock eraTo)
-&gt; RequiringBoth
     WrapConsensusConfig
     (Translate WrapChainDepState)
     (ShelleyBlock eraFrom)
     (ShelleyBlock eraTo)
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (h :: k -&gt; *).
f x y -&gt; RequiringBoth h f x y
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ignoringBoth</span></a></span><span> </span><span class="annot"><span class="annottext">(Translate
   WrapChainDepState (ShelleyBlock eraFrom) (ShelleyBlock eraTo)
 -&gt; RequiringBoth
      WrapConsensusConfig
      (Translate WrapChainDepState)
      (ShelleyBlock eraFrom)
      (ShelleyBlock eraTo))
-&gt; Translate
     WrapChainDepState (ShelleyBlock eraFrom) (ShelleyBlock eraTo)
-&gt; RequiringBoth
     WrapConsensusConfig
     (Translate WrapChainDepState)
     (ShelleyBlock eraFrom)
     (ShelleyBlock eraTo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-644"></span><span>      </span><span class="annot"><span class="annottext">(EpochNo
 -&gt; WrapChainDepState (ShelleyBlock eraFrom)
 -&gt; WrapChainDepState (ShelleyBlock eraTo))
-&gt; Translate
     WrapChainDepState (ShelleyBlock eraFrom) (ShelleyBlock eraTo)
forall (f :: * -&gt; *) x y.
(EpochNo -&gt; f x -&gt; f y) -&gt; Translate f x y
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">Translate</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochNo
  -&gt; WrapChainDepState (ShelleyBlock eraFrom)
  -&gt; WrapChainDepState (ShelleyBlock eraTo))
 -&gt; Translate
      WrapChainDepState (ShelleyBlock eraFrom) (ShelleyBlock eraTo))
-&gt; (EpochNo
    -&gt; WrapChainDepState (ShelleyBlock eraFrom)
    -&gt; WrapChainDepState (ShelleyBlock eraTo))
-&gt; Translate
     WrapChainDepState (ShelleyBlock eraFrom) (ShelleyBlock eraTo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679286391"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679286391"><span class="hs-identifier hs-var">_epochNo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapChainDepState</span></a></span><span> </span><span id="local-6989586621679286390"><span class="annot"><span class="annottext">ChainDepState (BlockProtocol (ShelleyBlock eraFrom))
</span><a href="#local-6989586621679286390"><span class="hs-identifier hs-var">chainDepState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-645"></span><span>        </span><span class="hs-comment">-- Same protocol, same 'ChainDepState'. Note that we don't have to apply</span><span>
</span><span id="line-646"></span><span>        </span><span class="hs-comment">-- any changes related to an epoch transition, this is already done when</span><span>
</span><span id="line-647"></span><span>        </span><span class="hs-comment">-- ticking the state.</span><span>
</span><span id="line-648"></span><span>        </span><span class="annot"><span class="annottext">ChainDepState (BlockProtocol (ShelleyBlock eraTo))
-&gt; WrapChainDepState (ShelleyBlock eraTo)
forall blk.
ChainDepState (BlockProtocol blk) -&gt; WrapChainDepState blk
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">WrapChainDepState</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDepState (BlockProtocol (ShelleyBlock eraFrom))
ChainDepState (BlockProtocol (ShelleyBlock eraTo))
</span><a href="#local-6989586621679286390"><span class="hs-identifier hs-var">chainDepState</span></a></span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateLedgerViewAcrossShelley"><span class="hs-identifier hs-type">translateLedgerViewAcrossShelley</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-651"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679286952"><span class="annot"><a href="#local-6989586621679286952"><span class="hs-identifier hs-type">eraFrom</span></a></span></span><span> </span><span id="local-6989586621679286951"><span class="annot"><a href="#local-6989586621679286951"><span class="hs-identifier hs-type">eraTo</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-652"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">EraCrypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286952"><span class="hs-identifier hs-type">eraFrom</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">EraCrypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286951"><span class="hs-identifier hs-type">eraTo</span></a></span><span>
</span><span id="line-653"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBasedEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286952"><span class="hs-identifier hs-type">eraFrom</span></a></span><span>
</span><span id="line-654"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-655"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">RequiringBoth</span></a></span><span>
</span><span id="line-656"></span><span>       </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapLedgerConfig</span></a></span><span>
</span><span id="line-657"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">TranslateForecast</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapLedgerView</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-658"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286952"><span class="hs-identifier hs-type">eraFrom</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679286951"><span class="hs-identifier hs-type">eraTo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-660"></span><span id="translateLedgerViewAcrossShelley"><span class="annot"><span class="annottext">translateLedgerViewAcrossShelley :: RequiringBoth
  WrapLedgerConfig
  (TranslateForecast LedgerState WrapLedgerView)
  (ShelleyBlock eraFrom)
  (ShelleyBlock eraTo)
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateLedgerViewAcrossShelley"><span class="hs-identifier hs-var hs-var">translateLedgerViewAcrossShelley</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-661"></span><span>    </span><span class="annot"><span class="annottext">(WrapLedgerConfig (ShelleyBlock eraFrom)
 -&gt; WrapLedgerConfig (ShelleyBlock eraTo)
 -&gt; TranslateForecast
      LedgerState
      WrapLedgerView
      (ShelleyBlock eraFrom)
      (ShelleyBlock eraTo))
-&gt; RequiringBoth
     WrapLedgerConfig
     (TranslateForecast LedgerState WrapLedgerView)
     (ShelleyBlock eraFrom)
     (ShelleyBlock eraTo)
forall k (h :: k -&gt; *) (f :: k -&gt; k -&gt; *) (x :: k) (y :: k).
(h x -&gt; h y -&gt; f x y) -&gt; RequiringBoth h f x y
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">RequireBoth</span></a></span><span> </span><span class="annot"><span class="annottext">((WrapLedgerConfig (ShelleyBlock eraFrom)
  -&gt; WrapLedgerConfig (ShelleyBlock eraTo)
  -&gt; TranslateForecast
       LedgerState
       WrapLedgerView
       (ShelleyBlock eraFrom)
       (ShelleyBlock eraTo))
 -&gt; RequiringBoth
      WrapLedgerConfig
      (TranslateForecast LedgerState WrapLedgerView)
      (ShelleyBlock eraFrom)
      (ShelleyBlock eraTo))
-&gt; (WrapLedgerConfig (ShelleyBlock eraFrom)
    -&gt; WrapLedgerConfig (ShelleyBlock eraTo)
    -&gt; TranslateForecast
         LedgerState
         WrapLedgerView
         (ShelleyBlock eraFrom)
         (ShelleyBlock eraTo))
-&gt; RequiringBoth
     WrapLedgerConfig
     (TranslateForecast LedgerState WrapLedgerView)
     (ShelleyBlock eraFrom)
     (ShelleyBlock eraTo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapLedgerConfig</span></a></span><span> </span><span id="local-6989586621679286389"><span class="annot"><span class="annottext">LedgerConfig (ShelleyBlock eraFrom)
</span><a href="#local-6989586621679286389"><span class="hs-identifier hs-var">cfgFrom</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-662"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapLedgerConfig</span></a></span><span> </span><span id="local-6989586621679286388"><span class="annot"><span class="annottext">LedgerConfig (ShelleyBlock eraTo)
</span><a href="#local-6989586621679286388"><span class="hs-identifier hs-var">cfgTo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-663"></span><span>      </span><span class="annot"><span class="annottext">(Bound
 -&gt; SlotNo
 -&gt; LedgerState (ShelleyBlock eraFrom)
 -&gt; Except
      OutsideForecastRange
      (Ticked (WrapLedgerView (ShelleyBlock eraTo))))
-&gt; TranslateForecast
     LedgerState
     WrapLedgerView
     (ShelleyBlock eraFrom)
     (ShelleyBlock eraTo)
forall (f :: * -&gt; *) (g :: * -&gt; *) x y.
(Bound
 -&gt; SlotNo -&gt; f x -&gt; Except OutsideForecastRange (Ticked (g y)))
-&gt; TranslateForecast f g x y
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">TranslateForecast</span></a></span><span> </span><span class="annot"><span class="annottext">((Bound
  -&gt; SlotNo
  -&gt; LedgerState (ShelleyBlock eraFrom)
  -&gt; Except
       OutsideForecastRange
       (Ticked (WrapLedgerView (ShelleyBlock eraTo))))
 -&gt; TranslateForecast
      LedgerState
      WrapLedgerView
      (ShelleyBlock eraFrom)
      (ShelleyBlock eraTo))
-&gt; (Bound
    -&gt; SlotNo
    -&gt; LedgerState (ShelleyBlock eraFrom)
    -&gt; Except
         OutsideForecastRange
         (Ticked (WrapLedgerView (ShelleyBlock eraTo))))
-&gt; TranslateForecast
     LedgerState
     WrapLedgerView
     (ShelleyBlock eraFrom)
     (ShelleyBlock eraTo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShelleyLedgerConfig eraFrom
-&gt; ShelleyLedgerConfig eraTo
-&gt; Bound
-&gt; SlotNo
-&gt; LedgerState (ShelleyBlock eraFrom)
-&gt; Except
     OutsideForecastRange (Ticked (WrapLedgerView (ShelleyBlock eraTo)))
forall eraFrom eraTo.
(EraCrypto eraFrom ~ EraCrypto eraTo, ShelleyBasedEra eraFrom) =&gt;
ShelleyLedgerConfig eraFrom
-&gt; ShelleyLedgerConfig eraTo
-&gt; Bound
-&gt; SlotNo
-&gt; LedgerState (ShelleyBlock eraFrom)
-&gt; Except
     OutsideForecastRange (Ticked (WrapLedgerView (ShelleyBlock eraTo)))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#forecastAcrossShelley"><span class="hs-identifier hs-var">forecastAcrossShelley</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerConfig (ShelleyBlock eraFrom)
ShelleyLedgerConfig eraFrom
</span><a href="#local-6989586621679286389"><span class="hs-identifier hs-var">cfgFrom</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerConfig (ShelleyBlock eraTo)
ShelleyLedgerConfig eraTo
</span><a href="#local-6989586621679286388"><span class="hs-identifier hs-var">cfgTo</span></a></span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Translation from Shelley to Allegra
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-668"></span><span>
</span><span id="line-669"></span><span id="local-6989586621679286959"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateLedgerStateShelleyToAllegraWrapper"><span class="hs-identifier hs-type">translateLedgerStateShelleyToAllegraWrapper</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-670"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">PraosCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679286959"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">RequiringBoth</span></a></span><span>
</span><span id="line-672"></span><span>       </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapLedgerConfig</span></a></span><span>
</span><span id="line-673"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Translate</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ShelleyEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286959"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AllegraEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286959"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-676"></span><span id="translateLedgerStateShelleyToAllegraWrapper"><span class="annot"><span class="annottext">translateLedgerStateShelleyToAllegraWrapper :: RequiringBoth
  WrapLedgerConfig
  (Translate LedgerState)
  (ShelleyBlock (ShelleyEra c))
  (ShelleyBlock (AllegraEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateLedgerStateShelleyToAllegraWrapper"><span class="hs-identifier hs-var hs-var">translateLedgerStateShelleyToAllegraWrapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-677"></span><span>    </span><span class="annot"><span class="annottext">Translate
  LedgerState
  (ShelleyBlock (ShelleyEra c))
  (ShelleyBlock (AllegraEra c))
-&gt; RequiringBoth
     WrapLedgerConfig
     (Translate LedgerState)
     (ShelleyBlock (ShelleyEra c))
     (ShelleyBlock (AllegraEra c))
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (h :: k -&gt; *).
f x y -&gt; RequiringBoth h f x y
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ignoringBoth</span></a></span><span> </span><span class="annot"><span class="annottext">(Translate
   LedgerState
   (ShelleyBlock (ShelleyEra c))
   (ShelleyBlock (AllegraEra c))
 -&gt; RequiringBoth
      WrapLedgerConfig
      (Translate LedgerState)
      (ShelleyBlock (ShelleyEra c))
      (ShelleyBlock (AllegraEra c)))
-&gt; Translate
     LedgerState
     (ShelleyBlock (ShelleyEra c))
     (ShelleyBlock (AllegraEra c))
-&gt; RequiringBoth
     WrapLedgerConfig
     (Translate LedgerState)
     (ShelleyBlock (ShelleyEra c))
     (ShelleyBlock (AllegraEra c))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-678"></span><span>      </span><span class="annot"><span class="annottext">(EpochNo
 -&gt; LedgerState (ShelleyBlock (ShelleyEra c))
 -&gt; LedgerState (ShelleyBlock (AllegraEra c)))
-&gt; Translate
     LedgerState
     (ShelleyBlock (ShelleyEra c))
     (ShelleyBlock (AllegraEra c))
forall (f :: * -&gt; *) x y.
(EpochNo -&gt; f x -&gt; f y) -&gt; Translate f x y
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">Translate</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochNo
  -&gt; LedgerState (ShelleyBlock (ShelleyEra c))
  -&gt; LedgerState (ShelleyBlock (AllegraEra c)))
 -&gt; Translate
      LedgerState
      (ShelleyBlock (ShelleyEra c))
      (ShelleyBlock (AllegraEra c)))
-&gt; (EpochNo
    -&gt; LedgerState (ShelleyBlock (ShelleyEra c))
    -&gt; LedgerState (ShelleyBlock (AllegraEra c)))
-&gt; Translate
     LedgerState
     (ShelleyBlock (ShelleyEra c))
     (ShelleyBlock (AllegraEra c))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679286387"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679286387"><span class="hs-identifier hs-var">_epochNo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-679"></span><span>        </span><span class="annot"><span class="annottext">(:.:) LedgerState ShelleyBlock (AllegraEra c)
-&gt; LedgerState (ShelleyBlock (AllegraEra c))
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
(:.:) f g p -&gt; f (g p)
</span><span class="hs-identifier hs-var">unComp</span></span><span> </span><span class="annot"><span class="annottext">((:.:) LedgerState ShelleyBlock (AllegraEra c)
 -&gt; LedgerState (ShelleyBlock (AllegraEra c)))
-&gt; (LedgerState (ShelleyBlock (ShelleyEra c))
    -&gt; (:.:) LedgerState ShelleyBlock (AllegraEra c))
-&gt; LedgerState (ShelleyBlock (ShelleyEra c))
-&gt; LedgerState (ShelleyBlock (AllegraEra c))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TranslationContext (AllegraEra c)
-&gt; (:.:) LedgerState ShelleyBlock (PreviousEra (AllegraEra c))
-&gt; (:.:) LedgerState ShelleyBlock (AllegraEra c)
forall era (f :: * -&gt; *).
(TranslateEra era f, TranslationError era f ~ Void) =&gt;
TranslationContext era -&gt; f (PreviousEra era) -&gt; f era
</span><span class="hs-identifier hs-var">SL.translateEra'</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((:.:) LedgerState ShelleyBlock (ShelleyEra c)
 -&gt; (:.:) LedgerState ShelleyBlock (AllegraEra c))
-&gt; (LedgerState (ShelleyBlock (ShelleyEra c))
    -&gt; (:.:) LedgerState ShelleyBlock (ShelleyEra c))
-&gt; LedgerState (ShelleyBlock (ShelleyEra c))
-&gt; (:.:) LedgerState ShelleyBlock (AllegraEra c)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LedgerState (ShelleyBlock (ShelleyEra c))
-&gt; (:.:) LedgerState ShelleyBlock (ShelleyEra c)
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
f (g p) -&gt; (:.:) f g p
</span><span class="hs-identifier hs-var">Comp</span></span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span id="local-6989586621679286932"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateTxShelleyToAllegraWrapper"><span class="hs-identifier hs-type">translateTxShelleyToAllegraWrapper</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-682"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">PraosCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679286932"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-683"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">InjectTx</span></a></span><span>
</span><span id="line-684"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ShelleyEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286932"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AllegraEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286932"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-686"></span><span id="translateTxShelleyToAllegraWrapper"><span class="annot"><span class="annottext">translateTxShelleyToAllegraWrapper :: InjectTx
  (ShelleyBlock (ShelleyEra c)) (ShelleyBlock (AllegraEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateTxShelleyToAllegraWrapper"><span class="hs-identifier hs-var hs-var">translateTxShelleyToAllegraWrapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenTx (ShelleyBlock (ShelleyEra c))
 -&gt; Maybe (GenTx (ShelleyBlock (AllegraEra c))))
-&gt; InjectTx
     (ShelleyBlock (ShelleyEra c)) (ShelleyBlock (AllegraEra c))
forall blk blk'.
(GenTx blk -&gt; Maybe (GenTx blk')) -&gt; InjectTx blk blk'
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">InjectTx</span></a></span><span> </span><span class="annot"><span class="annottext">((GenTx (ShelleyBlock (ShelleyEra c))
  -&gt; Maybe (GenTx (ShelleyBlock (AllegraEra c))))
 -&gt; InjectTx
      (ShelleyBlock (ShelleyEra c)) (ShelleyBlock (AllegraEra c)))
-&gt; (GenTx (ShelleyBlock (ShelleyEra c))
    -&gt; Maybe (GenTx (ShelleyBlock (AllegraEra c))))
-&gt; InjectTx
     (ShelleyBlock (ShelleyEra c)) (ShelleyBlock (AllegraEra c))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-687"></span><span>    </span><span class="annot"><span class="annottext">((:.:) GenTx ShelleyBlock (AllegraEra c)
 -&gt; GenTx (ShelleyBlock (AllegraEra c)))
-&gt; Maybe ((:.:) GenTx ShelleyBlock (AllegraEra c))
-&gt; Maybe (GenTx (ShelleyBlock (AllegraEra c)))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(:.:) GenTx ShelleyBlock (AllegraEra c)
-&gt; GenTx (ShelleyBlock (AllegraEra c))
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
(:.:) f g p -&gt; f (g p)
</span><span class="hs-identifier hs-var">unComp</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ((:.:) GenTx ShelleyBlock (AllegraEra c))
 -&gt; Maybe (GenTx (ShelleyBlock (AllegraEra c))))
-&gt; (GenTx (ShelleyBlock (ShelleyEra c))
    -&gt; Maybe ((:.:) GenTx ShelleyBlock (AllegraEra c)))
-&gt; GenTx (ShelleyBlock (ShelleyEra c))
-&gt; Maybe (GenTx (ShelleyBlock (AllegraEra c)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Either DecoderError ((:.:) GenTx ShelleyBlock (AllegraEra c))
-&gt; Maybe ((:.:) GenTx ShelleyBlock (AllegraEra c))
forall a b. Either a b -&gt; Maybe b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">eitherToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(Either DecoderError ((:.:) GenTx ShelleyBlock (AllegraEra c))
 -&gt; Maybe ((:.:) GenTx ShelleyBlock (AllegraEra c)))
-&gt; (GenTx (ShelleyBlock (ShelleyEra c))
    -&gt; Either DecoderError ((:.:) GenTx ShelleyBlock (AllegraEra c)))
-&gt; GenTx (ShelleyBlock (ShelleyEra c))
-&gt; Maybe ((:.:) GenTx ShelleyBlock (AllegraEra c))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Except DecoderError ((:.:) GenTx ShelleyBlock (AllegraEra c))
-&gt; Either DecoderError ((:.:) GenTx ShelleyBlock (AllegraEra c))
forall e a. Except e a -&gt; Either e a
</span><span class="hs-identifier hs-var">runExcept</span></span><span> </span><span class="annot"><span class="annottext">(Except DecoderError ((:.:) GenTx ShelleyBlock (AllegraEra c))
 -&gt; Either DecoderError ((:.:) GenTx ShelleyBlock (AllegraEra c)))
-&gt; (GenTx (ShelleyBlock (ShelleyEra c))
    -&gt; Except DecoderError ((:.:) GenTx ShelleyBlock (AllegraEra c)))
-&gt; GenTx (ShelleyBlock (ShelleyEra c))
-&gt; Either DecoderError ((:.:) GenTx ShelleyBlock (AllegraEra c))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TranslationContext (AllegraEra c)
-&gt; (:.:) GenTx ShelleyBlock (PreviousEra (AllegraEra c))
-&gt; Except
     (TranslationError (AllegraEra c) (GenTx :.: ShelleyBlock))
     ((:.:) GenTx ShelleyBlock (AllegraEra c))
forall era (f :: * -&gt; *).
TranslateEra era f =&gt;
TranslationContext era
-&gt; f (PreviousEra era) -&gt; Except (TranslationError era f) (f era)
</span><span class="hs-identifier hs-var">SL.translateEra</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((:.:) GenTx ShelleyBlock (ShelleyEra c)
 -&gt; Except DecoderError ((:.:) GenTx ShelleyBlock (AllegraEra c)))
-&gt; (GenTx (ShelleyBlock (ShelleyEra c))
    -&gt; (:.:) GenTx ShelleyBlock (ShelleyEra c))
-&gt; GenTx (ShelleyBlock (ShelleyEra c))
-&gt; Except DecoderError ((:.:) GenTx ShelleyBlock (AllegraEra c))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenTx (ShelleyBlock (ShelleyEra c))
-&gt; (:.:) GenTx ShelleyBlock (ShelleyEra c)
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
f (g p) -&gt; (:.:) f g p
</span><span class="hs-identifier hs-var">Comp</span></span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Translation from Shelley to Allegra
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span id="local-6989586621679286958"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateLedgerStateAllegraToMaryWrapper"><span class="hs-identifier hs-type">translateLedgerStateAllegraToMaryWrapper</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-694"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">PraosCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679286958"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-695"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">RequiringBoth</span></a></span><span>
</span><span id="line-696"></span><span>       </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">WrapLedgerConfig</span></a></span><span>
</span><span id="line-697"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Translate</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AllegraEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286958"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MaryEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286958"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-700"></span><span id="translateLedgerStateAllegraToMaryWrapper"><span class="annot"><span class="annottext">translateLedgerStateAllegraToMaryWrapper :: RequiringBoth
  WrapLedgerConfig
  (Translate LedgerState)
  (ShelleyBlock (AllegraEra c))
  (ShelleyBlock (MaryEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateLedgerStateAllegraToMaryWrapper"><span class="hs-identifier hs-var hs-var">translateLedgerStateAllegraToMaryWrapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-701"></span><span>    </span><span class="annot"><span class="annottext">Translate
  LedgerState
  (ShelleyBlock (AllegraEra c))
  (ShelleyBlock (MaryEra c))
-&gt; RequiringBoth
     WrapLedgerConfig
     (Translate LedgerState)
     (ShelleyBlock (AllegraEra c))
     (ShelleyBlock (MaryEra c))
forall k (f :: k -&gt; k -&gt; *) (x :: k) (y :: k) (h :: k -&gt; *).
f x y -&gt; RequiringBoth h f x y
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ignoringBoth</span></a></span><span> </span><span class="annot"><span class="annottext">(Translate
   LedgerState
   (ShelleyBlock (AllegraEra c))
   (ShelleyBlock (MaryEra c))
 -&gt; RequiringBoth
      WrapLedgerConfig
      (Translate LedgerState)
      (ShelleyBlock (AllegraEra c))
      (ShelleyBlock (MaryEra c)))
-&gt; Translate
     LedgerState
     (ShelleyBlock (AllegraEra c))
     (ShelleyBlock (MaryEra c))
-&gt; RequiringBoth
     WrapLedgerConfig
     (Translate LedgerState)
     (ShelleyBlock (AllegraEra c))
     (ShelleyBlock (MaryEra c))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-702"></span><span>      </span><span class="annot"><span class="annottext">(EpochNo
 -&gt; LedgerState (ShelleyBlock (AllegraEra c))
 -&gt; LedgerState (ShelleyBlock (MaryEra c)))
-&gt; Translate
     LedgerState
     (ShelleyBlock (AllegraEra c))
     (ShelleyBlock (MaryEra c))
forall (f :: * -&gt; *) x y.
(EpochNo -&gt; f x -&gt; f y) -&gt; Translate f x y
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">Translate</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochNo
  -&gt; LedgerState (ShelleyBlock (AllegraEra c))
  -&gt; LedgerState (ShelleyBlock (MaryEra c)))
 -&gt; Translate
      LedgerState
      (ShelleyBlock (AllegraEra c))
      (ShelleyBlock (MaryEra c)))
-&gt; (EpochNo
    -&gt; LedgerState (ShelleyBlock (AllegraEra c))
    -&gt; LedgerState (ShelleyBlock (MaryEra c)))
-&gt; Translate
     LedgerState
     (ShelleyBlock (AllegraEra c))
     (ShelleyBlock (MaryEra c))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679286384"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679286384"><span class="hs-identifier hs-var">_epochNo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-703"></span><span>        </span><span class="annot"><span class="annottext">(:.:) LedgerState ShelleyBlock (MaryEra c)
-&gt; LedgerState (ShelleyBlock (MaryEra c))
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
(:.:) f g p -&gt; f (g p)
</span><span class="hs-identifier hs-var">unComp</span></span><span> </span><span class="annot"><span class="annottext">((:.:) LedgerState ShelleyBlock (MaryEra c)
 -&gt; LedgerState (ShelleyBlock (MaryEra c)))
-&gt; (LedgerState (ShelleyBlock (AllegraEra c))
    -&gt; (:.:) LedgerState ShelleyBlock (MaryEra c))
-&gt; LedgerState (ShelleyBlock (AllegraEra c))
-&gt; LedgerState (ShelleyBlock (MaryEra c))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TranslationContext (MaryEra c)
-&gt; (:.:) LedgerState ShelleyBlock (PreviousEra (MaryEra c))
-&gt; (:.:) LedgerState ShelleyBlock (MaryEra c)
forall era (f :: * -&gt; *).
(TranslateEra era f, TranslationError era f ~ Void) =&gt;
TranslationContext era -&gt; f (PreviousEra era) -&gt; f era
</span><span class="hs-identifier hs-var">SL.translateEra'</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((:.:) LedgerState ShelleyBlock (AllegraEra c)
 -&gt; (:.:) LedgerState ShelleyBlock (MaryEra c))
-&gt; (LedgerState (ShelleyBlock (AllegraEra c))
    -&gt; (:.:) LedgerState ShelleyBlock (AllegraEra c))
-&gt; LedgerState (ShelleyBlock (AllegraEra c))
-&gt; (:.:) LedgerState ShelleyBlock (MaryEra c)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LedgerState (ShelleyBlock (AllegraEra c))
-&gt; (:.:) LedgerState ShelleyBlock (AllegraEra c)
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
f (g p) -&gt; (:.:) f g p
</span><span class="hs-identifier hs-var">Comp</span></span><span>
</span><span id="line-704"></span><span>
</span><span id="line-705"></span><span id="local-6989586621679286931"><span class="annot"><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateTxAllegraToMaryWrapper"><span class="hs-identifier hs-type">translateTxAllegraToMaryWrapper</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-706"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">PraosCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679286931"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-707"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">InjectTx</span></a></span><span>
</span><span id="line-708"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AllegraEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286931"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-shelley-0.1.0.0/noopt/doc/html/ouroboros-consensus-shelley/src"><span class="hs-identifier hs-type">ShelleyBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MaryEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679286931"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-710"></span><span id="translateTxAllegraToMaryWrapper"><span class="annot"><span class="annottext">translateTxAllegraToMaryWrapper :: InjectTx (ShelleyBlock (AllegraEra c)) (ShelleyBlock (MaryEra c))
</span><a href="Ouroboros.Consensus.Cardano.CanHardFork.html#translateTxAllegraToMaryWrapper"><span class="hs-identifier hs-var hs-var">translateTxAllegraToMaryWrapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenTx (ShelleyBlock (AllegraEra c))
 -&gt; Maybe (GenTx (ShelleyBlock (MaryEra c))))
-&gt; InjectTx
     (ShelleyBlock (AllegraEra c)) (ShelleyBlock (MaryEra c))
forall blk blk'.
(GenTx blk -&gt; Maybe (GenTx blk')) -&gt; InjectTx blk blk'
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">InjectTx</span></a></span><span> </span><span class="annot"><span class="annottext">((GenTx (ShelleyBlock (AllegraEra c))
  -&gt; Maybe (GenTx (ShelleyBlock (MaryEra c))))
 -&gt; InjectTx
      (ShelleyBlock (AllegraEra c)) (ShelleyBlock (MaryEra c)))
-&gt; (GenTx (ShelleyBlock (AllegraEra c))
    -&gt; Maybe (GenTx (ShelleyBlock (MaryEra c))))
-&gt; InjectTx
     (ShelleyBlock (AllegraEra c)) (ShelleyBlock (MaryEra c))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-711"></span><span>    </span><span class="annot"><span class="annottext">((:.:) GenTx ShelleyBlock (MaryEra c)
 -&gt; GenTx (ShelleyBlock (MaryEra c)))
-&gt; Maybe ((:.:) GenTx ShelleyBlock (MaryEra c))
-&gt; Maybe (GenTx (ShelleyBlock (MaryEra c)))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(:.:) GenTx ShelleyBlock (MaryEra c)
-&gt; GenTx (ShelleyBlock (MaryEra c))
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
(:.:) f g p -&gt; f (g p)
</span><span class="hs-identifier hs-var">unComp</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ((:.:) GenTx ShelleyBlock (MaryEra c))
 -&gt; Maybe (GenTx (ShelleyBlock (MaryEra c))))
-&gt; (GenTx (ShelleyBlock (AllegraEra c))
    -&gt; Maybe ((:.:) GenTx ShelleyBlock (MaryEra c)))
-&gt; GenTx (ShelleyBlock (AllegraEra c))
-&gt; Maybe (GenTx (ShelleyBlock (MaryEra c)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Either DecoderError ((:.:) GenTx ShelleyBlock (MaryEra c))
-&gt; Maybe ((:.:) GenTx ShelleyBlock (MaryEra c))
forall a b. Either a b -&gt; Maybe b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/ouroboros-consensus-0.1.0.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">eitherToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(Either DecoderError ((:.:) GenTx ShelleyBlock (MaryEra c))
 -&gt; Maybe ((:.:) GenTx ShelleyBlock (MaryEra c)))
-&gt; (GenTx (ShelleyBlock (AllegraEra c))
    -&gt; Either DecoderError ((:.:) GenTx ShelleyBlock (MaryEra c)))
-&gt; GenTx (ShelleyBlock (AllegraEra c))
-&gt; Maybe ((:.:) GenTx ShelleyBlock (MaryEra c))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Except DecoderError ((:.:) GenTx ShelleyBlock (MaryEra c))
-&gt; Either DecoderError ((:.:) GenTx ShelleyBlock (MaryEra c))
forall e a. Except e a -&gt; Either e a
</span><span class="hs-identifier hs-var">runExcept</span></span><span> </span><span class="annot"><span class="annottext">(Except DecoderError ((:.:) GenTx ShelleyBlock (MaryEra c))
 -&gt; Either DecoderError ((:.:) GenTx ShelleyBlock (MaryEra c)))
-&gt; (GenTx (ShelleyBlock (AllegraEra c))
    -&gt; Except DecoderError ((:.:) GenTx ShelleyBlock (MaryEra c)))
-&gt; GenTx (ShelleyBlock (AllegraEra c))
-&gt; Either DecoderError ((:.:) GenTx ShelleyBlock (MaryEra c))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TranslationContext (MaryEra c)
-&gt; (:.:) GenTx ShelleyBlock (PreviousEra (MaryEra c))
-&gt; Except
     (TranslationError (MaryEra c) (GenTx :.: ShelleyBlock))
     ((:.:) GenTx ShelleyBlock (MaryEra c))
forall era (f :: * -&gt; *).
TranslateEra era f =&gt;
TranslationContext era
-&gt; f (PreviousEra era) -&gt; Except (TranslationError era f) (f era)
</span><span class="hs-identifier hs-var">SL.translateEra</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((:.:) GenTx ShelleyBlock (AllegraEra c)
 -&gt; Except DecoderError ((:.:) GenTx ShelleyBlock (MaryEra c)))
-&gt; (GenTx (ShelleyBlock (AllegraEra c))
    -&gt; (:.:) GenTx ShelleyBlock (AllegraEra c))
-&gt; GenTx (ShelleyBlock (AllegraEra c))
-&gt; Except DecoderError ((:.:) GenTx ShelleyBlock (MaryEra c))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GenTx (ShelleyBlock (AllegraEra c))
-&gt; (:.:) GenTx ShelleyBlock (AllegraEra c)
forall l k (f :: l -&gt; *) (g :: k -&gt; l) (p :: k).
f (g p) -&gt; (:.:) f g p
</span><span class="hs-identifier hs-var">Comp</span></span><span>
</span><span id="line-712"></span></pre></body></html>