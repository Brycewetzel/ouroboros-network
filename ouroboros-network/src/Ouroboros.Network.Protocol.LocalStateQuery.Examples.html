<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Network.Protocol.LocalStateQuery.Examples</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.Block.html"><span class="hs-identifier">Ouroboros.Network.Block</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Block.html#Point"><span class="hs-identifier">Point</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html"><span class="hs-identifier">Ouroboros.Network.Protocol.LocalStateQuery.Client</span></a></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Server.html"><span class="hs-identifier">Ouroboros.Network.Protocol.LocalStateQuery.Server</span></a></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Type.html"><span class="hs-identifier">Ouroboros.Network.Protocol.LocalStateQuery.Type</span></a></span><span>
</span><span id="line-10"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Type.html#AcquireFailure"><span class="hs-identifier">AcquireFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- Example client</span><span>
</span><span id="line-15"></span><span class="hs-comment">--</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-comment">-- | An example 'LocalStateQueryClient', which, for each point in the given</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- list, acquires the state for that point, and if that succeeds, returns the</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- result for the corresponding query. When the state could not be acquired,</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- the 'AcquireFailure' is returned instead of the query results.</span><span>
</span><span id="line-21"></span><span class="hs-comment">--</span><span>
</span><span id="line-22"></span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Examples.html#localStateQueryClient"><span class="hs-identifier hs-type">localStateQueryClient</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679210579"><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span></span><span> </span><span id="local-6989586621679210578"><span class="annot"><a href="#local-6989586621679210578"><span class="hs-identifier hs-type">query</span></a></span></span><span> </span><span id="local-6989586621679210577"><span class="annot"><a href="#local-6989586621679210577"><span class="hs-identifier hs-type">result</span></a></span></span><span> </span><span id="local-6989586621679210576"><span class="annot"><a href="#local-6989586621679210576"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621679210576"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Block.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679210578"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210577"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html#LocalStateQueryClient"><span class="hs-identifier hs-type">LocalStateQueryClient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210578"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210576"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-26"></span><span>                           </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Block.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Type.html#AcquireFailure"><span class="hs-identifier hs-type">AcquireFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210577"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-27"></span><span id="localStateQueryClient"><span class="annot"><span class="annottext">localStateQueryClient :: [(Point block, query result)]
-&gt; LocalStateQueryClient
     block query m [(Point block, Either AcquireFailure result)]
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Examples.html#localStateQueryClient"><span class="hs-identifier hs-var hs-var">localStateQueryClient</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (ClientStIdle
     block query m [(Point block, Either AcquireFailure result)])
-&gt; LocalStateQueryClient
     block query m [(Point block, Either AcquireFailure result)]
forall block (query :: * -&gt; *) (m :: * -&gt; *) a.
m (ClientStIdle block query m a)
-&gt; LocalStateQueryClient block query m a
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html#LocalStateQueryClient"><span class="hs-identifier hs-var">LocalStateQueryClient</span></a></span><span> </span><span class="annot"><span class="annottext">(m (ClientStIdle
      block query m [(Point block, Either AcquireFailure result)])
 -&gt; LocalStateQueryClient
      block query m [(Point block, Either AcquireFailure result)])
-&gt; ([(Point block, query result)]
    -&gt; m (ClientStIdle
            block query m [(Point block, Either AcquireFailure result)]))
-&gt; [(Point block, query result)]
-&gt; LocalStateQueryClient
     block query m [(Point block, Either AcquireFailure result)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ClientStIdle
  block query m [(Point block, Either AcquireFailure result)]
-&gt; m (ClientStIdle
        block query m [(Point block, Either AcquireFailure result)])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ClientStIdle
   block query m [(Point block, Either AcquireFailure result)]
 -&gt; m (ClientStIdle
         block query m [(Point block, Either AcquireFailure result)]))
-&gt; ([(Point block, query result)]
    -&gt; ClientStIdle
         block query m [(Point block, Either AcquireFailure result)])
-&gt; [(Point block, query result)]
-&gt; m (ClientStIdle
        block query m [(Point block, Either AcquireFailure result)])
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
-&gt; [(Point block, query result)]
-&gt; ClientStIdle
     block query m [(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210573"><span class="hs-identifier hs-var">goIdle</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="#local-6989586621679210573"><span class="hs-identifier hs-type">goIdle</span></a></span><span>
</span><span id="line-30"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Block.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Type.html#AcquireFailure"><span class="hs-identifier hs-type">AcquireFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210577"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ Accumulator</span><span>
</span><span id="line-31"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Block.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679210578"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210577"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ Remainder</span><span>
</span><span id="line-32"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html#ClientStIdle"><span class="hs-identifier hs-type">ClientStIdle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210578"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210576"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-33"></span><span>                      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Block.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Type.html#AcquireFailure"><span class="hs-identifier hs-type">AcquireFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210577"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-34"></span><span>    </span><span id="local-6989586621679210573"><span class="annot"><span class="annottext">goIdle :: [(Point block, Either AcquireFailure result)]
-&gt; [(Point block, query result)]
-&gt; ClientStIdle
     block query m [(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210573"><span class="hs-identifier hs-var hs-var">goIdle</span></a></span></span><span> </span><span id="local-6989586621679210572"><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210572"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
-&gt; ClientStIdle
     block query m [(Point block, Either AcquireFailure result)]
forall a block (query :: * -&gt; *) (m :: * -&gt; *).
a -&gt; ClientStIdle block query m a
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html#SendMsgDone"><span class="hs-identifier hs-var">SendMsgDone</span></a></span><span> </span><span class="annot"><span class="annottext">([(Point block, Either AcquireFailure result)]
 -&gt; ClientStIdle
      block query m [(Point block, Either AcquireFailure result)])
-&gt; [(Point block, Either AcquireFailure result)]
-&gt; ClientStIdle
     block query m [(Point block, Either AcquireFailure result)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
-&gt; [(Point block, Either AcquireFailure result)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210572"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="#local-6989586621679210573"><span class="hs-identifier hs-var">goIdle</span></a></span><span> </span><span id="local-6989586621679210569"><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210569"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679210568"><span class="annot"><span class="annottext">Point block
</span><a href="#local-6989586621679210568"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679210567"><span class="annot"><span class="annottext">query result
</span><a href="#local-6989586621679210567"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679210566"><span class="annot"><span class="annottext">[(Point block, query result)]
</span><a href="#local-6989586621679210566"><span class="hs-identifier hs-var">ptqs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point block
-&gt; ClientStAcquiring
     block query m [(Point block, Either AcquireFailure result)]
-&gt; ClientStIdle
     block query m [(Point block, Either AcquireFailure result)]
forall block (query :: * -&gt; *) (m :: * -&gt; *) a.
Point block
-&gt; ClientStAcquiring block query m a
-&gt; ClientStIdle block query m a
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html#SendMsgAcquire"><span class="hs-identifier hs-var">SendMsgAcquire</span></a></span><span> </span><span class="annot"><span class="annottext">Point block
</span><a href="#local-6989586621679210568"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">(ClientStAcquiring
   block query m [(Point block, Either AcquireFailure result)]
 -&gt; ClientStIdle
      block query m [(Point block, Either AcquireFailure result)])
-&gt; ClientStAcquiring
     block query m [(Point block, Either AcquireFailure result)]
-&gt; ClientStIdle
     block query m [(Point block, Either AcquireFailure result)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
-&gt; Point block
-&gt; query result
-&gt; [(Point block, query result)]
-&gt; ClientStAcquiring
     block query m [(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210564"><span class="hs-identifier hs-var">goAcquiring</span></a></span><span> </span><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210569"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Point block
</span><a href="#local-6989586621679210568"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">query result
</span><a href="#local-6989586621679210567"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">[(Point block, query result)]
</span><a href="#local-6989586621679210566"><span class="hs-identifier hs-var">ptqs'</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="#local-6989586621679210564"><span class="hs-identifier hs-type">goAcquiring</span></a></span><span>
</span><span id="line-38"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Block.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Type.html#AcquireFailure"><span class="hs-identifier hs-type">AcquireFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210577"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ Accumulator</span><span>
</span><span id="line-39"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Block.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span>
</span><span id="line-40"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679210578"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210577"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-41"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Block.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679210578"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210577"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ Remainder</span><span>
</span><span id="line-42"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html#ClientStAcquiring"><span class="hs-identifier hs-type">ClientStAcquiring</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210578"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210576"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-43"></span><span>                           </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Block.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Type.html#AcquireFailure"><span class="hs-identifier hs-type">AcquireFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210577"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-44"></span><span>    </span><span id="local-6989586621679210564"><span class="annot"><span class="annottext">goAcquiring :: [(Point block, Either AcquireFailure result)]
-&gt; Point block
-&gt; query result
-&gt; [(Point block, query result)]
-&gt; ClientStAcquiring
     block query m [(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210564"><span class="hs-identifier hs-var hs-var">goAcquiring</span></a></span></span><span> </span><span id="local-6989586621679210563"><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210563"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679210562"><span class="annot"><span class="annottext">Point block
</span><a href="#local-6989586621679210562"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span id="local-6989586621679210561"><span class="annot"><span class="annottext">query result
</span><a href="#local-6989586621679210561"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621679210560"><span class="annot"><span class="annottext">[(Point block, query result)]
</span><a href="#local-6989586621679210560"><span class="hs-identifier hs-var">ptqss'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClientStAcquiring :: forall block (query :: * -&gt; *) (m :: * -&gt; *) a.
ClientStAcquired block query m a
-&gt; (AcquireFailure -&gt; m (ClientStIdle block query m a))
-&gt; ClientStAcquiring block query m a
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html#ClientStAcquiring"><span class="hs-identifier hs-type">ClientStAcquiring</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-45"></span><span>        </span><span class="annot"><span class="annottext">recvMsgAcquired :: ClientStAcquired
  block query m [(Point block, Either AcquireFailure result)]
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html#recvMsgAcquired"><span class="hs-identifier hs-var">recvMsgAcquired</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">query result
-&gt; (result
    -&gt; ClientStAcquired
         block query m [(Point block, Either AcquireFailure result)])
-&gt; ClientStAcquired
     block query m [(Point block, Either AcquireFailure result)]
forall a.
query result
-&gt; (result -&gt; ClientStAcquired block query m a)
-&gt; ClientStAcquired block query m a
</span><a href="#local-6989586621679210557"><span class="hs-identifier hs-var">goQuery</span></a></span><span> </span><span class="annot"><span class="annottext">query result
</span><a href="#local-6989586621679210561"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">((result
  -&gt; ClientStAcquired
       block query m [(Point block, Either AcquireFailure result)])
 -&gt; ClientStAcquired
      block query m [(Point block, Either AcquireFailure result)])
-&gt; (result
    -&gt; ClientStAcquired
         block query m [(Point block, Either AcquireFailure result)])
-&gt; ClientStAcquired
     block query m [(Point block, Either AcquireFailure result)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679210556"><span class="annot"><span class="annottext">result
</span><a href="#local-6989586621679210556"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
-&gt; [(Point block, query result)]
-&gt; ClientStAcquired
     block query m [(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210555"><span class="hs-identifier hs-var">goAcquired</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point block
</span><a href="#local-6989586621679210562"><span class="hs-identifier hs-var">pt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">result -&gt; Either AcquireFailure result
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">result
</span><a href="#local-6989586621679210556"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Point block, Either AcquireFailure result)
-&gt; [(Point block, Either AcquireFailure result)]
-&gt; [(Point block, Either AcquireFailure result)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210563"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Point block, query result)]
</span><a href="#local-6989586621679210560"><span class="hs-identifier hs-var">ptqss'</span></a></span><span>
</span><span id="line-46"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recvMsgFailure :: AcquireFailure
-&gt; m (ClientStIdle
        block query m [(Point block, Either AcquireFailure result)])
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html#recvMsgFailure"><span class="hs-identifier hs-var">recvMsgFailure</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679210553"><span class="annot"><span class="annottext">AcquireFailure
</span><a href="#local-6989586621679210553"><span class="hs-identifier hs-var">failure</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ClientStIdle
  block query m [(Point block, Either AcquireFailure result)]
-&gt; m (ClientStIdle
        block query m [(Point block, Either AcquireFailure result)])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ClientStIdle
   block query m [(Point block, Either AcquireFailure result)]
 -&gt; m (ClientStIdle
         block query m [(Point block, Either AcquireFailure result)]))
-&gt; ClientStIdle
     block query m [(Point block, Either AcquireFailure result)]
-&gt; m (ClientStIdle
        block query m [(Point block, Either AcquireFailure result)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
-&gt; [(Point block, query result)]
-&gt; ClientStIdle
     block query m [(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210573"><span class="hs-identifier hs-var">goIdle</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point block
</span><a href="#local-6989586621679210562"><span class="hs-identifier hs-var">pt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AcquireFailure -&gt; Either AcquireFailure result
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">AcquireFailure
</span><a href="#local-6989586621679210553"><span class="hs-identifier hs-var">failure</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Point block, Either AcquireFailure result)
-&gt; [(Point block, Either AcquireFailure result)]
-&gt; [(Point block, Either AcquireFailure result)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210563"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Point block, query result)]
</span><a href="#local-6989586621679210560"><span class="hs-identifier hs-var">ptqss'</span></a></span><span>
</span><span id="line-47"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><a href="#local-6989586621679210555"><span class="hs-identifier hs-type">goAcquired</span></a></span><span>
</span><span id="line-50"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Block.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Type.html#AcquireFailure"><span class="hs-identifier hs-type">AcquireFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210577"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-51"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Block.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679210578"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210577"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- ^ Remainder</span><span>
</span><span id="line-52"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html#ClientStAcquired"><span class="hs-identifier hs-type">ClientStAcquired</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210578"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210576"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-53"></span><span>                          </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Block.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Type.html#AcquireFailure"><span class="hs-identifier hs-type">AcquireFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210577"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-54"></span><span>    </span><span id="local-6989586621679210555"><span class="annot"><span class="annottext">goAcquired :: [(Point block, Either AcquireFailure result)]
-&gt; [(Point block, query result)]
-&gt; ClientStAcquired
     block query m [(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210555"><span class="hs-identifier hs-var hs-var">goAcquired</span></a></span></span><span> </span><span id="local-6989586621679210552"><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210552"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (ClientStIdle
     block query m [(Point block, Either AcquireFailure result)])
-&gt; ClientStAcquired
     block query m [(Point block, Either AcquireFailure result)]
forall (m :: * -&gt; *) block (query :: * -&gt; *) a.
m (ClientStIdle block query m a)
-&gt; ClientStAcquired block query m a
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html#SendMsgRelease"><span class="hs-identifier hs-var">SendMsgRelease</span></a></span><span> </span><span class="annot"><span class="annottext">(m (ClientStIdle
      block query m [(Point block, Either AcquireFailure result)])
 -&gt; ClientStAcquired
      block query m [(Point block, Either AcquireFailure result)])
-&gt; m (ClientStIdle
        block query m [(Point block, Either AcquireFailure result)])
-&gt; ClientStAcquired
     block query m [(Point block, Either AcquireFailure result)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClientStIdle
  block query m [(Point block, Either AcquireFailure result)]
-&gt; m (ClientStIdle
        block query m [(Point block, Either AcquireFailure result)])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ClientStIdle
   block query m [(Point block, Either AcquireFailure result)]
 -&gt; m (ClientStIdle
         block query m [(Point block, Either AcquireFailure result)]))
-&gt; ClientStIdle
     block query m [(Point block, Either AcquireFailure result)]
-&gt; m (ClientStIdle
        block query m [(Point block, Either AcquireFailure result)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
-&gt; ClientStIdle
     block query m [(Point block, Either AcquireFailure result)]
forall a block (query :: * -&gt; *) (m :: * -&gt; *).
a -&gt; ClientStIdle block query m a
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html#SendMsgDone"><span class="hs-identifier hs-var">SendMsgDone</span></a></span><span> </span><span class="annot"><span class="annottext">([(Point block, Either AcquireFailure result)]
 -&gt; ClientStIdle
      block query m [(Point block, Either AcquireFailure result)])
-&gt; [(Point block, Either AcquireFailure result)]
-&gt; ClientStIdle
     block query m [(Point block, Either AcquireFailure result)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
-&gt; [(Point block, Either AcquireFailure result)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210552"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="#local-6989586621679210555"><span class="hs-identifier hs-var">goAcquired</span></a></span><span> </span><span id="local-6989586621679210550"><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210550"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679210549"><span class="annot"><span class="annottext">Point block
</span><a href="#local-6989586621679210549"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679210548"><span class="annot"><span class="annottext">query result
</span><a href="#local-6989586621679210548"><span class="hs-identifier hs-var">qs</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679210547"><span class="annot"><span class="annottext">[(Point block, query result)]
</span><a href="#local-6989586621679210547"><span class="hs-identifier hs-var">ptqss'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point block
-&gt; ClientStAcquiring
     block query m [(Point block, Either AcquireFailure result)]
-&gt; ClientStAcquired
     block query m [(Point block, Either AcquireFailure result)]
forall block (query :: * -&gt; *) (m :: * -&gt; *) a.
Point block
-&gt; ClientStAcquiring block query m a
-&gt; ClientStAcquired block query m a
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html#SendMsgReAcquire"><span class="hs-identifier hs-var">SendMsgReAcquire</span></a></span><span> </span><span class="annot"><span class="annottext">Point block
</span><a href="#local-6989586621679210549"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">(ClientStAcquiring
   block query m [(Point block, Either AcquireFailure result)]
 -&gt; ClientStAcquired
      block query m [(Point block, Either AcquireFailure result)])
-&gt; ClientStAcquiring
     block query m [(Point block, Either AcquireFailure result)]
-&gt; ClientStAcquired
     block query m [(Point block, Either AcquireFailure result)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-56"></span><span>      </span><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
-&gt; Point block
-&gt; query result
-&gt; [(Point block, query result)]
-&gt; ClientStAcquiring
     block query m [(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210564"><span class="hs-identifier hs-var">goAcquiring</span></a></span><span> </span><span class="annot"><span class="annottext">[(Point block, Either AcquireFailure result)]
</span><a href="#local-6989586621679210550"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Point block
</span><a href="#local-6989586621679210549"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="annot"><span class="annottext">query result
</span><a href="#local-6989586621679210548"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Point block, query result)]
</span><a href="#local-6989586621679210547"><span class="hs-identifier hs-var">ptqss'</span></a></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><a href="#local-6989586621679210557"><span class="hs-identifier hs-type">goQuery</span></a></span><span>
</span><span id="line-59"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679210640"><span class="annot"><a href="#local-6989586621679210640"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-60"></span><span>         </span><span class="annot"><a href="#local-6989586621679210578"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210577"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-61"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679210577"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html#ClientStAcquired"><span class="hs-identifier hs-type">ClientStAcquired</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210578"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210576"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210640"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>         </span><span class="hs-comment">-- ^ Continuation</span><span>
</span><span id="line-63"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html#ClientStAcquired"><span class="hs-identifier hs-type">ClientStAcquired</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210579"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210578"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210576"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210640"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span id="local-6989586621679210557"><span class="annot"><span class="annottext">goQuery :: query result
-&gt; (result -&gt; ClientStAcquired block query m a)
-&gt; ClientStAcquired block query m a
</span><a href="#local-6989586621679210557"><span class="hs-identifier hs-var hs-var">goQuery</span></a></span></span><span> </span><span id="local-6989586621679210545"><span class="annot"><span class="annottext">query result
</span><a href="#local-6989586621679210545"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621679210544"><span class="annot"><span class="annottext">result -&gt; ClientStAcquired block query m a
</span><a href="#local-6989586621679210544"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">query result
-&gt; ClientStQuerying block query m a result
-&gt; ClientStAcquired block query m a
forall (query :: * -&gt; *) result block (m :: * -&gt; *) a.
query result
-&gt; ClientStQuerying block query m a result
-&gt; ClientStAcquired block query m a
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html#SendMsgQuery"><span class="hs-identifier hs-var">SendMsgQuery</span></a></span><span> </span><span class="annot"><span class="annottext">query result
</span><a href="#local-6989586621679210545"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">(ClientStQuerying block query m a result
 -&gt; ClientStAcquired block query m a)
-&gt; ClientStQuerying block query m a result
-&gt; ClientStAcquired block query m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(result -&gt; m (ClientStAcquired block query m a))
-&gt; ClientStQuerying block query m a result
forall block (query :: * -&gt; *) (m :: * -&gt; *) a result.
(result -&gt; m (ClientStAcquired block query m a))
-&gt; ClientStQuerying block query m a result
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Client.html#ClientStQuerying"><span class="hs-identifier hs-var">ClientStQuerying</span></a></span><span> </span><span class="annot"><span class="annottext">((result -&gt; m (ClientStAcquired block query m a))
 -&gt; ClientStQuerying block query m a result)
-&gt; (result -&gt; m (ClientStAcquired block query m a))
-&gt; ClientStQuerying block query m a result
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679210541"><span class="annot"><span class="annottext">result
</span><a href="#local-6989586621679210541"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ClientStAcquired block query m a
-&gt; m (ClientStAcquired block query m a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ClientStAcquired block query m a
 -&gt; m (ClientStAcquired block query m a))
-&gt; ClientStAcquired block query m a
-&gt; m (ClientStAcquired block query m a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">result -&gt; ClientStAcquired block query m a
</span><a href="#local-6989586621679210544"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">result
</span><a href="#local-6989586621679210541"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-comment">--</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- Example server</span><span>
</span><span id="line-68"></span><span class="hs-comment">--</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- | An example 'LocalStateQueryServer'. The first function is called to</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- acquire a @state@, after which the second will be used to query the state.</span><span>
</span><span id="line-72"></span><span class="hs-comment">--</span><span>
</span><span id="line-73"></span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Examples.html#localStateQueryServer"><span class="hs-identifier hs-type">localStateQueryServer</span></a></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679210539"><span class="annot"><a href="#local-6989586621679210539"><span class="hs-identifier hs-type">block</span></a></span></span><span> </span><span id="local-6989586621679210538"><span class="annot"><a href="#local-6989586621679210538"><span class="hs-identifier hs-type">query</span></a></span></span><span> </span><span id="local-6989586621679210537"><span class="annot"><a href="#local-6989586621679210537"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679210536"><span class="annot"><a href="#local-6989586621679210536"><span class="hs-identifier hs-type">state</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621679210537"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Block.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210539"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Type.html#AcquireFailure"><span class="hs-identifier hs-type">AcquireFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210536"><span class="hs-identifier hs-type">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679210614"><span class="annot"><a href="#local-6989586621679210614"><span class="hs-identifier hs-type">result</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679210536"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679210538"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210614"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679210614"><span class="hs-identifier hs-type">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Server.html#LocalStateQueryServer"><span class="hs-identifier hs-type">LocalStateQueryServer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210539"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210538"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span id="localStateQueryServer"><span class="annot"><span class="annottext">localStateQueryServer :: (Point block -&gt; Either AcquireFailure state)
-&gt; (forall result. state -&gt; query result -&gt; result)
-&gt; LocalStateQueryServer block query m ()
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Examples.html#localStateQueryServer"><span class="hs-identifier hs-var hs-var">localStateQueryServer</span></a></span></span><span> </span><span id="local-6989586621679210535"><span class="annot"><span class="annottext">Point block -&gt; Either AcquireFailure state
</span><a href="#local-6989586621679210535"><span class="hs-identifier hs-var">acquire</span></a></span></span><span> </span><span id="local-6989586621679210534"><span class="annot"><span class="annottext">forall result. state -&gt; query result -&gt; result
</span><a href="#local-6989586621679210534"><span class="hs-identifier hs-var">answer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><span class="annottext">m (ServerStIdle block query m ())
-&gt; LocalStateQueryServer block query m ()
forall block (query :: * -&gt; *) (m :: * -&gt; *) a.
m (ServerStIdle block query m a)
-&gt; LocalStateQueryServer block query m a
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Server.html#LocalStateQueryServer"><span class="hs-identifier hs-var">LocalStateQueryServer</span></a></span><span> </span><span class="annot"><span class="annottext">(m (ServerStIdle block query m ())
 -&gt; LocalStateQueryServer block query m ())
-&gt; m (ServerStIdle block query m ())
-&gt; LocalStateQueryServer block query m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerStIdle block query m () -&gt; m (ServerStIdle block query m ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ServerStIdle block query m ()
</span><a href="#local-6989586621679210532"><span class="hs-identifier hs-var">goIdle</span></a></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="#local-6989586621679210532"><span class="hs-identifier hs-type">goIdle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Server.html#ServerStIdle"><span class="hs-identifier hs-type">ServerStIdle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210539"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210538"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>    </span><span id="local-6989586621679210532"><span class="annot"><span class="annottext">goIdle :: ServerStIdle block query m ()
</span><a href="#local-6989586621679210532"><span class="hs-identifier hs-var hs-var">goIdle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerStIdle :: forall block (query :: * -&gt; *) (m :: * -&gt; *) a.
(Point block -&gt; m (ServerStAcquiring block query m a))
-&gt; m a -&gt; ServerStIdle block query m a
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Server.html#ServerStIdle"><span class="hs-identifier hs-type">ServerStIdle</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-83"></span><span>        </span><span class="annot"><span class="annottext">recvMsgAcquire :: Point block -&gt; m (ServerStAcquiring block query m ())
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Server.html#recvMsgAcquire"><span class="hs-identifier hs-var">recvMsgAcquire</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point block -&gt; m (ServerStAcquiring block query m ())
</span><a href="#local-6989586621679210529"><span class="hs-identifier hs-var">goAcquiring</span></a></span><span>
</span><span id="line-84"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recvMsgDone :: m ()
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Server.html#recvMsgDone"><span class="hs-identifier hs-var">recvMsgDone</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><a href="#local-6989586621679210529"><span class="hs-identifier hs-type">goAcquiring</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.Block.html#Point"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210539"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679210537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Server.html#ServerStAcquiring"><span class="hs-identifier hs-type">ServerStAcquiring</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210539"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210538"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>    </span><span id="local-6989586621679210529"><span class="annot"><span class="annottext">goAcquiring :: Point block -&gt; m (ServerStAcquiring block query m ())
</span><a href="#local-6989586621679210529"><span class="hs-identifier hs-var hs-var">goAcquiring</span></a></span></span><span> </span><span id="local-6989586621679210527"><span class="annot"><span class="annottext">Point block
</span><a href="#local-6989586621679210527"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerStAcquiring block query m ()
-&gt; m (ServerStAcquiring block query m ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ServerStAcquiring block query m ()
 -&gt; m (ServerStAcquiring block query m ()))
-&gt; ServerStAcquiring block query m ()
-&gt; m (ServerStAcquiring block query m ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Point block -&gt; Either AcquireFailure state
</span><a href="#local-6989586621679210535"><span class="hs-identifier hs-var">acquire</span></a></span><span> </span><span class="annot"><span class="annottext">Point block
</span><a href="#local-6989586621679210527"><span class="hs-identifier hs-var">pt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-89"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679210526"><span class="annot"><span class="annottext">AcquireFailure
</span><a href="#local-6989586621679210526"><span class="hs-identifier hs-var">failure</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AcquireFailure
-&gt; ServerStIdle block query m ()
-&gt; ServerStAcquiring block query m ()
forall block (query :: * -&gt; *) (m :: * -&gt; *) a.
AcquireFailure
-&gt; ServerStIdle block query m a
-&gt; ServerStAcquiring block query m a
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Server.html#SendMsgFailure"><span class="hs-identifier hs-var">SendMsgFailure</span></a></span><span> </span><span class="annot"><span class="annottext">AcquireFailure
</span><a href="#local-6989586621679210526"><span class="hs-identifier hs-var">failure</span></a></span><span> </span><span class="annot"><span class="annottext">ServerStIdle block query m ()
</span><a href="#local-6989586621679210532"><span class="hs-identifier hs-var">goIdle</span></a></span><span>
</span><span id="line-90"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679210524"><span class="annot"><span class="annottext">state
</span><a href="#local-6989586621679210524"><span class="hs-identifier hs-var">state</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerStAcquired block query m ()
-&gt; ServerStAcquiring block query m ()
forall block (query :: * -&gt; *) (m :: * -&gt; *) a.
ServerStAcquired block query m a
-&gt; ServerStAcquiring block query m a
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Server.html#SendMsgAcquired"><span class="hs-identifier hs-var">SendMsgAcquired</span></a></span><span> </span><span class="annot"><span class="annottext">(ServerStAcquired block query m ()
 -&gt; ServerStAcquiring block query m ())
-&gt; ServerStAcquired block query m ()
-&gt; ServerStAcquiring block query m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">state -&gt; ServerStAcquired block query m ()
</span><a href="#local-6989586621679210522"><span class="hs-identifier hs-var">goAcquired</span></a></span><span> </span><span class="annot"><span class="annottext">state
</span><a href="#local-6989586621679210524"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><a href="#local-6989586621679210522"><span class="hs-identifier hs-type">goAcquired</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679210536"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.LocalStateQuery.Server.html#ServerStAcquired"><span class="hs-identifier hs-type">ServerStAcquired</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210539"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210538"><span class="hs-identifier hs-type">query</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679210537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>    </span><span id="local-6989586621679210522"><span class="annot"><span class="annottext">goAcquired :: state -&gt; ServerStAcquired block query m ()
</span><a href="#local-6989586621679210522"><span class="hs-identifier hs-var hs-var">goAcquired</span></a></span></span><span> </span><span id="local-6989586621679210521"><span class="annot"><span class="annottext">state
</span><a href="#local-6989586621679210521"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerStAcquired :: forall block (query :: * -&gt; *) (m :: * -&gt; *) a.
(forall result.
 query result -&gt; m (ServerStQuerying block query m a result))
-&gt; (Point block -&gt; m (ServerStAcquiring block query m a))
-&gt; m (ServerStIdle block query m a)
-&gt; ServerStAcquired block query m a
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Server.html#ServerStAcquired"><span class="hs-identifier hs-type">ServerStAcquired</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-94"></span><span>        </span><span class="annot"><span class="annottext">recvMsgQuery :: forall result.
query result -&gt; m (ServerStQuerying block query m () result)
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Server.html#recvMsgQuery"><span class="hs-identifier hs-var">recvMsgQuery</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679210518"><span class="annot"><span class="annottext">query result
</span><a href="#local-6989586621679210518"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-95"></span><span>          </span><span class="annot"><span class="annottext">ServerStQuerying block query m () result
-&gt; m (ServerStQuerying block query m () result)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ServerStQuerying block query m () result
 -&gt; m (ServerStQuerying block query m () result))
-&gt; ServerStQuerying block query m () result
-&gt; m (ServerStQuerying block query m () result)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">result
-&gt; ServerStAcquired block query m ()
-&gt; ServerStQuerying block query m () result
forall result block (query :: * -&gt; *) (m :: * -&gt; *) a.
result
-&gt; ServerStAcquired block query m a
-&gt; ServerStQuerying block query m a result
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Server.html#SendMsgResult"><span class="hs-identifier hs-var">SendMsgResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">state -&gt; query result -&gt; result
forall result. state -&gt; query result -&gt; result
</span><a href="#local-6989586621679210534"><span class="hs-identifier hs-var">answer</span></a></span><span> </span><span class="annot"><span class="annottext">state
</span><a href="#local-6989586621679210521"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">query result
</span><a href="#local-6989586621679210518"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ServerStAcquired block query m ()
 -&gt; ServerStQuerying block query m () result)
-&gt; ServerStAcquired block query m ()
-&gt; ServerStQuerying block query m () result
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">state -&gt; ServerStAcquired block query m ()
</span><a href="#local-6989586621679210522"><span class="hs-identifier hs-var">goAcquired</span></a></span><span> </span><span class="annot"><span class="annottext">state
</span><a href="#local-6989586621679210521"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-96"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recvMsgReAcquire :: Point block -&gt; m (ServerStAcquiring block query m ())
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Server.html#recvMsgReAcquire"><span class="hs-identifier hs-var">recvMsgReAcquire</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point block -&gt; m (ServerStAcquiring block query m ())
</span><a href="#local-6989586621679210529"><span class="hs-identifier hs-var">goAcquiring</span></a></span><span>
</span><span id="line-97"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">recvMsgRelease :: m (ServerStIdle block query m ())
</span><a href="Ouroboros.Network.Protocol.LocalStateQuery.Server.html#recvMsgRelease"><span class="hs-identifier hs-var">recvMsgRelease</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerStIdle block query m () -&gt; m (ServerStIdle block query m ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ServerStIdle block query m ()
</span><a href="#local-6989586621679210532"><span class="hs-identifier hs-var">goIdle</span></a></span><span>
</span><span id="line-98"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-99"></span></pre></body></html>