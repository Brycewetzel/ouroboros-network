<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns        #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveFunctor       #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns      #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards     #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Network.PeerSelection.Governor.Types</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Min</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Alternative</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;|&gt;)</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/network-mux-0.1.0.0/noopt/doc/html/network-mux/src"><span class="hs-identifier">Control.Concurrent.JobPool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/network-mux-0.1.0.0/noopt/doc/html/network-mux/src"><span class="hs-identifier">Job</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier">Control.Monad.Class.MonadSTM</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier">Control.Monad.Class.MonadTime</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">assert</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SomeException</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.EstablishedPeers</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EstablishedPeers</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.EstablishedPeers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html#EstablishedPeers"><span class="hs-identifier">EstablishedPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.KnownPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.KnownPeers</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">KnownPeers</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.KnownPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.KnownPeers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.KnownPeers.html#KnownPeers"><span class="hs-identifier">KnownPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.LocalRootPeers</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LocalRootPeers</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.LocalRootPeers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#LocalRootPeers"><span class="hs-identifier">LocalRootPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.Types</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-comment">-- | A peer pick policy is an action that picks a subset of elements from a</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- map of peers.</span><span>
</span><span id="line-33"></span><span class="hs-comment">--</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- The pre-condition is that the map of available choices will be non-empty,</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- and the requested number to pick will be strictly positive.</span><span>
</span><span id="line-36"></span><span class="hs-comment">--</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- The post-condition is that the picked set is non-empty but must not be</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- bigger than the requested number.</span><span>
</span><span id="line-39"></span><span class="hs-comment">--</span><span>
</span><span id="line-40"></span><span class="hs-keyword">type</span><span> </span><span id="PickPolicy"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-var">PickPolicy</span></a></span></span><span> </span><span id="local-6989586621679214521"><span class="annot"><a href="#local-6989586621679214521"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679214520"><span class="annot"><a href="#local-6989586621679214520"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214521"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-41"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-42"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-type">STM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214520"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214521"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-comment">-- | Check pre-conditions and post-conditions on the pick policies</span><span>
</span><span id="line-46"></span><span id="local-6989586621679214518"><span id="local-6989586621679214519"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#pickPeers"><span class="hs-identifier hs-type">pickPeers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679214519"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621679214518"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214519"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679214518"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214519"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>          </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214519"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679214518"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214519"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-49"></span><span id="pickPeers"><span class="annot"><span class="annottext">pickPeers :: (Set peeraddr -&gt; Int -&gt; m (Set peeraddr))
-&gt; Set peeraddr -&gt; Int -&gt; m (Set peeraddr)
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#pickPeers"><span class="hs-identifier hs-var hs-var">pickPeers</span></a></span></span><span> </span><span id="local-6989586621679214516"><span class="annot"><span class="annottext">Set peeraddr -&gt; Int -&gt; m (Set peeraddr)
</span><a href="#local-6989586621679214516"><span class="hs-identifier hs-var">pick</span></a></span></span><span> </span><span id="local-6989586621679214515"><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214515"><span class="hs-identifier hs-var">available</span></a></span></span><span> </span><span id="local-6989586621679214514"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679214514"><span class="hs-identifier hs-var">num</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m (Set peeraddr) -&gt; m (Set peeraddr)
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679214513"><span class="hs-identifier hs-var">precondition</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Set peeraddr) -&gt; m (Set peeraddr))
-&gt; m (Set peeraddr) -&gt; m (Set peeraddr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><span class="annottext">(Set peeraddr -&gt; Set peeraddr)
-&gt; m (Set peeraddr) -&gt; m (Set peeraddr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679214512"><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214512"><span class="hs-identifier hs-var">picked</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Set peeraddr -&gt; Set peeraddr
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
</span><a href="#local-6989586621679214511"><span class="hs-identifier hs-var">postcondition</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214512"><span class="hs-identifier hs-var">picked</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214512"><span class="hs-identifier hs-var">picked</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int -&gt; m (Set peeraddr)
</span><a href="#local-6989586621679214516"><span class="hs-identifier hs-var">pick</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214515"><span class="hs-identifier hs-var">available</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679214510"><span class="hs-identifier hs-var">numClamped</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-54"></span><span>    </span><span id="local-6989586621679214513"><span class="annot"><span class="annottext">precondition :: Bool
</span><a href="#local-6989586621679214513"><span class="hs-identifier hs-var hs-var">precondition</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214515"><span class="hs-identifier hs-var">available</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679214514"><span class="hs-identifier hs-var">num</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-55"></span><span>    </span><span id="local-6989586621679214511"><span class="annot"><span class="annottext">postcondition :: Set peeraddr -&gt; Bool
</span><a href="#local-6989586621679214511"><span class="hs-identifier hs-var hs-var">postcondition</span></a></span></span><span> </span><span id="local-6989586621679214505"><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214505"><span class="hs-identifier hs-var">picked</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214505"><span class="hs-identifier hs-var">picked</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>                        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214505"><span class="hs-identifier hs-var">picked</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679214510"><span class="hs-identifier hs-var">numClamped</span></a></span><span>
</span><span id="line-57"></span><span>                        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214505"><span class="hs-identifier hs-var">picked</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.isSubsetOf`</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214515"><span class="hs-identifier hs-var">available</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span id="local-6989586621679214510"><span class="annot"><span class="annottext">numClamped :: Int
</span><a href="#local-6989586621679214510"><span class="hs-identifier hs-var hs-var">numClamped</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679214514"><span class="hs-identifier hs-var">num</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214515"><span class="hs-identifier hs-var">available</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">data</span><span> </span><span id="PeerSelectionPolicy"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionPolicy"><span class="hs-identifier hs-var">PeerSelectionPolicy</span></a></span></span><span> </span><span id="local-6989586621679214500"><span class="annot"><a href="#local-6989586621679214500"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679214499"><span class="annot"><a href="#local-6989586621679214499"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerSelectionPolicy"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionPolicy"><span class="hs-identifier hs-var">PeerSelectionPolicy</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span>       </span><span id="policyPickKnownPeersForGossip"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr m
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickKnownPeersForGossip"><span class="hs-identifier hs-var hs-var">policyPickKnownPeersForGossip</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214500"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214499"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>       </span><span id="policyPickColdPeersToPromote"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr m
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickColdPeersToPromote"><span class="hs-identifier hs-var hs-var">policyPickColdPeersToPromote</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214500"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214499"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>       </span><span id="policyPickWarmPeersToPromote"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr m
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickWarmPeersToPromote"><span class="hs-identifier hs-var hs-var">policyPickWarmPeersToPromote</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214500"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214499"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>       </span><span id="policyPickHotPeersToDemote"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr m
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickHotPeersToDemote"><span class="hs-identifier hs-var hs-var">policyPickHotPeersToDemote</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214500"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214499"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>       </span><span id="policyPickWarmPeersToDemote"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr m
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickWarmPeersToDemote"><span class="hs-identifier hs-var hs-var">policyPickWarmPeersToDemote</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214500"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214499"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>       </span><span id="policyPickColdPeersToForget"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr m
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickColdPeersToForget"><span class="hs-identifier hs-var hs-var">policyPickColdPeersToForget</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214500"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214499"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span>       </span><span id="policyFindPublicRootTimeout"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; DiffTime
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyFindPublicRootTimeout"><span class="hs-identifier hs-var hs-var">policyFindPublicRootTimeout</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">DiffTime</span></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>       </span><span id="policyMaxInProgressGossipReqs"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyMaxInProgressGossipReqs"><span class="hs-identifier hs-var hs-var">policyMaxInProgressGossipReqs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>       </span><span id="policyGossipRetryTime"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; DiffTime
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyGossipRetryTime"><span class="hs-identifier hs-var hs-var">policyGossipRetryTime</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">DiffTime</span></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>       </span><span id="policyGossipBatchWaitTime"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; DiffTime
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyGossipBatchWaitTime"><span class="hs-identifier hs-var hs-var">policyGossipBatchWaitTime</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">DiffTime</span></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>       </span><span id="policyGossipOverallTimeout"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; DiffTime
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyGossipOverallTimeout"><span class="hs-identifier hs-var hs-var">policyGossipOverallTimeout</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">DiffTime</span></span><span>
</span><span id="line-75"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">-- | Adjustable targets for the peer selection mechanism.</span><span>
</span><span id="line-79"></span><span class="hs-comment">--</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- These are used by the peer selection governor as targets. They are used by</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- the peer churn governor loop as knobs to adjust, to influence the peer</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- selection governor.</span><span>
</span><span id="line-83"></span><span class="hs-comment">--</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- The /known/, /established/ and /active/ peer targets are targets both from</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- below and from above: the governor will attempt to grow or shrink the sets</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- to hit these targets.</span><span>
</span><span id="line-87"></span><span class="hs-comment">--</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- Unlike the other targets, the /root/ peer target is \&quot;one sided\&quot;, it is</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- only a target from below. The governor does not try to shrink the root set</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- to hit it, it simply stops looking for more.</span><span>
</span><span id="line-91"></span><span class="hs-comment">--</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- There is also an implicit target that enough local root peers are selected</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- as active. This comes from the configuration for local roots, and is not an</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- independently adjustable target.</span><span>
</span><span id="line-95"></span><span class="hs-comment">--</span><span>
</span><span id="line-96"></span><span class="hs-keyword">data</span><span> </span><span id="PeerSelectionTargets"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-var">PeerSelectionTargets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerSelectionTargets"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-var">PeerSelectionTargets</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>       </span><span id="targetNumberOfRootPeers"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfRootPeers"><span class="hs-identifier hs-var hs-var">targetNumberOfRootPeers</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>       </span><span id="targetNumberOfKnownPeers"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfKnownPeers"><span class="hs-identifier hs-var hs-var">targetNumberOfKnownPeers</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>       </span><span id="targetNumberOfEstablishedPeers"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfEstablishedPeers"><span class="hs-identifier hs-var hs-var">targetNumberOfEstablishedPeers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>       </span><span id="targetNumberOfActivePeers"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfActivePeers"><span class="hs-identifier hs-var hs-var">targetNumberOfActivePeers</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>       </span><span class="hs-comment">-- Expressed as intervals rather than frequencies</span><span>
</span><span id="line-104"></span><span class="hs-comment">--     targetChurnIntervalKnownPeers       :: !DiffTime,</span><span>
</span><span id="line-105"></span><span class="hs-comment">--     targetChurnIntervalEstablishedPeers :: !DiffTime,</span><span>
</span><span id="line-106"></span><span class="hs-comment">--     targetChurnIntervalActivePeers      :: !DiffTime</span><span>
</span><span id="line-107"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679214478"><span id="local-6989586621679214480"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool
(PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool)
-&gt; (PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool)
-&gt; Eq PeerSelectionTargets
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool
$c/= :: PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool
== :: PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool
$c== :: PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679214471"><span id="local-6989586621679214473"><span id="local-6989586621679214475"><span class="annot"><span class="annottext">Int -&gt; PeerSelectionTargets -&gt; ShowS
[PeerSelectionTargets] -&gt; ShowS
PeerSelectionTargets -&gt; String
(Int -&gt; PeerSelectionTargets -&gt; ShowS)
-&gt; (PeerSelectionTargets -&gt; String)
-&gt; ([PeerSelectionTargets] -&gt; ShowS)
-&gt; Show PeerSelectionTargets
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [PeerSelectionTargets] -&gt; ShowS
$cshowList :: [PeerSelectionTargets] -&gt; ShowS
show :: PeerSelectionTargets -&gt; String
$cshow :: PeerSelectionTargets -&gt; String
showsPrec :: Int -&gt; PeerSelectionTargets -&gt; ShowS
$cshowsPrec :: Int -&gt; PeerSelectionTargets -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#nullPeerSelectionTargets"><span class="hs-identifier hs-type">nullPeerSelectionTargets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span>
</span><span id="line-111"></span><span id="nullPeerSelectionTargets"><span class="annot"><span class="annottext">nullPeerSelectionTargets :: PeerSelectionTargets
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#nullPeerSelectionTargets"><span class="hs-identifier hs-var hs-var">nullPeerSelectionTargets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><span class="annottext">PeerSelectionTargets :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; PeerSelectionTargets
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-113"></span><span>       </span><span class="annot"><span class="annottext">targetNumberOfRootPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfRootPeers"><span class="hs-identifier hs-var">targetNumberOfRootPeers</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>       </span><span class="annot"><span class="annottext">targetNumberOfKnownPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfKnownPeers"><span class="hs-identifier hs-var">targetNumberOfKnownPeers</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>       </span><span class="annot"><span class="annottext">targetNumberOfEstablishedPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfEstablishedPeers"><span class="hs-identifier hs-var">targetNumberOfEstablishedPeers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>       </span><span class="annot"><span class="annottext">targetNumberOfActivePeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfActivePeers"><span class="hs-identifier hs-var">targetNumberOfActivePeers</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-117"></span><span class="hs-comment">--     targetChurnIntervalKnownPeers       = 0,</span><span>
</span><span id="line-118"></span><span class="hs-comment">--     targetChurnIntervalEstablishedPeers = 0,</span><span>
</span><span id="line-119"></span><span class="hs-comment">--     targetChurnIntervalActivePeers      = 0</span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#sanePeerSelectionTargets"><span class="hs-identifier hs-type">sanePeerSelectionTargets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-123"></span><span id="sanePeerSelectionTargets"><span class="annot"><span class="annottext">sanePeerSelectionTargets :: PeerSelectionTargets -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#sanePeerSelectionTargets"><span class="hs-identifier hs-var hs-var">sanePeerSelectionTargets</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span class="hs-special">{</span><span id="local-6989586621679214464"><span id="local-6989586621679214465"><span id="local-6989586621679214466"><span id="local-6989586621679214467"><span class="annot"><span class="annottext">Int
targetNumberOfActivePeers :: Int
targetNumberOfEstablishedPeers :: Int
targetNumberOfKnownPeers :: Int
targetNumberOfRootPeers :: Int
targetNumberOfActivePeers :: PeerSelectionTargets -&gt; Int
targetNumberOfEstablishedPeers :: PeerSelectionTargets -&gt; Int
targetNumberOfKnownPeers :: PeerSelectionTargets -&gt; Int
targetNumberOfRootPeers :: PeerSelectionTargets -&gt; Int
</span><a href="#local-6989586621679214464"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-124"></span><span>                                 </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679214464"><span class="hs-identifier hs-var">targetNumberOfActivePeers</span></a></span><span>
</span><span id="line-125"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679214464"><span class="hs-identifier hs-var">targetNumberOfActivePeers</span></a></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679214465"><span class="hs-identifier hs-var">targetNumberOfEstablishedPeers</span></a></span><span>
</span><span id="line-126"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679214465"><span class="hs-identifier hs-var">targetNumberOfEstablishedPeers</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679214466"><span class="hs-identifier hs-var">targetNumberOfKnownPeers</span></a></span><span>
</span><span id="line-127"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>      </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679214467"><span class="hs-identifier hs-var">targetNumberOfRootPeers</span></a></span><span>   </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679214466"><span class="hs-identifier hs-var">targetNumberOfKnownPeers</span></a></span><span>
</span><span id="line-128"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>                              </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679214467"><span class="hs-identifier hs-var">targetNumberOfRootPeers</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679214464"><span class="hs-identifier hs-var">targetNumberOfActivePeers</span></a></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span>
</span><span id="line-131"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679214465"><span class="hs-identifier hs-var">targetNumberOfEstablishedPeers</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000</span></span><span>
</span><span id="line-132"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679214466"><span class="hs-identifier hs-var">targetNumberOfKnownPeers</span></a></span><span>       </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10000</span></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-comment">-- | Actions performed by the peer selection governor.</span><span>
</span><span id="line-136"></span><span class="hs-comment">--</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- These being pluggable allows:</span><span>
</span><span id="line-138"></span><span class="hs-comment">--</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- * choice of known peer root sets</span><span>
</span><span id="line-140"></span><span class="hs-comment">-- * running both in simulation and for real</span><span>
</span><span id="line-141"></span><span class="hs-comment">--</span><span>
</span><span id="line-142"></span><span class="hs-keyword">data</span><span> </span><span id="PeerSelectionActions"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionActions"><span class="hs-identifier hs-var">PeerSelectionActions</span></a></span></span><span> </span><span id="local-6989586621679214463"><span class="annot"><a href="#local-6989586621679214463"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679214462"><span class="annot"><a href="#local-6989586621679214462"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span id="local-6989586621679214461"><span class="annot"><a href="#local-6989586621679214461"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerSelectionActions"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionActions"><span class="hs-identifier hs-var">PeerSelectionActions</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>       </span><span id="readPeerSelectionTargets"><span class="annot"><span class="annottext">PeerSelectionActions peeraddr peerconn m
-&gt; STM m PeerSelectionTargets
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#readPeerSelectionTargets"><span class="hs-identifier hs-var hs-var">readPeerSelectionTargets</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-type">STM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214461"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>       </span><span class="hs-comment">-- | Read the current set of locally or privately known root peers.</span><span>
</span><span id="line-147"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-148"></span><span>       </span><span class="hs-comment">-- In general this is expected to be updated asynchronously by some</span><span>
</span><span id="line-149"></span><span>       </span><span class="hs-comment">-- other thread. It is intended to cover the use case of peers from</span><span>
</span><span id="line-150"></span><span>       </span><span class="hs-comment">-- local configuration. It could be dynamic due to DNS resolution, or</span><span>
</span><span id="line-151"></span><span>       </span><span class="hs-comment">-- due to dynamic configuration updates.</span><span>
</span><span id="line-152"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-153"></span><span>       </span><span class="hs-comment">-- It is structured as a collection of (non-overlapping) groups of peers</span><span>
</span><span id="line-154"></span><span>       </span><span class="hs-comment">-- where we are supposed to select n from each group.</span><span>
</span><span id="line-155"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-156"></span><span>       </span><span id="readLocalRootPeers"><span class="annot"><span class="annottext">PeerSelectionActions peeraddr peerconn m
-&gt; STM m [(Int, Map peeraddr PeerAdvertise)]
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#readLocalRootPeers"><span class="hs-identifier hs-var hs-var">readLocalRootPeers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-type">STM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214461"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679214463"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerAdvertise"><span class="hs-identifier hs-type">PeerAdvertise</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>       </span><span class="hs-comment">-- | Request a sample of public root peers.</span><span>
</span><span id="line-159"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-160"></span><span>       </span><span class="hs-comment">-- It is intended to cover use cases including:</span><span>
</span><span id="line-161"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-162"></span><span>       </span><span class="hs-comment">-- * federated relays from a DNS pool</span><span>
</span><span id="line-163"></span><span>       </span><span class="hs-comment">-- * stake pool relays published in the blockchain</span><span>
</span><span id="line-164"></span><span>       </span><span class="hs-comment">-- * a pre-distributed snapshot of stake pool relays from the blockchain</span><span>
</span><span id="line-165"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-166"></span><span>       </span><span id="requestPublicRootPeers"><span class="annot"><span class="annottext">PeerSelectionActions peeraddr peerconn m
-&gt; Int -&gt; m (Set peeraddr, DiffTime)
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#requestPublicRootPeers"><span class="hs-identifier hs-var hs-var">requestPublicRootPeers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679214461"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214463"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiffTime</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span>       </span><span class="hs-comment">-- | The action to contact a known peer and request a sample of its</span><span>
</span><span id="line-169"></span><span>       </span><span class="hs-comment">-- known peers.</span><span>
</span><span id="line-170"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-171"></span><span>       </span><span class="hs-comment">-- This is synchronous, but it should expect to be interrupted by a</span><span>
</span><span id="line-172"></span><span>       </span><span class="hs-comment">-- timeout asynchronous exception. Failures are throw as exceptions.</span><span>
</span><span id="line-173"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-174"></span><span>       </span><span id="requestPeerGossip"><span class="annot"><span class="annottext">PeerSelectionActions peeraddr peerconn m
-&gt; peeraddr -&gt; m [peeraddr]
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#requestPeerGossip"><span class="hs-identifier hs-var hs-var">requestPeerGossip</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679214463"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679214461"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679214463"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>       </span><span class="hs-comment">-- | Core actions run by the governor to change 'PeerStatus'.</span><span>
</span><span id="line-177"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-178"></span><span>       </span><span id="peerStateActions"><span class="annot"><span class="annottext">PeerSelectionActions peeraddr peerconn m
-&gt; PeerStateActions peeraddr peerconn m
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#peerStateActions"><span class="hs-identifier hs-var hs-var">peerStateActions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerStateActions"><span class="hs-identifier hs-type">PeerStateActions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214463"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214462"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214461"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-179"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="hs-comment">-- | Callbacks which are performed to change peer state.</span><span>
</span><span id="line-183"></span><span class="hs-comment">--</span><span>
</span><span id="line-184"></span><span class="hs-keyword">data</span><span> </span><span id="PeerStateActions"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerStateActions"><span class="hs-identifier hs-var">PeerStateActions</span></a></span></span><span> </span><span id="local-6989586621679214454"><span class="annot"><a href="#local-6989586621679214454"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679214453"><span class="annot"><a href="#local-6989586621679214453"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span id="local-6989586621679214452"><span class="annot"><a href="#local-6989586621679214452"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerStateActions"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerStateActions"><span class="hs-identifier hs-var">PeerStateActions</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-comment">-- | Monitor peer state.</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-187"></span><span>    </span><span id="monitorPeerConnection"><span class="annot"><span class="annottext">PeerStateActions peeraddr peerconn m
-&gt; peerconn -&gt; STM m PeerStatus
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#monitorPeerConnection"><span class="hs-identifier hs-var hs-var">monitorPeerConnection</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679214453"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-type">STM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214452"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerStatus"><span class="hs-identifier hs-type">PeerStatus</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-comment">-- | Establish new connection.</span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-191"></span><span>    </span><span id="establishPeerConnection"><span class="annot"><span class="annottext">PeerStateActions peeraddr peerconn m -&gt; peeraddr -&gt; m peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishPeerConnection"><span class="hs-identifier hs-var hs-var">establishPeerConnection</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679214454"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679214452"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214453"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-comment">-- | Activate a connection: warm to hot promotion.</span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-195"></span><span>    </span><span id="activatePeerConnection"><span class="annot"><span class="annottext">PeerStateActions peeraddr peerconn m -&gt; peerconn -&gt; m ()
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#activatePeerConnection"><span class="hs-identifier hs-var hs-var">activatePeerConnection</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679214453"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679214452"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-comment">-- | Deactive a peer: hot to warm demotion.</span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-199"></span><span>    </span><span id="deactivatePeerConnection"><span class="annot"><span class="annottext">PeerStateActions peeraddr peerconn m -&gt; peerconn -&gt; m ()
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#deactivatePeerConnection"><span class="hs-identifier hs-var hs-var">deactivatePeerConnection</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679214453"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679214452"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-comment">-- | Close a connection: warm to cold transition.</span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-203"></span><span>    </span><span id="closePeerConnection"><span class="annot"><span class="annottext">PeerStateActions peeraddr peerconn m -&gt; peerconn -&gt; m ()
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#closePeerConnection"><span class="hs-identifier hs-var hs-var">closePeerConnection</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679214453"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679214452"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- Peer Selection State</span><span>
</span><span id="line-208"></span><span class="hs-comment">--</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">-- | The internal state used by the 'peerSelectionGovernor'.</span><span>
</span><span id="line-211"></span><span class="hs-comment">--</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- The local and public root sets are disjoint, and their union is the</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- overall root set.</span><span>
</span><span id="line-214"></span><span class="hs-comment">--</span><span>
</span><span id="line-215"></span><span class="hs-keyword">data</span><span> </span><span id="PeerSelectionState"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-var">PeerSelectionState</span></a></span></span><span> </span><span id="local-6989586621679214587"><span class="annot"><a href="#local-6989586621679214587"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679214586"><span class="annot"><a href="#local-6989586621679214586"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerSelectionState"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-var">PeerSelectionState</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>       </span><span id="targets"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; PeerSelectionTargets
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targets"><span class="hs-identifier hs-var hs-var">targets</span></a></span></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>       </span><span class="hs-comment">-- | The current set of local root peers. This is structured as a</span><span>
</span><span id="line-220"></span><span>       </span><span class="hs-comment">-- bunch of groups, with a target for each group. This gives us a set of</span><span>
</span><span id="line-221"></span><span>       </span><span class="hs-comment">-- n-of-m choices, e.g. \&quot;pick 2 from this group and 1 from this group\&quot;.</span><span>
</span><span id="line-222"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-223"></span><span>       </span><span class="hs-comment">-- The targets must of course be achievable, and to keep things simple,</span><span>
</span><span id="line-224"></span><span>       </span><span class="hs-comment">-- the groups must be disjoint.</span><span>
</span><span id="line-225"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-226"></span><span>       </span><span id="localRootPeers"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; LocalRootPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#localRootPeers"><span class="hs-identifier hs-var hs-var">localRootPeers</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#LocalRootPeers"><span class="hs-identifier hs-type">LocalRootPeers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214587"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span>       </span><span id="publicRootPeers"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootPeers"><span class="hs-identifier hs-var hs-var">publicRootPeers</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214587"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span>       </span><span class="hs-comment">-- |</span><span>
</span><span id="line-231"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-232"></span><span>       </span><span id="knownPeers"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; KnownPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#knownPeers"><span class="hs-identifier hs-var hs-var">knownPeers</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.KnownPeers.html#KnownPeers"><span class="hs-identifier hs-type">KnownPeers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214587"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span>       </span><span class="hs-comment">-- |</span><span>
</span><span id="line-235"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-236"></span><span>       </span><span id="establishedPeers"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn
-&gt; EstablishedPeers peeraddr peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishedPeers"><span class="hs-identifier hs-var hs-var">establishedPeers</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html#EstablishedPeers"><span class="hs-identifier hs-type">EstablishedPeers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214587"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214586"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span>       </span><span class="hs-comment">-- |</span><span>
</span><span id="line-239"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-240"></span><span>       </span><span id="activePeers"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#activePeers"><span class="hs-identifier hs-var hs-var">activePeers</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214587"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>       </span><span class="hs-comment">-- | A counter to manage the exponential backoff strategy for when to</span><span>
</span><span id="line-243"></span><span>       </span><span class="hs-comment">-- retry querying for more public root peers. It is negative for retry</span><span>
</span><span id="line-244"></span><span>       </span><span class="hs-comment">-- counts after failure, and positive for retry counts that are</span><span>
</span><span id="line-245"></span><span>       </span><span class="hs-comment">-- successful but make no progress.</span><span>
</span><span id="line-246"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-247"></span><span>       </span><span id="publicRootBackoffs"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootBackoffs"><span class="hs-identifier hs-var hs-var">publicRootBackoffs</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>       </span><span class="hs-comment">-- | The earliest time we would be prepared to request more public root</span><span>
</span><span id="line-250"></span><span>       </span><span class="hs-comment">-- peers. This is used with the 'publicRootBackoffs' to manage the</span><span>
</span><span id="line-251"></span><span>       </span><span class="hs-comment">-- exponential backoff.</span><span>
</span><span id="line-252"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-253"></span><span>       </span><span id="publicRootRetryTime"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Time
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootRetryTime"><span class="hs-identifier hs-var hs-var">publicRootRetryTime</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-type">Time</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>       </span><span id="inProgressPublicRootsReq"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPublicRootsReq"><span class="hs-identifier hs-var hs-var">inProgressPublicRootsReq</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span>
</span><span id="line-256"></span><span>       </span><span id="inProgressGossipReqs"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressGossipReqs"><span class="hs-identifier hs-var hs-var">inProgressGossipReqs</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span>
</span><span id="line-257"></span><span>       </span><span id="inProgressPromoteCold"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPromoteCold"><span class="hs-identifier hs-var hs-var">inProgressPromoteCold</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214587"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-258"></span><span>       </span><span id="inProgressPromoteWarm"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPromoteWarm"><span class="hs-identifier hs-var hs-var">inProgressPromoteWarm</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214587"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-259"></span><span>       </span><span id="inProgressDemoteWarm"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressDemoteWarm"><span class="hs-identifier hs-var hs-var">inProgressDemoteWarm</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214587"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-260"></span><span>       </span><span id="inProgressDemoteHot"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressDemoteHot"><span class="hs-identifier hs-var hs-var">inProgressDemoteHot</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214587"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-comment">--     TODO: need something like this to distinguish between lots of bad peers</span><span>
</span><span id="line-263"></span><span class="hs-comment">--     and us getting disconnected from the network locally. We don't want a</span><span>
</span><span id="line-264"></span><span class="hs-comment">--     network disconnect to cause us to flush our full known peer set by</span><span>
</span><span id="line-265"></span><span class="hs-comment">--     considering them all to have bad connectivity.</span><span>
</span><span id="line-266"></span><span class="hs-comment">--     Should also take account of DNS failures for root peer set.</span><span>
</span><span id="line-267"></span><span class="hs-comment">--     lastSucessfulNetworkEvent :: Time</span><span>
</span><span id="line-268"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-269"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679214425"><span id="local-6989586621679214427"><span id="local-6989586621679214429"><span class="annot"><span class="annottext">Int -&gt; PeerSelectionState peeraddr peerconn -&gt; ShowS
[PeerSelectionState peeraddr peerconn] -&gt; ShowS
PeerSelectionState peeraddr peerconn -&gt; String
(Int -&gt; PeerSelectionState peeraddr peerconn -&gt; ShowS)
-&gt; (PeerSelectionState peeraddr peerconn -&gt; String)
-&gt; ([PeerSelectionState peeraddr peerconn] -&gt; ShowS)
-&gt; Show (PeerSelectionState peeraddr peerconn)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall peeraddr peerconn.
(Show peeraddr, Show peerconn) =&gt;
Int -&gt; PeerSelectionState peeraddr peerconn -&gt; ShowS
forall peeraddr peerconn.
(Show peeraddr, Show peerconn) =&gt;
[PeerSelectionState peeraddr peerconn] -&gt; ShowS
forall peeraddr peerconn.
(Show peeraddr, Show peerconn) =&gt;
PeerSelectionState peeraddr peerconn -&gt; String
showList :: [PeerSelectionState peeraddr peerconn] -&gt; ShowS
$cshowList :: forall peeraddr peerconn.
(Show peeraddr, Show peerconn) =&gt;
[PeerSelectionState peeraddr peerconn] -&gt; ShowS
show :: PeerSelectionState peeraddr peerconn -&gt; String
$cshow :: forall peeraddr peerconn.
(Show peeraddr, Show peerconn) =&gt;
PeerSelectionState peeraddr peerconn -&gt; String
showsPrec :: Int -&gt; PeerSelectionState peeraddr peerconn -&gt; ShowS
$cshowsPrec :: forall peeraddr peerconn.
(Show peeraddr, Show peerconn) =&gt;
Int -&gt; PeerSelectionState peeraddr peerconn -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679214421"><span id="local-6989586621679214423"><span class="annot"><span class="annottext">a -&gt; PeerSelectionState peeraddr b -&gt; PeerSelectionState peeraddr a
(a -&gt; b)
-&gt; PeerSelectionState peeraddr a -&gt; PeerSelectionState peeraddr b
(forall a b.
 (a -&gt; b)
 -&gt; PeerSelectionState peeraddr a -&gt; PeerSelectionState peeraddr b)
-&gt; (forall a b.
    a
    -&gt; PeerSelectionState peeraddr b -&gt; PeerSelectionState peeraddr a)
-&gt; Functor (PeerSelectionState peeraddr)
forall a b.
a -&gt; PeerSelectionState peeraddr b -&gt; PeerSelectionState peeraddr a
forall a b.
(a -&gt; b)
-&gt; PeerSelectionState peeraddr a -&gt; PeerSelectionState peeraddr b
forall peeraddr a b.
a -&gt; PeerSelectionState peeraddr b -&gt; PeerSelectionState peeraddr a
forall peeraddr a b.
(a -&gt; b)
-&gt; PeerSelectionState peeraddr a -&gt; PeerSelectionState peeraddr b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: a -&gt; PeerSelectionState peeraddr b -&gt; PeerSelectionState peeraddr a
$c&lt;$ :: forall peeraddr a b.
a -&gt; PeerSelectionState peeraddr b -&gt; PeerSelectionState peeraddr a
fmap :: (a -&gt; b)
-&gt; PeerSelectionState peeraddr a -&gt; PeerSelectionState peeraddr b
$cfmap :: forall peeraddr a b.
(a -&gt; b)
-&gt; PeerSelectionState peeraddr a -&gt; PeerSelectionState peeraddr b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span id="local-6989586621679214418"><span id="local-6989586621679214419"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#emptyPeerSelectionState"><span class="hs-identifier hs-type">emptyPeerSelectionState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214419"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214418"><span class="hs-identifier hs-type">peerconn</span></a></span></span></span><span>
</span><span id="line-273"></span><span id="emptyPeerSelectionState"><span class="annot"><span class="annottext">emptyPeerSelectionState :: PeerSelectionState peeraddr peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#emptyPeerSelectionState"><span class="hs-identifier hs-var hs-var">emptyPeerSelectionState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-274"></span><span>    </span><span class="annot"><span class="annottext">PeerSelectionState :: forall peeraddr peerconn.
PeerSelectionTargets
-&gt; LocalRootPeers peeraddr
-&gt; Set peeraddr
-&gt; KnownPeers peeraddr
-&gt; EstablishedPeers peeraddr peerconn
-&gt; Set peeraddr
-&gt; Int
-&gt; Time
-&gt; Bool
-&gt; Int
-&gt; Set peeraddr
-&gt; Set peeraddr
-&gt; Set peeraddr
-&gt; Set peeraddr
-&gt; PeerSelectionState peeraddr peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-275"></span><span>      </span><span class="annot"><span class="annottext">targets :: PeerSelectionTargets
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targets"><span class="hs-identifier hs-var">targets</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerSelectionTargets
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#nullPeerSelectionTargets"><span class="hs-identifier hs-var">nullPeerSelectionTargets</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-276"></span><span>      </span><span class="annot"><span class="annottext">localRootPeers :: LocalRootPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#localRootPeers"><span class="hs-identifier hs-var">localRootPeers</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr
forall peeraddr. LocalRootPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#empty"><span class="hs-identifier hs-var">LocalRootPeers.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-277"></span><span>      </span><span class="annot"><span class="annottext">publicRootPeers :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootPeers"><span class="hs-identifier hs-var">publicRootPeers</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">,</span><span>
</span><span id="line-278"></span><span>      </span><span class="annot"><span class="annottext">knownPeers :: KnownPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#knownPeers"><span class="hs-identifier hs-var">knownPeers</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
forall peeraddr. KnownPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.KnownPeers.html#empty"><span class="hs-identifier hs-var">KnownPeers.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-279"></span><span>      </span><span class="annot"><span class="annottext">establishedPeers :: EstablishedPeers peeraddr peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishedPeers"><span class="hs-identifier hs-var">establishedPeers</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
forall peeraddr perconn. EstablishedPeers peeraddr perconn
</span><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html#empty"><span class="hs-identifier hs-var">EstablishedPeers.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-280"></span><span>      </span><span class="annot"><span class="annottext">activePeers :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#activePeers"><span class="hs-identifier hs-var">activePeers</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">,</span><span>
</span><span id="line-281"></span><span>      </span><span class="annot"><span class="annottext">publicRootBackoffs :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootBackoffs"><span class="hs-identifier hs-var">publicRootBackoffs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-282"></span><span>      </span><span class="annot"><span class="annottext">publicRootRetryTime :: Time
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootRetryTime"><span class="hs-identifier hs-var">publicRootRetryTime</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; Time
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-var">Time</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-283"></span><span>      </span><span class="annot"><span class="annottext">inProgressPublicRootsReq :: Bool
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPublicRootsReq"><span class="hs-identifier hs-var">inProgressPublicRootsReq</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-284"></span><span>      </span><span class="annot"><span class="annottext">inProgressGossipReqs :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressGossipReqs"><span class="hs-identifier hs-var">inProgressGossipReqs</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-285"></span><span>      </span><span class="annot"><span class="annottext">inProgressPromoteCold :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPromoteCold"><span class="hs-identifier hs-var">inProgressPromoteCold</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">,</span><span>
</span><span id="line-286"></span><span>      </span><span class="annot"><span class="annottext">inProgressPromoteWarm :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPromoteWarm"><span class="hs-identifier hs-var">inProgressPromoteWarm</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">,</span><span>
</span><span id="line-287"></span><span>      </span><span class="annot"><span class="annottext">inProgressDemoteWarm :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressDemoteWarm"><span class="hs-identifier hs-var">inProgressDemoteWarm</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">,</span><span>
</span><span id="line-288"></span><span>      </span><span class="annot"><span class="annottext">inProgressDemoteHot :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressDemoteHot"><span class="hs-identifier hs-var">inProgressDemoteHot</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span id="local-6989586621679214409"><span id="local-6989586621679214410"><span id="local-6989586621679214411"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#assertPeerSelectionState"><span class="hs-identifier hs-type">assertPeerSelectionState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679214411"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-293"></span><span>                         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214411"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214410"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-294"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679214409"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679214409"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-295"></span><span id="assertPeerSelectionState"><span class="annot"><span class="annottext">assertPeerSelectionState :: PeerSelectionState peeraddr peerconn -&gt; a -&gt; a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#assertPeerSelectionState"><span class="hs-identifier hs-var hs-var">assertPeerSelectionState</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679214394"><span id="local-6989586621679214395"><span id="local-6989586621679214396"><span id="local-6989586621679214397"><span id="local-6989586621679214398"><span id="local-6989586621679214399"><span id="local-6989586621679214400"><span id="local-6989586621679214401"><span id="local-6989586621679214402"><span id="local-6989586621679214403"><span id="local-6989586621679214404"><span id="local-6989586621679214405"><span id="local-6989586621679214406"><span id="local-6989586621679214407"><span class="annot"><span class="annottext">Bool
Int
Set peeraddr
Time
EstablishedPeers peeraddr peerconn
KnownPeers peeraddr
LocalRootPeers peeraddr
PeerSelectionTargets
inProgressDemoteHot :: Set peeraddr
inProgressDemoteWarm :: Set peeraddr
inProgressPromoteWarm :: Set peeraddr
inProgressPromoteCold :: Set peeraddr
inProgressGossipReqs :: Int
inProgressPublicRootsReq :: Bool
publicRootRetryTime :: Time
publicRootBackoffs :: Int
activePeers :: Set peeraddr
establishedPeers :: EstablishedPeers peeraddr peerconn
knownPeers :: KnownPeers peeraddr
publicRootPeers :: Set peeraddr
localRootPeers :: LocalRootPeers peeraddr
targets :: PeerSelectionTargets
inProgressDemoteHot :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
inProgressDemoteWarm :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
inProgressPromoteWarm :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
inProgressPromoteCold :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
inProgressGossipReqs :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Int
inProgressPublicRootsReq :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Bool
publicRootRetryTime :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Time
publicRootBackoffs :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Int
activePeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
establishedPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn
-&gt; EstablishedPeers peeraddr peerconn
knownPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; KnownPeers peeraddr
publicRootPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
localRootPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; LocalRootPeers peeraddr
targets :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; PeerSelectionTargets
</span><a href="#local-6989586621679214394"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-296"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownPeers peeraddr -&gt; Bool
forall peeraddr. Ord peeraddr =&gt; KnownPeers peeraddr -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.KnownPeers.html#invariant"><span class="hs-identifier hs-var">KnownPeers.invariant</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
</span><a href="#local-6989586621679214404"><span class="hs-identifier hs-var">knownPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn -&gt; Bool
forall peeraddr peerconn.
Ord peeraddr =&gt;
EstablishedPeers peeraddr peerconn -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html#invariant"><span class="hs-identifier hs-var">EstablishedPeers.invariant</span></a></span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
</span><a href="#local-6989586621679214403"><span class="hs-identifier hs-var">establishedPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalRootPeers peeraddr -&gt; Bool
forall peeraddr. Ord peeraddr =&gt; LocalRootPeers peeraddr -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#invariant"><span class="hs-identifier hs-var">LocalRootPeers.invariant</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr
</span><a href="#local-6989586621679214406"><span class="hs-identifier hs-var">localRootPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-comment">-- The activePeers is a subset of the establishedPeers</span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-comment">-- which is a subset of the known peers</span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.isSubsetOf</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214389"><span class="hs-identifier hs-var">activePeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214388"><span class="hs-identifier hs-var">establishedReadySet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.isSubsetOf</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214387"><span class="hs-identifier hs-var">establishedPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214386"><span class="hs-identifier hs-var">knownPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span>   </span><span class="hs-comment">-- The localRootPeers and publicRootPeers must not overlap.</span><span>
</span><span id="line-306"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.intersection</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214384"><span class="hs-identifier hs-var">localRootPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214405"><span class="hs-identifier hs-var">publicRootPeers</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-comment">-- The localRootPeers are a subset of the knownPeers,</span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-comment">-- and with correct source info in the knownPeers (either</span><span>
</span><span id="line-310"></span><span>    </span><span class="hs-comment">-- 'PeerSroucePublicRoot' or 'PeerSourceLocalRoot', as local and public</span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-comment">-- root peers might overlap).</span><span>
</span><span id="line-312"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.isSubsetOf</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214384"><span class="hs-identifier hs-var">localRootPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214386"><span class="hs-identifier hs-var">knownPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-comment">-- The publicRootPeers are a subset of the knownPeers,</span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-comment">-- and with correct source info in the knownPeers.</span><span>
</span><span id="line-316"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.isSubsetOf</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214405"><span class="hs-identifier hs-var">publicRootPeers</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214386"><span class="hs-identifier hs-var">knownPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-comment">-- The targets should respect the containment relationships of the root,</span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-comment">-- known, established and active peers</span><span>
</span><span id="line-320"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#sanePeerSelectionTargets"><span class="hs-identifier hs-var">sanePeerSelectionTargets</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionTargets
</span><a href="#local-6989586621679214407"><span class="hs-identifier hs-var">targets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-comment">-- All the local root peers are always a subset of the known peers. The</span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-comment">-- target for known peers is a target from both below and above. Thus the</span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-comment">-- number of local root peers must be less than or equal to the known peers</span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-comment">-- target, otherwise we could get stuck.</span><span>
</span><span id="line-326"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalRootPeers peeraddr -&gt; Int
forall peeraddr. LocalRootPeers peeraddr -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#size"><span class="hs-identifier hs-var">LocalRootPeers.size</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr
</span><a href="#local-6989586621679214406"><span class="hs-identifier hs-var">localRootPeers</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfKnownPeers"><span class="hs-identifier hs-var hs-var">targetNumberOfKnownPeers</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionTargets
</span><a href="#local-6989586621679214407"><span class="hs-identifier hs-var">targets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span>    </span><span class="hs-comment">-- Interestingly, although the local root peers are also a subset of the</span><span>
</span><span id="line-329"></span><span>    </span><span class="hs-comment">-- root peers, the equivalent constraint does not apply to the target</span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-comment">-- number of root peers. The reason is that the root peers target is only</span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-comment">-- a target from below, not from above. It is ok to have more than the</span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-comment">-- target number of root peers.</span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-334"></span><span>    </span><span class="hs-comment">--That is, we do /not/ need or want this invariant:</span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-comment">--    LocalRootPeers.size   localRootPeers &lt;= targetNumberOfRootPeers</span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-comment">-- It is also not necessary for all the targets to be achievable. It is</span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-comment">-- just necessary that we do not get stuck. So although we have an implicit</span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-comment">-- target that all local root peers become established, and a certain</span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-comment">-- number of them become active, these targets do not need to be achievable.</span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-comment">--That is, we do /not/ need or want this invariant:</span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-comment">--    LocalRootPeers.size   localRootPeers &lt;= targetNumberOfEstablishedPeers</span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-comment">--    LocalRootPeers.target localRootPeers &lt;= targetNumberOfActivePeers</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-comment">-- All currently established peers are in the availableToConnect set since</span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-comment">-- the alternative is a record of failure, but these are not (yet) failed.</span><span>
</span><span id="line-349"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.isSubsetOf</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214387"><span class="hs-identifier hs-var">establishedPeersSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownPeers peeraddr -&gt; Set peeraddr
forall peeraddr. KnownPeers peeraddr -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.KnownPeers.html#availableToConnect"><span class="hs-identifier hs-var hs-var">KnownPeers.availableToConnect</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
</span><a href="#local-6989586621679214404"><span class="hs-identifier hs-var">knownPeers</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-comment">-- No constraint for publicRootBackoffs, publicRootRetryTime</span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-comment">-- or inProgressPublicRootsReq</span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679214398"><span class="hs-identifier hs-var">inProgressGossipReqs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.isSubsetOf</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214397"><span class="hs-identifier hs-var">inProgressPromoteCold</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214381"><span class="hs-identifier hs-var">coldPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.isSubsetOf</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214396"><span class="hs-identifier hs-var">inProgressPromoteWarm</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214380"><span class="hs-identifier hs-var">warmPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.isSubsetOf</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214395"><span class="hs-identifier hs-var">inProgressDemoteWarm</span></a></span><span>  </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214380"><span class="hs-identifier hs-var">warmPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.isSubsetOf</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214394"><span class="hs-identifier hs-var">inProgressDemoteHot</span></a></span><span>   </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214379"><span class="hs-identifier hs-var">hotPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.intersection</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214396"><span class="hs-identifier hs-var">inProgressPromoteWarm</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214395"><span class="hs-identifier hs-var">inProgressDemoteWarm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-361"></span><span>    </span><span id="local-6989586621679214386"><span class="annot"><span class="annottext">knownPeersSet :: Set peeraddr
</span><a href="#local-6989586621679214386"><span class="hs-identifier hs-var hs-var">knownPeersSet</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr -&gt; Set peeraddr
forall peeraddr. KnownPeers peeraddr -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.KnownPeers.html#toSet"><span class="hs-identifier hs-var">KnownPeers.toSet</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
</span><a href="#local-6989586621679214404"><span class="hs-identifier hs-var">knownPeers</span></a></span><span>
</span><span id="line-362"></span><span>    </span><span id="local-6989586621679214384"><span class="annot"><span class="annottext">localRootPeersSet :: Set peeraddr
</span><a href="#local-6989586621679214384"><span class="hs-identifier hs-var hs-var">localRootPeersSet</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr -&gt; Set peeraddr
forall peeraddr. LocalRootPeers peeraddr -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#keysSet"><span class="hs-identifier hs-var">LocalRootPeers.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr
</span><a href="#local-6989586621679214406"><span class="hs-identifier hs-var">localRootPeers</span></a></span><span>
</span><span id="line-363"></span><span>    </span><span id="local-6989586621679214387"><span class="annot"><span class="annottext">establishedPeersSet :: Set peeraddr
</span><a href="#local-6989586621679214387"><span class="hs-identifier hs-var hs-var">establishedPeersSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
forall peeraddr peerconn.
EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html#toSet"><span class="hs-identifier hs-var">EstablishedPeers.toSet</span></a></span><span>      </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
</span><a href="#local-6989586621679214403"><span class="hs-identifier hs-var">establishedPeers</span></a></span><span>
</span><span id="line-364"></span><span>    </span><span id="local-6989586621679214388"><span class="annot"><span class="annottext">establishedReadySet :: Set peeraddr
</span><a href="#local-6989586621679214388"><span class="hs-identifier hs-var hs-var">establishedReadySet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
forall peeraddr peerconn.
Ord peeraddr =&gt;
EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html#readyPeers"><span class="hs-identifier hs-var">EstablishedPeers.readyPeers</span></a></span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
</span><a href="#local-6989586621679214403"><span class="hs-identifier hs-var">establishedPeers</span></a></span><span>
</span><span id="line-365"></span><span>    </span><span id="local-6989586621679214389"><span class="annot"><span class="annottext">activePeersSet :: Set peeraddr
</span><a href="#local-6989586621679214389"><span class="hs-identifier hs-var hs-var">activePeersSet</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214402"><span class="hs-identifier hs-var">activePeers</span></a></span><span>
</span><span id="line-366"></span><span>    </span><span id="local-6989586621679214381"><span class="annot"><span class="annottext">coldPeersSet :: Set peeraddr
</span><a href="#local-6989586621679214381"><span class="hs-identifier hs-var hs-var">coldPeersSet</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214386"><span class="hs-identifier hs-var">knownPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">Set.\\</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214387"><span class="hs-identifier hs-var">establishedPeersSet</span></a></span><span>
</span><span id="line-367"></span><span>    </span><span id="local-6989586621679214380"><span class="annot"><span class="annottext">warmPeersSet :: Set peeraddr
</span><a href="#local-6989586621679214380"><span class="hs-identifier hs-var hs-var">warmPeersSet</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214387"><span class="hs-identifier hs-var">establishedPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">Set.\\</span></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214389"><span class="hs-identifier hs-var">activePeersSet</span></a></span><span>
</span><span id="line-368"></span><span>    </span><span id="local-6989586621679214379"><span class="annot"><span class="annottext">hotPeersSet :: Set peeraddr
</span><a href="#local-6989586621679214379"><span class="hs-identifier hs-var hs-var">hotPeersSet</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214389"><span class="hs-identifier hs-var">activePeersSet</span></a></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="hs-comment">-- | A view of the status of each established peer, for testing and debugging.</span><span>
</span><span id="line-372"></span><span class="hs-comment">--</span><span>
</span><span id="line-373"></span><span id="local-6989586621679214372"><span id="local-6989586621679214373"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishedPeersStatus"><span class="hs-identifier hs-type">establishedPeersStatus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679214373"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-374"></span><span>                       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214373"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214372"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-375"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679214373"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerStatus"><span class="hs-identifier hs-type">PeerStatus</span></a></span></span></span><span>
</span><span id="line-376"></span><span id="establishedPeersStatus"><span class="annot"><span class="annottext">establishedPeersStatus :: PeerSelectionState peeraddr peerconn -&gt; Map peeraddr PeerStatus
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishedPeersStatus"><span class="hs-identifier hs-var hs-var">establishedPeersStatus</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679214370"><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
establishedPeers :: EstablishedPeers peeraddr peerconn
establishedPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn
-&gt; EstablishedPeers peeraddr peerconn
</span><a href="#local-6989586621679214370"><span class="hs-identifier hs-var hs-var">establishedPeers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679214369"><span class="annot"><span class="annottext">Set peeraddr
activePeers :: Set peeraddr
activePeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="#local-6989586621679214369"><span class="hs-identifier hs-var hs-var">activePeers</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-comment">-- map union-override, left to right</span><span>
</span><span id="line-378"></span><span>    </span><span class="annot"><span class="annottext">(peeraddr -&gt; PeerStatus) -&gt; Set peeraddr -&gt; Map peeraddr PeerStatus
forall k a. (k -&gt; a) -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromSet</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">peeraddr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PeerStatus
</span><a href="Ouroboros.Network.PeerSelection.Types.html#PeerHot"><span class="hs-identifier hs-var">PeerHot</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679214369"><span class="hs-identifier hs-var">activePeers</span></a></span><span>
</span><span id="line-379"></span><span> </span><span class="annot"><span class="annottext">Map peeraddr PeerStatus
-&gt; Map peeraddr PeerStatus -&gt; Map peeraddr PeerStatus
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(peeraddr -&gt; PeerStatus) -&gt; Set peeraddr -&gt; Map peeraddr PeerStatus
forall k a. (k -&gt; a) -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromSet</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">peeraddr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PeerStatus
</span><a href="Ouroboros.Network.PeerSelection.Types.html#PeerWarm"><span class="hs-identifier hs-var">PeerWarm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
forall peeraddr peerconn.
EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html#toSet"><span class="hs-identifier hs-var">EstablishedPeers.toSet</span></a></span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
</span><a href="#local-6989586621679214370"><span class="hs-identifier hs-var">establishedPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-384"></span><span class="hs-comment">-- Peer Selection Decisions</span><span>
</span><span id="line-385"></span><span class="hs-comment">--</span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="hs-comment">-- | The governor is using @Guarded m (Decision m peeraddr peerconn)@ where 'm'</span><span>
</span><span id="line-389"></span><span class="hs-comment">-- is an 'STM' monad, to drive its progress.</span><span>
</span><span id="line-390"></span><span class="hs-comment">--</span><span>
</span><span id="line-391"></span><span class="hs-keyword">data</span><span> </span><span id="Guarded"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-var">Guarded</span></a></span></span><span> </span><span id="local-6989586621679214549"><span class="annot"><a href="#local-6989586621679214549"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679214548"><span class="annot"><a href="#local-6989586621679214548"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-comment">-- | 'GuardedSkip' is used to instruct that there is no action to be made</span><span>
</span><span id="line-393"></span><span>    </span><span class="hs-comment">-- by the governor.</span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-comment">-- Let us note that the combined value which is computed by</span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-comment">-- @guardedDecisions@ term in</span><span>
</span><span id="line-397"></span><span>    </span><span class="hs-comment">-- 'Ouroboros.Newtork.PeerSelection.Governor.peerSelectionGovernorLoop' will</span><span>
</span><span id="line-398"></span><span>    </span><span class="hs-comment">-- never return it: this is bacause there are monitoring decisions which</span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-comment">-- never return this constructor, e.g.  'Monitor.targetPeers',</span><span>
</span><span id="line-400"></span><span>    </span><span class="hs-comment">-- 'Monitor.jobs', 'Monitor.connections', and thus the governor has always</span><span>
</span><span id="line-401"></span><span>    </span><span class="hs-comment">-- something to do.</span><span>
</span><span id="line-402"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-403"></span><span>    </span><span id="GuardedSkip"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-identifier hs-var">GuardedSkip</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Min</span></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-type">Time</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-comment">-- | 'Guarded' is used to provide an action, possibly with a timeout, to</span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-comment">-- the governor main loop.</span><span>
</span><span id="line-407"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-408"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Guarded"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-var">Guarded</span></a></span></span><span>     </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Min</span></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-type">Time</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679214549"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214548"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="hs-comment">-- | 'Guarded' constructor is absorbing in the sense that</span><span>
</span><span id="line-411"></span><span class="hs-comment">--</span><span>
</span><span id="line-412"></span><span class="hs-comment">-- &gt; Guarded x y &lt;&gt; a = Guarded x' y'</span><span>
</span><span id="line-413"></span><span class="hs-comment">-- &gt; a &lt;&gt; Guarded x y = Guarded x' y'</span><span>
</span><span id="line-414"></span><span class="hs-comment">--</span><span>
</span><span id="line-415"></span><span class="hs-comment">-- In the algebraic sense, @'Guarded' (Just minBound) (return x)@ is a left</span><span>
</span><span id="line-416"></span><span class="hs-comment">-- absorbing element when &quot;m ~ STM m'@ for some monad @m'@.  There is no right</span><span>
</span><span id="line-417"></span><span class="hs-comment">-- absorbing element since there is no right absorbing elemnt in @STM m'@.</span><span>
</span><span id="line-418"></span><span class="hs-comment">--</span><span>
</span><span id="line-419"></span><span class="hs-comment">-- Ref. [absorbing element](https://en.wikipedia.org/wiki/Absorbing_element)</span><span>
</span><span id="line-420"></span><span class="hs-comment">--</span><span>
</span><span id="line-421"></span><span id="local-6989586621679214362"><span id="local-6989586621679214363"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679214357"><span id="local-6989586621679214359"><span class="annot"><span class="hs-identifier hs-type">Alternative</span></span><span> </span><span class="annot"><a href="#local-6989586621679214363"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-type">Guarded</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214363"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214362"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-422"></span><span>  </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-type">Guarded</span></a></span><span>     </span><span id="local-6989586621679214355"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679214355"><span class="hs-identifier hs-var">ta</span></a></span></span><span> </span><span id="local-6989586621679214354"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679214354"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679214353"><span class="annot"><span class="annottext">&lt;&gt; :: Guarded m a -&gt; Guarded m a -&gt; Guarded m a
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-type">Guarded</span></a></span><span>     </span><span id="local-6989586621679214352"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679214352"><span class="hs-identifier hs-var">tb</span></a></span></span><span> </span><span id="local-6989586621679214351"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679214351"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; m a -&gt; Guarded m a
forall (m :: * -&gt; *) a. Maybe (Min Time) -&gt; m a -&gt; Guarded m a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-var">Guarded</span></a></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679214355"><span class="hs-identifier hs-var">ta</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; Maybe (Min Time) -&gt; Maybe (Min Time)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679214352"><span class="hs-identifier hs-var">tb</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679214354"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; m a -&gt; m a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679214351"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>  </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-type">Guarded</span></a></span><span>     </span><span id="local-6989586621679214350"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679214350"><span class="hs-identifier hs-var">ta</span></a></span></span><span> </span><span id="local-6989586621679214349"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679214349"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-identifier hs-type">GuardedSkip</span></a></span><span> </span><span id="local-6989586621679214348"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679214348"><span class="hs-identifier hs-var">tb</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; m a -&gt; Guarded m a
forall (m :: * -&gt; *) a. Maybe (Min Time) -&gt; m a -&gt; Guarded m a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-var">Guarded</span></a></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679214350"><span class="hs-identifier hs-var">ta</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; Maybe (Min Time) -&gt; Maybe (Min Time)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679214348"><span class="hs-identifier hs-var">tb</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679214349"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-424"></span><span>  </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-identifier hs-type">GuardedSkip</span></a></span><span> </span><span id="local-6989586621679214347"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679214347"><span class="hs-identifier hs-var">ta</span></a></span></span><span>   </span><span class="annot"><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-type">Guarded</span></a></span><span>     </span><span id="local-6989586621679214346"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679214346"><span class="hs-identifier hs-var">tb</span></a></span></span><span> </span><span id="local-6989586621679214345"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679214345"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; m a -&gt; Guarded m a
forall (m :: * -&gt; *) a. Maybe (Min Time) -&gt; m a -&gt; Guarded m a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-var">Guarded</span></a></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679214347"><span class="hs-identifier hs-var">ta</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; Maybe (Min Time) -&gt; Maybe (Min Time)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679214346"><span class="hs-identifier hs-var">tb</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679214345"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-425"></span><span>  </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-identifier hs-type">GuardedSkip</span></a></span><span> </span><span id="local-6989586621679214344"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679214344"><span class="hs-identifier hs-var">ta</span></a></span></span><span>   </span><span class="annot"><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-identifier hs-type">GuardedSkip</span></a></span><span> </span><span id="local-6989586621679214343"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679214343"><span class="hs-identifier hs-var">tb</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; Guarded m a
forall (m :: * -&gt; *) a. Maybe (Min Time) -&gt; Guarded m a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-identifier hs-var">GuardedSkip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679214344"><span class="hs-identifier hs-var">ta</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; Maybe (Min Time) -&gt; Maybe (Min Time)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679214343"><span class="hs-identifier hs-var">tb</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span class="hs-keyword">data</span><span> </span><span id="Decision"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Decision"><span class="hs-identifier hs-var">Decision</span></a></span></span><span> </span><span id="local-6989586621679214342"><span class="annot"><a href="#local-6989586621679214342"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679214341"><span class="annot"><a href="#local-6989586621679214341"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679214340"><span class="annot"><a href="#local-6989586621679214340"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Decision"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Decision"><span class="hs-identifier hs-var">Decision</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-429"></span><span>         </span><span class="hs-comment">-- | A trace event to classify the decision and action</span><span>
</span><span id="line-430"></span><span>       </span><span id="decisionTrace"><span class="annot"><span class="annottext">Decision m peeraddr peerconn -&gt; TracePeerSelection peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#decisionTrace"><span class="hs-identifier hs-var hs-var">decisionTrace</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePeerSelection"><span class="hs-identifier hs-type">TracePeerSelection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214341"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span>         </span><span class="hs-comment">-- | An updated state to use immediately</span><span>
</span><span id="line-433"></span><span>       </span><span id="decisionState"><span class="annot"><span class="annottext">Decision m peeraddr peerconn
-&gt; PeerSelectionState peeraddr peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#decisionState"><span class="hs-identifier hs-var hs-var">decisionState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214341"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214340"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span>       </span><span class="hs-comment">-- | An optional 'Job' to execute asynchronously. This job leads to</span><span>
</span><span id="line-436"></span><span>       </span><span class="hs-comment">-- a further 'Decision'. This gives a state update to apply upon</span><span>
</span><span id="line-437"></span><span>       </span><span class="hs-comment">-- completion, but also allows chaining further job actions.</span><span>
</span><span id="line-438"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-439"></span><span>       </span><span id="decisionJobs"><span class="annot"><span class="annottext">Decision m peeraddr peerconn
-&gt; [Job () m (Completion m peeraddr peerconn)]
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#decisionJobs"><span class="hs-identifier hs-var hs-var">decisionJobs</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/network-mux-0.1.0.0/noopt/doc/html/network-mux/src"><span class="hs-identifier hs-type">Job</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679214342"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Completion"><span class="hs-identifier hs-type">Completion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214342"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214341"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214340"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-440"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span class="hs-comment">-- | Decision which has access to the current time, rather than the time when</span><span>
</span><span id="line-443"></span><span class="hs-comment">-- the governor's loop blocked to make a decision.</span><span>
</span><span id="line-444"></span><span class="hs-comment">--</span><span>
</span><span id="line-445"></span><span class="hs-keyword">type</span><span> </span><span id="TimedDecision"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TimedDecision"><span class="hs-identifier hs-var">TimedDecision</span></a></span></span><span> </span><span id="local-6989586621679214334"><span class="annot"><a href="#local-6989586621679214334"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679214333"><span class="annot"><a href="#local-6989586621679214333"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679214332"><span class="annot"><a href="#local-6989586621679214332"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-type">Time</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Decision"><span class="hs-identifier hs-type">Decision</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214334"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214333"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214332"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span class="hs-comment">-- | Type alias for function types which are used to create governor decisions.</span><span>
</span><span id="line-448"></span><span class="hs-comment">-- Allmost all decisions are following this pattern.</span><span>
</span><span id="line-449"></span><span class="hs-comment">--</span><span>
</span><span id="line-450"></span><span class="hs-keyword">type</span><span> </span><span id="MkGuardedDecision"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#MkGuardedDecision"><span class="hs-identifier hs-var">MkGuardedDecision</span></a></span></span><span> </span><span id="local-6989586621679214330"><span class="annot"><a href="#local-6989586621679214330"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679214329"><span class="annot"><a href="#local-6989586621679214329"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span id="local-6989586621679214328"><span class="annot"><a href="#local-6989586621679214328"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-451"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionPolicy"><span class="hs-identifier hs-type">PeerSelectionPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214330"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214328"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-452"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214330"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214329"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-type">Guarded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-type">STM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214328"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TimedDecision"><span class="hs-identifier hs-type">TimedDecision</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214328"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214330"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214329"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span class="hs-keyword">newtype</span><span> </span><span id="Completion"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Completion"><span class="hs-identifier hs-var">Completion</span></a></span></span><span> </span><span id="local-6989586621679214327"><span class="annot"><a href="#local-6989586621679214327"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679214326"><span class="annot"><a href="#local-6989586621679214326"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679214325"><span class="annot"><a href="#local-6989586621679214325"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-457"></span><span>        </span><span id="Completion"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Completion"><span class="hs-identifier hs-var">Completion</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214326"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214325"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-458"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-type">Time</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Decision"><span class="hs-identifier hs-type">Decision</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214327"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214326"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214325"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span class="hs-keyword">data</span><span> </span><span id="TracePeerSelection"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePeerSelection"><span class="hs-identifier hs-var">TracePeerSelection</span></a></span></span><span> </span><span id="local-6989586621679214323"><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-461"></span><span>       </span><span id="TraceLocalRootPeersChanged"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceLocalRootPeersChanged"><span class="hs-identifier hs-var">TraceLocalRootPeersChanged</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#LocalRootPeers"><span class="hs-identifier hs-type">LocalRootPeers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#LocalRootPeers"><span class="hs-identifier hs-type">LocalRootPeers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceTargetsChanged"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceTargetsChanged"><span class="hs-identifier hs-var">TraceTargetsChanged</span></a></span></span><span>     </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span>
</span><span id="line-464"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePublicRootsRequest"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePublicRootsRequest"><span class="hs-identifier hs-var">TracePublicRootsRequest</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-465"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePublicRootsResults"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePublicRootsResults"><span class="hs-identifier hs-var">TracePublicRootsResults</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiffTime</span></span><span>
</span><span id="line-466"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePublicRootsFailure"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePublicRootsFailure"><span class="hs-identifier hs-var">TracePublicRootsFailure</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiffTime</span></span><span>
</span><span id="line-467"></span><span>     </span><span class="hs-comment">-- | target known peers, actual known peers, peers available for gossip,</span><span>
</span><span id="line-468"></span><span>     </span><span class="hs-comment">-- peers selected for gossip</span><span>
</span><span id="line-469"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceGossipRequests"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceGossipRequests"><span class="hs-identifier hs-var">TraceGossipRequests</span></a></span></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceGossipResults"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceGossipResults"><span class="hs-identifier hs-var">TraceGossipResults</span></a></span></span><span>      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">--TODO: classify failures</span><span>
</span><span id="line-471"></span><span>     </span><span class="hs-comment">-- | target known peers, actual known peers, selected peer</span><span>
</span><span id="line-472"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceForgetColdPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceForgetColdPeers"><span class="hs-identifier hs-var">TraceForgetColdPeers</span></a></span></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-473"></span><span>     </span><span class="hs-comment">-- | target established, actual established, selected peers</span><span>
</span><span id="line-474"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteColdPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteColdPeers"><span class="hs-identifier hs-var">TracePromoteColdPeers</span></a></span></span><span>   </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-475"></span><span>     </span><span class="hs-comment">-- | target established, actual established, peer, delay until next</span><span>
</span><span id="line-476"></span><span>     </span><span class="hs-comment">-- promotion, reason</span><span>
</span><span id="line-477"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteColdFailed"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteColdFailed"><span class="hs-identifier hs-var">TracePromoteColdFailed</span></a></span></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiffTime</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span>
</span><span id="line-478"></span><span>     </span><span class="hs-comment">-- | target established, actual established, peer</span><span>
</span><span id="line-479"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteColdDone"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteColdDone"><span class="hs-identifier hs-var">TracePromoteColdDone</span></a></span></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-480"></span><span>     </span><span class="hs-comment">-- | target active, actual active, selected peers</span><span>
</span><span id="line-481"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteWarmPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteWarmPeers"><span class="hs-identifier hs-var">TracePromoteWarmPeers</span></a></span></span><span>   </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span>     </span><span class="hs-comment">-- | target active, actual active, peer, reason</span><span>
</span><span id="line-483"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteWarmFailed"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteWarmFailed"><span class="hs-identifier hs-var">TracePromoteWarmFailed</span></a></span></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span>
</span><span id="line-484"></span><span>     </span><span class="hs-comment">-- | target active, actual active, peer</span><span>
</span><span id="line-485"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteWarmDone"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteWarmDone"><span class="hs-identifier hs-var">TracePromoteWarmDone</span></a></span></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-486"></span><span>     </span><span class="hs-comment">-- | target established, actual established, selected peers</span><span>
</span><span id="line-487"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteWarmPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteWarmPeers"><span class="hs-identifier hs-var">TraceDemoteWarmPeers</span></a></span></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>     </span><span class="hs-comment">-- | target established, actual established, peer, reason</span><span>
</span><span id="line-489"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteWarmFailed"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteWarmFailed"><span class="hs-identifier hs-var">TraceDemoteWarmFailed</span></a></span></span><span>   </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>  </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span>
</span><span id="line-490"></span><span>     </span><span class="hs-comment">-- | target established, actual established, peer</span><span>
</span><span id="line-491"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteWarmDone"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteWarmDone"><span class="hs-identifier hs-var">TraceDemoteWarmDone</span></a></span></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-492"></span><span>     </span><span class="hs-comment">-- | target active, actual active, selected peers</span><span>
</span><span id="line-493"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteHotPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteHotPeers"><span class="hs-identifier hs-var">TraceDemoteHotPeers</span></a></span></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>     </span><span class="hs-comment">-- | target active, actual active, peer, reason</span><span>
</span><span id="line-495"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteHotFailed"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteHotFailed"><span class="hs-identifier hs-var">TraceDemoteHotFailed</span></a></span></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span>
</span><span id="line-496"></span><span>     </span><span class="hs-comment">-- | target active, actual active, peer</span><span>
</span><span id="line-497"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteHotDone"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteHotDone"><span class="hs-identifier hs-var">TraceDemoteHotDone</span></a></span></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-498"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteAsynchronous"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteAsynchronous"><span class="hs-identifier hs-var">TraceDemoteAsynchronous</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679214323"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerStatus"><span class="hs-identifier hs-type">PeerStatus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-499"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceGovernorWakeup"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceGovernorWakeup"><span class="hs-identifier hs-var">TraceGovernorWakeup</span></a></span></span><span>
</span><span id="line-500"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679214295"><span id="local-6989586621679214297"><span id="local-6989586621679214299"><span class="annot"><span class="annottext">Int -&gt; TracePeerSelection peeraddr -&gt; ShowS
[TracePeerSelection peeraddr] -&gt; ShowS
TracePeerSelection peeraddr -&gt; String
(Int -&gt; TracePeerSelection peeraddr -&gt; ShowS)
-&gt; (TracePeerSelection peeraddr -&gt; String)
-&gt; ([TracePeerSelection peeraddr] -&gt; ShowS)
-&gt; Show (TracePeerSelection peeraddr)
forall peeraddr.
Show peeraddr =&gt;
Int -&gt; TracePeerSelection peeraddr -&gt; ShowS
forall peeraddr.
Show peeraddr =&gt;
[TracePeerSelection peeraddr] -&gt; ShowS
forall peeraddr.
Show peeraddr =&gt;
TracePeerSelection peeraddr -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [TracePeerSelection peeraddr] -&gt; ShowS
$cshowList :: forall peeraddr.
Show peeraddr =&gt;
[TracePeerSelection peeraddr] -&gt; ShowS
show :: TracePeerSelection peeraddr -&gt; String
$cshow :: forall peeraddr.
Show peeraddr =&gt;
TracePeerSelection peeraddr -&gt; String
showsPrec :: Int -&gt; TracePeerSelection peeraddr -&gt; ShowS
$cshowsPrec :: forall peeraddr.
Show peeraddr =&gt;
Int -&gt; TracePeerSelection peeraddr -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span class="hs-keyword">data</span><span> </span><span id="DebugPeerSelection"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#DebugPeerSelection"><span class="hs-identifier hs-var">DebugPeerSelection</span></a></span></span><span> </span><span id="local-6989586621679214294"><span class="annot"><a href="#local-6989586621679214294"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679214293"><span class="annot"><a href="#local-6989586621679214293"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-503"></span><span>       </span><span id="TraceGovernorState"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceGovernorState"><span class="hs-identifier hs-var">TraceGovernorState</span></a></span></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.4/io-sim-classes-0.2.0.0/noopt/doc/html/io-sim-classes/src"><span class="hs-identifier hs-type">Time</span></a></span><span>
</span><span id="line-504"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiffTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-505"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214294"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679214293"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679214286"><span id="local-6989586621679214288"><span id="local-6989586621679214290"><span class="annot"><span class="annottext">Int -&gt; DebugPeerSelection peeraddr peerconn -&gt; ShowS
[DebugPeerSelection peeraddr peerconn] -&gt; ShowS
DebugPeerSelection peeraddr peerconn -&gt; String
(Int -&gt; DebugPeerSelection peeraddr peerconn -&gt; ShowS)
-&gt; (DebugPeerSelection peeraddr peerconn -&gt; String)
-&gt; ([DebugPeerSelection peeraddr peerconn] -&gt; ShowS)
-&gt; Show (DebugPeerSelection peeraddr peerconn)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall peeraddr peerconn.
(Show peeraddr, Show peerconn) =&gt;
Int -&gt; DebugPeerSelection peeraddr peerconn -&gt; ShowS
forall peeraddr peerconn.
(Show peeraddr, Show peerconn) =&gt;
[DebugPeerSelection peeraddr peerconn] -&gt; ShowS
forall peeraddr peerconn.
(Show peeraddr, Show peerconn) =&gt;
DebugPeerSelection peeraddr peerconn -&gt; String
showList :: [DebugPeerSelection peeraddr peerconn] -&gt; ShowS
$cshowList :: forall peeraddr peerconn.
(Show peeraddr, Show peerconn) =&gt;
[DebugPeerSelection peeraddr peerconn] -&gt; ShowS
show :: DebugPeerSelection peeraddr peerconn -&gt; String
$cshow :: forall peeraddr peerconn.
(Show peeraddr, Show peerconn) =&gt;
DebugPeerSelection peeraddr peerconn -&gt; String
showsPrec :: Int -&gt; DebugPeerSelection peeraddr peerconn -&gt; ShowS
$cshowsPrec :: forall peeraddr peerconn.
(Show peeraddr, Show peerconn) =&gt;
Int -&gt; DebugPeerSelection peeraddr peerconn -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679214282"><span id="local-6989586621679214284"><span class="annot"><span class="annottext">a -&gt; DebugPeerSelection peeraddr b -&gt; DebugPeerSelection peeraddr a
(a -&gt; b)
-&gt; DebugPeerSelection peeraddr a -&gt; DebugPeerSelection peeraddr b
(forall a b.
 (a -&gt; b)
 -&gt; DebugPeerSelection peeraddr a -&gt; DebugPeerSelection peeraddr b)
-&gt; (forall a b.
    a
    -&gt; DebugPeerSelection peeraddr b -&gt; DebugPeerSelection peeraddr a)
-&gt; Functor (DebugPeerSelection peeraddr)
forall a b.
a -&gt; DebugPeerSelection peeraddr b -&gt; DebugPeerSelection peeraddr a
forall a b.
(a -&gt; b)
-&gt; DebugPeerSelection peeraddr a -&gt; DebugPeerSelection peeraddr b
forall peeraddr a b.
a -&gt; DebugPeerSelection peeraddr b -&gt; DebugPeerSelection peeraddr a
forall peeraddr a b.
(a -&gt; b)
-&gt; DebugPeerSelection peeraddr a -&gt; DebugPeerSelection peeraddr b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: a -&gt; DebugPeerSelection peeraddr b -&gt; DebugPeerSelection peeraddr a
$c&lt;$ :: forall peeraddr a b.
a -&gt; DebugPeerSelection peeraddr b -&gt; DebugPeerSelection peeraddr a
fmap :: (a -&gt; b)
-&gt; DebugPeerSelection peeraddr a -&gt; DebugPeerSelection peeraddr b
$cfmap :: forall peeraddr a b.
(a -&gt; b)
-&gt; DebugPeerSelection peeraddr a -&gt; DebugPeerSelection peeraddr b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span></pre></body></html>