<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeSynonymInstances #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Test.Shelley.Spec.Ledger.Generator.Utxo</span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genTx"><span class="hs-identifier">genTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#Delta"><span class="hs-identifier">Delta</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#showBalance"><span class="hs-identifier">showBalance</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-binary-1.5.0/noopt/doc/html/cardano-binary/src"><span class="hs-identifier">Cardano.Binary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-binary-1.5.0/noopt/doc/html/cardano-binary/src"><span class="hs-identifier">serialize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Cardano.Ledger.Core</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Core</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Cardano.Ledger.Era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Crypto</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Cardano.Ledger.Shelley</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Shelley</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Cardano.Ledger.Val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Val</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">sumVal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-operator">(&lt;+&gt;)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-operator">(&lt;-&gt;)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-operator">(&lt;&#215;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src"><span class="hs-identifier">Cardano.Slotting.Slot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src"><span class="hs-identifier">SlotNo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/small-steps-0.1.0.0/noopt/doc/html/small-steps/src"><span class="hs-identifier">Control.SetAlgebra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/small-steps-0.1.0.0/noopt/doc/html/small-steps/src"><span class="hs-identifier">forwards</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BSL</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">partitionEithers</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">nub</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src"><span class="hs-identifier">Data.Sequence.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src"><span class="hs-identifier">StrictSeq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src"><span class="hs-identifier">Data.Sequence.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">StrictSeq</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Records</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HasField</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Stack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HasCallStack</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Shelley.Spec.Ledger.API</span></a></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">DCert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">MultiSig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">ScriptHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Update</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Shelley.Spec.Ledger.Address</span></a></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Addr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">RewardAcnt</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">scriptToCred</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">toCred</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Shelley.Spec.Ledger.BaseTypes</span></a></span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Network</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">StrictMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">maybeToStrictMaybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Shelley.Spec.Ledger.Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Shelley.Spec.Ledger.Credential</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Credential</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">StakeReference</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Shelley.Spec.Ledger.Keys</span></a></span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Hash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">KeyHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">KeyPair</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">KeyRole</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">asWitness</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Shelley.Spec.Ledger.LedgerState</span></a></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">DPState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">DState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">KeyPairs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">PState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">UTxOState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">consumed</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">minfee</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">produced</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">_dstate</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">_ptrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">_rewards</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Shelley.Spec.Ledger.MetaData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">MetaDataHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Shelley.Spec.Ledger.PParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">PParams</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">PParams'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Shelley.Spec.Ledger.STS.Ledger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">LedgerEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Shelley.Spec.Ledger.Scripts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">hashMultiSigScript</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Shelley.Spec.Ledger.Tx</span></a></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Tx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">TxBody</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">TxOut</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">WitnessSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">WitnessSetHKD</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">getKeyCombination</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Shelley.Spec.Ledger.TxBody</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Wdrl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Shelley.Spec.Ledger.Hashing</span></a></span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">EraIndependentTxBody</span></a></span><span class="hs-special">,</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">HashAnnotated</span></a></span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">hashAnnotated</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">Shelley.Spec.Ledger.UTxO</span></a></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">UTxO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">balance</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">makeWitnessesFromScriptKeys</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier">makeWitnessesVKey</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Gen</span></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">QC</span></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.ConcreteCryptoTypes.html"><span class="hs-identifier">Test.Shelley.Spec.Ledger.ConcreteCryptoTypes</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.ConcreteCryptoTypes.html#Mock"><span class="hs-identifier">Mock</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Constants.html"><span class="hs-identifier">Test.Shelley.Spec.Ledger.Generator.Constants</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Constants.html#Constants"><span class="hs-identifier">Constants</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Constants.html#defaultConstants"><span class="hs-identifier">defaultConstants</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Core.html"><span class="hs-identifier">Test.Shelley.Spec.Ledger.Generator.Core</span></a></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#GenEnv"><span class="hs-identifier">GenEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#KeySpace"><span class="hs-identifier">KeySpace</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#findPayKeyPairAddr"><span class="hs-identifier">findPayKeyPairAddr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#findPayKeyPairCred"><span class="hs-identifier">findPayKeyPairCred</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#findPayScriptFromAddr"><span class="hs-identifier">findPayScriptFromAddr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#findStakeScriptFromCred"><span class="hs-identifier">findStakeScriptFromCred</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#genNatural"><span class="hs-identifier">genNatural</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.MetaData.html"><span class="hs-identifier">Test.Shelley.Spec.Ledger.Generator.MetaData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.MetaData.html#genMetaData"><span class="hs-identifier">genMetaData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Trace.DCert.html"><span class="hs-identifier">Test.Shelley.Spec.Ledger.Generator.Trace.DCert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Trace.DCert.html#genDCerts"><span class="hs-identifier">genDCerts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Update.html"><span class="hs-identifier">Test.Shelley.Spec.Ledger.Generator.Update</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Update.html#genUpdate"><span class="hs-identifier">genUpdate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html"><span class="hs-identifier">Test.Shelley.Spec.Ledger.Utils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html#MultiSigPairs"><span class="hs-identifier">MultiSigPairs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html#ShelleyTest"><span class="hs-identifier">ShelleyTest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html#Split"><span class="hs-identifier">Split</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span id="local-6989586621679267977"><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#showBalance"><span class="hs-identifier hs-type">showBalance</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html#ShelleyTest"><span class="hs-identifier hs-type">ShelleyTest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267977"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HasField</span></span><span> </span><span class="annot"><span class="hs-string">&quot;inputs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267977"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">TxIn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267977"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HasField</span></span><span> </span><span class="annot"><span class="hs-string">&quot;outputs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267977"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src"><span class="hs-identifier hs-type">StrictSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267977"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HasField</span></span><span> </span><span class="annot"><span class="hs-string">&quot;wdrls&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267977"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Wdrl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267977"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HasField</span></span><span> </span><span class="annot"><span class="hs-string">&quot;txfee&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267977"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HasField</span></span><span> </span><span class="annot"><span class="hs-string">&quot;certs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Core.TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267977"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src"><span class="hs-identifier hs-type">StrictSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">DCert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267977"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">LedgerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267977"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">UTxOState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267977"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">DPState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267977"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267977"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">String</span></span></span><span>
</span><span id="line-131"></span><span id="showBalance"><span class="annot"><span class="annottext">showBalance :: LedgerEnv era -&gt; UTxOState era -&gt; DPState era -&gt; Tx era -&gt; String
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#showBalance"><span class="hs-identifier hs-var hs-var">showBalance</span></a></span></span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">LedgerEnv</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ix
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679267975"><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679267975"><span class="hs-identifier hs-var">pparams</span></a></span></span><span> </span><span class="annot"><span class="annottext">AccountState
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">UTxOState</span></a></span><span> </span><span id="local-6989586621679267973"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679267973"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PPUPState era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">DPState</span></a></span><span> </span><span class="annot"><span class="annottext">DState era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">PState</span></a></span><span> </span><span id="local-6989586621679267970"><span class="annot"><span class="annottext">Map (KeyHash 'StakePool (Crypto era)) (PoolParams era)
</span><a href="#local-6989586621679267970"><span class="hs-identifier hs-var">stakepools</span></a></span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool (Crypto era)) (PoolParams era)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool (Crypto era)) EpochNo
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span id="local-6989586621679267968"><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679267968"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="annot"><span class="annottext">WitnessSet era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">StrictMaybe MetaData
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n\nConsumed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Value era -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PParams era -&gt; UTxO era -&gt; TxBody era -&gt; Value era
forall era.
(ShelleyBased era,
 HasField &quot;certs&quot; (TxBody era) (StrictSeq (DCert era)),
 HasField &quot;inputs&quot; (TxBody era) (Set (TxIn era)),
 HasField &quot;wdrls&quot; (TxBody era) (Wdrl era)) =&gt;
PParams era -&gt; UTxO era -&gt; TxBody era -&gt; Value era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">consumed</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679267975"><span class="hs-identifier hs-var">pparams</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679267973"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679267968"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  Produced: &quot;</span></span><span>
</span><span id="line-138"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Value era -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PParams era
-&gt; Map (KeyHash 'StakePool (Crypto era)) (PoolParams era)
-&gt; TxBody era
-&gt; Value era
forall era.
(ShelleyBased era,
 HasField &quot;certs&quot; (TxBody era) (StrictSeq (DCert era)),
 HasField &quot;outputs&quot; (TxBody era) (StrictSeq (TxOut era)),
 HasField &quot;txfee&quot; (TxBody era) Coin) =&gt;
PParams era
-&gt; Map (KeyHash 'StakePool (Crypto era)) (PoolParams era)
-&gt; TxBody era
-&gt; Value era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">produced</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679267975"><span class="hs-identifier hs-var">pparams</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool (Crypto era)) (PoolParams era)
</span><a href="#local-6989586621679267970"><span class="hs-identifier hs-var">stakepools</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679267968"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-comment">--  ========================================================================</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="hs-comment">-- | Generates a transaction in the context of the LEDGER STS environment</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- and state.</span><span>
</span><span id="line-144"></span><span class="hs-comment">--</span><span>
</span><span id="line-145"></span><span class="hs-comment">--  A generated transaction may not have sufficient spending balance and</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- need to be discarded. In that case we try to compute a Delta, that when</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- added (applyDelta) to the transaction, repairs it. The repair is made</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- by adding additional inputs from which more Ada can flow into the fee.</span><span>
</span><span id="line-149"></span><span class="hs-comment">-- If that doesn't fix it, we add add more inputs to the Delta.</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- Experience shows that this converges quite quickly (in traces we never saw</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- more than 3 iterations).</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span class="hs-comment">-- Note: the spending balance emerges from inputs, refund withdrawals,</span><span>
</span><span id="line-154"></span><span class="hs-comment">-- certificate deposits and fees (which in turn depend on number of</span><span>
</span><span id="line-155"></span><span class="hs-comment">-- inputs, outputs, witnesses, metadata etc.). It's hard to avoid this</span><span>
</span><span id="line-156"></span><span class="hs-comment">-- completely, but in practice it is relatively easy to calibrate</span><span>
</span><span id="line-157"></span><span class="hs-comment">-- the generator 'Constants' so that there is sufficient spending balance.</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genTx"><span class="hs-identifier hs-type">genTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679267966"><span class="annot"><a href="#local-6989586621679267966"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html#ShelleyTest"><span class="hs-identifier hs-type">ShelleyTest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267966"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.ConcreteCryptoTypes.html#Mock"><span class="hs-identifier hs-type">Mock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267966"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#GenEnv"><span class="hs-identifier hs-type">GenEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267966"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-166"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">LedgerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267966"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">UTxOState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267966"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">DPState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267966"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-168"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267966"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span id="genTx"><span class="annot"><span class="annottext">genTx :: GenEnv era
-&gt; LedgerEnv era -&gt; (UTxOState era, DPState era) -&gt; Gen (Tx era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genTx"><span class="hs-identifier hs-var hs-var">genTx</span></a></span></span><span>
</span><span id="line-170"></span><span>  </span><span id="local-6989586621679267965"><span class="annot"><span class="annottext">ge :: GenEnv era
</span><a href="#local-6989586621679267965"><span class="hs-identifier hs-var">ge</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#GenEnv"><span class="hs-identifier hs-type">GenEnv</span></a></span><span>
</span><span id="line-171"></span><span>         </span><span id="local-6989586621679267963"><span class="annot"><span class="annottext">keySpace :: KeySpace era
</span><a href="#local-6989586621679267963"><span class="hs-identifier hs-var">keySpace</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#KeySpace_"><span class="hs-identifier hs-type">KeySpace_</span></a></span><span>
</span><span id="line-172"></span><span>                      </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679267961"><span class="annot"><span class="annottext">KeyPairs (Crypto era)
ksKeyPairs :: forall era. KeySpace era -&gt; KeyPairs (Crypto era)
ksKeyPairs :: KeyPairs (Crypto era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#ksKeyPairs"><span class="hs-identifier hs-var hs-var">ksKeyPairs</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-173"></span><span>                        </span><span id="local-6989586621679267959"><span class="annot"><span class="annottext">[(GenesisKeyPair (Crypto era),
  AllIssuerKeys (Crypto era) 'GenesisDelegate)]
ksCoreNodes :: forall era.
KeySpace era
-&gt; [(GenesisKeyPair (Crypto era),
     AllIssuerKeys (Crypto era) 'GenesisDelegate)]
ksCoreNodes :: [(GenesisKeyPair (Crypto era),
  AllIssuerKeys (Crypto era) 'GenesisDelegate)]
</span><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#ksCoreNodes"><span class="hs-identifier hs-var hs-var">ksCoreNodes</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-174"></span><span>                        </span><span id="local-6989586621679267957"><span class="annot"><span class="annottext">MultiSigPairs era
ksMSigScripts :: forall era. KeySpace era -&gt; MultiSigPairs era
ksMSigScripts :: MultiSigPairs era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#ksMSigScripts"><span class="hs-identifier hs-var hs-var">ksMSigScripts</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-175"></span><span>                        </span><span id="local-6989586621679267955"><span class="annot"><span class="annottext">Map
  (KeyHash 'GenesisDelegate (Crypto era))
  (AllIssuerKeys (Crypto era) 'GenesisDelegate)
ksIndexedGenDelegates :: forall era.
KeySpace era
-&gt; Map
     (KeyHash 'GenesisDelegate (Crypto era))
     (AllIssuerKeys (Crypto era) 'GenesisDelegate)
ksIndexedGenDelegates :: Map
  (KeyHash 'GenesisDelegate (Crypto era))
  (AllIssuerKeys (Crypto era) 'GenesisDelegate)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#ksIndexedGenDelegates"><span class="hs-identifier hs-var hs-var">ksIndexedGenDelegates</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-176"></span><span>                        </span><span id="local-6989586621679267953"><span class="annot"><span class="annottext">Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
ksIndexedPaymentKeys :: forall era.
KeySpace era
-&gt; Map
     (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
ksIndexedPaymentKeys :: Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
</span><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#ksIndexedPaymentKeys"><span class="hs-identifier hs-var hs-var">ksIndexedPaymentKeys</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-177"></span><span>                        </span><span id="local-6989586621679267951"><span class="annot"><span class="annottext">Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
ksIndexedStakingKeys :: forall era.
KeySpace era
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
ksIndexedStakingKeys :: Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
</span><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#ksIndexedStakingKeys"><span class="hs-identifier hs-var hs-var">ksIndexedStakingKeys</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-178"></span><span>                        </span><span id="local-6989586621679267949"><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era, MultiSig era)
ksIndexedPayScripts :: forall era.
KeySpace era -&gt; Map (ScriptHash era) (MultiSig era, MultiSig era)
ksIndexedPayScripts :: Map (ScriptHash era) (MultiSig era, MultiSig era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#ksIndexedPayScripts"><span class="hs-identifier hs-var hs-var">ksIndexedPayScripts</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-179"></span><span>                        </span><span id="local-6989586621679267947"><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era, MultiSig era)
ksIndexedStakeScripts :: forall era.
KeySpace era -&gt; Map (ScriptHash era) (MultiSig era, MultiSig era)
ksIndexedStakeScripts :: Map (ScriptHash era) (MultiSig era, MultiSig era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#ksIndexedStakeScripts"><span class="hs-identifier hs-var hs-var">ksIndexedStakeScripts</span></a></span></span><span>
</span><span id="line-180"></span><span>                      </span><span class="hs-special">}</span><span>
</span><span id="line-181"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>         </span><span id="local-6989586621679267945"><span class="annot"><span class="annottext">Constants
</span><a href="#local-6989586621679267945"><span class="hs-identifier hs-var">constants</span></a></span></span><span>
</span><span id="line-183"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">LedgerEnv</span></a></span><span> </span><span id="local-6989586621679267944"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679267944"><span class="hs-identifier hs-var">slot</span></a></span></span><span> </span><span id="local-6989586621679267943"><span class="annot"><span class="annottext">Ix
</span><a href="#local-6989586621679267943"><span class="hs-identifier hs-var">txIx</span></a></span></span><span> </span><span id="local-6989586621679267942"><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679267942"><span class="hs-identifier hs-var">pparams</span></a></span></span><span> </span><span id="local-6989586621679267941"><span class="annot"><span class="annottext">AccountState
</span><a href="#local-6989586621679267941"><span class="hs-identifier hs-var">reserves</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679267940"><span class="annot"><span class="annottext">utxoSt :: UTxOState era
</span><a href="#local-6989586621679267940"><span class="hs-identifier hs-var">utxoSt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">UTxOState</span></a></span><span> </span><span id="local-6989586621679267939"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679267939"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PPUPState era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267938"><span class="annot"><span class="annottext">DPState era
</span><a href="#local-6989586621679267938"><span class="hs-identifier hs-var">dpState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-keyword">do</span><span>
</span><span id="line-187"></span><span>      </span><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><span id="line-188"></span><span>      </span><span class="hs-comment">-- Generate the building blocks of a TxBody</span><span>
</span><span id="line-189"></span><span>      </span><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><span id="line-190"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679267937"><span class="annot"><span class="annottext">[TxIn era]
</span><a href="#local-6989586621679267937"><span class="hs-identifier hs-var">inputs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267936"><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679267936"><span class="hs-identifier hs-var">spendingBalanceUtxo</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679267935"><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267935"><span class="hs-identifier hs-var">spendWits</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267934"><span class="annot"><span class="annottext">MultiSigPairs era
</span><a href="#local-6989586621679267934"><span class="hs-identifier hs-var">spendScripts</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-191"></span><span>        </span><span class="annot"><span class="annottext">(Int, Int)
-&gt; Map
     (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; Map (ScriptHash era) (MultiSig era, MultiSig era)
-&gt; UTxO era
-&gt; Gen
     ([TxIn era], Value era,
      ([KeyPair 'Witness (Crypto era)], MultiSigPairs era))
forall era.
ShelleyTest era =&gt;
(Int, Int)
-&gt; Map
     (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; Map (ScriptHash era) (MultiSig era, MultiSig era)
-&gt; UTxO era
-&gt; Gen
     ([TxIn era], Value era,
      ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genInputs"><span class="hs-identifier hs-var">genInputs</span></a></span><span>
</span><span id="line-192"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constants -&gt; Int
</span><a href="Test.Shelley.Spec.Ledger.Generator.Constants.html#minNumGenInputs"><span class="hs-identifier hs-var hs-var">minNumGenInputs</span></a></span><span> </span><span class="annot"><span class="annottext">Constants
</span><a href="#local-6989586621679267945"><span class="hs-identifier hs-var">constants</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constants -&gt; Int
</span><a href="Test.Shelley.Spec.Ledger.Generator.Constants.html#maxNumGenInputs"><span class="hs-identifier hs-var hs-var">maxNumGenInputs</span></a></span><span> </span><span class="annot"><span class="annottext">Constants
</span><a href="#local-6989586621679267945"><span class="hs-identifier hs-var">constants</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>          </span><span class="annot"><span class="annottext">Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
</span><a href="#local-6989586621679267953"><span class="hs-identifier hs-var">ksIndexedPaymentKeys</span></a></span><span>
</span><span id="line-194"></span><span>          </span><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era, MultiSig era)
</span><a href="#local-6989586621679267949"><span class="hs-identifier hs-var">ksIndexedPayScripts</span></a></span><span>
</span><span id="line-195"></span><span>          </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679267939"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-196"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679267930"><span class="annot"><span class="annottext">[(RewardAcnt era, Coin)]
</span><a href="#local-6989586621679267930"><span class="hs-identifier hs-var">wdrls</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679267929"><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267929"><span class="hs-identifier hs-var">wdrlWits</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267928"><span class="annot"><span class="annottext">MultiSigPairs era
</span><a href="#local-6989586621679267928"><span class="hs-identifier hs-var">wdrlScripts</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-197"></span><span>        </span><span class="annot"><span class="annottext">Constants
-&gt; Map (ScriptHash era) (MultiSig era, MultiSig era)
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; Map (Credential 'Staking era) Coin
-&gt; Gen
     ([(RewardAcnt era, Coin)],
      ([KeyPair 'Witness (Crypto era)], MultiSigPairs era))
forall era.
Constants
-&gt; Map (ScriptHash era) (MultiSig era, MultiSig era)
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; Map (Credential 'Staking era) Coin
-&gt; Gen
     ([(RewardAcnt era, Coin)],
      ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genWithdrawals"><span class="hs-identifier hs-var">genWithdrawals</span></a></span><span>
</span><span id="line-198"></span><span>          </span><span class="annot"><span class="annottext">Constants
</span><a href="#local-6989586621679267945"><span class="hs-identifier hs-var">constants</span></a></span><span>
</span><span id="line-199"></span><span>          </span><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era, MultiSig era)
</span><a href="#local-6989586621679267947"><span class="hs-identifier hs-var">ksIndexedStakeScripts</span></a></span><span>
</span><span id="line-200"></span><span>          </span><span class="annot"><span class="annottext">Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
</span><a href="#local-6989586621679267951"><span class="hs-identifier hs-var">ksIndexedStakingKeys</span></a></span><span>
</span><span id="line-201"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">DState era -&gt; Map (Credential 'Staking era) Coin
forall era. DState era -&gt; RewardAccounts era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var hs-var">_rewards</span></a></span><span> </span><span class="annot"><span class="annottext">(DState era -&gt; Map (Credential 'Staking era) Coin)
-&gt; (DPState era -&gt; DState era)
-&gt; DPState era
-&gt; Map (Credential 'Staking era) Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DPState era -&gt; DState era
forall era. DPState era -&gt; DState era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var hs-var">_dstate</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DPState era
</span><a href="#local-6989586621679267938"><span class="hs-identifier hs-var">dpState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679267925"><span class="annot"><span class="annottext">Maybe (Update era)
</span><a href="#local-6989586621679267925"><span class="hs-identifier hs-var">update</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267924"><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267924"><span class="hs-identifier hs-var">updateWits</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-203"></span><span>        </span><span class="annot"><span class="annottext">Constants
-&gt; SlotNo
-&gt; [(GenesisKeyPair (Crypto era),
     AllIssuerKeys (Crypto era) 'GenesisDelegate)]
-&gt; Map
     (KeyHash 'GenesisDelegate (Crypto era))
     (AllIssuerKeys (Crypto era) 'GenesisDelegate)
-&gt; PParams era
-&gt; (UTxOState era, DPState era)
-&gt; Gen (Maybe (Update era), [KeyPair 'Witness (Crypto era)])
forall era.
(HasCallStack, Era era) =&gt;
Constants
-&gt; SlotNo
-&gt; [(GenesisKeyPair (Crypto era),
     AllIssuerKeys (Crypto era) 'GenesisDelegate)]
-&gt; Map
     (KeyHash 'GenesisDelegate (Crypto era))
     (AllIssuerKeys (Crypto era) 'GenesisDelegate)
-&gt; PParams era
-&gt; (UTxOState era, DPState era)
-&gt; Gen (Maybe (Update era), [KeyPair 'Witness (Crypto era)])
</span><a href="Test.Shelley.Spec.Ledger.Generator.Update.html#genUpdate"><span class="hs-identifier hs-var">genUpdate</span></a></span><span>
</span><span id="line-204"></span><span>          </span><span class="annot"><span class="annottext">Constants
</span><a href="#local-6989586621679267945"><span class="hs-identifier hs-var">constants</span></a></span><span>
</span><span id="line-205"></span><span>          </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679267944"><span class="hs-identifier hs-var">slot</span></a></span><span>
</span><span id="line-206"></span><span>          </span><span class="annot"><span class="annottext">[(GenesisKeyPair (Crypto era),
  AllIssuerKeys (Crypto era) 'GenesisDelegate)]
</span><a href="#local-6989586621679267959"><span class="hs-identifier hs-var">ksCoreNodes</span></a></span><span>
</span><span id="line-207"></span><span>          </span><span class="annot"><span class="annottext">Map
  (KeyHash 'GenesisDelegate (Crypto era))
  (AllIssuerKeys (Crypto era) 'GenesisDelegate)
</span><a href="#local-6989586621679267955"><span class="hs-identifier hs-var">ksIndexedGenDelegates</span></a></span><span>
</span><span id="line-208"></span><span>          </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679267942"><span class="hs-identifier hs-var">pparams</span></a></span><span>
</span><span id="line-209"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxOState era
</span><a href="#local-6989586621679267940"><span class="hs-identifier hs-var">utxoSt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DPState era
</span><a href="#local-6989586621679267938"><span class="hs-identifier hs-var">dpState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679267923"><span class="annot"><span class="annottext">StrictSeq (DCert era)
</span><a href="#local-6989586621679267923"><span class="hs-identifier hs-var">certs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267922"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267922"><span class="hs-identifier hs-var">deposits</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267921"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267921"><span class="hs-identifier hs-var">refunds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267920"><span class="annot"><span class="annottext">DPState era
</span><a href="#local-6989586621679267920"><span class="hs-identifier hs-var">dpState'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679267919"><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267919"><span class="hs-identifier hs-var">certWits</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267918"><span class="annot"><span class="annottext">MultiSigPairs era
</span><a href="#local-6989586621679267918"><span class="hs-identifier hs-var">certScripts</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-211"></span><span>        </span><span class="annot"><span class="annottext">GenEnv era
-&gt; PParams era
-&gt; DPState era
-&gt; SlotNo
-&gt; Ix
-&gt; AccountState
-&gt; Gen
     (StrictSeq (DCert era), Coin, Coin, DPState era,
      ([KeyPair 'Witness (Crypto era)], MultiSigPairs era))
forall era.
Era era =&gt;
GenEnv era
-&gt; PParams era
-&gt; DPState era
-&gt; SlotNo
-&gt; Ix
-&gt; AccountState
-&gt; Gen
     (StrictSeq (DCert era), Coin, Coin, DPState era,
      ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
</span><a href="Test.Shelley.Spec.Ledger.Generator.Trace.DCert.html#genDCerts"><span class="hs-identifier hs-var">genDCerts</span></a></span><span> </span><span class="annot"><span class="annottext">GenEnv era
</span><a href="#local-6989586621679267965"><span class="hs-identifier hs-var">ge</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679267942"><span class="hs-identifier hs-var">pparams</span></a></span><span> </span><span class="annot"><span class="annottext">DPState era
</span><a href="#local-6989586621679267938"><span class="hs-identifier hs-var">dpState</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679267944"><span class="hs-identifier hs-var">slot</span></a></span><span> </span><span class="annot"><span class="annottext">Ix
</span><a href="#local-6989586621679267943"><span class="hs-identifier hs-var">txIx</span></a></span><span> </span><span class="annot"><span class="annottext">AccountState
</span><a href="#local-6989586621679267941"><span class="hs-identifier hs-var">reserves</span></a></span><span>
</span><span id="line-212"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679267917"><span class="annot"><span class="annottext">StrictMaybe MetaData
</span><a href="#local-6989586621679267917"><span class="hs-identifier hs-var">metadata</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267916"><span class="annot"><span class="annottext">StrictMaybe (MetaDataHash era)
</span><a href="#local-6989586621679267916"><span class="hs-identifier hs-var">metadataHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Constants
-&gt; Gen (StrictMaybe MetaData, StrictMaybe (MetaDataHash era))
forall era.
Era era =&gt;
Constants
-&gt; Gen (StrictMaybe MetaData, StrictMaybe (MetaDataHash era))
</span><a href="Test.Shelley.Spec.Ledger.Generator.MetaData.html#genMetaData"><span class="hs-identifier hs-var">genMetaData</span></a></span><span> </span><span class="annot"><span class="annottext">Constants
</span><a href="#local-6989586621679267945"><span class="hs-identifier hs-var">constants</span></a></span><span>
</span><span id="line-213"></span><span>      </span><span id="local-6989586621679267915"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679267915"><span class="hs-identifier hs-var">ttl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; Gen SlotNo
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genTimeToLive"><span class="hs-identifier hs-var">genTimeToLive</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679267944"><span class="hs-identifier hs-var">slot</span></a></span><span>
</span><span id="line-214"></span><span>      </span><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><span id="line-215"></span><span>      </span><span class="hs-comment">-- Gather Key Witnesses and Scripts, prepare a constructor for Tx Wits</span><span>
</span><span id="line-216"></span><span>      </span><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><span id="line-217"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679267913"><span class="annot"><span class="annottext">wits :: [KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267913"><span class="hs-identifier hs-var hs-var">wits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267935"><span class="hs-identifier hs-var">spendWits</span></a></span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
-&gt; [KeyPair 'Witness (Crypto era)]
-&gt; [KeyPair 'Witness (Crypto era)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267929"><span class="hs-identifier hs-var">wdrlWits</span></a></span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
-&gt; [KeyPair 'Witness (Crypto era)]
-&gt; [KeyPair 'Witness (Crypto era)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267919"><span class="hs-identifier hs-var">certWits</span></a></span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
-&gt; [KeyPair 'Witness (Crypto era)]
-&gt; [KeyPair 'Witness (Crypto era)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267924"><span class="hs-identifier hs-var">updateWits</span></a></span><span>
</span><span id="line-218"></span><span>          </span><span id="local-6989586621679267912"><span class="annot"><span class="annottext">scripts :: Map (ScriptHash era) (MultiSig era)
</span><a href="#local-6989586621679267912"><span class="hs-identifier hs-var hs-var">scripts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MultiSigPairs era
-&gt; MultiSigPairs era -&gt; Map (ScriptHash era) (MultiSig era)
forall era.
TxBodyConstraints era =&gt;
[(MultiSig era, MultiSig era)]
-&gt; [(MultiSig era, MultiSig era)]
-&gt; Map (ScriptHash era) (MultiSig era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#mkScriptWits"><span class="hs-identifier hs-var">mkScriptWits</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSigPairs era
</span><a href="#local-6989586621679267934"><span class="hs-identifier hs-var">spendScripts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MultiSigPairs era
</span><a href="#local-6989586621679267918"><span class="hs-identifier hs-var">certScripts</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSigPairs era -&gt; MultiSigPairs era -&gt; MultiSigPairs era
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">MultiSigPairs era
</span><a href="#local-6989586621679267928"><span class="hs-identifier hs-var">wdrlScripts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>          </span><span id="local-6989586621679267910"><span class="annot"><span class="annottext">mkTxWits' :: TxBody era -&gt; WitnessSet era
</span><a href="#local-6989586621679267910"><span class="hs-identifier hs-var hs-var">mkTxWits'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-220"></span><span>            </span><span class="annot"><span class="annottext">Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; [KeyPair 'Witness (Crypto era)]
-&gt; Map (ScriptHash era) (MultiSig era)
-&gt; Hash (HASH (Crypto era)) EraIndependentTxBody
-&gt; WitnessSet era
forall era.
(Era era, Mock (Crypto era), AnnotatedData (Script era),
 Script era ~ MultiSig era) =&gt;
Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; [KeyPair 'Witness (Crypto era)]
-&gt; Map (ScriptHash era) (MultiSig era)
-&gt; Hash (Crypto era) EraIndependentTxBody
-&gt; WitnessSet era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#mkTxWits"><span class="hs-identifier hs-var">mkTxWits</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
</span><a href="#local-6989586621679267953"><span class="hs-identifier hs-var">ksIndexedPaymentKeys</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
</span><a href="#local-6989586621679267951"><span class="hs-identifier hs-var">ksIndexedStakingKeys</span></a></span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267913"><span class="hs-identifier hs-var">wits</span></a></span><span> </span><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era)
</span><a href="#local-6989586621679267912"><span class="hs-identifier hs-var">scripts</span></a></span><span>
</span><span id="line-221"></span><span>              </span><span class="annot"><span class="annottext">(Hash (HASH (Crypto era)) EraIndependentTxBody -&gt; WitnessSet era)
-&gt; (TxBody era -&gt; Hash (HASH (Crypto era)) EraIndependentTxBody)
-&gt; TxBody era
-&gt; WitnessSet era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxBody era -&gt; Hash (HASH (Crypto era)) EraIndependentTxBody
forall a e.
HashAnnotated a e =&gt;
a -&gt; Hash (HASH (Crypto e)) (HashIndex a)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">hashAnnotated</span></a></span><span>
</span><span id="line-222"></span><span>      </span><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><span id="line-223"></span><span>      </span><span class="hs-comment">-- SpendingBalance, Output Addresses (including some Pointer addresses)</span><span>
</span><span id="line-224"></span><span>      </span><span class="hs-comment">-- and a Outputs builder that distributes the given balance over addresses.</span><span>
</span><span id="line-225"></span><span>      </span><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><span id="line-226"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679267908"><span class="annot"><span class="annottext">withdrawals :: Coin
</span><a href="#local-6989586621679267908"><span class="hs-identifier hs-var hs-var">withdrawals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coin] -&gt; Coin
forall (t :: * -&gt; *) v. (Foldable t, Val v) =&gt; t v -&gt; v
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">sumVal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RewardAcnt era, Coin) -&gt; Coin
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((RewardAcnt era, Coin) -&gt; Coin)
-&gt; [(RewardAcnt era, Coin)] -&gt; [Coin]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(RewardAcnt era, Coin)]
</span><a href="#local-6989586621679267930"><span class="hs-identifier hs-var">wdrls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>          </span><span id="local-6989586621679267906"><span class="annot"><span class="annottext">spendingBalance :: Value era
</span><a href="#local-6989586621679267906"><span class="hs-identifier hs-var hs-var">spendingBalance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-228"></span><span>            </span><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679267936"><span class="hs-identifier hs-var">spendingBalanceUtxo</span></a></span><span>
</span><span id="line-229"></span><span>              </span><span class="annot"><span class="annottext">Value era -&gt; Value era -&gt; Value era
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Value era
forall t. Val t =&gt; Coin -&gt; t
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Value era) -&gt; Coin -&gt; Value era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267908"><span class="hs-identifier hs-var">withdrawals</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-operator hs-var">&lt;-&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267922"><span class="hs-identifier hs-var">deposits</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267921"><span class="hs-identifier hs-var">refunds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>          </span><span id="local-6989586621679267904"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621679267904"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-231"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (TxIn era) (TxOut era) -&gt; Int
forall k a. Map k a -&gt; Int
</span><span class="hs-identifier hs-var">Map.size</span></span><span> </span><span class="annot"><span class="annottext">(Map (TxIn era) (TxOut era) -&gt; Int)
-&gt; (UTxO era -&gt; Map (TxIn era) (TxOut era)) -&gt; UTxO era -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UTxO era -&gt; Map (TxIn era) (TxOut era)
forall era. UTxO era -&gt; Map (TxIn era) (TxOut era)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var hs-var">unUTxO</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679267939"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constants -&gt; Int
</span><a href="Test.Shelley.Spec.Ledger.Generator.Constants.html#genTxStableUtxoSize"><span class="hs-identifier hs-var hs-var">genTxStableUtxoSize</span></a></span><span> </span><span class="annot"><span class="annottext">Constants
</span><a href="Test.Shelley.Spec.Ledger.Generator.Constants.html#defaultConstants"><span class="hs-identifier hs-var">defaultConstants</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- something moderate 80-120</span><span>
</span><span id="line-232"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constants -&gt; Int
</span><a href="Test.Shelley.Spec.Ledger.Generator.Constants.html#genTxUtxoIncrement"><span class="hs-identifier hs-var hs-var">genTxUtxoIncrement</span></a></span><span> </span><span class="annot"><span class="annottext">Constants
</span><a href="Test.Shelley.Spec.Ledger.Generator.Constants.html#defaultConstants"><span class="hs-identifier hs-var">defaultConstants</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- something small 2-5</span><span>
</span><span id="line-233"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-comment">-- no change at all</span><span>
</span><span id="line-234"></span><span>              </span><span class="hs-comment">-- This algorithm has an instability in that if we don't balance genTxStableUtxoSize and</span><span>
</span><span id="line-235"></span><span>              </span><span class="hs-comment">-- genTxUtxoIncrement correctly the size of the UTxO gradually shrinks so small we cannot</span><span>
</span><span id="line-236"></span><span>              </span><span class="hs-comment">-- support generating a transaction. If we get unexplained failures one might investigate</span><span>
</span><span id="line-237"></span><span>              </span><span class="hs-comment">-- changing these constants.</span><span>
</span><span id="line-238"></span><span>      </span><span id="local-6989586621679267898"><span class="annot"><span class="annottext">[Addr era]
</span><a href="#local-6989586621679267898"><span class="hs-identifier hs-var">outputAddrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-239"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; KeyPairs (Crypto era) -&gt; MultiSigPairs era -&gt; Gen [Addr era]
forall era.
Era era =&gt;
Int -&gt; KeyPairs (Crypto era) -&gt; MultiSigPairs era -&gt; Gen [Addr era]
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genRecipients"><span class="hs-identifier hs-var">genRecipients</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TxIn era] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[TxIn era]
</span><a href="#local-6989586621679267937"><span class="hs-identifier hs-var">inputs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267904"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">KeyPairs (Crypto era)
</span><a href="#local-6989586621679267961"><span class="hs-identifier hs-var">ksKeyPairs</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSigPairs era
</span><a href="#local-6989586621679267957"><span class="hs-identifier hs-var">ksMSigScripts</span></a></span><span>
</span><span id="line-240"></span><span>          </span><span class="annot"><span class="annottext">Gen [Addr era] -&gt; ([Addr era] -&gt; Gen [Addr era]) -&gt; Gen [Addr era]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">DState era -&gt; [Addr era] -&gt; Gen [Addr era]
forall h. DState h -&gt; [Addr h] -&gt; Gen [Addr h]
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genPtrAddrs"><span class="hs-identifier hs-var">genPtrAddrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DPState era -&gt; DState era
forall era. DPState era -&gt; DState era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var hs-var">_dstate</span></a></span><span> </span><span class="annot"><span class="annottext">DPState era
</span><a href="#local-6989586621679267920"><span class="hs-identifier hs-var">dpState'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>      </span><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><span id="line-242"></span><span>      </span><span class="hs-comment">-- Build a Draft Tx and repeatedly add to Delta until all fees are accounted for.</span><span>
</span><span id="line-243"></span><span>      </span><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><span id="line-244"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679267893"><span class="annot"><span class="annottext">draftFee :: Coin
</span><a href="#local-6989586621679267893"><span class="hs-identifier hs-var hs-var">draftFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-245"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679267891"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267891"><span class="hs-identifier hs-var">remainderCoin</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267890"><span class="annot"><span class="annottext">StrictSeq (TxOut era)
</span><a href="#local-6989586621679267890"><span class="hs-identifier hs-var">draftOutputs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-246"></span><span>            </span><span class="annot"><span class="annottext">Value era -&gt; [Addr era] -&gt; Coin -&gt; (Coin, StrictSeq (TxOut era))
forall era.
ShelleyTest era =&gt;
Value era -&gt; [Addr era] -&gt; Coin -&gt; (Coin, StrictSeq (TxOut era))
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#calcOutputsFromBalance"><span class="hs-identifier hs-var">calcOutputsFromBalance</span></a></span><span>
</span><span id="line-247"></span><span>              </span><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679267906"><span class="hs-identifier hs-var">spendingBalance</span></a></span><span>
</span><span id="line-248"></span><span>              </span><span class="annot"><span class="annottext">[Addr era]
</span><a href="#local-6989586621679267898"><span class="hs-identifier hs-var">outputAddrs</span></a></span><span>
</span><span id="line-249"></span><span>              </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267893"><span class="hs-identifier hs-var">draftFee</span></a></span><span>
</span><span id="line-250"></span><span>      </span><span id="local-6989586621679267888"><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679267888"><span class="hs-identifier hs-var">draftTxBody</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-251"></span><span>        </span><span class="annot"><span class="annottext">[TxIn era]
-&gt; StrictSeq (TxOut era)
-&gt; StrictSeq (DCert era)
-&gt; [(RewardAcnt era, Coin)]
-&gt; Maybe (Update era)
-&gt; Coin
-&gt; SlotNo
-&gt; StrictMaybe (MetaDataHash era)
-&gt; Gen (TxBody era)
forall era.
ShelleyTest era =&gt;
[TxIn era]
-&gt; StrictSeq (TxOut era)
-&gt; StrictSeq (DCert era)
-&gt; [(RewardAcnt era, Coin)]
-&gt; Maybe (Update era)
-&gt; Coin
-&gt; SlotNo
-&gt; StrictMaybe (MetaDataHash era)
-&gt; Gen (TxBody era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genTxBody"><span class="hs-identifier hs-var">genTxBody</span></a></span><span>
</span><span id="line-252"></span><span>          </span><span class="annot"><span class="annottext">[TxIn era]
</span><a href="#local-6989586621679267937"><span class="hs-identifier hs-var">inputs</span></a></span><span>
</span><span id="line-253"></span><span>          </span><span class="annot"><span class="annottext">StrictSeq (TxOut era)
</span><a href="#local-6989586621679267890"><span class="hs-identifier hs-var">draftOutputs</span></a></span><span>
</span><span id="line-254"></span><span>          </span><span class="annot"><span class="annottext">StrictSeq (DCert era)
</span><a href="#local-6989586621679267923"><span class="hs-identifier hs-var">certs</span></a></span><span>
</span><span id="line-255"></span><span>          </span><span class="annot"><span class="annottext">[(RewardAcnt era, Coin)]
</span><a href="#local-6989586621679267930"><span class="hs-identifier hs-var">wdrls</span></a></span><span>
</span><span id="line-256"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Update era)
</span><a href="#local-6989586621679267925"><span class="hs-identifier hs-var">update</span></a></span><span>
</span><span id="line-257"></span><span>          </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267893"><span class="hs-identifier hs-var">draftFee</span></a></span><span>
</span><span id="line-258"></span><span>          </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679267915"><span class="hs-identifier hs-var">ttl</span></a></span><span>
</span><span id="line-259"></span><span>          </span><span class="annot"><span class="annottext">StrictMaybe (MetaDataHash era)
</span><a href="#local-6989586621679267916"><span class="hs-identifier hs-var">metadataHash</span></a></span><span>
</span><span id="line-260"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679267886"><span class="annot"><span class="annottext">draftTx :: Tx era
</span><a href="#local-6989586621679267886"><span class="hs-identifier hs-var hs-var">draftTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxBody era -&gt; WitnessSet era -&gt; StrictMaybe MetaData -&gt; Tx era
forall era.
TxBodyConstraints era =&gt;
TxBody era -&gt; WitnessSet era -&gt; StrictMaybe MetaData -&gt; Tx era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">Tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
TxBody era
</span><a href="#local-6989586621679267888"><span class="hs-identifier hs-var">draftTxBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBody era -&gt; WitnessSet era
</span><a href="#local-6989586621679267910"><span class="hs-identifier hs-var">mkTxWits'</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679267888"><span class="hs-identifier hs-var">draftTxBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StrictMaybe MetaData
</span><a href="#local-6989586621679267917"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-261"></span><span>      </span><span class="hs-comment">-- We add now repeatedly add inputs until the process converges.</span><span>
</span><span id="line-262"></span><span>      </span><span class="annot"><span class="annottext">Coin
-&gt; [KeyPair 'Witness (Crypto era)]
-&gt; Map (ScriptHash era) (MultiSig era)
-&gt; KeyPairs (Crypto era)
-&gt; MultiSigPairs era
-&gt; UTxO era
-&gt; PParams era
-&gt; KeySpace era
-&gt; Tx era
-&gt; Gen (Tx era)
forall era.
(ShelleyTest era, Mock (Crypto era)) =&gt;
Coin
-&gt; [KeyPair 'Witness (Crypto era)]
-&gt; Map (ScriptHash era) (MultiSig era)
-&gt; KeyPairs (Crypto era)
-&gt; MultiSigPairs era
-&gt; UTxO era
-&gt; PParams era
-&gt; KeySpace era
-&gt; Tx era
-&gt; Gen (Tx era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#converge"><span class="hs-identifier hs-var">converge</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267891"><span class="hs-identifier hs-var">remainderCoin</span></a></span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267913"><span class="hs-identifier hs-var">wits</span></a></span><span> </span><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era)
</span><a href="#local-6989586621679267912"><span class="hs-identifier hs-var">scripts</span></a></span><span> </span><span class="annot"><span class="annottext">KeyPairs (Crypto era)
</span><a href="#local-6989586621679267961"><span class="hs-identifier hs-var">ksKeyPairs</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSigPairs era
</span><a href="#local-6989586621679267957"><span class="hs-identifier hs-var">ksMSigScripts</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679267939"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679267942"><span class="hs-identifier hs-var">pparams</span></a></span><span> </span><span class="annot"><span class="annottext">KeySpace era
</span><a href="#local-6989586621679267963"><span class="hs-identifier hs-var">keySpace</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679267886"><span class="hs-identifier hs-var">draftTx</span></a></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-comment">-- | - Collect additional inputs (and witnesses and keys and scripts) to make the transaction balance.</span><span>
</span><span id="line-265"></span><span class="hs-keyword">data</span><span> </span><span id="Delta"><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#Delta"><span class="hs-identifier hs-var">Delta</span></a></span></span><span> </span><span id="local-6989586621679268171"><span class="annot"><a href="#local-6989586621679268171"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Delta"><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#Delta"><span class="hs-identifier hs-var">Delta</span></a></span></span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="dfees"><span class="annot"><span class="annottext">Delta era -&gt; Coin
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#dfees"><span class="hs-identifier hs-var hs-var">dfees</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-267"></span><span>    </span><span id="extraInputs"><span class="annot"><span class="annottext">Delta era -&gt; Set (TxIn era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#extraInputs"><span class="hs-identifier hs-var hs-var">extraInputs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">TxIn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268171"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-268"></span><span>    </span><span id="extraWitnesses"><span class="annot"><span class="annottext">Delta era -&gt; WitnessSet era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#extraWitnesses"><span class="hs-identifier hs-var hs-var">extraWitnesses</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">WitnessSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268171"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-269"></span><span>    </span><span id="change"><span class="annot"><span class="annottext">Delta era -&gt; TxOut era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#change"><span class="hs-identifier hs-var hs-var">change</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268171"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-270"></span><span>    </span><span id="deltaVKeys"><span class="annot"><span class="annottext">Delta era -&gt; [KeyPair 'Witness (Crypto era)]
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#deltaVKeys"><span class="hs-identifier hs-var hs-var">deltaVKeys</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Witness</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268171"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-271"></span><span>    </span><span id="deltaScripts"><span class="annot"><span class="annottext">Delta era -&gt; [(MultiSig era, MultiSig era)]
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#deltaScripts"><span class="hs-identifier hs-var hs-var">deltaScripts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268171"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268171"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="hs-comment">-- | - We need this instance to know when delta has stopped growing. We don't actually need to compare all</span><span>
</span><span id="line-275"></span><span class="hs-comment">--  the fields, because if the extraInputs has not changed then the Scripts and keys will not have changed.</span><span>
</span><span id="line-276"></span><span id="local-6989586621679267877"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679267874"><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html#ShelleyTest"><span class="hs-identifier hs-type">ShelleyTest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267877"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679267877"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-277"></span><span>  </span><span id="local-6989586621679267872"><span class="annot"><span class="annottext">Delta era
</span><a href="#local-6989586621679267872"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679267871"><span class="annot"><span class="annottext">== :: Delta era -&gt; Delta era -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span id="local-6989586621679267870"><span class="annot"><span class="annottext">Delta era
</span><a href="#local-6989586621679267870"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><span class="annottext">Delta era -&gt; Coin
forall era. Delta era -&gt; Coin
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#dfees"><span class="hs-identifier hs-var hs-var">dfees</span></a></span><span> </span><span class="annot"><span class="annottext">Delta era
</span><a href="#local-6989586621679267872"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Delta era -&gt; Coin
forall era. Delta era -&gt; Coin
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#dfees"><span class="hs-identifier hs-var hs-var">dfees</span></a></span><span> </span><span class="annot"><span class="annottext">Delta era
</span><a href="#local-6989586621679267870"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-279"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Delta era -&gt; Set (TxIn era)
forall era. Delta era -&gt; Set (TxIn era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#extraInputs"><span class="hs-identifier hs-var hs-var">extraInputs</span></a></span><span> </span><span class="annot"><span class="annottext">Delta era
</span><a href="#local-6989586621679267872"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Set (TxIn era) -&gt; Set (TxIn era) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Delta era -&gt; Set (TxIn era)
forall era. Delta era -&gt; Set (TxIn era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#extraInputs"><span class="hs-identifier hs-var hs-var">extraInputs</span></a></span><span> </span><span class="annot"><span class="annottext">Delta era
</span><a href="#local-6989586621679267870"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-280"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Delta era -&gt; WitnessSet era
forall era. Delta era -&gt; WitnessSet era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#extraWitnesses"><span class="hs-identifier hs-var hs-var">extraWitnesses</span></a></span><span> </span><span class="annot"><span class="annottext">Delta era
</span><a href="#local-6989586621679267872"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">WitnessSet era -&gt; WitnessSet era -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Delta era -&gt; WitnessSet era
forall era. Delta era -&gt; WitnessSet era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#extraWitnesses"><span class="hs-identifier hs-var hs-var">extraWitnesses</span></a></span><span> </span><span class="annot"><span class="annottext">Delta era
</span><a href="#local-6989586621679267870"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-281"></span><span>      </span><span class="hs-comment">-- deltaVKeys and deltaScripts equality are implied by extraWitnesses equality, at least in the use case below.</span><span>
</span><span id="line-282"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Delta era -&gt; TxOut era
forall era. Delta era -&gt; TxOut era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#change"><span class="hs-identifier hs-var hs-var">change</span></a></span><span> </span><span class="annot"><span class="annottext">Delta era
</span><a href="#local-6989586621679267872"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut era -&gt; TxOut era -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Delta era -&gt; TxOut era
forall era. Delta era -&gt; TxOut era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#change"><span class="hs-identifier hs-var hs-var">change</span></a></span><span> </span><span class="annot"><span class="annottext">Delta era
</span><a href="#local-6989586621679267870"><span class="hs-identifier hs-var">b</span></a></span></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span id="local-6989586621679268125"><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#deltaZero"><span class="hs-identifier hs-type">deltaZero</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html#ShelleyTest"><span class="hs-identifier hs-type">ShelleyTest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268125"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Addr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268125"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268125"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-285"></span><span id="deltaZero"><span class="annot"><span class="annottext">deltaZero :: Coin -&gt; Coin -&gt; Addr era -&gt; Delta era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#deltaZero"><span class="hs-identifier hs-var hs-var">deltaZero</span></a></span></span><span> </span><span id="local-6989586621679267867"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267867"><span class="hs-identifier hs-var">initialfee</span></a></span></span><span> </span><span id="local-6989586621679267866"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267866"><span class="hs-identifier hs-var">minAda</span></a></span></span><span> </span><span id="local-6989586621679267865"><span class="annot"><span class="annottext">Addr era
</span><a href="#local-6989586621679267865"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><span class="annottext">Coin
-&gt; Set (TxIn era)
-&gt; WitnessSet era
-&gt; TxOut era
-&gt; [KeyPair 'Witness (Crypto era)]
-&gt; [(MultiSig era, MultiSig era)]
-&gt; Delta era
forall era.
Coin
-&gt; Set (TxIn era)
-&gt; WitnessSet era
-&gt; TxOut era
-&gt; [KeyPair 'Witness (Crypto era)]
-&gt; [(MultiSig era, MultiSig era)]
-&gt; Delta era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#Delta"><span class="hs-identifier hs-var">Delta</span></a></span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267867"><span class="hs-identifier hs-var">initialfee</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-operator hs-var">&lt;-&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267866"><span class="hs-identifier hs-var">minAda</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>    </span><span class="annot"><span class="annottext">Set (TxIn era)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-289"></span><span>    </span><span class="annot"><span class="annottext">WitnessSet era
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Addr era -&gt; Value era -&gt; TxOut era
forall era. ShelleyBased era =&gt; Addr era -&gt; Value era -&gt; TxOut era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">TxOut</span></a></span><span> </span><span class="annot"><span class="annottext">Addr era
</span><a href="#local-6989586621679267865"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Value era
forall t. Val t =&gt; Coin -&gt; t
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267866"><span class="hs-identifier hs-var">minAda</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>    </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-292"></span><span>    </span><span class="annot"><span class="annottext">[(MultiSig era, MultiSig era)]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span class="hs-comment">-- | - Do the work of computing what additioanl inputs we need to 'fix-up' the transaction so that it will balance.</span><span>
</span><span id="line-295"></span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genNextDelta"><span class="hs-identifier hs-type">genNextDelta</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679268126"><span class="annot"><a href="#local-6989586621679268126"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html#ShelleyTest"><span class="hs-identifier hs-type">ShelleyTest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268126"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.ConcreteCryptoTypes.html#Mock"><span class="hs-identifier hs-type">Mock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268126"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-298"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268126"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-299"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">PParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268126"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-300"></span><span>  </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#KeySpace"><span class="hs-identifier hs-type">KeySpace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268126"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-301"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268126"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268126"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-303"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268126"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span id="genNextDelta"><span class="annot"><span class="annottext">genNextDelta :: UTxO era
-&gt; PParams era
-&gt; KeySpace era
-&gt; Tx era
-&gt; Delta era
-&gt; Gen (Delta era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genNextDelta"><span class="hs-identifier hs-var hs-var">genNextDelta</span></a></span></span><span>
</span><span id="line-305"></span><span>  </span><span id="local-6989586621679267862"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679267862"><span class="hs-identifier hs-var">utxo</span></a></span></span><span>
</span><span id="line-306"></span><span>  </span><span id="local-6989586621679267861"><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679267861"><span class="hs-identifier hs-var">pparams</span></a></span></span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#KeySpace_"><span class="hs-identifier hs-type">KeySpace_</span></a></span><span>
</span><span id="line-308"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679267860"><span class="annot"><span class="annottext">Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
ksIndexedStakingKeys :: Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
ksIndexedStakingKeys :: forall era.
KeySpace era
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
</span><a href="#local-6989586621679267860"><span class="hs-identifier hs-var hs-var">ksIndexedStakingKeys</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-309"></span><span>        </span><span id="local-6989586621679267859"><span class="annot"><span class="annottext">Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
ksIndexedPaymentKeys :: Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
ksIndexedPaymentKeys :: forall era.
KeySpace era
-&gt; Map
     (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
</span><a href="#local-6989586621679267859"><span class="hs-identifier hs-var hs-var">ksIndexedPaymentKeys</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-310"></span><span>        </span><span id="local-6989586621679267858"><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era, MultiSig era)
ksIndexedPayScripts :: Map (ScriptHash era) (MultiSig era, MultiSig era)
ksIndexedPayScripts :: forall era.
KeySpace era -&gt; Map (ScriptHash era) (MultiSig era, MultiSig era)
</span><a href="#local-6989586621679267858"><span class="hs-identifier hs-var hs-var">ksIndexedPayScripts</span></a></span></span><span>
</span><span id="line-311"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>  </span><span id="local-6989586621679267857"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679267857"><span class="hs-identifier hs-var">tx</span></a></span></span><span>
</span><span id="line-314"></span><span>  </span><span id="local-6989586621679267856"><span class="annot"><span class="annottext">delta :: Delta era
</span><a href="#local-6989586621679267856"><span class="hs-identifier hs-var">delta</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span> </span><span id="local-6989586621679267855"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267855"><span class="hs-identifier hs-var">dfees</span></a></span></span><span> </span><span id="local-6989586621679267854"><span class="annot"><span class="annottext">Set (TxIn era)
</span><a href="#local-6989586621679267854"><span class="hs-identifier hs-var">extraInputs</span></a></span></span><span> </span><span id="local-6989586621679267853"><span class="annot"><span class="annottext">WitnessSet era
</span><a href="#local-6989586621679267853"><span class="hs-identifier hs-var">extraWitnesses</span></a></span></span><span> </span><span id="local-6989586621679267852"><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679267852"><span class="hs-identifier hs-var">change</span></a></span></span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(MultiSig era, MultiSig era)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679267851"><span class="annot"><span class="annottext">baseTxFee :: Coin
</span><a href="#local-6989586621679267851"><span class="hs-identifier hs-var hs-var">baseTxFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PParams era -&gt; Tx era -&gt; Coin
forall era. PParams era -&gt; Tx era -&gt; Coin
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">minfee</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679267861"><span class="hs-identifier hs-var">pparams</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679267857"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-316"></span><span>        </span><span id="local-6989586621679267850"><span class="annot"><span class="annottext">encodedLen :: a -&gt; b
</span><a href="#local-6989586621679267850"><span class="hs-identifier hs-var hs-var">encodedLen</span></a></span></span><span> </span><span id="local-6989586621679267849"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679267849"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; b
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int64 -&gt; b) -&gt; Int64 -&gt; b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int64
</span><span class="hs-identifier hs-var">BSL.length</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; ByteString
forall a. ToCBOR a =&gt; a -&gt; ByteString
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-binary-1.5.0/noopt/doc/html/cardano-binary/src"><span class="hs-identifier hs-var">serialize</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679267849"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>        </span><span class="hs-comment">-- based on the current contents of delta, how much will the fee increase when we add the delta to the tx?</span><span>
</span><span id="line-318"></span><span>        </span><span id="local-6989586621679267847"><span class="annot"><span class="annottext">draftSize :: Integer
</span><a href="#local-6989586621679267847"><span class="hs-identifier hs-var hs-var">draftSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-319"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Integer] -&gt; Integer
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span>
</span><span id="line-320"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">5</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- safety net in case the coin or a list prefix rolls over into a larger encoding</span><span>
</span><span id="line-321"></span><span>                </span><span class="annot"><span class="annottext">Coin -&gt; Integer
forall b a. (Num b, ToCBOR a) =&gt; a -&gt; b
</span><a href="#local-6989586621679267850"><span class="hs-identifier hs-var">encodedLen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267855"><span class="hs-identifier hs-var">dfees</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span>
</span><span id="line-322"></span><span>                </span><span class="annot"><span class="annottext">(TxIn era -&gt; Integer -&gt; Integer)
-&gt; Integer -&gt; Set (TxIn era) -&gt; Integer
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679267843"><span class="annot"><span class="annottext">TxIn era
</span><a href="#local-6989586621679267843"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679267842"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679267842"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679267842"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">TxIn era -&gt; Integer
forall b a. (Num b, ToCBOR a) =&gt; a -&gt; b
</span><a href="#local-6989586621679267850"><span class="hs-identifier hs-var">encodedLen</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn era
</span><a href="#local-6989586621679267843"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Set (TxIn era)
</span><a href="#local-6989586621679267854"><span class="hs-identifier hs-var">extraInputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-323"></span><span>                </span><span class="annot"><span class="annottext">TxOut era -&gt; Integer
forall b a. (Num b, ToCBOR a) =&gt; a -&gt; b
</span><a href="#local-6989586621679267850"><span class="hs-identifier hs-var">encodedLen</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679267852"><span class="hs-identifier hs-var">change</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-324"></span><span>                </span><span class="annot"><span class="annottext">WitnessSet era -&gt; Integer
forall b a. (Num b, ToCBOR a) =&gt; a -&gt; b
</span><a href="#local-6989586621679267850"><span class="hs-identifier hs-var">encodedLen</span></a></span><span> </span><span class="annot"><span class="annottext">WitnessSet era
</span><a href="#local-6989586621679267853"><span class="hs-identifier hs-var">extraWitnesses</span></a></span><span>
</span><span id="line-325"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-326"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>        </span><span id="local-6989586621679267841"><span class="annot"><span class="annottext">deltaFee :: Coin
</span><a href="#local-6989586621679267841"><span class="hs-identifier hs-var hs-var">deltaFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679267847"><span class="hs-identifier hs-var">draftSize</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin -&gt; Coin
forall t i. (Val t, Integral i) =&gt; i -&gt; t -&gt; t
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-operator hs-var">&lt;&#215;&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ix -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PParams era -&gt; HKD Identity Ix
forall (f :: * -&gt; *) era. PParams' f era -&gt; HKD f Ix
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var hs-var">_minfeeA</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679267861"><span class="hs-identifier hs-var">pparams</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>        </span><span id="local-6989586621679267839"><span class="annot"><span class="annottext">totalFee :: Coin
</span><a href="#local-6989586621679267839"><span class="hs-identifier hs-var hs-var">totalFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267851"><span class="hs-identifier hs-var">baseTxFee</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267841"><span class="hs-identifier hs-var">deltaFee</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-329"></span><span>        </span><span id="local-6989586621679267838"><span class="annot"><span class="annottext">remainingFee :: Coin
</span><a href="#local-6989586621679267838"><span class="hs-identifier hs-var hs-var">remainingFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267839"><span class="hs-identifier hs-var">totalFee</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-operator hs-var">&lt;-&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267855"><span class="hs-identifier hs-var">dfees</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-330"></span><span>        </span><span id="local-6989586621679267837"><span class="annot"><span class="annottext">changeAmount :: Coin
</span><a href="#local-6989586621679267837"><span class="hs-identifier hs-var hs-var">changeAmount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOut era -&gt; Coin
forall era.
(Compactible (Value era), HashAnnotated (TxBody era) era,
 FromCBOR (Value era), FromCBOR (CompactForm (Value era)),
 FromCBOR (Annotator (TxBody era)),
 FromCBOR (Annotator (Script era)), ToCBOR (Value era),
 ToCBOR (TxBody era), ToCBOR (Script era),
 ToCBOR (CompactForm (Value era)), Val (Value era),
 Show (Value era), Show (TxBody era), Show (Script era),
 Eq (TxBody era), Eq (Script era), NoThunks (Value era),
 NoThunks (TxBody era), NoThunks (Script era),
 HashIndex (TxBody era) ~ EraIndependentTxBody) =&gt;
TxOut era -&gt; Coin
</span><a href="#local-6989586621679267836"><span class="hs-identifier hs-var">getChangeAmount</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679267852"><span class="hs-identifier hs-var">change</span></a></span><span>
</span><span id="line-331"></span><span>        </span><span id="local-6989586621679267835"><span class="annot"><span class="annottext">minAda :: HKD Identity Coin
</span><a href="#local-6989586621679267835"><span class="hs-identifier hs-var hs-var">minAda</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PParams era -&gt; HKD Identity Coin
forall (f :: * -&gt; *) era. PParams' f era -&gt; HKD f Coin
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var hs-var">_minUTxOValue</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679267861"><span class="hs-identifier hs-var">pparams</span></a></span><span>
</span><span id="line-332"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267838"><span class="hs-identifier hs-var">remainingFee</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- we've paid for all the fees</span><span>
</span><span id="line-333"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Delta era -&gt; Gen (Delta era)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Delta era
</span><a href="#local-6989586621679267856"><span class="hs-identifier hs-var">delta</span></a></span><span> </span><span class="hs-comment">-- we're done</span><span>
</span><span id="line-334"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-comment">-- the change covers what we need, so shift Coin from change to dfees.</span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267838"><span class="hs-identifier hs-var">remainingFee</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267837"><span class="hs-identifier hs-var">changeAmount</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-operator hs-var">&lt;-&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
HKD Identity Coin
</span><a href="#local-6989586621679267835"><span class="hs-identifier hs-var">minAda</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>              </span><span class="hs-keyword">then</span><span>
</span><span id="line-338"></span><span>                </span><span class="annot"><span class="annottext">Delta era -&gt; Gen (Delta era)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Delta era -&gt; Gen (Delta era)) -&gt; Delta era -&gt; Gen (Delta era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-339"></span><span>                  </span><span class="annot"><span class="annottext">Delta era
</span><a href="#local-6989586621679267856"><span class="hs-identifier hs-var">delta</span></a></span><span>
</span><span id="line-340"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dfees :: Coin
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#dfees"><span class="hs-identifier hs-var">dfees</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267839"><span class="hs-identifier hs-var">totalFee</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-341"></span><span>                      </span><span class="annot"><span class="annottext">change :: TxOut era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#change"><span class="hs-identifier hs-var">change</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-342"></span><span>                        </span><span class="annot"><span class="annottext">(Value era -&gt; Value era) -&gt; TxOut era -&gt; TxOut era
</span><a href="#local-6989586621679267832"><span class="hs-identifier hs-var">deltaChange</span></a></span><span>
</span><span id="line-343"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value era -&gt; Value era -&gt; Value era
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-operator hs-var">&lt;-&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Value era
forall t. Val t =&gt; Coin -&gt; t
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267838"><span class="hs-identifier hs-var">remainingFee</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>                          </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679267852"><span class="hs-identifier hs-var">change</span></a></span><span>
</span><span id="line-345"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-346"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-comment">-- add a new input to cover the fee</span><span>
</span><span id="line-347"></span><span>              </span><span class="hs-keyword">do</span><span>
</span><span id="line-348"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679267831"><span class="annot"><span class="annottext">utxo' :: UTxO era
</span><a href="#local-6989586621679267831"><span class="hs-identifier hs-var hs-var">utxo'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-349"></span><span>                      </span><span class="hs-comment">-- Remove possible inputs from Utxo, if they already appear in inputs.</span><span>
</span><span id="line-350"></span><span>                      </span><span class="annot"><span class="annottext">Map (TxIn era) (TxOut era) -&gt; UTxO era
forall era. Map (TxIn era) (TxOut era) -&gt; UTxO era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">UTxO</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (TxIn era) (TxOut era) -&gt; UTxO era)
-&gt; Map (TxIn era) (TxOut era) -&gt; UTxO era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-351"></span><span>                        </span><span class="annot"><span class="annottext">Map (TxIn era) (TxOut era)
-&gt; Set (TxIn era) -&gt; Map (TxIn era) (TxOut era)
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.withoutKeys</span></span><span>
</span><span id="line-352"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxO era -&gt; Map (TxIn era) (TxOut era)
forall era. UTxO era -&gt; Map (TxIn era) (TxOut era)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var hs-var">unUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679267862"><span class="hs-identifier hs-var">utxo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>                          </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBody era -&gt; Set (TxIn era)
forall era. TxBody era -&gt; ShelleyBased era =&gt; Set (TxIn era)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">_inputs</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Set (TxIn era))
-&gt; (Tx era -&gt; TxBody era) -&gt; Tx era -&gt; Set (TxIn era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; TxBody era
forall era. Tx era -&gt; TxBodyConstraints era =&gt; TxBody era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">_body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679267857"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Set (TxIn era) -&gt; Set (TxIn era) -&gt; Set (TxIn era)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set (TxIn era)
</span><a href="#local-6989586621679267854"><span class="hs-identifier hs-var">extraInputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679267826"><span class="annot"><span class="annottext">[TxIn era]
</span><a href="#local-6989586621679267826"><span class="hs-identifier hs-var">inputs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267825"><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679267825"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679267824"><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267824"><span class="hs-identifier hs-var">vkeyPairs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267823"><span class="annot"><span class="annottext">[(MultiSig era, MultiSig era)]
</span><a href="#local-6989586621679267823"><span class="hs-identifier hs-var">msigPairs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int)
-&gt; Map
     (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; Map (ScriptHash era) (MultiSig era, MultiSig era)
-&gt; UTxO era
-&gt; Gen
     ([TxIn era], Value era,
      ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
forall era.
ShelleyTest era =&gt;
(Int, Int)
-&gt; Map
     (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; Map (ScriptHash era) (MultiSig era, MultiSig era)
-&gt; UTxO era
-&gt; Gen
     ([TxIn era], Value era,
      ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genInputs"><span class="hs-identifier hs-var">genInputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
</span><a href="#local-6989586621679267859"><span class="hs-identifier hs-var">ksIndexedPaymentKeys</span></a></span><span> </span><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era, MultiSig era)
</span><a href="#local-6989586621679267858"><span class="hs-identifier hs-var">ksIndexedPayScripts</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679267831"><span class="hs-identifier hs-var">utxo'</span></a></span><span>
</span><span id="line-355"></span><span>                </span><span class="hs-comment">-- It is possible that the Utxo has no possible inputs left, so fail. We try and keep this from happening</span><span>
</span><span id="line-356"></span><span>                </span><span class="hs-comment">-- by using feedback: adding to the number of ouputs (in the call to genRecipients) in genTx above. Adding to the</span><span>
</span><span id="line-357"></span><span>                </span><span class="hs-comment">-- outputs means in the next cycle the size of the UTxO will grow.</span><span>
</span><span id="line-358"></span><span>                </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TxIn era] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[TxIn era]
</span><a href="#local-6989586621679267826"><span class="hs-identifier hs-var">inputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Gen ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Not enough money in the world&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">() -&gt; Gen ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679267820"><span class="annot"><span class="annottext">newWits :: WitnessSet era
</span><a href="#local-6989586621679267820"><span class="hs-identifier hs-var hs-var">newWits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-360"></span><span>                      </span><span class="annot"><span class="annottext">Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; [KeyPair 'Witness (Crypto era)]
-&gt; Map (ScriptHash era) (MultiSig era)
-&gt; Hash (Crypto era) EraIndependentTxBody
-&gt; WitnessSet era
forall era.
(Era era, Mock (Crypto era), AnnotatedData (Script era),
 Script era ~ MultiSig era) =&gt;
Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; [KeyPair 'Witness (Crypto era)]
-&gt; Map (ScriptHash era) (MultiSig era)
-&gt; Hash (Crypto era) EraIndependentTxBody
-&gt; WitnessSet era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#mkTxWits"><span class="hs-identifier hs-var">mkTxWits</span></a></span><span>
</span><span id="line-361"></span><span>                        </span><span class="annot"><span class="annottext">Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
</span><a href="#local-6989586621679267859"><span class="hs-identifier hs-var">ksIndexedPaymentKeys</span></a></span><span>
</span><span id="line-362"></span><span>                        </span><span class="annot"><span class="annottext">Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
</span><a href="#local-6989586621679267860"><span class="hs-identifier hs-var">ksIndexedStakingKeys</span></a></span><span>
</span><span id="line-363"></span><span>                        </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267824"><span class="hs-identifier hs-var">vkeyPairs</span></a></span><span>
</span><span id="line-364"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(MultiSig era, MultiSig era)]
-&gt; [(MultiSig era, MultiSig era)]
-&gt; Map (ScriptHash era) (MultiSig era)
forall era.
TxBodyConstraints era =&gt;
[(MultiSig era, MultiSig era)]
-&gt; [(MultiSig era, MultiSig era)]
-&gt; Map (ScriptHash era) (MultiSig era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#mkScriptWits"><span class="hs-identifier hs-var">mkScriptWits</span></a></span><span> </span><span class="annot"><span class="annottext">[(MultiSig era, MultiSig era)]
</span><a href="#local-6989586621679267823"><span class="hs-identifier hs-var">msigPairs</span></a></span><span> </span><span class="annot"><span class="annottext">[(MultiSig era, MultiSig era)]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBody era -&gt; Hash (HASH (Crypto era)) (HashIndex (TxBody era))
forall a e.
HashAnnotated a e =&gt;
a -&gt; Hash (HASH (Crypto e)) (HashIndex a)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">hashAnnotated</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Hash (HASH (Crypto era)) (HashIndex (TxBody era)))
-&gt; TxBody era -&gt; Hash (HASH (Crypto era)) (HashIndex (TxBody era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; TxBodyConstraints era =&gt; TxBody era
forall era. Tx era -&gt; TxBodyConstraints era =&gt; TxBody era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">_body</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679267857"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>                </span><span class="annot"><span class="annottext">Delta era -&gt; Gen (Delta era)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Delta era -&gt; Gen (Delta era)) -&gt; Delta era -&gt; Gen (Delta era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-367"></span><span>                  </span><span class="annot"><span class="annottext">Delta era
</span><a href="#local-6989586621679267856"><span class="hs-identifier hs-var">delta</span></a></span><span>
</span><span id="line-368"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">extraWitnesses :: WitnessSet era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#extraWitnesses"><span class="hs-identifier hs-var">extraWitnesses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WitnessSet era
</span><a href="#local-6989586621679267853"><span class="hs-identifier hs-var">extraWitnesses</span></a></span><span> </span><span class="annot"><span class="annottext">WitnessSet era -&gt; WitnessSet era -&gt; WitnessSet era
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">WitnessSet era
</span><a href="#local-6989586621679267820"><span class="hs-identifier hs-var">newWits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-369"></span><span>                      </span><span class="annot"><span class="annottext">extraInputs :: Set (TxIn era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#extraInputs"><span class="hs-identifier hs-var">extraInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (TxIn era)
</span><a href="#local-6989586621679267854"><span class="hs-identifier hs-var">extraInputs</span></a></span><span> </span><span class="annot"><span class="annottext">Set (TxIn era) -&gt; Set (TxIn era) -&gt; Set (TxIn era)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TxIn era] -&gt; Set (TxIn era)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[TxIn era]
</span><a href="#local-6989586621679267826"><span class="hs-identifier hs-var">inputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-370"></span><span>                      </span><span class="annot"><span class="annottext">change :: TxOut era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#change"><span class="hs-identifier hs-var">change</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Value era -&gt; Value era) -&gt; TxOut era -&gt; TxOut era
</span><a href="#local-6989586621679267832"><span class="hs-identifier hs-var">deltaChange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value era -&gt; Value era -&gt; Value era
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679267825"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679267852"><span class="hs-identifier hs-var">change</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- &lt;+&gt; is plus of the Val class</span><span>
</span><span id="line-371"></span><span>                      </span><span class="annot"><span class="annottext">deltaVKeys :: [KeyPair 'Witness (Crypto era)]
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#deltaVKeys"><span class="hs-identifier hs-var">deltaVKeys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267824"><span class="hs-identifier hs-var">vkeyPairs</span></a></span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
-&gt; [KeyPair 'Witness (Crypto era)]
-&gt; [KeyPair 'Witness (Crypto era)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Delta era -&gt; [KeyPair 'Witness (Crypto era)]
forall era. Delta era -&gt; [KeyPair 'Witness (Crypto era)]
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#deltaVKeys"><span class="hs-identifier hs-var hs-var">deltaVKeys</span></a></span><span> </span><span class="annot"><span class="annottext">Delta era
</span><a href="#local-6989586621679267856"><span class="hs-identifier hs-var">delta</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-372"></span><span>                      </span><span class="annot"><span class="annottext">deltaScripts :: [(MultiSig era, MultiSig era)]
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#deltaScripts"><span class="hs-identifier hs-var">deltaScripts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(MultiSig era, MultiSig era)]
</span><a href="#local-6989586621679267823"><span class="hs-identifier hs-var">msigPairs</span></a></span><span> </span><span class="annot"><span class="annottext">[(MultiSig era, MultiSig era)]
-&gt; [(MultiSig era, MultiSig era)] -&gt; [(MultiSig era, MultiSig era)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Delta era -&gt; [(MultiSig era, MultiSig era)]
forall era. Delta era -&gt; [(MultiSig era, MultiSig era)]
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#deltaScripts"><span class="hs-identifier hs-var hs-var">deltaScripts</span></a></span><span> </span><span class="annot"><span class="annottext">Delta era
</span><a href="#local-6989586621679267856"><span class="hs-identifier hs-var">delta</span></a></span><span>
</span><span id="line-373"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-375"></span><span>      </span><span class="annot"><a href="#local-6989586621679267832"><span class="hs-identifier hs-type">deltaChange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Core.Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268126"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Core.Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268126"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268126"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268126"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-376"></span><span>      </span><span id="local-6989586621679267832"><span class="annot"><span class="annottext">deltaChange :: (Value era -&gt; Value era) -&gt; TxOut era -&gt; TxOut era
</span><a href="#local-6989586621679267832"><span class="hs-identifier hs-var hs-var">deltaChange</span></a></span></span><span> </span><span id="local-6989586621679267818"><span class="annot"><span class="annottext">Value era -&gt; Value era
</span><a href="#local-6989586621679267818"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span id="local-6989586621679267817"><span class="annot"><span class="annottext">Addr era
</span><a href="#local-6989586621679267817"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621679267816"><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679267816"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Addr era -&gt; Value era -&gt; TxOut era
forall era. ShelleyBased era =&gt; Addr era -&gt; Value era -&gt; TxOut era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">TxOut</span></a></span><span> </span><span class="annot"><span class="annottext">Addr era
</span><a href="#local-6989586621679267817"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">(Value era -&gt; TxOut era) -&gt; Value era -&gt; TxOut era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value era -&gt; Value era
</span><a href="#local-6989586621679267818"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679267816"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-377"></span><span>      </span><span id="local-6989586621679267836"><span class="annot"><span class="annottext">getChangeAmount :: TxOut era -&gt; Coin
</span><a href="#local-6989586621679267836"><span class="hs-identifier hs-var hs-var">getChangeAmount</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><span class="annottext">Addr era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679267815"><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679267815"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value era -&gt; Coin
forall t. Val t =&gt; t -&gt; Coin
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">coin</span></a></span><span> </span><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679267815"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="hs-comment">-- calculates fixed point of getNextDelta such that</span><span>
</span><span id="line-380"></span><span class="hs-comment">-- reqFees (tx + delta) = dfees delta</span><span>
</span><span id="line-381"></span><span class="hs-comment">-- start with zero delta</span><span>
</span><span id="line-382"></span><span class="hs-comment">-- genNextDelta repeatedly until genNextDelta delta = delta</span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span id="local-6989586621679268118"><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genNextDeltaTilFixPoint"><span class="hs-identifier hs-type">genNextDeltaTilFixPoint</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html#ShelleyTest"><span class="hs-identifier hs-type">ShelleyTest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268118"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.ConcreteCryptoTypes.html#Mock"><span class="hs-identifier hs-type">Mock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268118"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-386"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-387"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268118"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-388"></span><span>  </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html#MultiSigPairs"><span class="hs-identifier hs-type">MultiSigPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268118"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-389"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268118"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-390"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">PParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268118"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-391"></span><span>  </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#KeySpace"><span class="hs-identifier hs-type">KeySpace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268118"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-392"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268118"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-393"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268118"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-394"></span><span id="genNextDeltaTilFixPoint"><span class="annot"><span class="annottext">genNextDeltaTilFixPoint :: Coin
-&gt; KeyPairs (Crypto era)
-&gt; MultiSigPairs era
-&gt; UTxO era
-&gt; PParams era
-&gt; KeySpace era
-&gt; Tx era
-&gt; Gen (Delta era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genNextDeltaTilFixPoint"><span class="hs-identifier hs-var hs-var">genNextDeltaTilFixPoint</span></a></span></span><span> </span><span id="local-6989586621679267812"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267812"><span class="hs-identifier hs-var">initialfee</span></a></span></span><span> </span><span id="local-6989586621679267811"><span class="annot"><span class="annottext">KeyPairs (Crypto era)
</span><a href="#local-6989586621679267811"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span id="local-6989586621679267810"><span class="annot"><span class="annottext">MultiSigPairs era
</span><a href="#local-6989586621679267810"><span class="hs-identifier hs-var">scripts</span></a></span></span><span> </span><span id="local-6989586621679267809"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679267809"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621679267808"><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679267808"><span class="hs-identifier hs-var">pparams</span></a></span></span><span> </span><span id="local-6989586621679267807"><span class="annot"><span class="annottext">KeySpace era
</span><a href="#local-6989586621679267807"><span class="hs-identifier hs-var">keySpace</span></a></span></span><span> </span><span id="local-6989586621679267806"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679267806"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-395"></span><span>  </span><span id="local-6989586621679267805"><span class="annot"><span class="annottext">[Addr era]
</span><a href="#local-6989586621679267805"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; KeyPairs (Crypto era) -&gt; MultiSigPairs era -&gt; Gen [Addr era]
forall era.
Era era =&gt;
Int -&gt; KeyPairs (Crypto era) -&gt; MultiSigPairs era -&gt; Gen [Addr era]
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genRecipients"><span class="hs-identifier hs-var">genRecipients</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">KeyPairs (Crypto era)
</span><a href="#local-6989586621679267811"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSigPairs era
</span><a href="#local-6989586621679267810"><span class="hs-identifier hs-var">scripts</span></a></span><span>
</span><span id="line-396"></span><span>  </span><span class="annot"><span class="annottext">(Delta era -&gt; Gen (Delta era)) -&gt; Delta era -&gt; Gen (Delta era)
forall d (m :: * -&gt; *). (Eq d, Monad m) =&gt; (d -&gt; m d) -&gt; d -&gt; m d
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#fix"><span class="hs-identifier hs-var">fix</span></a></span><span>
</span><span id="line-397"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxO era
-&gt; PParams era
-&gt; KeySpace era
-&gt; Tx era
-&gt; Delta era
-&gt; Gen (Delta era)
forall era.
(ShelleyTest era, Mock (Crypto era)) =&gt;
UTxO era
-&gt; PParams era
-&gt; KeySpace era
-&gt; Tx era
-&gt; Delta era
-&gt; Gen (Delta era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genNextDelta"><span class="hs-identifier hs-var">genNextDelta</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679267809"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679267808"><span class="hs-identifier hs-var">pparams</span></a></span><span> </span><span class="annot"><span class="annottext">KeySpace era
</span><a href="#local-6989586621679267807"><span class="hs-identifier hs-var">keySpace</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679267806"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Addr era -&gt; Delta era
forall era.
ShelleyTest era =&gt;
Coin -&gt; Coin -&gt; Addr era -&gt; Delta era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#deltaZero"><span class="hs-identifier hs-var">deltaZero</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267812"><span class="hs-identifier hs-var">initialfee</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267803"><span class="hs-identifier hs-var">safetyOffset</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PParams era -&gt; HKD Identity Coin
forall (f :: * -&gt; *) era. PParams' f era -&gt; HKD f Coin
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var hs-var">_minUTxOValue</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679267808"><span class="hs-identifier hs-var">pparams</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Addr era] -&gt; Addr era
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Addr era]
</span><a href="#local-6989586621679267805"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-400"></span><span>    </span><span class="hs-comment">-- add a small offset here to ensure outputs above minUtxo value</span><span>
</span><span id="line-401"></span><span>    </span><span id="local-6989586621679267803"><span class="annot"><span class="annottext">safetyOffset :: Coin
</span><a href="#local-6989586621679267803"><span class="hs-identifier hs-var hs-var">safetyOffset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">5</span></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span id="local-6989586621679268117"><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#applyDelta"><span class="hs-identifier hs-type">applyDelta</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-404"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html#ShelleyTest"><span class="hs-identifier hs-type">ShelleyTest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268117"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.ConcreteCryptoTypes.html#Mock"><span class="hs-identifier hs-type">Mock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268117"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-405"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Witness</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268117"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-406"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268117"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268117"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-407"></span><span>  </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#KeySpace"><span class="hs-identifier hs-type">KeySpace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268117"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-408"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268117"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-409"></span><span>  </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268117"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-410"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268117"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-411"></span><span id="applyDelta"><span class="annot"><span class="annottext">applyDelta :: [KeyPair 'Witness (Crypto era)]
-&gt; Map (ScriptHash era) (MultiSig era)
-&gt; KeySpace era
-&gt; Tx era
-&gt; Delta era
-&gt; Tx era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#applyDelta"><span class="hs-identifier hs-var hs-var">applyDelta</span></a></span></span><span>
</span><span id="line-412"></span><span>  </span><span id="local-6989586621679267800"><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267800"><span class="hs-identifier hs-var">neededKeys</span></a></span></span><span>
</span><span id="line-413"></span><span>  </span><span id="local-6989586621679267799"><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era)
</span><a href="#local-6989586621679267799"><span class="hs-identifier hs-var">neededScripts</span></a></span></span><span>
</span><span id="line-414"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#KeySpace_"><span class="hs-identifier hs-type">KeySpace_</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679267798"><span class="annot"><span class="annottext">Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
ksIndexedPaymentKeys :: Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
ksIndexedPaymentKeys :: forall era.
KeySpace era
-&gt; Map
     (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
</span><a href="#local-6989586621679267798"><span class="hs-identifier hs-var hs-var">ksIndexedPaymentKeys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267797"><span class="annot"><span class="annottext">Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
ksIndexedStakingKeys :: Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
ksIndexedStakingKeys :: forall era.
KeySpace era
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
</span><a href="#local-6989586621679267797"><span class="hs-identifier hs-var hs-var">ksIndexedStakingKeys</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>  </span><span id="local-6989586621679267796"><span class="annot"><span class="annottext">tx :: Tx era
</span><a href="#local-6989586621679267796"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span id="local-6989586621679267795"><span class="annot"><span class="annottext">body :: TxBody era
</span><a href="#local-6989586621679267795"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">TxBody</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679267793"><span class="annot"><a href="#local-6989586621679267793"><span class="hs-identifier hs-var hs-var">_inputs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267792"><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var hs-var">_outputs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267790"><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var hs-var">_txfee</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679267788"><span class="annot"><span class="annottext">WitnessSet era
</span><a href="#local-6989586621679267788"><span class="hs-identifier hs-var">_wits</span></a></span></span><span> </span><span id="local-6989586621679267787"><span class="annot"><span class="annottext">StrictMaybe MetaData
</span><a href="#local-6989586621679267787"><span class="hs-identifier hs-var">_md</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#Delta"><span class="hs-identifier hs-type">Delta</span></a></span><span> </span><span id="local-6989586621679267786"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267786"><span class="hs-identifier hs-var">deltafees</span></a></span></span><span> </span><span id="local-6989586621679267785"><span class="annot"><span class="annottext">Set (TxIn era)
</span><a href="#local-6989586621679267785"><span class="hs-identifier hs-var">extraIn</span></a></span></span><span> </span><span id="local-6989586621679267784"><span class="annot"><span class="annottext">WitnessSet era
</span><a href="#local-6989586621679267784"><span class="hs-identifier hs-var">_extraWits</span></a></span></span><span> </span><span id="local-6989586621679267783"><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679267783"><span class="hs-identifier hs-var">change</span></a></span></span><span> </span><span id="local-6989586621679267782"><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267782"><span class="hs-identifier hs-var">extraKeys</span></a></span></span><span> </span><span id="local-6989586621679267781"><span class="annot"><span class="annottext">[(MultiSig era, MultiSig era)]
</span><a href="#local-6989586621679267781"><span class="hs-identifier hs-var">extraScripts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-comment">--fix up the witnesses here?</span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-comment">-- Adds extraInputs, extraWitnesses, and change from delta to tx</span><span>
</span><span id="line-419"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679267780"><span class="annot"><span class="annottext">outputs' :: StrictSeq (TxOut era)
</span><a href="#local-6989586621679267780"><span class="hs-identifier hs-var hs-var">outputs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StrictSeq (TxOut era)
</span><a href="#local-6989586621679267792"><span class="hs-identifier hs-var">_outputs</span></a></span><span> </span><span class="annot"><span class="annottext">StrictSeq (TxOut era) -&gt; TxOut era -&gt; StrictSeq (TxOut era)
forall a. StrictSeq a -&gt; a -&gt; StrictSeq a
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src"><span class="hs-operator hs-var">StrictSeq.|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679267783"><span class="hs-identifier hs-var">change</span></a></span><span>
</span><span id="line-420"></span><span>        </span><span id="local-6989586621679267778"><span class="annot"><span class="annottext">body' :: TxBody era
</span><a href="#local-6989586621679267778"><span class="hs-identifier hs-var hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-421"></span><span>          </span><span class="annot"><span class="annottext">TxBody era
TxBody era
</span><a href="#local-6989586621679267795"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-422"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_txfee :: Coin
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">_txfee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267786"><span class="hs-identifier hs-var">deltafees</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-423"></span><span>              </span><span class="annot"><span class="annottext">_inputs :: Set (TxIn era)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">_inputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (TxIn era)
</span><a href="#local-6989586621679267793"><span class="hs-identifier hs-var">_inputs</span></a></span><span> </span><span class="annot"><span class="annottext">Set (TxIn era) -&gt; Set (TxIn era) -&gt; Set (TxIn era)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set (TxIn era)
</span><a href="#local-6989586621679267785"><span class="hs-identifier hs-var">extraIn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-424"></span><span>              </span><span class="annot"><span class="annottext">_outputs :: StrictSeq (TxOut era)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">_outputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StrictSeq (TxOut era)
</span><a href="#local-6989586621679267780"><span class="hs-identifier hs-var">outputs'</span></a></span><span>
</span><span id="line-425"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-426"></span><span>        </span><span id="local-6989586621679267777"><span class="annot"><span class="annottext">kw :: [KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267777"><span class="hs-identifier hs-var hs-var">kw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267800"><span class="hs-identifier hs-var">neededKeys</span></a></span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
-&gt; [KeyPair 'Witness (Crypto era)]
-&gt; [KeyPair 'Witness (Crypto era)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267782"><span class="hs-identifier hs-var">extraKeys</span></a></span><span>
</span><span id="line-427"></span><span>        </span><span id="local-6989586621679267776"><span class="annot"><span class="annottext">sw :: Map (ScriptHash era) (MultiSig era)
</span><a href="#local-6989586621679267776"><span class="hs-identifier hs-var hs-var">sw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era)
</span><a href="#local-6989586621679267799"><span class="hs-identifier hs-var">neededScripts</span></a></span><span> </span><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era)
-&gt; Map (ScriptHash era) (MultiSig era)
-&gt; Map (ScriptHash era) (MultiSig era)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(MultiSig era, MultiSig era)]
-&gt; [(MultiSig era, MultiSig era)]
-&gt; Map (ScriptHash era) (MultiSig era)
forall era.
TxBodyConstraints era =&gt;
[(MultiSig era, MultiSig era)]
-&gt; [(MultiSig era, MultiSig era)]
-&gt; Map (ScriptHash era) (MultiSig era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#mkScriptWits"><span class="hs-identifier hs-var">mkScriptWits</span></a></span><span> </span><span class="annot"><span class="annottext">[(MultiSig era, MultiSig era)]
</span><a href="#local-6989586621679267781"><span class="hs-identifier hs-var">extraScripts</span></a></span><span> </span><span class="annot"><span class="annottext">[(MultiSig era, MultiSig era)]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-428"></span><span>        </span><span id="local-6989586621679267775"><span class="annot"><span class="annottext">newWitnessSet :: WitnessSet era
</span><a href="#local-6989586621679267775"><span class="hs-identifier hs-var hs-var">newWitnessSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-429"></span><span>          </span><span class="annot"><span class="annottext">Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; [KeyPair 'Witness (Crypto era)]
-&gt; Map (ScriptHash era) (MultiSig era)
-&gt; Hash (Crypto era) EraIndependentTxBody
-&gt; WitnessSet era
forall era.
(Era era, Mock (Crypto era), AnnotatedData (Script era),
 Script era ~ MultiSig era) =&gt;
Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; [KeyPair 'Witness (Crypto era)]
-&gt; Map (ScriptHash era) (MultiSig era)
-&gt; Hash (Crypto era) EraIndependentTxBody
-&gt; WitnessSet era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#mkTxWits"><span class="hs-identifier hs-var">mkTxWits</span></a></span><span>
</span><span id="line-430"></span><span>            </span><span class="annot"><span class="annottext">Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
</span><a href="#local-6989586621679267798"><span class="hs-identifier hs-var">ksIndexedPaymentKeys</span></a></span><span>
</span><span id="line-431"></span><span>            </span><span class="annot"><span class="annottext">Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
</span><a href="#local-6989586621679267797"><span class="hs-identifier hs-var">ksIndexedStakingKeys</span></a></span><span>
</span><span id="line-432"></span><span>            </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267777"><span class="hs-identifier hs-var">kw</span></a></span><span>
</span><span id="line-433"></span><span>            </span><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era)
</span><a href="#local-6989586621679267776"><span class="hs-identifier hs-var">sw</span></a></span><span>
</span><span id="line-434"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBody era -&gt; Hash (HASH (Crypto era)) (HashIndex (TxBody era))
forall a e.
HashAnnotated a e =&gt;
a -&gt; Hash (HASH (Crypto e)) (HashIndex a)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">hashAnnotated</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679267778"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679267796"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">_body :: TxBody era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxBody era
TxBody era
</span><a href="#local-6989586621679267778"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_witnessSet :: WitnessSet era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">_witnessSet</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WitnessSet era
</span><a href="#local-6989586621679267775"><span class="hs-identifier hs-var">newWitnessSet</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span id="local-6989586621679268127"><span id="local-6989586621679268128"><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#fix"><span class="hs-identifier hs-type">fix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679268128"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679268127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679268128"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268127"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268128"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268128"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679268127"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268128"><span class="hs-identifier hs-type">d</span></a></span></span></span><span>
</span><span id="line-438"></span><span id="fix"><span class="annot"><span class="annottext">fix :: (d -&gt; m d) -&gt; d -&gt; m d
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#fix"><span class="hs-identifier hs-var hs-var">fix</span></a></span></span><span> </span><span id="local-6989586621679267773"><span class="annot"><span class="annottext">d -&gt; m d
</span><a href="#local-6989586621679267773"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679267772"><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621679267772"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679267771"><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621679267771"><span class="hs-identifier hs-var">d1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">d -&gt; m d
</span><a href="#local-6989586621679267773"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621679267772"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621679267771"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="annot"><span class="annottext">d -&gt; d -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621679267772"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">d -&gt; m d
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621679267772"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(d -&gt; m d) -&gt; d -&gt; m d
forall d (m :: * -&gt; *). (Eq d, Monad m) =&gt; (d -&gt; m d) -&gt; d -&gt; m d
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#fix"><span class="hs-identifier hs-var">fix</span></a></span><span> </span><span class="annot"><span class="annottext">d -&gt; m d
</span><a href="#local-6989586621679267773"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621679267771"><span class="hs-identifier hs-var">d1</span></a></span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span id="local-6989586621679268181"><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#converge"><span class="hs-identifier hs-type">converge</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html#ShelleyTest"><span class="hs-identifier hs-type">ShelleyTest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268181"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.ConcreteCryptoTypes.html#Mock"><span class="hs-identifier hs-type">Mock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268181"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-442"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Witness</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268181"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-444"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268181"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268181"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-445"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268181"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-446"></span><span>  </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html#MultiSigPairs"><span class="hs-identifier hs-type">MultiSigPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268181"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-447"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268181"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-448"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">PParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268181"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-449"></span><span>  </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#KeySpace"><span class="hs-identifier hs-type">KeySpace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268181"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-450"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268181"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-451"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268181"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-452"></span><span id="converge"><span class="annot"><span class="annottext">converge :: Coin
-&gt; [KeyPair 'Witness (Crypto era)]
-&gt; Map (ScriptHash era) (MultiSig era)
-&gt; KeyPairs (Crypto era)
-&gt; MultiSigPairs era
-&gt; UTxO era
-&gt; PParams era
-&gt; KeySpace era
-&gt; Tx era
-&gt; Gen (Tx era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#converge"><span class="hs-identifier hs-var hs-var">converge</span></a></span></span><span> </span><span id="local-6989586621679267770"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267770"><span class="hs-identifier hs-var">initialfee</span></a></span></span><span> </span><span id="local-6989586621679267769"><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267769"><span class="hs-identifier hs-var">neededKeys</span></a></span></span><span> </span><span id="local-6989586621679267768"><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era)
</span><a href="#local-6989586621679267768"><span class="hs-identifier hs-var">neededScripts</span></a></span></span><span> </span><span id="local-6989586621679267767"><span class="annot"><span class="annottext">KeyPairs (Crypto era)
</span><a href="#local-6989586621679267767"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span id="local-6989586621679267766"><span class="annot"><span class="annottext">MultiSigPairs era
</span><a href="#local-6989586621679267766"><span class="hs-identifier hs-var">scripts</span></a></span></span><span> </span><span id="local-6989586621679267765"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679267765"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621679267764"><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679267764"><span class="hs-identifier hs-var">pparams</span></a></span></span><span> </span><span id="local-6989586621679267763"><span class="annot"><span class="annottext">KeySpace era
</span><a href="#local-6989586621679267763"><span class="hs-identifier hs-var">keySpace</span></a></span></span><span> </span><span id="local-6989586621679267762"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679267762"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-453"></span><span>  </span><span id="local-6989586621679267761"><span class="annot"><span class="annottext">Delta era
</span><a href="#local-6989586621679267761"><span class="hs-identifier hs-var">delta</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coin
-&gt; KeyPairs (Crypto era)
-&gt; MultiSigPairs era
-&gt; UTxO era
-&gt; PParams era
-&gt; KeySpace era
-&gt; Tx era
-&gt; Gen (Delta era)
forall era.
(ShelleyTest era, Mock (Crypto era)) =&gt;
Coin
-&gt; KeyPairs (Crypto era)
-&gt; MultiSigPairs era
-&gt; UTxO era
-&gt; PParams era
-&gt; KeySpace era
-&gt; Tx era
-&gt; Gen (Delta era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genNextDeltaTilFixPoint"><span class="hs-identifier hs-var">genNextDeltaTilFixPoint</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267770"><span class="hs-identifier hs-var">initialfee</span></a></span><span> </span><span class="annot"><span class="annottext">KeyPairs (Crypto era)
</span><a href="#local-6989586621679267767"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSigPairs era
</span><a href="#local-6989586621679267766"><span class="hs-identifier hs-var">scripts</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679267765"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679267764"><span class="hs-identifier hs-var">pparams</span></a></span><span> </span><span class="annot"><span class="annottext">KeySpace era
</span><a href="#local-6989586621679267763"><span class="hs-identifier hs-var">keySpace</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679267762"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-454"></span><span>  </span><span class="annot"><span class="annottext">Tx era -&gt; Gen (Tx era)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
-&gt; Map (ScriptHash era) (MultiSig era)
-&gt; KeySpace era
-&gt; Tx era
-&gt; Delta era
-&gt; Tx era
forall era.
(ShelleyTest era, Mock (Crypto era)) =&gt;
[KeyPair 'Witness (Crypto era)]
-&gt; Map (ScriptHash era) (MultiSig era)
-&gt; KeySpace era
-&gt; Tx era
-&gt; Delta era
-&gt; Tx era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#applyDelta"><span class="hs-identifier hs-var">applyDelta</span></a></span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267769"><span class="hs-identifier hs-var">neededKeys</span></a></span><span> </span><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era)
</span><a href="#local-6989586621679267768"><span class="hs-identifier hs-var">neededScripts</span></a></span><span> </span><span class="annot"><span class="annottext">KeySpace era
</span><a href="#local-6989586621679267763"><span class="hs-identifier hs-var">keySpace</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679267762"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Delta era
</span><a href="#local-6989586621679267761"><span class="hs-identifier hs-var">delta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span class="hs-comment">-- ======================================================</span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span class="hs-comment">-- | Return up to /k/ random elements from /items/</span><span>
</span><span id="line-459"></span><span class="hs-comment">-- (instead of the less efficient /take k &lt;$&gt; QC.shuffle items/)</span><span>
</span><span id="line-460"></span><span id="local-6989586621679268064"><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#ruffle"><span class="hs-identifier hs-type">ruffle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679268064"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679268064"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-461"></span><span id="ruffle"><span class="annot"><span class="annottext">ruffle :: Int -&gt; [a] -&gt; Gen [a]
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#ruffle"><span class="hs-identifier hs-var hs-var">ruffle</span></a></span></span><span> </span><span id="local-6989586621679267759"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267759"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679267758"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679267758"><span class="hs-identifier hs-var">items</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-462"></span><span>  </span><span id="local-6989586621679267757"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679267757"><span class="hs-identifier hs-var">indices</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">nub</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; Gen [Int] -&gt; Gen [Int]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Gen Int -&gt; Gen [Int]
forall a. Int -&gt; Gen a -&gt; Gen [a]
</span><span class="hs-identifier hs-var">QC.vectorOf</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267759"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Gen Int
</span><a href="#local-6989586621679267755"><span class="hs-identifier hs-var">pickIndex</span></a></span><span>
</span><span id="line-463"></span><span>  </span><span class="annot"><span class="annottext">[a] -&gt; Gen [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">([a] -&gt; Gen [a]) -&gt; [a] -&gt; Gen [a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; a) -&gt; [Int] -&gt; [a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679267758"><span class="hs-identifier hs-var">items</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Int -&gt; a
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679267757"><span class="hs-identifier hs-var">indices</span></a></span><span>
</span><span id="line-464"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-465"></span><span>    </span><span id="local-6989586621679267755"><span class="annot"><span class="annottext">pickIndex :: Gen Int
</span><a href="#local-6989586621679267755"><span class="hs-identifier hs-var hs-var">pickIndex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Gen Int
forall a. Random a =&gt; (a, a) -&gt; Gen a
</span><span class="hs-identifier hs-var">QC.choose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679267758"><span class="hs-identifier hs-var">items</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genTimeToLive"><span class="hs-identifier hs-type">genTimeToLive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span>
</span><span id="line-468"></span><span id="genTimeToLive"><span class="annot"><span class="annottext">genTimeToLive :: SlotNo -&gt; Gen SlotNo
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genTimeToLive"><span class="hs-identifier hs-var hs-var">genTimeToLive</span></a></span></span><span> </span><span id="local-6989586621679267752"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679267752"><span class="hs-identifier hs-var">currentSlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-469"></span><span>  </span><span id="local-6989586621679267751"><span class="annot"><span class="annottext">Ix
</span><a href="#local-6989586621679267751"><span class="hs-identifier hs-var">ttl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ix -&gt; Ix -&gt; Gen Ix
</span><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#genNatural"><span class="hs-identifier hs-var">genNatural</span></a></span><span> </span><span class="annot"><span class="annottext">Ix
</span><span class="hs-number">50</span></span><span> </span><span class="annot"><span class="annottext">Ix
</span><span class="hs-number">100</span></span><span>
</span><span id="line-470"></span><span>  </span><span class="annot"><span class="annottext">SlotNo -&gt; Gen SlotNo
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SlotNo -&gt; Gen SlotNo) -&gt; SlotNo -&gt; Gen SlotNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679267752"><span class="hs-identifier hs-var">currentSlot</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; SlotNo
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SlotNo
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src"><span class="hs-identifier hs-var">SlotNo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ix -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Ix
</span><a href="#local-6989586621679267751"><span class="hs-identifier hs-var">ttl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#mkScriptWits"><span class="hs-identifier hs-type">mkScriptWits</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679268224"><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-474"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Shelley.TxBodyConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-475"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-476"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-477"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span id="mkScriptWits"><span class="annot"><span class="annottext">mkScriptWits :: [(MultiSig era, MultiSig era)]
-&gt; [(MultiSig era, MultiSig era)]
-&gt; Map (ScriptHash era) (MultiSig era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#mkScriptWits"><span class="hs-identifier hs-var hs-var">mkScriptWits</span></a></span></span><span> </span><span id="local-6989586621679267749"><span class="annot"><span class="annottext">[(MultiSig era, MultiSig era)]
</span><a href="#local-6989586621679267749"><span class="hs-identifier hs-var">payScripts</span></a></span></span><span> </span><span id="local-6989586621679267748"><span class="annot"><span class="annottext">[(MultiSig era, MultiSig era)]
</span><a href="#local-6989586621679267748"><span class="hs-identifier hs-var">stakeScripts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-479"></span><span>  </span><span class="annot"><span class="annottext">[(ScriptHash era, MultiSig era)]
-&gt; Map (ScriptHash era) (MultiSig era)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(ScriptHash era, MultiSig era)]
 -&gt; Map (ScriptHash era) (MultiSig era))
-&gt; [(ScriptHash era, MultiSig era)]
-&gt; Map (ScriptHash era) (MultiSig era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-480"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(MultiSig era, MultiSig era) -&gt; (ScriptHash era, MultiSig era)
</span><a href="#local-6989586621679267746"><span class="hs-identifier hs-var">hashPayScript</span></a></span><span> </span><span class="annot"><span class="annottext">((MultiSig era, MultiSig era) -&gt; (ScriptHash era, MultiSig era))
-&gt; [(MultiSig era, MultiSig era)]
-&gt; [(ScriptHash era, MultiSig era)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(MultiSig era, MultiSig era)]
</span><a href="#local-6989586621679267749"><span class="hs-identifier hs-var">payScripts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>      </span><span class="annot"><span class="annottext">[(ScriptHash era, MultiSig era)]
-&gt; [(ScriptHash era, MultiSig era)]
-&gt; [(ScriptHash era, MultiSig era)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(MultiSig era, MultiSig era) -&gt; (ScriptHash era, MultiSig era)
</span><a href="#local-6989586621679267745"><span class="hs-identifier hs-var">hashStakeScript</span></a></span><span> </span><span class="annot"><span class="annottext">((MultiSig era, MultiSig era) -&gt; (ScriptHash era, MultiSig era))
-&gt; [(MultiSig era, MultiSig era)]
-&gt; [(ScriptHash era, MultiSig era)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(MultiSig era, MultiSig era)]
</span><a href="#local-6989586621679267748"><span class="hs-identifier hs-var">stakeScripts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-483"></span><span>    </span><span class="annot"><a href="#local-6989586621679267746"><span class="hs-identifier hs-type">hashPayScript</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>    </span><span id="local-6989586621679267746"><span class="annot"><span class="annottext">hashPayScript :: (MultiSig era, MultiSig era) -&gt; (ScriptHash era, MultiSig era)
</span><a href="#local-6989586621679267746"><span class="hs-identifier hs-var hs-var">hashPayScript</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679267744"><span class="annot"><span class="annottext">MultiSig era
</span><a href="#local-6989586621679267744"><span class="hs-identifier hs-var">payScript</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MultiSig era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-485"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">MultiSig era -&gt; ScriptHash era
forall era. Era era =&gt; MultiSig era -&gt; ScriptHash era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">hashMultiSigScript</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSig era
</span><a href="#local-6989586621679267744"><span class="hs-identifier hs-var">payScript</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MultiSig era
</span><a href="#local-6989586621679267744"><span class="hs-identifier hs-var">payScript</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>    </span><span class="annot"><a href="#local-6989586621679267745"><span class="hs-identifier hs-type">hashStakeScript</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>    </span><span id="local-6989586621679267745"><span class="annot"><span class="annottext">hashStakeScript :: (MultiSig era, MultiSig era) -&gt; (ScriptHash era, MultiSig era)
</span><a href="#local-6989586621679267745"><span class="hs-identifier hs-var hs-var">hashStakeScript</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MultiSig era
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267743"><span class="annot"><span class="annottext">MultiSig era
</span><a href="#local-6989586621679267743"><span class="hs-identifier hs-var">sScript</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-488"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">MultiSig era -&gt; ScriptHash era
forall era. Era era =&gt; MultiSig era -&gt; ScriptHash era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">hashMultiSigScript</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSig era
</span><a href="#local-6989586621679267743"><span class="hs-identifier hs-var">sScript</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268224"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MultiSig era
</span><a href="#local-6989586621679267743"><span class="hs-identifier hs-var">sScript</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span id="local-6989586621679268218"><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#mkTxWits"><span class="hs-identifier hs-type">mkTxWits</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-491"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268218"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-492"></span><span>    </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.ConcreteCryptoTypes.html#Mock"><span class="hs-identifier hs-type">Mock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268218"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-493"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Core.AnnotatedData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Core.Script</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268218"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-494"></span><span>    </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Core.Script</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268218"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268218"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-496"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268218"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268218"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-497"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268218"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268218"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-498"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Witness</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268218"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-499"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268218"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268218"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-500"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Hash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268218"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">EraIndependentTxBody</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-501"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">WitnessSet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268218"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-502"></span><span id="mkTxWits"><span class="annot"><span class="annottext">mkTxWits :: Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; [KeyPair 'Witness (Crypto era)]
-&gt; Map (ScriptHash era) (MultiSig era)
-&gt; Hash (Crypto era) EraIndependentTxBody
-&gt; WitnessSet era
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#mkTxWits"><span class="hs-identifier hs-var hs-var">mkTxWits</span></a></span></span><span>
</span><span id="line-503"></span><span>  </span><span id="local-6989586621679267742"><span class="annot"><span class="annottext">Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
</span><a href="#local-6989586621679267742"><span class="hs-identifier hs-var">indexedPaymentKeys</span></a></span></span><span>
</span><span id="line-504"></span><span>  </span><span id="local-6989586621679267741"><span class="annot"><span class="annottext">Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
</span><a href="#local-6989586621679267741"><span class="hs-identifier hs-var">indexedStakingKeys</span></a></span></span><span>
</span><span id="line-505"></span><span>  </span><span id="local-6989586621679267740"><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267740"><span class="hs-identifier hs-var">awits</span></a></span></span><span>
</span><span id="line-506"></span><span>  </span><span id="local-6989586621679267739"><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era)
</span><a href="#local-6989586621679267739"><span class="hs-identifier hs-var">msigs</span></a></span></span><span>
</span><span id="line-507"></span><span>  </span><span id="local-6989586621679267738"><span class="annot"><span class="annottext">Hash (Crypto era) EraIndependentTxBody
</span><a href="#local-6989586621679267738"><span class="hs-identifier hs-var">txBodyHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-508"></span><span>    </span><span class="annot"><span class="annottext">WitnessSet :: forall era.
(Era era, AnnotatedData (Script era)) =&gt;
Set (WitVKey 'Witness era)
-&gt; Map (ScriptHash era) (Script era)
-&gt; Set (BootstrapWitness era)
-&gt; WitnessSet era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">WitnessSet</span></a></span><span>
</span><span id="line-509"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">addrWits :: Set (WitVKey 'Witness era)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">addrWits</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-510"></span><span>          </span><span class="annot"><span class="annottext">Hash (Crypto era) EraIndependentTxBody
-&gt; [KeyPair 'Witness (Crypto era)] -&gt; Set (WitVKey 'Witness era)
forall era (kr :: KeyRole).
(Era era,
 DSignable (Crypto era) (Hash (Crypto era) EraIndependentTxBody)) =&gt;
Hash (Crypto era) EraIndependentTxBody
-&gt; [KeyPair kr (Crypto era)] -&gt; Set (WitVKey 'Witness era)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">makeWitnessesVKey</span></a></span><span> </span><span class="annot"><span class="annottext">Hash (Crypto era) EraIndependentTxBody
</span><a href="#local-6989586621679267738"><span class="hs-identifier hs-var">txBodyHash</span></a></span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness (Crypto era)]
</span><a href="#local-6989586621679267740"><span class="hs-identifier hs-var">awits</span></a></span><span>
</span><span id="line-511"></span><span>            </span><span class="annot"><span class="annottext">Set (WitVKey 'Witness era)
-&gt; Set (WitVKey 'Witness era) -&gt; Set (WitVKey 'Witness era)
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`Set.union`</span></span><span> </span><span class="annot"><span class="annottext">Hash (Crypto era) EraIndependentTxBody
-&gt; Map
     (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era))
-&gt; Set (KeyHash 'Witness (Crypto era))
-&gt; Set (WitVKey 'Witness era)
forall era (kr :: KeyRole).
(Era era,
 DSignable (Crypto era) (Hash (Crypto era) EraIndependentTxBody)) =&gt;
Hash (Crypto era) EraIndependentTxBody
-&gt; Map (KeyHash kr (Crypto era)) (KeyPair kr (Crypto era))
-&gt; Set (KeyHash kr (Crypto era))
-&gt; Set (WitVKey 'Witness era)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">makeWitnessesFromScriptKeys</span></a></span><span>
</span><span id="line-512"></span><span>              </span><span class="annot"><span class="annottext">Hash (Crypto era) EraIndependentTxBody
</span><a href="#local-6989586621679267738"><span class="hs-identifier hs-var">txBodyHash</span></a></span><span>
</span><span id="line-513"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era))
</span><a href="#local-6989586621679267734"><span class="hs-identifier hs-var">indexedPaymentKeysAsWitnesses</span></a></span><span>
</span><span id="line-514"></span><span>                  </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era))
-&gt; Map
     (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era))
-&gt; Map
     (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era))
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-operator hs-var">`Map.union`</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era))
</span><a href="#local-6989586621679267732"><span class="hs-identifier hs-var">indexedStakingKeysAsWitnesses</span></a></span><span>
</span><span id="line-515"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>              </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness (Crypto era))
</span><a href="#local-6989586621679267731"><span class="hs-identifier hs-var">msigSignatures</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-517"></span><span>        </span><span class="annot"><span class="annottext">scriptWits :: Map (ScriptHash era) (Script era)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">scriptWits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era)
Map (ScriptHash era) (Script era)
</span><a href="#local-6989586621679267739"><span class="hs-identifier hs-var">msigs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-518"></span><span>        </span><span class="annot"><span class="annottext">bootWits :: Set (BootstrapWitness era)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">bootWits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (BootstrapWitness era)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-519"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-520"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-521"></span><span>      </span><span id="local-6989586621679267734"><span class="annot"><span class="annottext">indexedPaymentKeysAsWitnesses :: Map (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era))
</span><a href="#local-6989586621679267734"><span class="hs-identifier hs-var hs-var">indexedPaymentKeysAsWitnesses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-522"></span><span>        </span><span class="annot"><span class="annottext">[(KeyHash 'Witness (Crypto era), KeyPair 'Witness (Crypto era))]
-&gt; Map
     (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era))
forall k a. Eq k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromAscList</span></span><span>
</span><span id="line-523"></span><span>          </span><span class="annot"><span class="annottext">([(KeyHash 'Witness (Crypto era), KeyPair 'Witness (Crypto era))]
 -&gt; Map
      (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era)))
-&gt; (Map
      (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
    -&gt; [(KeyHash 'Witness (Crypto era),
         KeyPair 'Witness (Crypto era))])
-&gt; Map
     (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; Map
     (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((KeyHash 'Payment (Crypto era), KeyPair 'Payment (Crypto era))
 -&gt; (KeyHash 'Witness (Crypto era), KeyPair 'Witness (Crypto era)))
-&gt; [(KeyHash 'Payment (Crypto era), KeyPair 'Payment (Crypto era))]
-&gt; [(KeyHash 'Witness (Crypto era), KeyPair 'Witness (Crypto era))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679267727"><span class="annot"><span class="annottext">KeyHash 'Payment (Crypto era)
</span><a href="#local-6989586621679267727"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267726"><span class="annot"><span class="annottext">KeyPair 'Payment (Crypto era)
</span><a href="#local-6989586621679267726"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyHash 'Payment (Crypto era) -&gt; KeyHash 'Witness (Crypto era)
forall (a :: KeyRole -&gt; * -&gt; *) (r :: KeyRole) crypto.
HasKeyRole a =&gt;
a r crypto -&gt; a 'Witness crypto
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">asWitness</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'Payment (Crypto era)
</span><a href="#local-6989586621679267727"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">KeyPair 'Payment (Crypto era) -&gt; KeyPair 'Witness (Crypto era)
forall (a :: KeyRole -&gt; * -&gt; *) (r :: KeyRole) crypto.
HasKeyRole a =&gt;
a r crypto -&gt; a 'Witness crypto
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">asWitness</span></a></span><span> </span><span class="annot"><span class="annottext">KeyPair 'Payment (Crypto era)
</span><a href="#local-6989586621679267726"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>          </span><span class="annot"><span class="annottext">([(KeyHash 'Payment (Crypto era), KeyPair 'Payment (Crypto era))]
 -&gt; [(KeyHash 'Witness (Crypto era),
      KeyPair 'Witness (Crypto era))])
-&gt; (Map
      (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
    -&gt; [(KeyHash 'Payment (Crypto era),
         KeyPair 'Payment (Crypto era))])
-&gt; Map
     (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; [(KeyHash 'Witness (Crypto era), KeyPair 'Witness (Crypto era))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; [(KeyHash 'Payment (Crypto era), KeyPair 'Payment (Crypto era))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toAscList</span></span><span>
</span><span id="line-525"></span><span>          </span><span class="annot"><span class="annottext">(Map
   (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
 -&gt; Map
      (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era)))
-&gt; Map
     (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; Map
     (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
</span><a href="#local-6989586621679267742"><span class="hs-identifier hs-var">indexedPaymentKeys</span></a></span><span>
</span><span id="line-526"></span><span>      </span><span id="local-6989586621679267732"><span class="annot"><span class="annottext">indexedStakingKeysAsWitnesses :: Map (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era))
</span><a href="#local-6989586621679267732"><span class="hs-identifier hs-var hs-var">indexedStakingKeysAsWitnesses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-527"></span><span>        </span><span class="annot"><span class="annottext">[(KeyHash 'Witness (Crypto era), KeyPair 'Witness (Crypto era))]
-&gt; Map
     (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era))
forall k a. Eq k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromAscList</span></span><span>
</span><span id="line-528"></span><span>          </span><span class="annot"><span class="annottext">([(KeyHash 'Witness (Crypto era), KeyPair 'Witness (Crypto era))]
 -&gt; Map
      (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era)))
-&gt; (Map
      (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
    -&gt; [(KeyHash 'Witness (Crypto era),
         KeyPair 'Witness (Crypto era))])
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; Map
     (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((KeyHash 'Staking (Crypto era), KeyPair 'Staking (Crypto era))
 -&gt; (KeyHash 'Witness (Crypto era), KeyPair 'Witness (Crypto era)))
-&gt; [(KeyHash 'Staking (Crypto era), KeyPair 'Staking (Crypto era))]
-&gt; [(KeyHash 'Witness (Crypto era), KeyPair 'Witness (Crypto era))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679267724"><span class="annot"><span class="annottext">KeyHash 'Staking (Crypto era)
</span><a href="#local-6989586621679267724"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267723"><span class="annot"><span class="annottext">KeyPair 'Staking (Crypto era)
</span><a href="#local-6989586621679267723"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyHash 'Staking (Crypto era) -&gt; KeyHash 'Witness (Crypto era)
forall (a :: KeyRole -&gt; * -&gt; *) (r :: KeyRole) crypto.
HasKeyRole a =&gt;
a r crypto -&gt; a 'Witness crypto
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">asWitness</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'Staking (Crypto era)
</span><a href="#local-6989586621679267724"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">KeyPair 'Staking (Crypto era) -&gt; KeyPair 'Witness (Crypto era)
forall (a :: KeyRole -&gt; * -&gt; *) (r :: KeyRole) crypto.
HasKeyRole a =&gt;
a r crypto -&gt; a 'Witness crypto
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">asWitness</span></a></span><span> </span><span class="annot"><span class="annottext">KeyPair 'Staking (Crypto era)
</span><a href="#local-6989586621679267723"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>          </span><span class="annot"><span class="annottext">([(KeyHash 'Staking (Crypto era), KeyPair 'Staking (Crypto era))]
 -&gt; [(KeyHash 'Witness (Crypto era),
      KeyPair 'Witness (Crypto era))])
-&gt; (Map
      (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
    -&gt; [(KeyHash 'Staking (Crypto era),
         KeyPair 'Staking (Crypto era))])
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; [(KeyHash 'Witness (Crypto era), KeyPair 'Witness (Crypto era))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; [(KeyHash 'Staking (Crypto era), KeyPair 'Staking (Crypto era))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toAscList</span></span><span>
</span><span id="line-530"></span><span>          </span><span class="annot"><span class="annottext">(Map
   (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
 -&gt; Map
      (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era)))
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; Map
     (KeyHash 'Witness (Crypto era)) (KeyPair 'Witness (Crypto era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
</span><a href="#local-6989586621679267741"><span class="hs-identifier hs-var">indexedStakingKeys</span></a></span><span>
</span><span id="line-531"></span><span>      </span><span id="local-6989586621679267722"><span class="annot"><span class="annottext">keysLists :: [[KeyHash 'Witness (Crypto era)]]
</span><a href="#local-6989586621679267722"><span class="hs-identifier hs-var hs-var">keysLists</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MultiSig era -&gt; [KeyHash 'Witness (Crypto era)])
-&gt; [MultiSig era] -&gt; [[KeyHash 'Witness (Crypto era)]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">MultiSig era -&gt; [KeyHash 'Witness (Crypto era)]
forall era.
Era era =&gt;
MultiSig era -&gt; [KeyHash 'Witness (Crypto era)]
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">getKeyCombination</span></a></span><span> </span><span class="annot"><span class="annottext">([MultiSig era] -&gt; [[KeyHash 'Witness (Crypto era)]])
-&gt; [MultiSig era] -&gt; [[KeyHash 'Witness (Crypto era)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era) -&gt; [MultiSig era]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era)
</span><a href="#local-6989586621679267739"><span class="hs-identifier hs-var">msigs</span></a></span><span>
</span><span id="line-532"></span><span>      </span><span id="local-6989586621679267731"><span class="annot"><span class="annottext">msigSignatures :: Set (KeyHash 'Witness (Crypto era))
</span><a href="#local-6989586621679267731"><span class="hs-identifier hs-var hs-var">msigSignatures</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set (KeyHash 'Witness (Crypto era))
 -&gt; Set (KeyHash 'Witness (Crypto era))
 -&gt; Set (KeyHash 'Witness (Crypto era)))
-&gt; Set (KeyHash 'Witness (Crypto era))
-&gt; [Set (KeyHash 'Witness (Crypto era))]
-&gt; Set (KeyHash 'Witness (Crypto era))
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness (Crypto era))
-&gt; Set (KeyHash 'Witness (Crypto era))
-&gt; Set (KeyHash 'Witness (Crypto era))
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness (Crypto era))
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span> </span><span class="annot"><span class="annottext">([Set (KeyHash 'Witness (Crypto era))]
 -&gt; Set (KeyHash 'Witness (Crypto era)))
-&gt; [Set (KeyHash 'Witness (Crypto era))]
-&gt; Set (KeyHash 'Witness (Crypto era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([KeyHash 'Witness (Crypto era)]
 -&gt; Set (KeyHash 'Witness (Crypto era)))
-&gt; [[KeyHash 'Witness (Crypto era)]]
-&gt; [Set (KeyHash 'Witness (Crypto era))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[KeyHash 'Witness (Crypto era)]
-&gt; Set (KeyHash 'Witness (Crypto era))
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[[KeyHash 'Witness (Crypto era)]]
</span><a href="#local-6989586621679267722"><span class="hs-identifier hs-var">keysLists</span></a></span><span>
</span><span id="line-533"></span><span>
</span><span id="line-534"></span><span class="hs-comment">-- | Generate a transaction body with the given inputs/outputs and certificates</span><span>
</span><span id="line-535"></span><span id="local-6989586621679268183"><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genTxBody"><span class="hs-identifier hs-type">genTxBody</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-536"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html#ShelleyTest"><span class="hs-identifier hs-type">ShelleyTest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268183"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-537"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">TxIn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268183"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-538"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src"><span class="hs-identifier hs-type">StrictSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268183"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-539"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src"><span class="hs-identifier hs-type">StrictSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">DCert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268183"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-540"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">RewardAcnt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268183"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-541"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Update</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268183"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-542"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-543"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-544"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">StrictMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MetaDataHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268183"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-545"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268183"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-546"></span><span id="genTxBody"><span class="annot"><span class="annottext">genTxBody :: [TxIn era]
-&gt; StrictSeq (TxOut era)
-&gt; StrictSeq (DCert era)
-&gt; [(RewardAcnt era, Coin)]
-&gt; Maybe (Update era)
-&gt; Coin
-&gt; SlotNo
-&gt; StrictMaybe (MetaDataHash era)
-&gt; Gen (TxBody era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genTxBody"><span class="hs-identifier hs-var hs-var">genTxBody</span></a></span></span><span> </span><span id="local-6989586621679267719"><span class="annot"><span class="annottext">[TxIn era]
</span><a href="#local-6989586621679267719"><span class="hs-identifier hs-var">inputs</span></a></span></span><span> </span><span id="local-6989586621679267718"><span class="annot"><span class="annottext">StrictSeq (TxOut era)
</span><a href="#local-6989586621679267718"><span class="hs-identifier hs-var">outputs</span></a></span></span><span> </span><span id="local-6989586621679267717"><span class="annot"><span class="annottext">StrictSeq (DCert era)
</span><a href="#local-6989586621679267717"><span class="hs-identifier hs-var">certs</span></a></span></span><span> </span><span id="local-6989586621679267716"><span class="annot"><span class="annottext">[(RewardAcnt era, Coin)]
</span><a href="#local-6989586621679267716"><span class="hs-identifier hs-var">wdrls</span></a></span></span><span> </span><span id="local-6989586621679267715"><span class="annot"><span class="annottext">Maybe (Update era)
</span><a href="#local-6989586621679267715"><span class="hs-identifier hs-var">update</span></a></span></span><span> </span><span id="local-6989586621679267714"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267714"><span class="hs-identifier hs-var">fee</span></a></span></span><span> </span><span id="local-6989586621679267713"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679267713"><span class="hs-identifier hs-var">slotWithTTL</span></a></span></span><span> </span><span id="local-6989586621679267712"><span class="annot"><span class="annottext">StrictMaybe (MetaDataHash era)
</span><a href="#local-6989586621679267712"><span class="hs-identifier hs-var">mdHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-547"></span><span>  </span><span class="annot"><span class="annottext">TxBody era -&gt; Gen (TxBody era)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Gen (TxBody era)) -&gt; TxBody era -&gt; Gen (TxBody era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-548"></span><span>    </span><span class="annot"><span class="annottext">Set (TxIn era)
-&gt; StrictSeq (TxOut era)
-&gt; StrictSeq (DCert era)
-&gt; Wdrl era
-&gt; Coin
-&gt; SlotNo
-&gt; StrictMaybe (Update era)
-&gt; StrictMaybe (MetaDataHash era)
-&gt; TxBody era
forall era.
ShelleyBased era =&gt;
Set (TxIn era)
-&gt; StrictSeq (TxOut era)
-&gt; StrictSeq (DCert era)
-&gt; Wdrl era
-&gt; Coin
-&gt; SlotNo
-&gt; StrictMaybe (Update era)
-&gt; StrictMaybe (MetaDataHash era)
-&gt; TxBody era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">TxBody</span></a></span><span>
</span><span id="line-549"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TxIn era] -&gt; Set (TxIn era)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[TxIn era]
</span><a href="#local-6989586621679267719"><span class="hs-identifier hs-var">inputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-550"></span><span>      </span><span class="annot"><span class="annottext">StrictSeq (TxOut era)
</span><a href="#local-6989586621679267718"><span class="hs-identifier hs-var">outputs</span></a></span><span>
</span><span id="line-551"></span><span>      </span><span class="annot"><span class="annottext">StrictSeq (DCert era)
</span><a href="#local-6989586621679267717"><span class="hs-identifier hs-var">certs</span></a></span><span>
</span><span id="line-552"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (RewardAcnt era) Coin -&gt; Wdrl era
forall era. Map (RewardAcnt era) Coin -&gt; Wdrl era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">Wdrl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(RewardAcnt era, Coin)] -&gt; Map (RewardAcnt era) Coin
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(RewardAcnt era, Coin)]
</span><a href="#local-6989586621679267716"><span class="hs-identifier hs-var">wdrls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>      </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267714"><span class="hs-identifier hs-var">fee</span></a></span><span>
</span><span id="line-554"></span><span>      </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679267713"><span class="hs-identifier hs-var">slotWithTTL</span></a></span><span>
</span><span id="line-555"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Update era) -&gt; StrictMaybe (Update era)
forall a. Maybe a -&gt; StrictMaybe a
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">maybeToStrictMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Update era)
</span><a href="#local-6989586621679267715"><span class="hs-identifier hs-var">update</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>      </span><span class="annot"><span class="annottext">StrictMaybe (MetaDataHash era)
</span><a href="#local-6989586621679267712"><span class="hs-identifier hs-var">mdHash</span></a></span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="hs-comment">-- | Distribute the sum of `balance_` and `fee` over the addresses, return the</span><span>
</span><span id="line-559"></span><span class="hs-comment">-- sum of `fee` and the remainder of the equal distribution and the list ouf</span><span>
</span><span id="line-560"></span><span class="hs-comment">-- transaction outputs that cover the balance and fees.</span><span>
</span><span id="line-561"></span><span class="hs-comment">--</span><span>
</span><span id="line-562"></span><span class="hs-comment">-- The idea is to have an specified spending balance and fees that must be paid</span><span>
</span><span id="line-563"></span><span class="hs-comment">-- by the selected addresses.</span><span>
</span><span id="line-564"></span><span class="hs-comment">-- TODO need right splitting of v!</span><span>
</span><span id="line-565"></span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#calcOutputsFromBalance"><span class="hs-identifier hs-type">calcOutputsFromBalance</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-566"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679268184"><span class="annot"><a href="#local-6989586621679268184"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-567"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html#ShelleyTest"><span class="hs-identifier hs-type">ShelleyTest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268184"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-568"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Core.Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268184"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-569"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Addr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268184"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-570"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-571"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src"><span class="hs-identifier hs-type">StrictSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268184"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span id="calcOutputsFromBalance"><span class="annot"><span class="annottext">calcOutputsFromBalance :: Value era -&gt; [Addr era] -&gt; Coin -&gt; (Coin, StrictSeq (TxOut era))
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#calcOutputsFromBalance"><span class="hs-identifier hs-var hs-var">calcOutputsFromBalance</span></a></span></span><span> </span><span id="local-6989586621679267710"><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679267710"><span class="hs-identifier hs-var">balance_</span></a></span></span><span> </span><span id="local-6989586621679267709"><span class="annot"><span class="annottext">[Addr era]
</span><a href="#local-6989586621679267709"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span id="local-6989586621679267708"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267708"><span class="hs-identifier hs-var">fee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-573"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267708"><span class="hs-identifier hs-var">fee</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267707"><span class="hs-identifier hs-var">splitCoinRem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-574"></span><span>    </span><span class="annot"><span class="annottext">[TxOut era] -&gt; StrictSeq (TxOut era)
forall a. [a] -&gt; StrictSeq a
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src"><span class="hs-identifier hs-var">StrictSeq.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([TxOut era] -&gt; StrictSeq (TxOut era))
-&gt; [TxOut era] -&gt; StrictSeq (TxOut era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Addr era -&gt; Value era -&gt; TxOut era)
-&gt; [Addr era] -&gt; [Value era] -&gt; [TxOut era]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Addr era -&gt; Value era -&gt; TxOut era
forall era. ShelleyBased era =&gt; Addr era -&gt; Value era -&gt; TxOut era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">TxOut</span></a></span><span> </span><span class="annot"><span class="annottext">[Addr era]
</span><a href="#local-6989586621679267709"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[Value era]
</span><a href="#local-6989586621679267704"><span class="hs-identifier hs-var">amountPerOutput</span></a></span><span>
</span><span id="line-575"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-577"></span><span>    </span><span class="hs-comment">-- split the available balance into equal portions (one for each address),</span><span>
</span><span id="line-578"></span><span>    </span><span class="hs-comment">-- if there is a remainder, then add it to the fee.</span><span>
</span><span id="line-579"></span><span>    </span><span id="local-6989586621679267703"><span class="annot"><span class="annottext">balanceAfterFee :: Value era
</span><a href="#local-6989586621679267703"><span class="hs-identifier hs-var hs-var">balanceAfterFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679267710"><span class="hs-identifier hs-var">balance_</span></a></span><span> </span><span class="annot"><span class="annottext">Value era -&gt; Value era -&gt; Value era
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-operator hs-var">&lt;-&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Value era
forall t. Val t =&gt; Coin -&gt; t
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267708"><span class="hs-identifier hs-var">fee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679267704"><span class="annot"><span class="annottext">[Value era]
</span><a href="#local-6989586621679267704"><span class="hs-identifier hs-var">amountPerOutput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267707"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679267707"><span class="hs-identifier hs-var">splitCoinRem</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value era -&gt; Integer -&gt; ([Value era], Coin)
forall v. Split v =&gt; v -&gt; Integer -&gt; ([v], Coin)
</span><a href="Test.Shelley.Spec.Ledger.Utils.html#vsplit"><span class="hs-identifier hs-var">vsplit</span></a></span><span> </span><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679267703"><span class="hs-identifier hs-var">balanceAfterFee</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Integer) -&gt; Int -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Addr era] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Addr era]
</span><a href="#local-6989586621679267709"><span class="hs-identifier hs-var">addrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>
</span><span id="line-582"></span><span class="hs-comment">-- | Select unspent output(s) to serve as inputs for a new transaction</span><span>
</span><span id="line-583"></span><span class="hs-comment">--</span><span>
</span><span id="line-584"></span><span class="hs-comment">-- Returns the inputs, paired with the KeyPair or multi-sig script required to</span><span>
</span><span id="line-585"></span><span class="hs-comment">-- witness the spending of the input.</span><span>
</span><span id="line-586"></span><span class="hs-comment">-- Also returns the total spendable balance.</span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span class="hs-comment">-- NOTE: this function needs access to the keys and multi-sig scripts that the</span><span>
</span><span id="line-589"></span><span class="hs-comment">-- given UTxO originated from (in order to produce the appropriate witnesses to</span><span>
</span><span id="line-590"></span><span class="hs-comment">-- spend these outputs). If this is not the case, `findPayKeyPairAddr` /</span><span>
</span><span id="line-591"></span><span class="hs-comment">-- `findPayScriptFromAddr` will fail by not finding the matching keys or scripts.</span><span>
</span><span id="line-592"></span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genInputs"><span class="hs-identifier hs-type">genInputs</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-593"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679268242"><span class="annot"><a href="#local-6989586621679268242"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-594"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html#ShelleyTest"><span class="hs-identifier hs-type">ShelleyTest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268242"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-595"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-596"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268242"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268242"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-597"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268242"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268242"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268242"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-598"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268242"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-599"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">TxIn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268242"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Core.Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268242"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Witness</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268242"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268242"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268242"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span id="genInputs"><span class="annot"><span class="annottext">genInputs :: (Int, Int)
-&gt; Map
     (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; Map (ScriptHash era) (MultiSig era, MultiSig era)
-&gt; UTxO era
-&gt; Gen
     ([TxIn era], Value era,
      ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genInputs"><span class="hs-identifier hs-var hs-var">genInputs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679267701"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267701"><span class="hs-identifier hs-var">minNumGenInputs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267700"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267700"><span class="hs-identifier hs-var">maxNumGenInputs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679267699"><span class="annot"><span class="annottext">Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
</span><a href="#local-6989586621679267699"><span class="hs-identifier hs-var">keyHashMap</span></a></span></span><span> </span><span id="local-6989586621679267698"><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era, MultiSig era)
</span><a href="#local-6989586621679267698"><span class="hs-identifier hs-var">payScriptMap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span id="local-6989586621679267697"><span class="annot"><span class="annottext">Map (TxIn era) (TxOut era)
</span><a href="#local-6989586621679267697"><span class="hs-identifier hs-var">utxo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-601"></span><span>  </span><span id="local-6989586621679267696"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267696"><span class="hs-identifier hs-var">numInputs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Gen Int
forall a. Random a =&gt; (a, a) -&gt; Gen a
</span><span class="hs-identifier hs-var">QC.choose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267701"><span class="hs-identifier hs-var">minNumGenInputs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267700"><span class="hs-identifier hs-var">maxNumGenInputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-602"></span><span>  </span><span id="local-6989586621679267695"><span class="annot"><span class="annottext">[(TxIn era, TxOut era)]
</span><a href="#local-6989586621679267695"><span class="hs-identifier hs-var">selectedUtxo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(TxIn era, TxOut era)] -&gt; Gen [(TxIn era, TxOut era)]
forall a. Int -&gt; [a] -&gt; Gen [a]
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#ruffle"><span class="hs-identifier hs-var">ruffle</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267696"><span class="hs-identifier hs-var">numInputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (TxIn era) (TxOut era) -&gt; [(TxIn era, TxOut era)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map (TxIn era) (TxOut era)
</span><a href="#local-6989586621679267697"><span class="hs-identifier hs-var">utxo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679267693"><span class="annot"><span class="annottext">[TxIn era]
</span><a href="#local-6989586621679267693"><span class="hs-identifier hs-var">inputs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267692"><span class="annot"><span class="annottext">[Either
   (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)]
</span><a href="#local-6989586621679267692"><span class="hs-identifier hs-var">witnesses</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TxIn era,
  Either
    (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era))]
-&gt; ([TxIn era],
    [Either
       (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxIn era, TxOut era)
-&gt; (TxIn era,
    Either
      (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era))
</span><a href="#local-6989586621679267690"><span class="hs-identifier hs-var">witnessedInput</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn era, TxOut era)
 -&gt; (TxIn era,
     Either
       (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)))
-&gt; [(TxIn era, TxOut era)]
-&gt; [(TxIn era,
     Either
       (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era))]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(TxIn era, TxOut era)]
</span><a href="#local-6989586621679267695"><span class="hs-identifier hs-var">selectedUtxo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-605"></span><span>  </span><span class="annot"><span class="annottext">([TxIn era], Value era,
 ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
-&gt; Gen
     ([TxIn era], Value era,
      ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-606"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[TxIn era]
</span><a href="#local-6989586621679267693"><span class="hs-identifier hs-var">inputs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-607"></span><span>      </span><span class="annot"><span class="annottext">UTxO era -&gt; Value era
forall era. ShelleyBased era =&gt; UTxO era -&gt; Value era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">balance</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (TxIn era) (TxOut era) -&gt; UTxO era
forall era. Map (TxIn era) (TxOut era) -&gt; UTxO era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">UTxO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(TxIn era, TxOut era)] -&gt; Map (TxIn era) (TxOut era)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(TxIn era, TxOut era)]
</span><a href="#local-6989586621679267695"><span class="hs-identifier hs-var">selectedUtxo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-608"></span><span>      </span><span class="annot"><span class="annottext">[Either
   (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)]
-&gt; ([KeyPair 'Witness (Crypto era)],
    [(MultiSig era, MultiSig era)])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">Either.partitionEithers</span></span><span> </span><span class="annot"><span class="annottext">[Either
   (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)]
</span><a href="#local-6989586621679267692"><span class="hs-identifier hs-var">witnesses</span></a></span><span>
</span><span id="line-609"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-611"></span><span>    </span><span id="local-6989586621679267690"><span class="annot"><span class="annottext">witnessedInput :: (TxIn era, TxOut era)
-&gt; (TxIn era,
    Either
      (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era))
</span><a href="#local-6989586621679267690"><span class="hs-identifier hs-var hs-var">witnessedInput</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679267689"><span class="annot"><span class="annottext">TxIn era
</span><a href="#local-6989586621679267689"><span class="hs-identifier hs-var">input</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span id="local-6989586621679267688"><span class="annot"><span class="annottext">addr :: Addr era
</span><a href="#local-6989586621679267688"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Addr</span></a></span><span> </span><span class="annot"><span class="annottext">Network
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyHashObj</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'Payment (Crypto era)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StakeReference era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-612"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn era
</span><a href="#local-6989586621679267689"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">KeyPair 'Witness (Crypto era)
-&gt; Either
     (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(KeyPair 'Witness (Crypto era)
 -&gt; Either
      (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era))
-&gt; (KeyPair 'Payment (Crypto era) -&gt; KeyPair 'Witness (Crypto era))
-&gt; KeyPair 'Payment (Crypto era)
-&gt; Either
     (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">KeyPair 'Payment (Crypto era) -&gt; KeyPair 'Witness (Crypto era)
forall (a :: KeyRole -&gt; * -&gt; *) (r :: KeyRole) crypto.
HasKeyRole a =&gt;
a r crypto -&gt; a 'Witness crypto
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">asWitness</span></a></span><span> </span><span class="annot"><span class="annottext">(KeyPair 'Payment (Crypto era)
 -&gt; Either
      (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era))
-&gt; KeyPair 'Payment (Crypto era)
-&gt; Either
     (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Addr era
-&gt; Map
     (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; KeyPair 'Payment (Crypto era)
forall era.
Addr era
-&gt; Map
     (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
-&gt; KeyPair 'Payment (Crypto era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#findPayKeyPairAddr"><span class="hs-identifier hs-var">findPayKeyPairAddr</span></a></span><span> </span><span class="annot"><span class="annottext">Addr era
</span><a href="#local-6989586621679267688"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Payment (Crypto era)) (KeyPair 'Payment (Crypto era))
</span><a href="#local-6989586621679267699"><span class="hs-identifier hs-var">keyHashMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-613"></span><span>    </span><span class="annot"><a href="#local-6989586621679267690"><span class="hs-identifier hs-var">witnessedInput</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679267685"><span class="annot"><span class="annottext">TxIn era
</span><a href="#local-6989586621679267685"><span class="hs-identifier hs-var">input</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span id="local-6989586621679267684"><span class="annot"><span class="annottext">addr :: Addr era
</span><a href="#local-6989586621679267684"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Addr</span></a></span><span> </span><span class="annot"><span class="annottext">Network
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">ScriptHashObj</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StakeReference era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-614"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn era
</span><a href="#local-6989586621679267685"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(MultiSig era, MultiSig era)
-&gt; Either
     (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">((MultiSig era, MultiSig era)
 -&gt; Either
      (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era))
-&gt; (MultiSig era, MultiSig era)
-&gt; Either
     (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Addr era
-&gt; Map (ScriptHash era) (MultiSig era, MultiSig era)
-&gt; (MultiSig era, MultiSig era)
forall era.
Addr era
-&gt; Map (ScriptHash era) (MultiSig era, MultiSig era)
-&gt; (MultiSig era, MultiSig era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#findPayScriptFromAddr"><span class="hs-identifier hs-var">findPayScriptFromAddr</span></a></span><span> </span><span class="annot"><span class="annottext">Addr era
</span><a href="#local-6989586621679267684"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era, MultiSig era)
</span><a href="#local-6989586621679267698"><span class="hs-identifier hs-var">payScriptMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-615"></span><span>    </span><span class="annot"><a href="#local-6989586621679267690"><span class="hs-identifier hs-var">witnessedInput</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn era, TxOut era)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (TxIn era,
    Either
      (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era))
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsupported address&quot;</span></span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span class="hs-comment">-- | Select a subset of the reward accounts to use for reward withdrawals.</span><span>
</span><span id="line-618"></span><span id="local-6989586621679268238"><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genWithdrawals"><span class="hs-identifier hs-type">genWithdrawals</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-619"></span><span>  </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Constants.html#Constants"><span class="hs-identifier hs-type">Constants</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-620"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268238"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268238"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268238"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-621"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268238"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268238"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-622"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268238"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-623"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span>
</span><span id="line-624"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">RewardAcnt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268238"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-625"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Witness</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268238"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268238"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268238"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>    </span><span class="hs-special">)</span></span><span>
</span><span id="line-627"></span><span id="genWithdrawals"><span class="annot"><span class="annottext">genWithdrawals :: Constants
-&gt; Map (ScriptHash era) (MultiSig era, MultiSig era)
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; Map (Credential 'Staking era) Coin
-&gt; Gen
     ([(RewardAcnt era, Coin)],
      ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genWithdrawals"><span class="hs-identifier hs-var hs-var">genWithdrawals</span></a></span></span><span>
</span><span id="line-628"></span><span>  </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Constants.html#Constants"><span class="hs-identifier hs-type">Constants</span></a></span><span>
</span><span id="line-629"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679267681"><span class="annot"><span class="annottext">Int
frequencyNoWithdrawals :: Constants -&gt; Int
frequencyNoWithdrawals :: Int
</span><a href="Test.Shelley.Spec.Ledger.Generator.Constants.html#frequencyNoWithdrawals"><span class="hs-identifier hs-var hs-var">frequencyNoWithdrawals</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-630"></span><span>      </span><span id="local-6989586621679267679"><span class="annot"><span class="annottext">Int
frequencyAFewWithdrawals :: Constants -&gt; Int
frequencyAFewWithdrawals :: Int
</span><a href="Test.Shelley.Spec.Ledger.Generator.Constants.html#frequencyAFewWithdrawals"><span class="hs-identifier hs-var hs-var">frequencyAFewWithdrawals</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-631"></span><span>      </span><span id="local-6989586621679267677"><span class="annot"><span class="annottext">Int
frequencyPotentiallyManyWithdrawals :: Constants -&gt; Int
frequencyPotentiallyManyWithdrawals :: Int
</span><a href="Test.Shelley.Spec.Ledger.Generator.Constants.html#frequencyPotentiallyManyWithdrawals"><span class="hs-identifier hs-var hs-var">frequencyPotentiallyManyWithdrawals</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-632"></span><span>      </span><span id="local-6989586621679267675"><span class="annot"><span class="annottext">Int
maxAFewWithdrawals :: Constants -&gt; Int
maxAFewWithdrawals :: Int
</span><a href="Test.Shelley.Spec.Ledger.Generator.Constants.html#maxAFewWithdrawals"><span class="hs-identifier hs-var hs-var">maxAFewWithdrawals</span></a></span></span><span>
</span><span id="line-633"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-634"></span><span>  </span><span id="local-6989586621679267673"><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era, MultiSig era)
</span><a href="#local-6989586621679267673"><span class="hs-identifier hs-var">ksIndexedStakeScripts</span></a></span></span><span>
</span><span id="line-635"></span><span>  </span><span id="local-6989586621679267672"><span class="annot"><span class="annottext">Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
</span><a href="#local-6989586621679267672"><span class="hs-identifier hs-var">ksIndexedStakingKeys</span></a></span></span><span>
</span><span id="line-636"></span><span>  </span><span id="local-6989586621679267671"><span class="annot"><span class="annottext">Map (Credential 'Staking era) Coin
</span><a href="#local-6989586621679267671"><span class="hs-identifier hs-var">wdrls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-637"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679267670"><span class="annot"><span class="annottext">[(RewardAcnt era, Coin)]
</span><a href="#local-6989586621679267670"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267669"><span class="annot"><span class="annottext">([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)])
</span><a href="#local-6989586621679267669"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-638"></span><span>      </span><span class="annot"><span class="annottext">[(Int,
  Gen
    ([(RewardAcnt era, Coin)],
     ([KeyPair 'Witness (Crypto era)],
      [(MultiSig era, MultiSig era)])))]
-&gt; Gen
     ([(RewardAcnt era, Coin)],
      ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
forall a. [(Int, Gen a)] -&gt; Gen a
</span><span class="hs-identifier hs-var">QC.frequency</span></span><span>
</span><span id="line-639"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267681"><span class="hs-identifier hs-var">frequencyNoWithdrawals</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-640"></span><span>            </span><span class="annot"><span class="annottext">([(RewardAcnt era, Coin)],
 ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
-&gt; Gen
     ([(RewardAcnt era, Coin)],
      ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-641"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-642"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267679"><span class="hs-identifier hs-var">frequencyAFewWithdrawals</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-643"></span><span>            </span><span class="annot"><span class="annottext">[(Credential 'Staking era, Coin)]
-&gt; Gen
     ([(RewardAcnt era, Coin)],
      ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
</span><a href="#local-6989586621679267667"><span class="hs-identifier hs-var">genWrdls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
-&gt; [(Credential 'Staking era, Coin)]
-&gt; [(Credential 'Staking era, Coin)]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267675"><span class="hs-identifier hs-var">maxAFewWithdrawals</span></a></span><span> </span><span class="annot"><span class="annottext">([(Credential 'Staking era, Coin)]
 -&gt; [(Credential 'Staking era, Coin)])
-&gt; (Map (Credential 'Staking era) Coin
    -&gt; [(Credential 'Staking era, Coin)])
-&gt; Map (Credential 'Staking era) Coin
-&gt; [(Credential 'Staking era, Coin)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'Staking era) Coin
-&gt; [(Credential 'Staking era, Coin)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map (Credential 'Staking era) Coin
 -&gt; [(Credential 'Staking era, Coin)])
-&gt; Map (Credential 'Staking era) Coin
-&gt; [(Credential 'Staking era, Coin)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'Staking era) Coin
</span><a href="#local-6989586621679267671"><span class="hs-identifier hs-var">wdrls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-645"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267677"><span class="hs-identifier hs-var">frequencyPotentiallyManyWithdrawals</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-646"></span><span>            </span><span class="annot"><span class="annottext">[(Credential 'Staking era, Coin)]
-&gt; Gen
     ([(RewardAcnt era, Coin)],
      ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
</span><a href="#local-6989586621679267667"><span class="hs-identifier hs-var">genWrdls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (Credential 'Staking era) Coin
-&gt; [(Credential 'Staking era, Coin)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'Staking era) Coin
</span><a href="#local-6989586621679267671"><span class="hs-identifier hs-var">wdrls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-649"></span><span>    </span><span class="annot"><span class="annottext">([(RewardAcnt era, Coin)],
 ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
-&gt; Gen
     ([(RewardAcnt era, Coin)],
      ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(RewardAcnt era, Coin)]
</span><a href="#local-6989586621679267670"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)])
</span><a href="#local-6989586621679267669"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-650"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-651"></span><span>      </span><span id="local-6989586621679267665"><span class="annot"><span class="annottext">toRewardAcnt :: (Credential 'Staking era, b) -&gt; (RewardAcnt era, b)
</span><a href="#local-6989586621679267665"><span class="hs-identifier hs-var hs-var">toRewardAcnt</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679267664"><span class="annot"><span class="annottext">Credential 'Staking era
</span><a href="#local-6989586621679267664"><span class="hs-identifier hs-var">rwd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679267663"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679267663"><span class="hs-identifier hs-var">coinx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Network -&gt; Credential 'Staking era -&gt; RewardAcnt era
forall era. Network -&gt; Credential 'Staking era -&gt; RewardAcnt era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">RewardAcnt</span></a></span><span> </span><span class="annot"><span class="annottext">Network
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">Testnet</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking era
</span><a href="#local-6989586621679267664"><span class="hs-identifier hs-var">rwd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679267663"><span class="hs-identifier hs-var">coinx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span>      </span><span id="local-6989586621679267667"><span class="annot"><span class="annottext">genWrdls :: [(Credential 'Staking era, Coin)]
-&gt; Gen
     ([(RewardAcnt era, Coin)],
      ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
</span><a href="#local-6989586621679267667"><span class="hs-identifier hs-var hs-var">genWrdls</span></a></span></span><span> </span><span id="local-6989586621679267660"><span class="annot"><span class="annottext">[(Credential 'Staking era, Coin)]
</span><a href="#local-6989586621679267660"><span class="hs-identifier hs-var">wdrls_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-653"></span><span>        </span><span id="local-6989586621679267659"><span class="annot"><span class="annottext">[(RewardAcnt era, Coin)]
</span><a href="#local-6989586621679267659"><span class="hs-identifier hs-var">selectedWrdls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Credential 'Staking era, Coin) -&gt; (RewardAcnt era, Coin))
-&gt; [(Credential 'Staking era, Coin)] -&gt; [(RewardAcnt era, Coin)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Credential 'Staking era, Coin) -&gt; (RewardAcnt era, Coin)
forall era b. (Credential 'Staking era, b) -&gt; (RewardAcnt era, b)
</span><a href="#local-6989586621679267665"><span class="hs-identifier hs-var">toRewardAcnt</span></a></span><span> </span><span class="annot"><span class="annottext">([(Credential 'Staking era, Coin)] -&gt; [(RewardAcnt era, Coin)])
-&gt; Gen [(Credential 'Staking era, Coin)]
-&gt; Gen [(RewardAcnt era, Coin)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Credential 'Staking era, Coin)]
-&gt; Gen [(Credential 'Staking era, Coin)]
forall a. [a] -&gt; Gen [a]
</span><span class="hs-identifier hs-var">QC.sublistOf</span></span><span> </span><span class="annot"><span class="annottext">[(Credential 'Staking era, Coin)]
</span><a href="#local-6989586621679267660"><span class="hs-identifier hs-var">wdrls_</span></a></span><span>
</span><span id="line-654"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679267657"><span class="annot"><span class="annottext">wits :: [Either
   (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)]
</span><a href="#local-6989586621679267657"><span class="hs-identifier hs-var hs-var">wits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era, MultiSig era)
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; Credential 'Staking era
-&gt; Either
     (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)
forall era.
Map (ScriptHash era) (MultiSig era, MultiSig era)
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; Credential 'Staking era
-&gt; Either
     (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#mkWdrlWits"><span class="hs-identifier hs-var">mkWdrlWits</span></a></span><span> </span><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era, MultiSig era)
</span><a href="#local-6989586621679267673"><span class="hs-identifier hs-var">ksIndexedStakeScripts</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
</span><a href="#local-6989586621679267672"><span class="hs-identifier hs-var">ksIndexedStakingKeys</span></a></span><span> </span><span class="annot"><span class="annottext">(Credential 'Staking era
 -&gt; Either
      (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era))
-&gt; ((RewardAcnt era, Coin) -&gt; Credential 'Staking era)
-&gt; (RewardAcnt era, Coin)
-&gt; Either
     (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RewardAcnt era -&gt; Credential 'Staking era
forall era. RewardAcnt era -&gt; Credential 'Staking era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var hs-var">getRwdCred</span></a></span><span> </span><span class="annot"><span class="annottext">(RewardAcnt era -&gt; Credential 'Staking era)
-&gt; ((RewardAcnt era, Coin) -&gt; RewardAcnt era)
-&gt; (RewardAcnt era, Coin)
-&gt; Credential 'Staking era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(RewardAcnt era, Coin) -&gt; RewardAcnt era
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((RewardAcnt era, Coin)
 -&gt; Either
      (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era))
-&gt; [(RewardAcnt era, Coin)]
-&gt; [Either
      (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(RewardAcnt era, Coin)]
</span><a href="#local-6989586621679267659"><span class="hs-identifier hs-var">selectedWrdls</span></a></span><span>
</span><span id="line-655"></span><span>        </span><span class="annot"><span class="annottext">([(RewardAcnt era, Coin)],
 ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
-&gt; Gen
     ([(RewardAcnt era, Coin)],
      ([KeyPair 'Witness (Crypto era)], [(MultiSig era, MultiSig era)]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(RewardAcnt era, Coin)]
</span><a href="#local-6989586621679267659"><span class="hs-identifier hs-var">selectedWrdls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Either
   (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)]
-&gt; ([KeyPair 'Witness (Crypto era)],
    [(MultiSig era, MultiSig era)])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">Either.partitionEithers</span></span><span> </span><span class="annot"><span class="annottext">[Either
   (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)]
</span><a href="#local-6989586621679267657"><span class="hs-identifier hs-var">wits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>
</span><span id="line-657"></span><span class="hs-comment">-- | Collect witnesses needed for reward withdrawals.</span><span>
</span><span id="line-658"></span><span id="local-6989586621679268044"><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#mkWdrlWits"><span class="hs-identifier hs-type">mkWdrlWits</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-659"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268044"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268044"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268044"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-660"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268044"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268044"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-661"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268044"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-662"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Witness</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268044"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268044"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">MultiSig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268044"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-663"></span><span id="mkWdrlWits"><span class="annot"><span class="annottext">mkWdrlWits :: Map (ScriptHash era) (MultiSig era, MultiSig era)
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; Credential 'Staking era
-&gt; Either
     (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#mkWdrlWits"><span class="hs-identifier hs-var hs-var">mkWdrlWits</span></a></span></span><span> </span><span id="local-6989586621679267654"><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era, MultiSig era)
</span><a href="#local-6989586621679267654"><span class="hs-identifier hs-var">scriptsByStakeHash</span></a></span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679267653"><span class="annot"><span class="annottext">c :: Credential 'Staking era
</span><a href="#local-6989586621679267653"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">ScriptHashObj</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-664"></span><span>  </span><span class="annot"><span class="annottext">(MultiSig era, MultiSig era)
-&gt; Either
     (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">((MultiSig era, MultiSig era)
 -&gt; Either
      (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era))
-&gt; (MultiSig era, MultiSig era)
-&gt; Either
     (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-665"></span><span>    </span><span class="annot"><span class="annottext">Credential 'Witness era
-&gt; Map (ScriptHash era) (MultiSig era, MultiSig era)
-&gt; (MultiSig era, MultiSig era)
forall era.
Credential 'Witness era
-&gt; Map (ScriptHash era) (MultiSig era, MultiSig era)
-&gt; (MultiSig era, MultiSig era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#findStakeScriptFromCred"><span class="hs-identifier hs-var">findStakeScriptFromCred</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Credential 'Staking era -&gt; Credential 'Witness era
forall (a :: KeyRole -&gt; * -&gt; *) (r :: KeyRole) crypto.
HasKeyRole a =&gt;
a r crypto -&gt; a 'Witness crypto
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">asWitness</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking era
</span><a href="#local-6989586621679267653"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era, MultiSig era)
</span><a href="#local-6989586621679267654"><span class="hs-identifier hs-var">scriptsByStakeHash</span></a></span><span>
</span><span id="line-666"></span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#mkWdrlWits"><span class="hs-identifier hs-var">mkWdrlWits</span></a></span><span> </span><span class="annot"><span class="annottext">Map (ScriptHash era) (MultiSig era, MultiSig era)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679267652"><span class="annot"><span class="annottext">Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
</span><a href="#local-6989586621679267652"><span class="hs-identifier hs-var">keyHashMap</span></a></span></span><span> </span><span id="local-6989586621679267651"><span class="annot"><span class="annottext">c :: Credential 'Staking era
</span><a href="#local-6989586621679267651"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyHashObj</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'Staking (Crypto era)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-667"></span><span>  </span><span class="annot"><span class="annottext">KeyPair 'Witness (Crypto era)
-&gt; Either
     (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(KeyPair 'Witness (Crypto era)
 -&gt; Either
      (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era))
-&gt; KeyPair 'Witness (Crypto era)
-&gt; Either
     (KeyPair 'Witness (Crypto era)) (MultiSig era, MultiSig era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-668"></span><span>    </span><span class="annot"><span class="annottext">KeyPair 'Staking (Crypto era) -&gt; KeyPair 'Witness (Crypto era)
forall (a :: KeyRole -&gt; * -&gt; *) (r :: KeyRole) crypto.
HasKeyRole a =&gt;
a r crypto -&gt; a 'Witness crypto
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">asWitness</span></a></span><span> </span><span class="annot"><span class="annottext">(KeyPair 'Staking (Crypto era) -&gt; KeyPair 'Witness (Crypto era))
-&gt; KeyPair 'Staking (Crypto era) -&gt; KeyPair 'Witness (Crypto era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-669"></span><span>      </span><span class="annot"><span class="annottext">Credential 'Staking era
-&gt; Map
     (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
-&gt; KeyPair 'Staking (Crypto era)
forall (kr :: KeyRole) era.
Credential kr era
-&gt; Map (KeyHash kr (Crypto era)) (KeyPair kr (Crypto era))
-&gt; KeyPair kr (Crypto era)
</span><a href="Test.Shelley.Spec.Ledger.Generator.Core.html#findPayKeyPairCred"><span class="hs-identifier hs-var">findPayKeyPairCred</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking era
</span><a href="#local-6989586621679267651"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Staking (Crypto era)) (KeyPair 'Staking (Crypto era))
</span><a href="#local-6989586621679267652"><span class="hs-identifier hs-var">keyHashMap</span></a></span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span class="hs-comment">-- | Select recipient addresses that will serve as output targets for a new transaction.</span><span>
</span><span id="line-672"></span><span id="local-6989586621679268192"><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genRecipients"><span class="hs-identifier hs-type">genRecipients</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-673"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268192"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-674"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-675"></span><span>  </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">KeyPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268192"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-676"></span><span>  </span><span class="annot"><a href="Test.Shelley.Spec.Ledger.Utils.html#MultiSigPairs"><span class="hs-identifier hs-type">MultiSigPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268192"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-677"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Addr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268192"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-678"></span><span id="genRecipients"><span class="annot"><span class="annottext">genRecipients :: Int -&gt; KeyPairs (Crypto era) -&gt; MultiSigPairs era -&gt; Gen [Addr era]
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genRecipients"><span class="hs-identifier hs-var hs-var">genRecipients</span></a></span></span><span> </span><span id="local-6989586621679267650"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267650"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span id="local-6989586621679267649"><span class="annot"><span class="annottext">KeyPairs (Crypto era)
</span><a href="#local-6989586621679267649"><span class="hs-identifier hs-var">keys</span></a></span></span><span> </span><span id="local-6989586621679267648"><span class="annot"><span class="annottext">MultiSigPairs era
</span><a href="#local-6989586621679267648"><span class="hs-identifier hs-var">scripts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-679"></span><span>  </span><span id="local-6989586621679267647"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267647"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-680"></span><span>    </span><span class="annot"><span class="annottext">[(Int, Gen Int)] -&gt; Gen Int
forall a. [(Int, Gen a)] -&gt; Gen a
</span><span class="hs-identifier hs-var">QC.frequency</span></span><span>
</span><span id="line-681"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267650"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Gen Int
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267650"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-682"></span><span>          </span><span class="hs-comment">-- contract size of UTxO (only if at least 2 inputs are chosen)</span><span>
</span><span id="line-683"></span><span>          </span><span class="annot"><span class="annottext">[(Int, Gen Int)] -&gt; [(Int, Gen Int)] -&gt; [(Int, Gen Int)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Gen Int
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267650"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-684"></span><span>          </span><span class="hs-comment">-- keep size</span><span>
</span><span id="line-685"></span><span>          </span><span class="annot"><span class="annottext">[(Int, Gen Int)] -&gt; [(Int, Gen Int)] -&gt; [(Int, Gen Int)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Gen Int
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Gen Int) -&gt; Int -&gt; Gen Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267650"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-686"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span>  </span><span class="hs-comment">-- expand size of UTxO</span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span>  </span><span class="hs-comment">-- choose m scripts and n keys as recipients</span><span>
</span><span id="line-690"></span><span>  </span><span id="local-6989586621679267645"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267645"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Gen Int
forall a. Random a =&gt; (a, a) -&gt; Gen a
</span><span class="hs-identifier hs-var">QC.choose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267647"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679267644"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621679267644"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267647"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267645"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-692"></span><span>  </span><span id="local-6989586621679267643"><span class="annot"><span class="annottext">KeyPairs (Crypto era)
</span><a href="#local-6989586621679267643"><span class="hs-identifier hs-var">recipientKeys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; KeyPairs (Crypto era) -&gt; Gen (KeyPairs (Crypto era))
forall a. Int -&gt; [a] -&gt; Gen [a]
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#ruffle"><span class="hs-identifier hs-var">ruffle</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267644"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">KeyPairs (Crypto era)
</span><a href="#local-6989586621679267649"><span class="hs-identifier hs-var">keys</span></a></span><span>
</span><span id="line-693"></span><span>  </span><span id="local-6989586621679267642"><span class="annot"><span class="annottext">MultiSigPairs era
</span><a href="#local-6989586621679267642"><span class="hs-identifier hs-var">recipientScripts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; MultiSigPairs era -&gt; Gen (MultiSigPairs era)
forall a. Int -&gt; [a] -&gt; Gen [a]
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#ruffle"><span class="hs-identifier hs-var">ruffle</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267645"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSigPairs era
</span><a href="#local-6989586621679267648"><span class="hs-identifier hs-var">scripts</span></a></span><span>
</span><span id="line-694"></span><span>
</span><span id="line-695"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679267641"><span class="annot"><span class="annottext">payKeys :: [Credential 'Payment era]
</span><a href="#local-6989586621679267641"><span class="hs-identifier hs-var hs-var">payKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyPair 'Payment (Crypto era) -&gt; Credential 'Payment era
forall era (kr :: KeyRole).
Era era =&gt;
KeyPair kr (Crypto era) -&gt; Credential kr era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">toCred</span></a></span><span> </span><span class="annot"><span class="annottext">(KeyPair 'Payment (Crypto era) -&gt; Credential 'Payment era)
-&gt; ((KeyPair 'Payment (Crypto era), KeyPair 'Staking (Crypto era))
    -&gt; KeyPair 'Payment (Crypto era))
-&gt; (KeyPair 'Payment (Crypto era), KeyPair 'Staking (Crypto era))
-&gt; Credential 'Payment era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(KeyPair 'Payment (Crypto era), KeyPair 'Staking (Crypto era))
-&gt; KeyPair 'Payment (Crypto era)
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((KeyPair 'Payment (Crypto era), KeyPair 'Staking (Crypto era))
 -&gt; Credential 'Payment era)
-&gt; KeyPairs (Crypto era) -&gt; [Credential 'Payment era]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">KeyPairs (Crypto era)
</span><a href="#local-6989586621679267643"><span class="hs-identifier hs-var">recipientKeys</span></a></span><span>
</span><span id="line-696"></span><span>      </span><span id="local-6989586621679267640"><span class="annot"><span class="annottext">stakeKeys :: [Credential 'Staking era]
</span><a href="#local-6989586621679267640"><span class="hs-identifier hs-var hs-var">stakeKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyPair 'Staking (Crypto era) -&gt; Credential 'Staking era
forall era (kr :: KeyRole).
Era era =&gt;
KeyPair kr (Crypto era) -&gt; Credential kr era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">toCred</span></a></span><span> </span><span class="annot"><span class="annottext">(KeyPair 'Staking (Crypto era) -&gt; Credential 'Staking era)
-&gt; ((KeyPair 'Payment (Crypto era), KeyPair 'Staking (Crypto era))
    -&gt; KeyPair 'Staking (Crypto era))
-&gt; (KeyPair 'Payment (Crypto era), KeyPair 'Staking (Crypto era))
-&gt; Credential 'Staking era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(KeyPair 'Payment (Crypto era), KeyPair 'Staking (Crypto era))
-&gt; KeyPair 'Staking (Crypto era)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((KeyPair 'Payment (Crypto era), KeyPair 'Staking (Crypto era))
 -&gt; Credential 'Staking era)
-&gt; KeyPairs (Crypto era) -&gt; [Credential 'Staking era]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">KeyPairs (Crypto era)
</span><a href="#local-6989586621679267643"><span class="hs-identifier hs-var">recipientKeys</span></a></span><span>
</span><span id="line-697"></span><span>      </span><span id="local-6989586621679267639"><span class="annot"><span class="annottext">payScripts :: [Credential 'Payment era]
</span><a href="#local-6989586621679267639"><span class="hs-identifier hs-var hs-var">payScripts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MultiSig era -&gt; Credential 'Payment era
forall era (kr :: KeyRole).
Era era =&gt;
MultiSig era -&gt; Credential kr era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">scriptToCred</span></a></span><span> </span><span class="annot"><span class="annottext">(MultiSig era -&gt; Credential 'Payment era)
-&gt; ((MultiSig era, MultiSig era) -&gt; MultiSig era)
-&gt; (MultiSig era, MultiSig era)
-&gt; Credential 'Payment era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(MultiSig era, MultiSig era) -&gt; MultiSig era
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((MultiSig era, MultiSig era) -&gt; Credential 'Payment era)
-&gt; MultiSigPairs era -&gt; [Credential 'Payment era]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MultiSigPairs era
</span><a href="#local-6989586621679267642"><span class="hs-identifier hs-var">recipientScripts</span></a></span><span>
</span><span id="line-698"></span><span>      </span><span id="local-6989586621679267638"><span class="annot"><span class="annottext">stakeScripts :: [Credential 'Staking era]
</span><a href="#local-6989586621679267638"><span class="hs-identifier hs-var hs-var">stakeScripts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MultiSig era -&gt; Credential 'Staking era
forall era (kr :: KeyRole).
Era era =&gt;
MultiSig era -&gt; Credential kr era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">scriptToCred</span></a></span><span> </span><span class="annot"><span class="annottext">(MultiSig era -&gt; Credential 'Staking era)
-&gt; ((MultiSig era, MultiSig era) -&gt; MultiSig era)
-&gt; (MultiSig era, MultiSig era)
-&gt; Credential 'Staking era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(MultiSig era, MultiSig era) -&gt; MultiSig era
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((MultiSig era, MultiSig era) -&gt; Credential 'Staking era)
-&gt; MultiSigPairs era -&gt; [Credential 'Staking era]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MultiSigPairs era
</span><a href="#local-6989586621679267642"><span class="hs-identifier hs-var">recipientScripts</span></a></span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span>  </span><span class="hs-comment">-- zip keys and scripts together as base addresses</span><span>
</span><span id="line-701"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679267637"><span class="annot"><span class="annottext">payCreds :: [Credential 'Payment era]
</span><a href="#local-6989586621679267637"><span class="hs-identifier hs-var hs-var">payCreds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Credential 'Payment era]
</span><a href="#local-6989586621679267641"><span class="hs-identifier hs-var">payKeys</span></a></span><span> </span><span class="annot"><span class="annottext">[Credential 'Payment era]
-&gt; [Credential 'Payment era] -&gt; [Credential 'Payment era]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Credential 'Payment era]
</span><a href="#local-6989586621679267639"><span class="hs-identifier hs-var">payScripts</span></a></span><span>
</span><span id="line-702"></span><span>      </span><span id="local-6989586621679267636"><span class="annot"><span class="annottext">stakeCreds :: [Credential 'Staking era]
</span><a href="#local-6989586621679267636"><span class="hs-identifier hs-var hs-var">stakeCreds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Credential 'Staking era]
</span><a href="#local-6989586621679267640"><span class="hs-identifier hs-var">stakeKeys</span></a></span><span> </span><span class="annot"><span class="annottext">[Credential 'Staking era]
-&gt; [Credential 'Staking era] -&gt; [Credential 'Staking era]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Credential 'Staking era]
</span><a href="#local-6989586621679267638"><span class="hs-identifier hs-var">stakeScripts</span></a></span><span>
</span><span id="line-703"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679267635"><span class="annot"><span class="annottext">stakeCreds' :: [StakeReference era]
</span><a href="#local-6989586621679267635"><span class="hs-identifier hs-var hs-var">stakeCreds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Credential 'Staking era -&gt; StakeReference era)
-&gt; [Credential 'Staking era] -&gt; [StakeReference era]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking era -&gt; StakeReference era
forall era. StakeCredential era -&gt; StakeReference era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">StakeRefBase</span></a></span><span> </span><span class="annot"><span class="annottext">[Credential 'Staking era]
</span><a href="#local-6989586621679267636"><span class="hs-identifier hs-var">stakeCreds</span></a></span><span>
</span><span id="line-704"></span><span>
</span><span id="line-705"></span><span>  </span><span class="annot"><span class="annottext">[Addr era] -&gt; Gen [Addr era]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Credential 'Payment era -&gt; StakeReference era -&gt; Addr era)
-&gt; [Credential 'Payment era] -&gt; [StakeReference era] -&gt; [Addr era]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Network
-&gt; Credential 'Payment era -&gt; StakeReference era -&gt; Addr era
forall era.
Network -&gt; PaymentCredential era -&gt; StakeReference era -&gt; Addr era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">Addr</span></a></span><span> </span><span class="annot"><span class="annottext">Network
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">Testnet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Credential 'Payment era]
</span><a href="#local-6989586621679267637"><span class="hs-identifier hs-var">payCreds</span></a></span><span> </span><span class="annot"><span class="annottext">[StakeReference era]
</span><a href="#local-6989586621679267635"><span class="hs-identifier hs-var">stakeCreds'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span id="local-6989586621679268185"><span class="annot"><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genPtrAddrs"><span class="hs-identifier hs-type">genPtrAddrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">DState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268185"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Addr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268185"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Addr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679268185"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-708"></span><span id="genPtrAddrs"><span class="annot"><span class="annottext">genPtrAddrs :: DState h -&gt; [Addr h] -&gt; Gen [Addr h]
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#genPtrAddrs"><span class="hs-identifier hs-var hs-var">genPtrAddrs</span></a></span></span><span> </span><span id="local-6989586621679267633"><span class="annot"><span class="annottext">DState h
</span><a href="#local-6989586621679267633"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679267632"><span class="annot"><span class="annottext">[Addr h]
</span><a href="#local-6989586621679267632"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-709"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679267631"><span class="annot"><span class="annottext">pointers :: Map Ptr (Credential 'Staking h)
</span><a href="#local-6989586621679267631"><span class="hs-identifier hs-var hs-var">pointers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BiMap (Credential 'Staking h) Ptr (Credential 'Staking h)
-&gt; Map Ptr (Credential 'Staking h)
forall v k. BiMap v k v -&gt; Map k v
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/small-steps-0.1.0.0/noopt/doc/html/small-steps/src"><span class="hs-identifier hs-var">forwards</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DState h
-&gt; BiMap (Credential 'Staking h) Ptr (Credential 'Staking h)
forall era. DState era -&gt; Bimap Ptr (Credential 'Staking era)
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var hs-var">_ptrs</span></a></span><span> </span><span class="annot"><span class="annottext">DState h
</span><a href="#local-6989586621679267633"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>
</span><span id="line-711"></span><span>  </span><span id="local-6989586621679267630"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267630"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Gen Int
forall a. Random a =&gt; (a, a) -&gt; Gen a
</span><span class="hs-identifier hs-var">QC.choose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Ptr (Credential 'Staking h) -&gt; Int
forall k a. Map k a -&gt; Int
</span><span class="hs-identifier hs-var">Map.size</span></span><span> </span><span class="annot"><span class="annottext">Map Ptr (Credential 'Staking h)
</span><a href="#local-6989586621679267631"><span class="hs-identifier hs-var">pointers</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Addr h] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Addr h]
</span><a href="#local-6989586621679267632"><span class="hs-identifier hs-var">addrs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>  </span><span id="local-6989586621679267628"><span class="annot"><span class="annottext">[Ptr]
</span><a href="#local-6989586621679267628"><span class="hs-identifier hs-var">pointerList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Ptr] -&gt; Gen [Ptr]
forall a. Int -&gt; [a] -&gt; Gen [a]
</span><a href="Test.Shelley.Spec.Ledger.Generator.Utxo.html#ruffle"><span class="hs-identifier hs-var">ruffle</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267630"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Ptr (Credential 'Staking h) -&gt; [Ptr]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">Map Ptr (Credential 'Staking h)
</span><a href="#local-6989586621679267631"><span class="hs-identifier hs-var">pointers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679267626"><span class="annot"><span class="annottext">addrs' :: [Addr h]
</span><a href="#local-6989586621679267626"><span class="hs-identifier hs-var hs-var">addrs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Addr h -&gt; Ptr -&gt; Addr h) -&gt; [Addr h] -&gt; [Ptr] -&gt; [Addr h]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Addr h -&gt; Ptr -&gt; Addr h
forall era. Addr era -&gt; Ptr -&gt; Addr era
</span><a href="#local-6989586621679267625"><span class="hs-identifier hs-var">baseAddrToPtrAddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Addr h] -&gt; [Addr h]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267630"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Addr h]
</span><a href="#local-6989586621679267632"><span class="hs-identifier hs-var">addrs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Ptr]
</span><a href="#local-6989586621679267628"><span class="hs-identifier hs-var">pointerList</span></a></span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span>  </span><span class="annot"><span class="annottext">[Addr h] -&gt; Gen [Addr h]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Addr h]
</span><a href="#local-6989586621679267626"><span class="hs-identifier hs-var">addrs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Addr h] -&gt; [Addr h] -&gt; [Addr h]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Addr h] -&gt; [Addr h]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679267630"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Addr h]
</span><a href="#local-6989586621679267632"><span class="hs-identifier hs-var">addrs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-718"></span><span>    </span><span id="local-6989586621679267625"><span class="annot"><span class="annottext">baseAddrToPtrAddr :: Addr era -&gt; Ptr -&gt; Addr era
</span><a href="#local-6989586621679267625"><span class="hs-identifier hs-var hs-var">baseAddrToPtrAddr</span></a></span></span><span> </span><span id="local-6989586621679267623"><span class="annot"><span class="annottext">Addr era
</span><a href="#local-6989586621679267623"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679267622"><span class="annot"><span class="annottext">Ptr
</span><a href="#local-6989586621679267622"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Addr era
</span><a href="#local-6989586621679267623"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-719"></span><span>      </span><span class="annot"><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-type">Addr</span></a></span><span> </span><span id="local-6989586621679267621"><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621679267621"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679267620"><span class="annot"><span class="annottext">PaymentCredential era
</span><a href="#local-6989586621679267620"><span class="hs-identifier hs-var">pay</span></a></span></span><span> </span><span class="annot"><span class="annottext">StakeReference era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Network -&gt; PaymentCredential era -&gt; StakeReference era -&gt; Addr era
forall era.
Network -&gt; PaymentCredential era -&gt; StakeReference era -&gt; Addr era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">Addr</span></a></span><span> </span><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621679267621"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">PaymentCredential era
</span><a href="#local-6989586621679267620"><span class="hs-identifier hs-var">pay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr -&gt; StakeReference era
forall era. Ptr -&gt; StakeReference era
</span><a href="../file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.2/shelley-spec-ledger-0.1.0.0/noopt/doc/html/shelley-spec-ledger/src"><span class="hs-identifier hs-var">StakeRefPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr
</span><a href="#local-6989586621679267622"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>      </span><span class="annot"><span class="annottext">Addr era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Addr era
</span><a href="#local-6989586621679267623"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-721"></span></pre></body></html>